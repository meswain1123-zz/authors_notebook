(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{137:function(e,t,a){},160:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA9CAYAAAAeYmHpAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAmRSURBVGhD7dpHqC1ZFQbg916bszZiwCyCICqCrag4cKSIIuJE0B4IQjsQDAOH4sDUKGob0BbFnDHQ2tqKiqHNophzzjnn8FzfvvXXW7denXPvfTg794f/VtWuvdZea+20dp178vTp0yd2Daem607h2OldwbHTu4Jjp3cFO+n0kZKTkydPTnf78ILi3Yu/Kz5Qwf874Vm2exj9W2U8HIYNLy7+qPjj4i+Lfy/+p/jP4nuLA2s6zoUNVxSfs3d7sP4Jzy6yd2B+1ytuYsPbi38p/nfiv4oczvNfix8sDqzpOgobvl78U/EPxTcrgANkXl78TfH3xWcpmOt0gSUXuLKoVzkaJ1HFTu/VHVjTexg2fKn45+LfinS73+fEitwri0ajKaf+d4sDo85SKGx4RfELxd8WOU3Jr4qibkjraQKd/yi+r7iq+yA2mEJ0aUfb6PmjxU0ylxXZZ9TFvn8Xv13cQxdcUfDJ4jeLFD2t+JRixxeLoh9nQyNAzzyzuNrGJjZYLxjbSSfuG0kNnytylE2uZDiNgvWp4tkGNViUzKUXjqcJi3reURxHXUPPPysO9Da2ccJPivR2492npz9e7HhJ8ftFvdvXmNynt60LF681CO8vcvjS8VTo9Rb143Qi6j70PHplTX6NEz5W/HXRVOJojI8Dny0GhrrFNQFyTV30HNv+WLxsTk7avvaa4k2LevoiBc2YJZ5XjA4KVNRQoOyO42Z9j9+E+xQ5fl6xC7qnX4/Cp4tyBDYY9gLFsW5w7snSd/4wuBlkLxwJRuFx/mxxGAj2CvT1Z++vXfzEeDiE4629hxT1HBBMW3rsusUfFu9cNNLYfb3izYuvKlrIyApQZOFqxfN6I+8u2tdUNPbHu22cQLkHcsgoz2GGlRG0qmeNEyxm5jC9aUN7etqwZe+85jS51xbVERDtd9uumId34bZF3Q/XKj517/ZAmE9riPOifNXivYtHHeZ0dBsJX6V49aK5/tLiY3ugpusji9aDDi9w3rMhUfVCVN5QnCO/xgmSgMj0K12Jsl6xr7+juKpryQk/L/be8gL19lhkt8ga/uqRjQ6BmqP4+uL5RVGM4tsXN6L1mPm1ht6lRpDeuYeHI/S2ObiGbxUvag5uQlbuBOw7xdlpQ7tbotKt3KwZ2MokAxaqIFa40qFiKhvi1yladA6LTLclOH0Qrl/UZmyyTt3JTZw2RBMRYOgNi8skoDtshbxrsc85DcRhib5Ie47z1yxeUNza2+2dkUf/svKm0RXZtxW1FTl2vMuN0RGDf1o0B/PsqsG7FS+NEc0Y8/8GRfOUXJCoCqCkwT5qXgV06u2PjKeDkU6ABBRWp16z757F7PF8+V7xwrXpkFw3yhkuQjb8Dumecimm5MTioD4Ds3BIFJ5bBKNFWfSq5/AykMWnc4I83ylJfYXdtq8WN8kB/eS0e1YqnJ4FPaNSIEpomFvmLy9y+CZF28HNio8v6r0goaYn97aqHxTTa8olEiM9bb2zRJ+P0G3to2eJZxQtgBSTf2NxX1BOtYeHFfWQghTGolsXH1C8RVGDby2C3owxZNxHJk7C7Yo9PVTP1HFs3YauD2IbO2cI3BQ8+h5TNJ/Vk6CMTunBHQY3x2U4kg0FaiHjI6GxdxYfPZ5OnLhD8Yy2MzJgOHbdcnnTAtS5RlGquam3uy5KZkWF4XRzFhxzH16UWKXQznJh0doyI70UmENxOPBssfpK0aop2wkojUHdSMN7ON3AIB8F+jCnzyKz5rgeshhFP6RSzwKlnNmODOv4lLqeb7R3u4el004sry6as2nIEDEv7uJBz7Xey7awtLgb2uubFn0kccqU+UZx6XjWin26Cu6zT7+s+OAiOwI+dRkdI/Ga9c9ON8MMwQwRDvua+KhirxP0xgKV+nzueFLRiOm9zYbbFB0lu+OxLQ54Ed1PLIJ1yIInz5D0WDBTH8ggO9+iYGDRc2CJp1jhxq1lwteKaSRbClmJyfi0tCID3qcNV4G257+pGPh8a+7Sa/FUD5VdUmSn8jE9Gmyx9GWbjP5fFPewMOjLRY0QUFnSMtCNb/VtYR6iHN3PJ5wNcs7X2kl9Vw7I8mw58OSitUS91EXTQ2eo70Ay0HQ7iAhMfEDy5v34bj6G0DSknHfl4KlIaO9D2maMBH7CPC4L87TZgHsVBUY7QNYcli+PFb3Q8+6u28HFPm/R9YVndni6+trz+WIPKpLzkeHEqTaHHlS0+iVkMq2HumlRXGJ8bGhQMZFdlWtlDEtvKGSI+WkbtC3eeCqD7rT6ZCVJm2yTEGUnAvKCeEsP6ZFsRyopyxzb5jAwcA3pwW24X9ECFKcDPS4Rum9xuZiBQF/ArgOC6jwdeU5rZ9/816sKMyQ4bU8dSpacYO6oF4OQrN6Tx6/Khg0SIu0uh2MWI3PXO8+z4Ws6wwm2WfWRf/P8F4kXFUVX7UTGVcbUt5CB6dli84hikofAyxi9Fc04v49xDOI0sIk+jkP0Zv8+CM4LkbGwCe7c7nuKmVuhZxV9UekGgp9mrZ6ibx9ncIxFz+Nklshv4wQ2RFd6NPqUK0vPW+FXdYUNpgIZ9sznafDTTR9aUW67MEwdHwOHc4oMF/PRgpKjZcjwjVvWkg0fKMbB7jTb2MImnNeaTWywBXPYl96BvJcJ2fs0hOm5UK/ar52S9D4n8wvDh4uMjIHqMxBHZGFp1JINPi7EweikX7ucVz7y7jU92CCB8Yun7+ADvY4f5zgUJ9ciLRAZzv0TEucZEllkdBKIzxT3GbWJDUZPbKBbkNO+MjYcpMOnYdni6j8JWLC8dI2TSQqixTuN6+3XFcf36wkcTFDivPoSAYnG+Lh4GDSjnbPH6l+wkLEHs6K6v6QvsO7bs4XZdmeVv7+CRUBm5FtWDHcV7dBZdUZT4muLnkjaJwDofqyWkAgfhhP8akEvW5YUaKOhQ57/9KKkxolt6z8FdEgp4zRHs8xfXhxYETQHBYshGYZ45J9owwb/ZsEOhd1pQdWeQ4uV3KIZWwXDcXNgTT/u/TkDQ8J8pNBwdkAfOEtwD3501yhDOE12fLSDpcxROEHPCWJ3GvuI9N48/1BxxprO8MzNHi4u2hI47WPCQBdY1AeZDxnOz//isCZzFDY4YjoWZtq4ctQ9WoS3/vPNkvsf9uBX/Xlv7u+XbGDY+B8TWKt7rpzgnG0kcVivSinlCUbm84urspt40p9gmXL2d5twLjJHQdNv37cj2CafoCA4apv7nN4V2FN3DsdO7wqOnd4VHDu9Kzh2ejdw4sT/AKg3OUKQFc+/AAAAAElFTkSuQmCC"},180:function(e,t,a){e.exports=a(227)},185:function(e,t,a){},186:function(e,t,a){},227:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(24),s=a.n(i),o=(a(185),a(10)),l=a(13),c=a(15),u=a(14),p=a(16),d=(a(186),a(22)),m=a(11),h=a(266),f=a(267),b=a(268),y=a(232),g=a(257),v=a(256),T=a(159),E=a.n(T);function w(e){return{type:"LOGOUT",payload:e}}function D(e){return{type:"SET_WORLDS",payload:e}}function A(e){return{type:"SET_TEMPLATES",payload:e}}function I(e){return{type:"UPDATE_WORLD",payload:e}}function N(e){return{type:"SET_PUBLIC_WORLDS",payload:e}}function O(e){return{type:"SELECT_WORLD",payload:e}}function S(e){return{type:"SET_ATTRIBUTES",payload:e}}function x(e){return{type:"SET_TYPES",payload:e}}function W(e){return{type:"ADD_TYPE",payload:e}}function k(e){return{type:"SET_THINGS",payload:e}}function C(e){return{type:"ADD_THING",payload:e}}function L(e){return{type:"UPDATE_TYPE",payload:e}}function _(e){return{type:"UPDATE_SELECTED_TYPE",payload:e}}function j(e){return{type:"UPDATE_THING",payload:e}}function F(e){return{type:"UPDATE_SELECTED_THING",payload:e}}function V(e){return{type:"TOGGLE_MENU",payload:e}}function P(e){return{type:"TOGGLE_LOGIN",payload:e}}function R(e){return{type:"NOT_FROM_LOGIN",payload:e}}function M(e){return{type:"SET_FOLLOWING_WORLDS",payload:e}}var B=a(258),U=a(294),H=a(19),z=a(2),J=a.n(z),G=a(6);function Y(e){this.name="UnauthorizedError",this.message=e}Y.prototype=new Error;var q=function(){var e;return{getInstance:function(){return e||(e=new K),e}}}(),K=function e(){var t=this;Object(o.a)(this,e),this.logErrorReason=function(e){return console.log("Response error reason:",e),Promise.reject(e)},this.checkStatus=function(e){if(e.status>=200&&e.status<300)return e;if(401===e.status){var t=new Y(e.statusText);return t.response=e,Promise.reject(t)}var a=new Error(e.statusText);return a.response=e,Promise.reject(a)},this.getVersion=Object(G.a)(J.a.mark((function e(){var a;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.fetchData("/version");case 3:return a=e.sent,e.abrupt("return",t.processResponse(a));case 7:return e.abrupt("return",{version:"0.0.1"});case 8:case"end":return e.stop()}}),e)}))),this.getAllUsers=Object(G.a)(J.a.mark((function e(){var a,r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/user/getAllUsers");case 3:return a=e.sent,r=function(){var e=Object(G.a)(J.a.mark((function e(){var a;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/user/getAllUsers");case 4:return a=e.sent,e.abrupt("return",t.processResponse(a));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(a,r));case 8:return e.abrupt("return",[{_id:"-1",email:"fake@fakemail.com",username:"Liar Liar"}]);case 9:case"end":return e.stop()}}),e)}))),this.login=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return r&&(n={body:a,expiresAt:"never"},sessionStorage.setItem("loginUser",JSON.stringify(n))),e.next=4,t.postData("/api/user/login",a);case 4:return i=e.sent,e.abrupt("return",t.processResponse(i,null,"user",r));case 8:return e.abrupt("return",{_id:"-1",email:"fake@fakemail.com",username:"Liar Liar"});case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.logout=function(){var e=Object(G.a)(J.a.mark((function e(a){return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=4;break}return e.next=3,t.postData("/api/user/logout");case 3:sessionStorage.removeItem("user");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.register=function(){var e=Object(G.a)(J.a.mark((function e(a){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/user/register",a);case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return",-1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.confirmEmail=function(){var e=Object(G.a)(J.a.mark((function e(a){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.patchData("/api/user/confirmEmail",{code:a});case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return",{_id:"-1",email:"fake@fakemail.com",username:"Liar Liar"});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendReset=function(){var e=Object(G.a)(J.a.mark((function e(a){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/user/sendReset",a);case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.checkResetPasswordCode=function(){var e=Object(G.a)(J.a.mark((function e(a){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/user/checkResetPasswordCode",{code:a});case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.resetPassword=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.patchData("/api/user/resetPassword",{code:a,newPassword:r});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n));case 7:return e.abrupt("return",{_id:"-1",email:"fake@fakemail.com",username:"Liar Liar"});case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.emailTest=function(){var e=Object(G.a)(J.a.mark((function e(a){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/user/emailTest",a);case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateUser=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/user/update",a);case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/user/update",a);case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",{_id:"-1",email:"fake@fakemail.com",username:"Liar Liar"});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createTemplate=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createTemplate",{template:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createTemplate",{template:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getTemplates=function(){var e=Object(G.a)(J.a.mark((function e(){var a,r=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0&&void 0!==r[0]&&r[0])){e.next=5;break}return e.abrupt("return",t.getTemplatesFromAPI());case 5:if(null===(a=t.getSessionData("templates"))){e.next=10;break}return e.abrupt("return",a);case 10:return e.abrupt("return",t.getTemplatesFromAPI());case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this.getTemplatesFromAPI=Object(G.a)(J.a.mark((function e(){var a,r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getTemplates/");case 3:return a=e.sent,r=function(){var e=Object(G.a)(J.a.mark((function e(){var a;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getTemplates/");case 4:return a=e.sent,e.abrupt("return",t.processResponse(a,null,"templates"));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(a,r,"templates"));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Alice"}]);case 9:case"end":return e.stop()}}),e)}))),this.getWorlds=function(){var e=Object(G.a)(J.a.mark((function e(){var a,r,n,i,s=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>0&&void 0!==s[0]&&s[0],e.prev=1,e.next=4,t.getPublicWorlds(a);case 4:return r=e.sent,e.next=7,t.getWorldsForUser(a);case 7:return n=e.sent,e.next=10,t.getTemplates(a);case 10:return i=e.sent,e.abrupt("return",{publicWorlds:r,userWorlds:n,templates:i});case 14:return e.prev=14,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",{error:e.t0});case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(){return e.apply(this,arguments)}}(),this.getWorldsForUser=function(){var e=Object(G.a)(J.a.mark((function e(){var a,r=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0&&void 0!==r[0]&&r[0])){e.next=5;break}return e.abrupt("return",t.getWorldsForUserFromAPI());case 5:if(null===(a=t.getSessionData("worlds"))){e.next=10;break}return e.abrupt("return",a);case 10:return e.abrupt("return",t.getWorldsForUserFromAPI());case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this.getWorldsForUserFromAPI=Object(G.a)(J.a.mark((function e(){var a,r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getWorldsForUser");case 3:return a=e.sent,r=function(){var e=Object(G.a)(J.a.mark((function e(){var a;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getWorldsForUser");case 4:return a=e.sent,e.abrupt("return",t.processResponse(a,null,"worlds"));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(a,r,"worlds"));case 8:return e.abrupt("return",[{_id:-1,OwnerID:-1,Name:"Alice in Wonderland",Public:!0}]);case 9:case"end":return e.stop()}}),e)}))),this.getPublicWorlds=function(){var e=Object(G.a)(J.a.mark((function e(){var a,r=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0&&void 0!==r[0]&&r[0])){e.next=5;break}return e.abrupt("return",t.getPublicWorldsFromAPI());case 5:if(null===(a=t.getSessionData("publicWorlds"))){e.next=10;break}return e.abrupt("return",a);case 10:return e.abrupt("return",t.getPublicWorldsFromAPI());case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this.getPublicWorldsFromAPI=Object(G.a)(J.a.mark((function e(){var a,r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getPublicWorlds");case 3:return a=e.sent,r=function(){var e=Object(G.a)(J.a.mark((function e(){var a;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getPublicWorlds");case 4:return a=e.sent,e.abrupt("return",t.processResponse(a,null,"publicWorlds"));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(a,r,"publicWorlds"));case 8:return e.abrupt("return",[{_id:-1,OwnerID:-1,Name:"Alice in Wonderland",Public:!0}]);case 9:case"end":return e.stop()}}),e)}))),this.getWorld=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n,i,s,o,l,c=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]&&c[1],e.prev=1,e.next=4,t.getAttributesForWorld(a,r);case 4:return n=(n=e.sent).attributes,e.next=8,t.getTypesForWorld(a,r);case 8:return i=(i=e.sent).types,e.next=12,t.getThingsForWorld(a,r);case 12:return s=(s=e.sent).things,o={},l={},n.forEach((function(e){e.TypeIDs=[],o[e._id]=e,l[e.Name]=e})),i.forEach((function(e){e.Supers=[],e.SuperIDs.forEach((function(t){e.Supers=e.Supers.concat(i.filter((function(e){return e._id===t})))})),e.AttributesArr=[],e.Attributes.forEach((function(t){var a=o[t.attrID];void 0===a||(a.TypeIDs.push(e._id),e.AttributesArr.push({index:e.AttributesArr.length,Name:a.Name.trim(),AttributeType:a.AttributeType,Options:a.Options,DefinedType:a.DefinedType,ListType:a.ListType,attrID:t.attrID,TypeIDs:a.TypeIDs}))}));var t={};void 0!==e.Defaults&&e.Defaults.forEach((function(e){t[e.attrID]=e})),e.DefaultsHash=t})),s.forEach((function(e){e.Types=[],e.TypeIDs.forEach((function(t){e.Types=e.Types.concat(i.filter((function(e){return e._id===t})))}))})),e.abrupt("return",{attributes:n,attributesByID:o,attributesByName:l,types:i,things:s});case 22:return e.prev=22,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",{error:e.t0});case 26:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t){return e.apply(this,arguments)}}(),this.createWorld=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createWorld",{world:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createWorld",{world:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteWorld=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/deleteWorld",{worldID:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/deleteWorld",{worldID:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateWorld=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/updateWorld",{world:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/updateWorld",{world:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.generateCollabLink=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/generateCollabLink",{worldID:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/generateCollabLink",{worldID:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.addNewCollaborator=function(){var e=Object(G.a)(J.a.mark((function e(a,r,n){var i,s;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/addNewCollaborator",{worldID:a,userID:r,email:n});case 3:return i=e.sent,s=function(){var e=Object(G.a)(J.a.mark((function e(){var i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/addNewCollaborator",{worldID:a,userID:r,email:n});case 4:return i=e.sent,e.abrupt("return",t.processResponse(i));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(i,s));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),this.emailCollaborator=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/emailCollaborator",{worldID:a,email:r});case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/emailCollaborator",{worldID:a,email:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.deleteCollab=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/deleteCollab",{worldID:a,collabID:r});case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/deleteCollab",{worldID:a,collabID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.updateCollaboratorPermission=function(){var e=Object(G.a)(J.a.mark((function e(a,r,n){var i,s;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/updateCollaboratorPermission",{worldID:a,collabID:r,editPermission:n});case 3:return i=e.sent,s=function(){var e=Object(G.a)(J.a.mark((function e(){var i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/updateCollaboratorPermission",{worldID:a,collabID:r,editPermission:n});case 4:return i=e.sent,e.abrupt("return",t.processResponse(i));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(i,s));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),this.checkCollabID=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/world/checkCollabID",{worldID:a,collabID:r});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.requestToCollaborate=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/requestToCollaborate",{worldID:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/requestToCollaborate",{worldID:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.declineCollabInvite=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/declineCollabInvite",{worldID:a,collabID:r});case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/declineCollabInvite",{worldID:a,collabID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.acceptCollabInvite=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/acceptCollabInvite",{worldID:a,collabID:r});case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/acceptCollabInvite",{worldID:a,collabID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.acceptCollabRequest=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/acceptCollabRequest",{worldID:a,collabID:r});case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/acceptCollabRequest",{worldID:a,collabID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.selectWorld=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/selectWorld",{worldID:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/selectWorld",{worldID:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getAttributesForWorld=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>1&&void 0!==n[1]&&n[1])){e.next=5;break}return e.abrupt("return",t.getAttributesForWorldFromAPI(a));case 5:if(null===(r=t.getSessionData("attributes_".concat(a)))){e.next=10;break}return e.abrupt("return",r);case 10:return e.abrupt("return",t.getAttributesForWorldFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getAttributesForWorldFromAPI=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getAttributesForWorld/".concat(a));case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getAttributesForWorld/".concat(a));case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null,"attributes_".concat(a)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n,"attributes_".concat(a)));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Character"}]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getAttribute=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getAttribute/".concat(a,"/").concat(r));case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getAttribute/".concat(a,"/").concat(r));case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return",{_id:-1,worldID:-1,Name:"Character",Description:"",Attributes:{}});case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.createAttribute=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createAttribute",{attribute:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createAttribute",{attribute:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.upsertAttributes=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/upsertAttributes",{worldID:a,attributes:r});case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/upsertAttributes",{worldID:a,attributes:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.getTypesForWorld=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>1&&void 0!==n[1]&&n[1])){e.next=5;break}return e.abrupt("return",t.getTypesForWorldFromAPI(a));case 5:if(null===(r=t.getSessionData("types_".concat(a)))){e.next=10;break}return e.abrupt("return",r);case 10:return e.abrupt("return",t.getTypesForWorldFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getTypesForWorldFromAPI=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getTypesForWorld/".concat(a));case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getTypesForWorld/".concat(a));case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null,"types_".concat(a)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n,"types_".concat(a)));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Character"}]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getType=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getType/".concat(a,"/").concat(r));case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getType/".concat(a,"/").concat(r));case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return",{_id:-1,worldID:-1,Name:"Character",Description:"",Attributes:{}});case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.createType=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createType",{type:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createType",{type:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteType=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/deleteType",{worldID:a,typeID:r});case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/deleteType",{worldID:a,typeID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.updateType=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/updateType",{type:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/updateType",{type:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getThingsForWorld=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>1&&void 0!==n[1]&&n[1])){e.next=5;break}return e.abrupt("return",t.getThingsForWorldFromAPI(a));case 5:if(null===(r=t.getSessionData("things_".concat(a)))){e.next=10;break}return e.abrupt("return",r);case 10:return e.abrupt("return",t.getThingsForWorldFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getThingsForWorldFromAPI=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getThingsForWorld/".concat(a));case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getThingsForWorld/".concat(a));case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null,"things_".concat(a)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n,"things_".concat(a)));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Alice"}]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getThing=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getThing/".concat(a,"/").concat(r));case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getThing/".concat(a,"/").concat(r));case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return",{_id:-1,worldID:-1,Types:[-1],Name:"Alice",Description:""});case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.createThing=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createThing",{thing:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createThing",{thing:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteThing=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/deleteThing",{worldID:a,thingID:r});case 3:return n=e.sent,i=function(){var e=Object(G.a)(J.a.mark((function e(){var n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/deleteThing",{worldID:a,thingID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.updateThing=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/updateThing",{thing:a});case 3:return r=e.sent,n=function(){var e=Object(G.a)(J.a.mark((function e(){var r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/updateThing",{thing:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.fetchData=function(){var e=Object(G.a)(J.a.mark((function e(a){var r,n=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=3,fetch("".concat(a),Object(H.a)({mode:"cors",credentials:"include"},r,{headers:Object(H.a)({Accept:"application/json"},r.headers)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.postData=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(H.a)({mode:"cors",credentials:"include"},n,{headers:Object(H.a)({Accept:"application/json","Content-Type":"application/json"},n.headers),method:"POST",body:JSON.stringify(r)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.putData=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(H.a)({mode:"cors",credentials:"include"},n,{headers:Object(H.a)({Accept:"application/json","Content-Type":"application/json"},n.headers),method:"PUT",body:JSON.stringify(r)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.patchData=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(H.a)({mode:"cors",credentials:"include"},n,{headers:Object(H.a)({Accept:"application/json","Content-Type":"application/json"},n.headers),method:"PATCH",body:JSON.stringify(r)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.deleteData=function(){var e=Object(G.a)(J.a.mark((function e(a,r){var n,i=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(H.a)({mode:"cors",credentials:"include"},n,{headers:Object(H.a)({Accept:"application/json","Content-Type":"application/json"},n.headers),method:"DELETE",body:JSON.stringify(r)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.processResponse=function(){var e=Object(G.a)(J.a.mark((function e(t){var a,r,n,i,s,o,l=arguments;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:null,r=l.length>2&&void 0!==l[2]?l[2]:null,n=l.length>3&&void 0!==l[3]&&l[3],e.next=5,t.json();case 5:if(i=e.sent,200===t.status){e.next=10;break}throw Error(i.message);case 10:if(void 0===i.error||null===a){e.next=14;break}return e.abrupt("return",a());case 14:return null!==r&&(s=new Date,n?s="never":s.setHours(s.getHours()+1),o={expiresAt:s,body:i},sessionStorage.setItem(r,JSON.stringify(o))),e.abrupt("return",i);case 16:case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.relogin=Object(G.a)(J.a.mark((function e(){var a,r;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null===(a=t.getSessionData("loginUser"))){e.next=7;break}return e.next=5,t.postData("/api/user/login",a);case 5:r=e.sent,t.processResponse(r,null,"user",!0);case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])}))),this.getSessionData=function(e){var t=sessionStorage.getItem(e);if(null!==t){var a=JSON.parse(t);if(void 0!==a.expiresAt&&("never"===a.expiresAt||a.expiresAt>new Date))return a.body}return null},this.real=!0},Z=q,Q=a(32),X=a(21),$=(a(137),a(138)),ee=a(149),te=a(150),ae=a(259),re=a(260),ne=a(295),ie=a(261),se=a(263),oe=a(264),le=a(110),ce=a.n(le),ue=a(153),pe=a.n(ue),de=a(157),me=a.n(de),he=a(63);var fe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={version:"0",redirectTo:null},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return this.props.fromLogin&&this.props.notFromLogin(),null!==this.state.redirectTo?n.a.createElement(he.a,{to:this.state.redirectTo}):n.a.createElement("div",null,n.a.createElement("h3",null,"Author's Notebook"),n.a.createElement("p",null,"This is something that I've been wanting to build for a while. It's purpose is to provide a place for keeping track of various aspects of books that an author is writing. It is able to keep track of details about characters, organizations, systems, and even storylines. I would like to make it so it's publicly available, and that any authors (aspiring and published) can use it to help them organize their stories. I want to make it automate a number of things, but the biggest part is to make it very dynamic and to allow for storage of all different kinds of notes. In order to make it publicly available however, it needs to at least be able to pay for itself. I'm not talking about the time I spent/spend working on it, but the costs of hosting the website, the db, and the url. Until I'm sure it's capable of doing those things, I can't let everyone have access to it."),n.a.createElement("p",null,"This is version 1 of instructions of how to use it. If I make it available for anyone, I'll update it with some video instructions."),n.a.createElement("p",null,"One thing you need to know is that this is a hobby project of mine. I'm working on it by myself for now. I've got a real job, and I've got a family, so this isn't my top priority, but that being said I do care about this probject, and I do plan to get to all the things that are on my to do list."),n.a.createElement("p",null,"If you want to do more than just look at the things others have put on (and which they're allowing you to see), then you'll have to register. Making it use Facebook and/or Google authentication is on my to do list. I know how to do that, but I just haven't gotten around to it. So, for now, just register and login. It currently doesn't send any emails, so if you forget your password or something, you'll have to reach out to me, and I can straighten it out. Again, that kind of thing is also on my to do list."),n.a.createElement("p",null,"Once you're logged in then you're able to start keeping track of things."),n.a.createElement("p",null,"The first thing you create is currently called a World. This is a holdover from when I was calling this my World Building App because I was aiming it for Fantasy/Sci-Fi authors (like me), but I realized that it could be used for anything really. If anyone has any suggestions for something to call this instead of World, I'm open to considering other options. Currently I'm considering changing it to 'Project', and I may do that before showing it to anyone other than family and close friends. Anyway, a World is basically the root of everything. Different Worlds aren't connected to each other. Each World has a Name, and you can choose whether or not to make it Public. If it's not Public then only the Owner (whoever created it) is able to see it. If it is Public then anyone can see it, but only the Owner can edit it. (Planned Future Features: When you create a new world you can use a template which will include generic Types common to that type of World, such as Character, Location, etc. I'm also planning to add the ability for Owners to add Collaborators to their World. Collaborators would be able to see the World, and the Owner would be able to control their other permissions as well (create/edit type, delete type, create/edit thing, and delete thing.). Only the Owner will have the ability to Edit or Delete the World itself, but they will be able to make someone else the Owner.)"),n.a.createElement("p",null,"Within a World you are able to define Types. Basically a Type is just that. It's a Type of Thing that you want to keep track of. In each Type you are able to define attributes which that Type of Thing share, such as Characters having Age, Race, Gender, Height, Weight, Skin Color, Eye Color, etc. Types can also be hierarchical through inheritance. For example, in Harry Potter I would have a 'Character' Type with all the attributes I listed above, but then I could have a 'Witch or Wizard' Type which has 'Character' as a Super Type. This means that 'Witch or Wizard' already has all those same Attributes as 'Character', but you can add more Attributes like Wand, Known Spells, etc. The way to set the Super Types for a type is with a control called a Multi Select. It's basically a textbox, but as you type it gives you suggestions. You click a suggestion and it adds a chip showing it as selected. Clicking the x on the right of the chip unselects it. When selecting a Type to be a Super Type it adds all the Attributes of that Type to the Type you're creating or editing, but they are greyed out and disabled for editing. The reason they're grey and disabled is that they come from a Super Type, so their definition is there. If a Super Type is removed then the Attributes remain, but are no longer grey and disabled. They can then be edited. There are a few more things to note however. First is that when adding a Super Type which has Super Types, those Super Types will be added as well. An example of this could be the 'Animagus' Type in Harry Potter. 'Animagus' has the Super Type 'Witch or Wizard', which has the Super Type 'Character', so when defining 'Animagus' I could add 'Witch or Wizard' as a Super Type, and that will automatically add 'Character' as well. Removing a Super Type of other Super Types will remove all Sub Types of the Super Type removed. An example of that would be removing 'Character' from 'Animagus'. This would automatically remove 'Witch or Wizard' as well. It doesn't make sense to do that for 'Animagus', but it may be necessary for you if you want to rethink how you're organizing things. The last thing to note about removing Super Types is that so long as a single Super Type exists which has an Attribute with that name, it will be greyed out and disabled. Another note about Attributes is that their names have to be unique on the Type (or Thing). It's generally a good idea to make sure that any Attributes you define with the same name also have the same Attribute type as well, otherwise you may run into Attribute name collisions. One last thing about Types. I've added an option to Types called Major Type. If it's checked then the Type is considered a Major Type and will show up in places of the UI where a regular Type will not. This makes finding, creating, and editing Things of that Type easier. I would make 'Character' a Major Type, but 'Witch or Wizard' and 'Animagus' would be regular Types. (Planned Future Features: Template Types like I have above for Template Worlds, but they're individual Types. Also add Plural Name field which will be used in the UI for places where we put the plural name of something. Currently it just adds an 's' to the end of the Type name, and I want to continue to do that if the Plural Name is left empty, but if it's not empty then display the Plural Name instead.)"),n.a.createElement("p",null,"Types have Attributes (as mentioned above). Things (which I'll get into more below) also have Attributes. The same Attributes really. In the Harry Potter World the Attributes on the 'Character' Type would then be given to every character you create afterward, but now instead of naming the Attribute and saying what type of Attribute it is, you get to specify a value for the Attribute."),n.a.createElement("p",null,"An Attribute is anything you may wish to keep track of for anything. These do not include Name or Description, because all Types and Things always have Name and Description by default. Attributes are for anything else you want to keep track of. It could be a relationship like 'Friend', 'Family Member', 'Significant Other', 'Coworker', etc. It could be skills and abilities, or possessions, or jobs, or home address, or work or school schedule. Really anything you want to keep track of which is part of something can be an Attribute. Currently there are six types of Attributes that are supported: Text, Number, True/False, Options, Type, and List. Text is just that. A Text Attribute gives you a textbox where you can type anything you want to keep track of. Number gives you a number box, which is like a textbox but it only accepts numbers, and it has arrows on the right which can be used to increment or decrement the number. True/False gives you a checkbox. Options allows you to specify possible choices for the Attribute, and then they show up in a drop down list (A quick example of this could be 'Gender' having 'Male', 'Female', and others if you wanted. They can have as many options as you want, and it can be used for whatever Attribute you want.). Specifying the choices is done using a control called a Chip Input. This looks like a regular textbox, but whenever you hit enter the text in it is added as a chip. Chips show the text, but have an x on their right which can be used to remove them. It's basically like the Multiselect except without the suggestions. The Chips are the choices that will be in the drop down list which the user has when creating or editing a Thing with that Attribute."),n.a.createElement("p",null,"The last two Attribute types are a little more complicated."),n.a.createElement("p",null,"When adding Attributes to a Type, the 'Type' Attribute type allows you to then choose from the various Types you've defined for the World, and then when you're creating or editing a Thing (such as the 'Character' 'Harry Potter') you would get all the Things of that Type as choices in a drop down list. For example you could have a 'Best Friend' Attribute which has the Attribute type of 'Type' and uses the Defined Type of 'Character'. Then when editing Harry you would have a drop down list which shows all the 'Characters' you've added to the World as possible 'Best Friends'. You would of course then choose 'Ron Weasley' (Sorry, Hermione, but you're a close second.)."),n.a.createElement("p",null,"The Attribute Type 'List' is still more complicated than 'Type'. It allows you to decide which type of 'List' it's going to be. For now it only supports 'Text', 'Options', and 'Type'. (I'm not planning to add any others, but if it's requested I may consider it. A List of Text could be anything really, so other types shouldn't be necessary.) If an Attribute is defined as a List of Text then when creating or editing a Thing the Attribute gives a Chip Input, which works the same as it does for Options (described above). A List of Options allows you to define the choices when creating or editing the Type, the same as with a regular Options Attribute, and then when creating or editing a Thing of that Type it gives a Multiselect which works the same as when choosing Super Types (described above) with the Options defined previously on the Type as the suggestions. A List of 'Type' allows you to choose a Defined Type (like with the Attribute type 'Type'), but when creating or editing a Thing it gives you a Multiselect instead of a regular drop down list so you can select more than one. With all 'List' Attributes, the items in the list are displayed separated by commas when looking at the details page rather than creating or editing."),n.a.createElement("p",null,"One last note about Attributes of type 'Type' or 'List' of 'Type'. I've made it so that if you want to choose a Defined Type which you haven't defined yet you can choose '+ Create New Type' and it opens a quick little window (modal for those who care) which lets you define a Type using just the name you want it to have. You'll have to edit that Type later to give it any Super Types or Attributes it should have, but you can create it there so you can continue defining the Type you're already working on rather than having to leave and come back to it. The same thing can be done when creating or editing a Thing with an Attribute of type 'Type' or 'List' of 'Type', but for Things the Type has already been chosen. Now you will be creating a Thing of that Type. An example of this would be if you're editing the 'Character' 'Harry Potter', but when you get to 'Best Friend' you realize you haven't added the 'Ron Weasley' 'Character' yet. You would choose '+ Create New Character', and then in the quick little window you would type 'Ron Weasley'. He would get added as a blank character with just his Name, but he would then be selected as Harry's 'Best Friend', and you could finish defining Harry, and get to Ron later."),n.a.createElement("p",null,"And one more thing about Attributes in general.  I added the ability to set Default values for attributes on the Type.  Default Values will automatically be set on any Things of that Type.  I made it as user friendly as I could think to make it."),n.a.createElement("p",null,"(Planned Future Features: Other Attribute types, including: Image, Event, and External Link. If you have any suggestions of others, feel free to recommend them.  Also need to put in validation to detect Name and Default collisions.)"),n.a.createElement("p",null,"And that brings us to Things. If you've gotten to this point, then you probably already understand what Things are, but I'll outline it anyway. The generic term Thing is used to mean any actual thing you're keeping track of. This would be your Characters, your Places, your Items, Spells, whatever. When creating or editing a Thing you are able to choose Types for the Thing (works the same as Super Types for Types), and all the Attributes of those Types are added to the Thing, but now you're able to give values for them. Again remember to avoid Attribute Name collisions (If for some reason you've defined 2 unrelated Types with an Attribute that has the same name but different Attribute types then you won't be able to have a Thing of both Types.). If a Type is edited to remove an Attribute, Things which use that Type and existed already will still have that Attribute. It will just be an orphaned Attribute. Currently there's no way to remove Attributes from Things. If a Type is edited to add Attributes then Things which already existed will gain those Attributes as soon as they're edited again. If a Type is edited and an Attribute is changed... I'm not actually sure what would happen to Things that already exist which have that Type. I'll have to test that. That's really it for Things. They're the simple part. (Planned Future Features: I'm planning to add the ability to add/remove/edit orphaned Attributes for Things. When I do, I'll probably try to find a way to make it so with adding/editing orphaned Attributes you'll be able to add the Attribute to a selected Type already on the Thing.)"),n.a.createElement("p",null,"I probably should have put Attributes below Things, but oh well."),n.a.createElement("p",null,"Other Planned Future Features:"),n.a.createElement("div",null,n.a.createElement("p",null,"Forums: I'm going to have a General Site Forum, and each World will automatically get its own Forum."),n.a.createElement("p",null,"Direct Messages: I'll add a simple messaging system to allow people to communicate directly with one another."),n.a.createElement("p",null,"Auto-links: For both Forums and DMs I'll allow users to put links to pages through a simple system similar to hashtags in Social Media. I'm thinking I also want to add this capability to Descriptions on Types and Things."),n.a.createElement("p",null,"Following Public Worlds: Currently all Public Worlds are listed in the menu, but I should make it so only those that the user follows are shown there, and have a button to pull up the full list, and add a button for people who neither own or collaborate on a Public World to 'Follow' the World."),n.a.createElement("p",null,"Home Page content: I'm planning to have actual Home Page content. This will have a link to a video tutorial for new users (which I have yet to make, and will need occasional updating after it's made), as well as things like recent software changes. I also want to make it so it can automatically have links to recently added or edited Types or Things and recent Forum posts which may be of interest to the user.")))}}]),t}(r.Component),be=Object(m.b)((function(e){return{fromLogin:e.app.fromLogin}}),(function(e){return{notFromLogin:function(){return e(R({}))}}}))(fe);var ye=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={version:"0",redirectTo:null},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return null!==this.state.redirectTo?n.a.createElement(he.a,{to:this.state.redirectTo}):n.a.createElement("div",{className:"col-sm-12"},"Template Page")}}]),t}(r.Component),ge=Object(m.b)((function(e){return{selectedPage:e.app.selectedPage}}),(function(e){return{}}))(ye),ve=[{path:"/",name:"Home",icon:pe.a,component:be},{path:"/Forums",name:"Forums",icon:me.a,component:ge}];var Te=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).toggleFollow=function(e,t){var r=Object(X.a)(a.props.followingWorlds);if(t)r.push(e);else{var n=r.indexOf(e);r.splice(n,1)}if(null!==a.props.user){var i=Object(H.a)({},a.props.user);i.followingWorlds=r,a.props.setFollowingWorlds(r),a.api.updateUser(i)}else a.props.setFollowingWorlds(r)},a.handleUserInput=function(e){var t=e.target.name,r="checkbox"===e.target.type?e.target.checked:e.target.value;a.setState(Object(Q.a)({},t,r))},a.state={browse:!1,Filter:""},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.api.getWorlds(!0).then((function(t){e.props.setPublicWorlds(t.publicWorlds.worlds),null!==e.props.user&&(void 0===t.publicWorlds?e.props.logout():(e.props.setWorlds(t.userWorlds.worlds),e.props.setTemplates(t.templates.templates)))}))}},{key:"links",value:function(){var e=this;return n.a.createElement("div",null,ve.map((function(t,a){return n.a.createElement(y.a,{key:a,className:"curvedButton"},n.a.createElement(d.b,{to:t.path,onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width,"px")},className:"MyButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},"string"===typeof t.icon?n.a.createElement(v.a,{className:"marginLeft"},t.icon):n.a.createElement(t.icon,{className:"marginLeft"}),"\xa0",n.a.createElement(g.a,{primary:t.name,className:"marginLeft"}))))})))}},{key:"publicWorlds",value:function(){var e=this,t=[],a=[];return void 0!==this.props.publicWorlds&&null!==this.props.publicWorlds&&void 0===this.props.publicWorlds.error&&this.props.publicWorlds.forEach((function(r){e.state.browse?(""===e.state.Filter||r.Name.toLowerCase().includes(e.state.Filter.toLowerCase()))&&(e.props.followingWorlds.includes(r._id)?t.push(r):a.push(r)):e.props.followingWorlds.includes(r._id)&&t.push(r)})),this.state.browse?n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"filter"},"Filter"),n.a.createElement(te.a,{id:"filter",name:"Filter",type:"text",autoComplete:"Off",value:this.state.Filter,onChange:this.handleUserInput,labelWidth:43,fullWidth:!0}))),n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,t.map((function(t,a){return n.a.createElement(y.a,{key:a,className:"curvedButton"},n.a.createElement(d.b,{to:"/world/details/".concat(t._id),onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width-80,"px")},className:"MySmallerButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(g.a,{primary:t.Name,className:"marginLeft"}))),n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(a){e.toggleFollow(t._id,!1)}},n.a.createElement(ie.a,null)))})),a.map((function(t,a){return n.a.createElement(y.a,{key:a,className:"curvedButton"},n.a.createElement(d.b,{to:"/world/details/".concat(t._id),onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width-80,"px")},className:"MySmallerButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(g.a,{primary:t.Name,className:"marginLeft"}))),n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(a){e.toggleFollow(t._id,!0)}},n.a.createElement(ce.a,null)))}))))):t.map((function(t,a){return n.a.createElement(y.a,{key:a,className:"curvedButton"},n.a.createElement(d.b,{to:"/world/details/".concat(t._id),onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width,"px")},className:"MyButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(g.a,{primary:t.Name,className:"marginLeft"}))))}))}},{key:"myWorlds",value:function(){var e=this;return null===this.props.user||void 0===this.props.user||void 0===this.props.worlds?"":this.props.worlds.map((function(t,a){return n.a.createElement(y.a,{key:a,className:"curvedButton"},n.a.createElement(d.b,{to:"/world/details/".concat(t._id),onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width,"px")},className:"MyButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(g.a,{primary:t.Name,className:"marginLeft"}))))}))}},{key:"render",value:function(){var e=this;return n.a.createElement(ae.a,null,this.links(),n.a.createElement(y.a,null,n.a.createElement(g.a,{display:"none",primary:"Public Worlds"}),n.a.createElement(ne.a,{title:"Browse Public Worlds"},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({browse:!e.state.browse})}},n.a.createElement(se.a,null)))),this.publicWorlds(),null!==this.props.user&&n.a.createElement(y.a,null,n.a.createElement(g.a,{primary:"My Worlds"})),null!==this.props.user&&n.a.createElement(y.a,{className:"curvedButton"},n.a.createElement(d.b,{to:"/world/create",onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(this.props.width,"px")},className:"MyButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(oe.a,null),n.a.createElement(g.a,{primary:"Create New"})))),this.myWorlds())}}]),t}(r.Component),Ee=Object(m.b)((function(e){return{selectedPage:e.app.selectedPage,worlds:e.app.worlds,publicWorlds:e.app.publicWorlds,user:e.app.user,followingWorlds:e.app.followingWorlds,width:e.app.width}}),(function(e){return{setWorlds:function(t){return e(D(t))},setPublicWorlds:function(t){return e(N(t))},setTemplates:function(t){return e(A(t))},setFollowingWorlds:function(t){return e(M(t))},toggleMenu:function(){return e(V({}))},logout:function(){return e(w({}))}}}))(Te),we=a(20),De=a(5),Ae=a(163),Ie=a(265),Ne=Object(De.a)({paper:{border:"1px solid #d3d4d5"}})((function(e){return n.a.createElement(Ae.a,Object.assign({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},e))}));function Oe(e){var t=n.a.useState(null),a=Object(we.a)(t,2),r=a[0],i=a[1];return n.a.createElement("span",{className:"float-right blue whiteFont"},n.a.createElement(y.a,{"aria-controls":"user-menu","aria-haspopup":"true",style:{cursor:"pointer"},onClick:function(e){i(e.currentTarget)},className:"curvedButton float-right"},n.a.createElement(v.a,null,"person"),n.a.createElement(g.a,{primary:" ".concat(e.username)})),n.a.createElement(Ne,{id:"customized-menu",anchorEl:r,keepMounted:!0,open:Boolean(r),onClose:function(e){i(null)}},n.a.createElement(Ie.a,{onClick:function(e){i(null)}},n.a.createElement(d.b,{to:"/User/Profile",style:{color:"black"}},n.a.createElement(g.a,{primary:"Profile"}))),n.a.createElement(Ie.a,{style:{color:"black"},onClick:function(t){void 0!==e.onLogout&&e.onLogout(),i(null)}},n.a.createElement(g.a,{primary:"Logout"}))))}var Se=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.loadFromStorage()}},{key:"render",value:function(){var e=this;return n.a.createElement(h.a,{position:"static"},n.a.createElement(f.a,null,n.a.createElement(B.a,{container:!0,spacing:0},n.a.createElement(B.a,{item:!0,xs:!0},n.a.createElement(b.a,{style:{color:"white"},"aria-label":"Menu",onClick:function(t){e.props.toggleMenu()}},n.a.createElement(E.a,null))),n.a.createElement(B.a,{item:!0,xs:!0},n.a.createElement(y.a,{className:"curvedButton"},n.a.createElement(g.a,{primary:null===this.props.selectedWorld?"Welcome!":this.props.selectedWorld.Name}))),n.a.createElement(B.a,{item:!0,xs:!0},null===this.props.user||void 0===this.props.user.username?n.a.createElement("span",{style:{cursor:"pointer"},onClick:function(t){e.props.toggleLogin()},className:"float-right blue whiteFont"},n.a.createElement(y.a,{className:"curvedButton float-right"},n.a.createElement(v.a,null,"person"),n.a.createElement(g.a,{primary:" Login/Register"}))):n.a.createElement(Oe,{username:this.props.user.username,onLogout:function(t){e.api.logout().then((function(t){e.props.logout()}))}})))),this.props.mobileMenuOpen&&n.a.createElement(U.a,{display:{xs:"inline",sm:"none"}},n.a.createElement(Ee,null)))}}]),t}(r.Component),xe=Object(m.b)((function(e){return{selectedPage:e.app.selectedPage,user:e.app.user,selectedWorld:e.app.selectedWorld,mobileMenuOpen:!e.app.menuOpen}}),(function(e){return{setWorlds:function(t){return e(D(t))},loadFromStorage:function(){return e({type:"LOAD_FROM_STORAGE",payload:{}})},toggleMenu:function(){return e(V({}))},toggleLogin:function(){return e(P({}))},logout:function(){return e(w({}))},redirectTo:function(t){return e({type:"REDIRECT_TO",payload:t})}}}))(Se),We=a(160),ke=a.n(We),Ce=a(270);var Le=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).toggleFollow=function(e,t){var r=Object(X.a)(a.props.followingWorlds);if(t)r.push(e);else{var n=r.indexOf(e);r.splice(n,1)}if(null!==a.props.user){var i=Object(H.a)({},a.props.user);i.followingWorlds=r,a.props.setFollowingWorlds(r),a.api.updateUser(i)}else a.props.setFollowingWorlds(r)},a.handleUserInput=function(e){var t=e.target.name,r="checkbox"===e.target.type?e.target.checked:e.target.value;a.setState(Object(Q.a)({},t,r))},a.state={browse:!1,Filter:""},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.api.getWorlds(!0).then((function(t){e.props.setPublicWorlds(t.publicWorlds.worlds),null!==e.props.user&&(void 0===t.publicWorlds?e.props.logout():(e.props.setWorlds(t.userWorlds.worlds),e.props.setTemplates(t.templates.templates)))}))}},{key:"links",value:function(){return ve.map((function(e,t){return n.a.createElement(y.a,{key:t,className:"curvedButton"},n.a.createElement(d.b,{to:e.path,className:"MyButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},"string"===typeof e.icon?n.a.createElement(v.a,{className:"marginLeft"},e.icon):n.a.createElement(e.icon,{className:"marginLeft"}),"\xa0",n.a.createElement(g.a,{primary:e.name,className:"marginLeft"}))))}))}},{key:"brand",value:function(){return n.a.createElement(d.b,{to:"/",className:"BlackTextButton",activeClassName:"active"},n.a.createElement(y.a,null,n.a.createElement("img",{src:ke.a,alt:"logo",className:"App-logo"}),n.a.createElement(g.a,{primary:this.props.logoText})))}},{key:"publicWorlds",value:function(){var e=this,t=[],a=[];return void 0!==this.props.publicWorlds&&null!==this.props.publicWorlds&&void 0===this.props.publicWorlds.error&&this.props.publicWorlds.forEach((function(r){e.state.browse?(""===e.state.Filter||r.Name.toLowerCase().includes(e.state.Filter.toLowerCase()))&&(e.props.followingWorlds.includes(r._id)?t.push(r):a.push(r)):e.props.followingWorlds.includes(r._id)&&t.push(r)})),this.state.browse?n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"filter"},"Filter"),n.a.createElement(te.a,{id:"filter",name:"Filter",type:"text",autoComplete:"Off",value:this.state.Filter,onChange:this.handleUserInput,labelWidth:43,fullWidth:!0}))),n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,t.map((function(t,a){return n.a.createElement(y.a,{key:a,className:"curvedButton"},n.a.createElement(d.b,{to:"/world/details/".concat(t._id),className:"MySmallerButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(g.a,{primary:t.Name,className:"marginLeft"}))),n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(a){e.toggleFollow(t._id,!1)}},n.a.createElement(ie.a,null)))})),a.map((function(t,a){return n.a.createElement(y.a,{key:a,className:"curvedButton"},n.a.createElement(d.b,{to:"/world/details/".concat(t._id),className:"MySmallerButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(g.a,{primary:t.Name,className:"marginLeft"}))),n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(a){e.toggleFollow(t._id,!0)}},n.a.createElement(ce.a,null)))}))))):t.map((function(e,t){return n.a.createElement(y.a,{key:t,className:"curvedButton"},n.a.createElement(d.b,{to:"/world/details/".concat(e._id),className:"MyButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(g.a,{primary:e.Name,className:"marginLeft"}))))}))}},{key:"myWorlds",value:function(){return null===this.props.user||void 0===this.props.user||void 0===this.props.worlds?"":this.props.worlds.map((function(e,t){return n.a.createElement(y.a,{key:t,className:"curvedButton"},n.a.createElement(d.b,{to:"/world/details/".concat(e._id),className:"MyButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(g.a,{primary:e.Name,className:"marginLeft"}))))}))}},{key:"render",value:function(){var e=this;return n.a.createElement(ae.a,null,this.brand(),n.a.createElement(Ce.a,{light:!0}),this.links(),n.a.createElement(y.a,null,n.a.createElement(g.a,{display:"none",primary:"Public Worlds"}),n.a.createElement(ne.a,{title:"Browse Public Worlds"},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({browse:!e.state.browse})}},n.a.createElement(se.a,null)))),this.publicWorlds(),null!==this.props.user&&n.a.createElement(y.a,null,n.a.createElement(g.a,{primary:"My Worlds"})),null!==this.props.user&&n.a.createElement(y.a,{className:"curvedButton"},n.a.createElement(d.b,{to:"/world/create",className:"MyButton",activeClassName:"active"},n.a.createElement(y.a,{button:!0},n.a.createElement(oe.a,null),n.a.createElement(g.a,{primary:"Create New"})))),this.myWorlds())}}]),t}(r.Component),_e=Object(m.b)((function(e){return{selectedPage:e.app.selectedPage,worlds:e.app.worlds,publicWorlds:e.app.publicWorlds,user:e.app.user,followingWorlds:e.app.followingWorlds}}),(function(e){return{setWorlds:function(t){return e(D(t))},setPublicWorlds:function(t){return e(N(t))},setFollowingWorlds:function(t){return e(M(t))},setTemplates:function(t){return e(A(t))},logout:function(){return e(w({}))}}}))(Le);var je=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return this.props.fromLogin&&this.props.notFromLogin(),null===this.props.selectedPage||"/".concat(this.props.selectedPage)===window.location.pathname?n.a.createElement("div",{className:"col-sm-12"},"Forum Menu Page!"):n.a.createElement(he.a,{to:"/".concat(this.props.selectedPage)})}}]),t}(r.Component),Fe=Object(m.b)((function(e){return{selectedPage:e.app.selectedPage,fromLogin:e.app.fromLogin}}),(function(e){return{notFromLogin:function(){return e(R({}))}}}))(je),Ve=a(33);var Pe=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).inputBlur=function(e){var t=e.target.name,r=a.validateField(t),n=a.state.fieldValidation;void 0!==n[t]&&n[t].valid!==r.valid&&(n[t].valid=r.valid,n[t].message=r.message,a.setState({fieldValidation:n}))},a.validateField=function(e){var t=null,r=!0,n="";switch(e){case"username":(t=a.state.username).length<2?(r=!1,n="Username is too short"):0!==a.state.allUsers.filter((function(e){return e.username===t&&e._id!==a.props.user._id})).length&&(r=!1,n="This Username is taken");break;case"email":n=(r=null!==(t=a.state.email).match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid",r&&t!==a.props.user.email&&(n="You will be sent a confirmation email at your new email upon submission.  Please use the link.")}return{valid:r,message:n}},a.validateForm=function(e){var t=a.validateField("username"),r=a.validateField("email"),n=t.valid&&r.valid,i=a.state.fieldValidation;i.Name=t,a.setState({formValid:n,fieldValidation:i},e)},a.onSubmit=function(){a.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},a.submitThroughAPI=function(){var e={_id:a.props.user._id,username:a.state.username.trim(),email:a.state.email.trim()};a.api.updateUser(e).then((function(e){if(null===e.user){var t=a.state.fieldValidation;t.loginError={message:e.error,valid:!1,show:!0},a.setState({fieldValidation:t,waiting:!1})}else a.props.userLogin(e.user),a.api.getWorldsForUser(e.user._id).then((function(e){a.props.setWorlds(e.worlds),a.props.onLogin(e.user)}))}))},a.load=function(){setTimeout((function(){a.setState({redirectTo:null,message:"Loading..."},a.finishLoading)}),500)},a.finishLoading=function(){a.props.fromLogin&&a.props.notFromLogin(),a.api.getAllUsers().then((function(e){a.setState({allUsers:e,username:a.props.user.username,email:a.props.user.email,loaded:!0,message:""})}))},a.state={username:"",email:"",fieldValidation:{username:{valid:!0,message:""},email:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,loaded:!1},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return this.state.loaded||this.load(),null!==this.state.redirectTo?n.a.createElement(he.a,{to:this.state.redirectTo}):null===this.props.user?n.a.createElement("span",null,"Please log in to be able to access your profile."):n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(Ve.Helmet,null,n.a.createElement("title",null,"Author's Notebook: User Profile")),n.a.createElement(B.a,{item:!0},n.a.createElement("h2",null,"User Profile")),n.a.createElement(B.a,{item:!0},"Username: ",this.props.user.username),n.a.createElement(B.a,{item:!0},"Email: ",this.props.user.email),n.a.createElement(B.a,{item:!0},"I'll add more profile elements here as the website grows"))}}]),t}(r.Component),Re=Object(m.b)((function(e){return{types:e.app.types,user:e.app.user,fromLogin:e.app.fromLogin}}),(function(e){return{setAttributes:function(t){return e(S(t))},setTypes:function(t){return e(x(t))},setThings:function(t){return e(k(t))},notFromLogin:function(){return e(R({}))}}}))(Pe),Me=a(272),Be=a(271),Ue=a(114),He=a.n(Ue),ze=a(115),Je=a.n(ze);var Ge=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){a.props.updateIndexExpandedPanel(a.props.indexExpandedPanel!==e&&e)},a.state={redirectTo:null},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"renderListForType",value:function(e){var t=this,a=this.props.things.filter((function(t){return t.TypeIDs.includes(e._id)}));return n.a.createElement("div",{className:"Things"},n.a.createElement(ae.a,{style:{width:"240px"}},n.a.createElement(y.a,null,n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){t.setState({redirectTo:"/thing/create/type_id_".concat(e._id)})}},n.a.createElement(oe.a,null),"Create New ".concat(e.Name))),a.map((function(e,a){return n.a.createElement(y.a,{key:a},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){t.setState({redirectTo:"/thing/details/".concat(e._id)})}},e.Name))}))))}},{key:"render",value:function(){var e=this;if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});var t=this.props.things.filter((function(e){return 0===e.Types.filter((function(e){return e.Major})).length})),a=null!==this.props.selectedWorld&&null!==this.props.user&&(this.props.selectedWorld.Owner===this.props.user._id||this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length>0);return n.a.createElement("div",null,n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"TYPES"===this.props.indexExpandedPanel?n.a.createElement(ne.a,{title:"Collapse Types"},n.a.createElement(Be.a,{onClick:function(t){e.handleChange("TYPES")}},n.a.createElement(He.a,null))):n.a.createElement(ne.a,{title:"Expand Types"},n.a.createElement(Be.a,{onClick:function(t){e.handleChange("TYPES")}},n.a.createElement(Je.a,null))),n.a.createElement("span",{className:"MuiTypography-root MuiListItemText-primary MuiTypography-body1"},"Types (".concat(this.props.types.length,")")),a&&n.a.createElement(ne.a,{title:"Create New Type"},n.a.createElement(re.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(t){e.setState({redirectTo:"/type/create"})}},n.a.createElement(oe.a,null)))),"TYPES"===this.props.indexExpandedPanel&&n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,{style:{maxWidth:"380px"}},this.props.types.map((function(t,r){return n.a.createElement(y.a,{key:r},n.a.createElement(B.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:8},n.a.createElement(ne.a,{title:"Details for ".concat(t.Name)},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},t.Name))),a&&n.a.createElement(B.a,{item:!0,xs:2},n.a.createElement(ne.a,{title:"Create New ".concat(t.Name)},n.a.createElement(re.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/thing/create/type_id_".concat(t._id)})}},n.a.createElement(oe.a,null)))),a&&n.a.createElement(B.a,{item:!0,xs:2},n.a.createElement(ne.a,{title:"Edit ".concat(t.Name)},n.a.createElement(re.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/type/edit/".concat(t._id)})}},n.a.createElement(Me.a,null))))))})))),this.props.types.filter((function(e){return e.Major})).map((function(t,r){var i=e.props.things.filter((function(e){return e.TypeIDs.includes(t._id)}));return n.a.createElement(B.a,{key:r,item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},e.props.indexExpandedPanel===t._id?n.a.createElement(ne.a,{title:"Collapse ".concat(void 0===t.PluralName||""===t.PluralName?"".concat(t.Name,"s"):t.PluralName)},n.a.createElement(Be.a,{onClick:function(a){e.handleChange(t._id)}},n.a.createElement(He.a,null))):n.a.createElement(ne.a,{title:"Expand ".concat(void 0===t.PluralName||""===t.PluralName?"".concat(t.Name,"s"):t.PluralName)},n.a.createElement(Be.a,{onClick:function(a){e.handleChange(t._id)}},n.a.createElement(Je.a,null))),n.a.createElement(ne.a,{title:"Details for ".concat(t.Name)},n.a.createElement(Be.a,{variant:"contained",color:"primary",style:{width:"180px"},onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},void 0===t.PluralName||""===t.PluralName?"".concat(t.Name,"s"):t.PluralName," (",i.length,")")),a&&n.a.createElement("span",null,n.a.createElement(ne.a,{title:"Create New ".concat(t.Name)},n.a.createElement(re.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/thing/create/type_id_".concat(t._id)})}},n.a.createElement(oe.a,null))),n.a.createElement(ne.a,{title:"Edit ".concat(t.Name)},n.a.createElement(re.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/type/edit/".concat(t._id)})}},n.a.createElement(Me.a,null))))),e.props.indexExpandedPanel===t._id&&n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,{style:{maxWidth:"380px"}},i.map((function(t,r){return n.a.createElement(y.a,{key:r},n.a.createElement(B.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:10},n.a.createElement(ne.a,{title:"Details for ".concat(t.Name)},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t._id)})}},t.Name))),a&&n.a.createElement(B.a,{item:!0,xs:2},n.a.createElement(ne.a,{title:"Edit ".concat(t.Name)},n.a.createElement(re.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/thing/edit/".concat(t._id)})}},n.a.createElement(Me.a,null))))))})))))})),n.a.createElement(B.a,{item:!0},"OTHER"===this.props.indexExpandedPanel?n.a.createElement(ne.a,{title:"Collapse Other Things"},n.a.createElement(Be.a,{onClick:function(t){e.handleChange("OTHER")}},n.a.createElement(He.a,null))):n.a.createElement(ne.a,{title:"Expand Other Things"},n.a.createElement(Be.a,{onClick:function(t){e.handleChange("OTHER")}},n.a.createElement(Je.a,null))),n.a.createElement("span",{className:"MuiTypography-root MuiListItemText-primary MuiTypography-body1"},"Other Things (".concat(t.length,")")),a&&n.a.createElement(ne.a,{title:"Create New Thing"},n.a.createElement(re.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(t){e.setState({redirectTo:"/thing/create"})}},n.a.createElement(oe.a,null)))),"OTHER"===this.props.indexExpandedPanel&&n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,{style:{maxWidth:"380px"}},t.map((function(t,r){return n.a.createElement(y.a,{key:r},n.a.createElement(B.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:10},n.a.createElement(ne.a,{title:"Details for ".concat(t.Name)},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t._id)})}},t.Name))),a&&n.a.createElement(B.a,{item:!0,xs:2},n.a.createElement(ne.a,{title:"Edit ".concat(t.Name)},n.a.createElement(re.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/thing/edit/".concat(t._id)})}},n.a.createElement(Me.a,null))))))}))))))}}]),t}(r.Component),Ye=Object(m.b)((function(e){return{things:e.app.things,types:e.app.types,selectedWorld:e.app.selectedWorld,user:e.app.user,indexExpandedPanel:e.app.indexExpandedPanel}}),(function(e){return{updateIndexExpandedPanel:function(t){return e({type:"UPDATE_INDEX_EXPANDED_PANEL",payload:t})}}}))(Ge),qe=a(274),Ke=a(275),Ze=a(293),Qe=a(273),Xe=a(291),$e=a(143);function et(e){var t=Object(r.useState)(void 0===e.Value||null===e.Value?"":e.Value),a=Object(we.a)(t,2),i=a[0],s=a[1],o=void 0===e.displayName?e.fieldName:e.displayName;return n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"text_field_".concat(e.fieldName)},o),void 0!==e.multiline&&e.multiline?n.a.createElement(te.a,{id:"text_field_".concat(e.fieldName),name:"text_field_".concat(e.fieldName),type:"text",autoComplete:"Off",multiline:!0,error:void 0!==e.message&&""!==e.message,value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){e.onBlur(i.trim())},labelWidth:e.labelWidth,fullWidth:!0}):n.a.createElement(te.a,{id:"text_field_".concat(e.fieldName),name:"text_field_".concat(e.fieldName),type:"text",autoComplete:"Off",error:void 0!==e.message&&""!==e.message,value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){e.onBlur(i.trim())},labelWidth:e.labelWidth,fullWidth:!0}),n.a.createElement($e.a,null,e.message))}function tt(e){var t=0===e.templates.filter((function(t){return t.Name===e.world.Name})).length,a=Object(r.useState)(e.world.Name),i=Object(we.a)(a,2),s=i[0],o=i[1],l=Object(r.useState)(""),c=Object(we.a)(l,2),u=c[0],p=c[1],d=Object(r.useState)(t?"":"This Template Name is already in use"),m=Object(we.a)(d,2),h=m[0],f=m[1],b=Object(r.useState)(!1),g=Object(we.a)(b,2),v=g[0],T=g[1],E=Object(r.useState)([]),w=Object(we.a)(E,2),D=w[0],A=w[1],I=Object(r.useState)(t),N=Object(we.a)(I,2),O=N[0],S=N[1];return n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"Create a template for use in other worlds based on this one. The template will be usable by any user."),n.a.createElement(B.a,{item:!0},n.a.createElement(et,{Value:s,fieldName:"Template Name",message:h,onBlur:function(t){o(t),S(function(e,t,a){var r=0===t.templates.filter((function(t){return t.Name===e})).length;return a(r?"":"This Template Name is already in use"),r}(t,e,f))},labelWidth:110})),n.a.createElement(B.a,{item:!0,style:{color:"red"}},u),n.a.createElement(B.a,{item:!0},"Choose which types you want to include in the template. Dependent Types will automatically be checked/unchecked as appropriate.",n.a.createElement(ae.a,null,n.a.createElement(y.a,null,n.a.createElement(Be.a,{variant:"contained",color:"primary",disabled:v||D.length===e.types.length,onClick:function(t){T(!0);var a=[];e.types.forEach((function(e){a.push(e._id)})),A(a),T(!1)}},v?"Please Wait":"Check All"),n.a.createElement(Be.a,{style:{marginLeft:"4px"},variant:"contained",color:"primary",disabled:v||0===D.length,onClick:function(e){A([])}},v?"Please Wait":"Uncheck All")),e.types.map((function(t,a){return n.a.createElement(y.a,{key:a},n.a.createElement(Qe.a,{control:n.a.createElement(Xe.a,{checked:D.includes(t._id),onChange:function(a){if(!v){T(!0);var r=Object(X.a)(D);a.target.checked?(r=function e(t,a,r,n){if(!n.includes(t._id)){n.push(t._id);for(var i=function(i){var s=a.filter((function(e){return e._id===t.SuperIDs[i]}));s.length>0&&(s=s[0],n=e(s,a,r,n))},s=0;s<t.SuperIDs.length;s++)i(s);for(var o=function(i){var s=r[t.Attributes[i].attrID];if("Type"===s.AttributeType||"List"===s.AttributeType&&"Type"===s.ListType){var o=a.filter((function(e){return e._id===s.DefinedType}));o.length>0&&(o=o[0],n=e(o,a,r,n))}},l=0;l<t.Attributes.length;l++)o(l)}return n}(t,e.types,e.attributesByID,r),A(r)):(r=function e(t,a,r,n){var i=n.indexOf(t._id);if(i>-1){n.splice(i);for(var s=a.filter((function(e){return e.SuperIDs.includes(t._id)})),o=0;o<s.length;o++){var l=s[o];l.length>0&&(n=e(l=l[0],a,r,n))}for(var c=a.filter((function(e){return void 0!==e.ReferenceIDs&&e.ReferenceIDs.includes(t._id)})),u=0;u<c.length;u++){n=e(c[u],a,r,n)}}return n}(t,e.types,e.attributesByID,r),A(r)),T(!1)}},name:"include_type_".concat(t._id),color:"primary"}),label:t.Name}))})))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:v||!O||0===D.length,onClick:function(t){T(!0),function(e,t,a,r,n){n(!0);var i={_id:null,Name:e.trim(),typeIDs:t,worldID:a.world._id};a.api.createTemplate(i).then((function(e){void 0===e.error?(r("Success"),setTimeout((function(){n(!1),a.onSave()}),500)):(r(e.error),n(!1))})).catch((function(e){return console.log(e)}))}(s,D,e,p,T)}},v?"Please Wait":"Submit")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){void 0!==e.onCancel&&null!==e.onCancel&&e.onCancel()}},"Cancel"))))}function at(e){var t=Object(r.useState)({}),a=Object(we.a)(t,2),i=a[0],s=a[1],o=Object(r.useState)(void 0===e.selectedTemplateIDs?[]:e.selectedTemplateIDs),l=Object(we.a)(o,2),c=l[0],u=l[1];return n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"Click a template to view its contents. Select the templates you want to import into your world. Any which have types or attributes with the same names (either with each other or with what you already have in your world), we will try to merge them if possible. If it's not, then we will append the names of them with the names of the templates they came from, and you can resolve it yourself afterward."),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:3},"Templates:",n.a.createElement(ae.a,null,e.templates.map((function(e,t){return n.a.createElement(y.a,{key:t},n.a.createElement(Xe.a,{checked:c.includes(e._id),onChange:function(t){var a=Object(X.a)(c);a.push(e._id),u(a)},name:"include_template_".concat(e._id),color:"primary"}),n.a.createElement(ne.a,{title:"Details for ".concat(e.Name)},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){s(e)}},e.Name)))})))),void 0!==i._id&&n.a.createElement(B.a,{item:!0,xs:9,container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},i.Name),n.a.createElement(B.a,{item:!0},"Types:"),i.Types.map((function(e,t){return n.a.createElement(B.a,{item:!0,key:t,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12,sm:3},e.Name),n.a.createElement(B.a,{item:!0,xs:12,sm:9},"Attributes (",e.Attributes.map((function(e,t){return n.a.createElement("span",{key:t},t>0&&n.a.createElement("span",null,",\xa0"),i.Attributes.filter((function(t){return t.attrID===e.attrID}))[0].Name)})),")"))})))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:0===c.length,onClick:function(t){e.onSubmit(c)}},"OK")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){void 0!==e.onCancel&&null!==e.onCancel&&e.onCancel()}},"Cancel"))))}var rt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).delete=function(e){a.api.deleteWorld(a.props.selectedWorldID).then((function(e){void 0===e.error?a.api.getWorlds(!0).then((function(e){a.props.setPublicWorlds(e.publicWorlds.worlds),a.props.setWorlds(e.userWorlds.worlds),a.props.setTemplates(e.templates.templates),a.props.selectWorld(null),a.setState({modalOpen:!1,redirectTo:"/"})})):a.setState({waiting:!1,message:e.error})}))},a.getModalStyle=function(){var e=Math.round(window.innerHeight/2)-50,t=Math.round(window.innerWidth/2)-200;return{top:"".concat(e,"%"),left:"".concat(t,"%"),transform:"translate(".concat(t,"px, ").concat(e,"px)")}},a.load=function(e){a.props.fromLogin&&a.props.notFromLogin(),setTimeout((function(){a.props.selectWorld(e),a.api.getWorld(e).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things)}))}),500)},a.requestToCollaborate=function(){a.api.requestToCollaborate(a.props.selectedWorldID).then((function(e){var t=a.props.selectedWorld;t.Collaborators.push(e),a.props.updatePublicWorldForCollab(t)}))},a.respondToInvite=function(){var e=a.props.selectedWorld.Collaborators.filter((function(e){return e.userID===a.props.user._id&&"invite"===e.type}))[0];a.setState({redirectTo:"/world/collaborate/".concat(a.props.selectedWorldID,"/").concat(e.collabID)})},a.updateTemplates=function(){a.api.getTemplates().then((function(e){a.props.setTemplates(e.templates),a.setState({templateMode:!1})}))},a.importSelectedTemplates=function(){var e=Object(X.a)(a.state.selectedTemplateIDs);if(e.length>0){var t=Object(H.a)({},a.props.templates.filter((function(t){return t._id===e[0]}))[0]);a.importDumbTypesRecursive(0,t.Types,[],{},t.Attributes,t.Name)}},a.importDumbTypesRecursive=function(e,t,r,n,i,s){var o=Object(H.a)({},t[e]),l=o.typeID,c=a.props.types.filter((function(e){return e.Name.trim().toLowerCase()===o.Name.trim().toLowerCase()}));c.length>0?(c=c[0],n[l]=c._id,r.push(c),c.Description!==o.Description||!c.Major&&o.Major?(c.Description!==o.Description&&(c.Description+=" From Template (".concat(s,") ").concat(o.Description)),o.Major&&(c.Major=!0),void 0!==c.PluralName&&""!==c.PluralName||(c.PluralName=o.PluralName),a.api.updateType(c).then((function(o){e++,t.length===e?a.compareAndFixAttributes(t,r,n,i,s):a.importDumbTypesRecursive(e,t,r,n,i,s)}))):(e++,t.length===e?a.compareAndFixAttributes(t,r,n,i,s):a.importDumbTypesRecursive(e,t,r,n,i,s))):(delete o.typeID,o.Attributes=[],o.worldID=a.props.selectedWorldID,a.api.createType(o).then((function(c){void 0===c.error?(n[l]=c.typeID,o._id=c.typeID,r.push(o),e++,t.length===e?a.compareAndFixAttributes(t,r,n,i,s):a.importDumbTypesRecursive(e,t,r,n,i,s)):console.log(c.error)})))},a.compareAndFixAttributes=function(e,t,r,n,i){var s=[],o={};n.forEach((function(e){var t=Object(H.a)({},e);delete t.attrID,("Type"===t.AttributeType||"List"===t.AttributeType&&"Type"===t.ListType)&&(t.DefinedType=r[t.DefinedType]);var n=a.props.attributesByName[t.Name];if(void 0!==n)if(t.AttributeType!==n.AttributeType||"List"===t.AttributeType&&t.ListType!==n.ListType)t.Name+=" From Template (".concat(i,")"),o[n.Name]=t.Name;else if(t._id=n._id,"Options"===t.AttributeType||"List"===t.AttributeType&&"Options"===t.ListType){var l=t.Options;t.Options=n.Options,l.forEach((function(e){t.Options.includes(e)||t.Options.push(e)}))}t.worldID=a.props.selectedWorldID,s.push(t)})),a.api.upsertAttributes(a.props.selectedWorldID,s).then((function(s){var l={};n.forEach((function(e){void 0!==o[e.Name]?l[e.attrID]=s.attributes[o[e.Name]]:l[e.attrID]=s.attributes[e.Name]})),a.addAttributesToDumbTypesRecursive(0,e,t,r,n,l,i)}))},a.addAttributesToDumbTypesRecursive=function(e,t,r,n,i,s,o){var l=t[e],c=r[e];if(l.Name!==c.Name)console.log("Names don't match");else{var u=!1;if(0===c.Attributes.length){var p=0;l.Attributes.forEach((function(e){var t=s[e.attrID];c.Attributes.push({attrID:t,index:p}),p++,u=!0}))}else{var d=c.Attributes.length;l.Attributes.forEach((function(e){var t=s[e.attrID];0===c.Attributes.filter((function(e){return e.attrID===t})).length&&(c.Attributes.push({attrID:t,index:d}),d++,u=!0)}))}u?a.api.updateType(c).then((function(l){void 0===l.error?(e++,t.length===e?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things);var t=Object(X.a)(a.state.selectedTemplateIDs);t.splice(0),a.setState({selectedTemplateIDs:t})})):a.addAttributesToDumbTypesRecursive(e,t,r,n,i,s,o)):console.log(l.error)})):(e++,t.length===e?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things);var t=Object(X.a)(a.state.selectedTemplateIDs);t.splice(0),a.setState({selectedTemplateIDs:t})})):a.addAttributesToDumbTypesRecursive(e,t,r,n,i,s,o))}},a.state={world:null,modalOpen:!1,redirectTo:null,templateMode:!1,importMode:!1,selectedTemplateIDs:[]},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"getAttributes",value:function(){var e=this;this.api.getAttributesForWorld(this.props.selectedWorldID).then((function(t){void 0!==t&&void 0===t.error&&(e.props.setAttributes(t.attributes),e.getTypes())}))}},{key:"getTypes",value:function(){var e=this;this.api.getTypesForWorld(this.props.selectedWorldID).then((function(t){if(void 0!==t&&void 0===t.error){var a=t.types,r=[];a.forEach((function(t){t.Supers=[],t.SuperIDs.forEach((function(e){t.Supers=t.Supers.concat(a.filter((function(t){return t._id===e})))})),t.AttributesArr=[],t.Attributes.forEach((function(a){var n=e.props.attributesByID[a.attrID];n.TypeIDs.push(t._id),r.push(n),t.AttributesArr.push({index:t.AttributesArr.length,Name:n.Name,AttributeType:n.AttributeType,Options:n.Options,DefinedType:n.DefinedType,ListType:n.ListType,attrID:a.attrID,TypeIDs:a.TypeIDs})}));var n={};void 0!==t.Defaults&&t.Defaults.forEach((function(e){n[e.attrID]=e})),t.DefaultsHash=n})),e.props.updateAttributes(r),e.props.setTypes(a),e.getThings()}}))}},{key:"getThings",value:function(){var e=this;this.api.getThingsForWorld(this.props.selectedWorldID).then((function(t){if(void 0!==t&&void 0===t.error){var a=t.things;a.forEach((function(t){t.Types=[],t.TypeIDs.forEach((function(a){t.Types=t.Types.concat(e.props.types.filter((function(e){return e._id===a})))}))})),e.props.setThings(a)}}))}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;return this.props.worlds.length>0&&(null===this.props.selectedWorldID||this.props.selectedWorldID!==t)&&this.load(t),null!==this.state.redirectTo?n.a.createElement(he.a,{to:this.state.redirectTo}):null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user?null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type})).length?this.state.templateMode?n.a.createElement(tt,{world:this.props.selectedWorld,types:this.props.types,attributesByID:this.props.attributesByID,templates:this.props.templates,onSave:function(t){e.updateTemplates()},onCancel:function(t){e.setState({templateMode:!1})},api:this.api}):this.state.importMode?n.a.createElement(at,{templates:this.props.templates,onSubmit:function(t){e.setState({selectedTemplateIDs:t,importMode:!1})},onCancel:function(t){e.setState({importMode:!1})}}):this.state.selectedTemplateIDs.length>0?(setTimeout((function(){e.importSelectedTemplates()}),500),n.a.createElement("span",null,"Importing ",this.props.templates.filter((function(t){return t._id===e.state.selectedTemplateIDs[0]}))[0].Name,".  Please Wait.")):n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},null!==this.props.selectedWorld&&n.a.createElement(B.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(Ve.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(B.a,{item:!0,xs:12,sm:8,container:!0,spacing:0,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement("h2",null,this.props.selectedWorld.Name)),n.a.createElement(B.a,{item:!0},this.props.selectedWorld.Description),n.a.createElement(B.a,{item:!0},n.a.createElement(U.a,{display:{xs:"none",sm:"block"}},n.a.createElement(Ye,null)))),null!==this.props.user&&n.a.createElement(B.a,{item:!0,xs:12,sm:4},this.props.selectedWorld.Owner===this.props.user._id?n.a.createElement(ae.a,null,n.a.createElement(y.a,null,n.a.createElement(B.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:4,sm:12},n.a.createElement(ne.a,{title:"Edit ".concat(this.props.selectedWorld.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/world/edit/".concat(e.props.selectedWorldID)})}},n.a.createElement(Me.a,null)))),n.a.createElement(B.a,{item:!0,xs:4,sm:12},n.a.createElement(ne.a,{title:"Edit Collaborators"},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/world/collaborators/".concat(e.props.selectedWorldID)})}},n.a.createElement(qe.a,null)))),n.a.createElement(B.a,{item:!0,xs:4,sm:12},n.a.createElement(ne.a,{title:"Delete ".concat(this.props.selectedWorld.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({modalOpen:!0})}},n.a.createElement(Ke.a,null)))))),n.a.createElement(y.a,null,n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.setState({templateMode:!0})}},"Create a Template")),n.a.createElement(y.a,null,n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.setState({importMode:!0})}},"Import Templates"))):n.a.createElement(ae.a,null,0===this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id})).length?n.a.createElement(y.a,null,this.props.selectedWorld.AcceptingCollaborators&&n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:this.requestToCollaborate,type:"button"},"Request to Collaborate")):this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"request"===t.type})).length>0?n.a.createElement(y.a,null,"Waiting on Collaboration Request"):this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"invite"===t.type})).length>0&&n.a.createElement(y.a,null,n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:this.respondToInvite,type:"button"},"You've been invited to Collaborate")))),n.a.createElement(B.a,{item:!0,xs:12},n.a.createElement(U.a,{display:{xs:"block",sm:"none"}},n.a.createElement(Ye,null)))),n.a.createElement(Ze.a,{"aria-labelledby":"delete-thing-modal","aria-describedby":"delete-thing-modal-description",open:this.state.modalOpen,onClose:function(t){e.setState({modalOpen:!1})}},n.a.createElement("div",{style:this.getModalStyle(),className:"paper"},n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"Are you sure you want to delete ",null!==this.props.selectedWorld?this.props.selectedWorld.Name:"","?"),n.a.createElement(B.a,{item:!0},"(All external references to it will be left alone and may not work correctly)"),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:this.delete},"Yes")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({modalOpen:!1})}},"Cancel"))))))):n.a.createElement(he.a,{to:"/"}):(setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login"))}}]),t}(r.Component),nt=Object(m.b)((function(e){return{selectedPage:e.app.selectedPage,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,worlds:e.app.worlds,publicWorlds:e.app.publicWorlds,types:e.app.types,things:e.app.things,user:e.app.user,attributesByID:e.app.attributesByID,attributesByName:e.app.attributesByName,fromLogin:e.app.fromLogin,templates:e.app.templates}}),(function(e){return{selectWorld:function(t){return e(O(t))},setTypes:function(t){return e(x(t))},setThings:function(t){return e(k(t))},setWorlds:function(t){return e(D(t))},setTemplates:function(t){return e(A(t))},setPublicWorlds:function(t){return e(N(t))},updatePublicWorldForCollab:function(t){return e({type:"UPDATE_PUBLIC_WORLD_COLLAB",payload:t})},setAttributes:function(t){return e(S(t))},updateAttributes:function(t){return e({type:"UPDATE_ATTRIBUTES",payload:t})},notFromLogin:function(){return e(R({}))},toggleLogin:function(){return e(P({}))}}}))(rt),it=a(276);var st=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleUserInput=function(e){var t=e.target.name,r="checkbox"===e.target.type?e.target.checked:e.target.value;a.setState(Object(Q.a)({},t,r))},a.inputBlur=function(e){var t=e.target.name,r=a.validateField(t),n=a.state.fieldValidation;void 0!==n[t]&&n[t].valid!==r.valid&&(n[t].valid=r.valid,n[t].message=r.message,a.setState({fieldValidation:n}))},a.a11yProps=function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}},a.validateField=function(e){var t=a.state[e],r=!0,n="";switch(e){case"Name":(r=null!==t.match(/^[a-zA-Z0-9 ]*$/i))?t.length<4?(r=!1,n="World Name is too short"):(r=0===a.props.worlds.filter((function(e){return e.Name===t&&e._id!==a.state._id})).length)||(n="This World Name is already in use"):n="Only Letters, Numbers, and Spaces allowed in World Names";break;case"inviteEmail":n=(r=null!==t.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid"}return{valid:r,message:n}},a.validateForm=function(e){var t=a.validateField("Name"),r=t.valid,n=a.state.fieldValidation;n.Name=t,a.setState({formValid:r,fieldValidation:n},e)},a.onSubmit=function(){a.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},a.submitThroughAPI=function(){var e={_id:a.state._id,Name:a.state.Name.trim(),Description:a.state.Description.trim(),Public:a.state.Public,AcceptingCollaborators:a.state.AcceptingCollaborators,Owner:a.props.user._id};null===e._id?a.api.createWorld(e).then((function(t){void 0!==t.error?a.setState({message:t.error},(function(){a.props.logout()})):(e._id=t.worldID,a.props.addWorld(e),a.props.selectWorld(e._id),void 0===a.state.tempSelectedTemplateIDs?a.setState({waiting:!1,redirectTo:"/world/details/".concat(t.worldID)}):a.setState({selectedTemplateIDs:a.state.tempSelectedTemplateIDs,tempSelectedTemplateIDs:[]}))})).catch((function(e){return console.log(e)})):a.api.updateWorld(e).then((function(t){void 0!==t.error?a.setState({message:t.error},(function(){a.props.logout()})):(a.props.updateWorld(e),a.setState({waiting:!1,redirectTo:"/world/details/".concat(a.props.selectedWorldID)}))})).catch((function(e){return console.log(e)}))},a.load=function(e){setTimeout((function(){a.setState({_id:e,redirectTo:null,loaded:!1},a.finishLoading)}),500)},a.finishLoading=function(){null===a.state._id?a.setState({Name:"",Description:"",AcceptingCollaborators:!1,Public:!1,loaded:!0}):a.api.selectWorld(a.state._id).then((function(e){a.props.selectWorld(a.state._id),a.api.getWorld(a.props.selectedWorldID).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things),a.setState({Name:a.props.selectedWorld.Name,Description:void 0===a.props.selectedWorld.Description?"":a.props.selectedWorld.Description,AcceptingCollaborators:void 0!==a.props.selectedWorld.AcceptingCollaborators&&a.props.selectedWorld.AcceptingCollaborators,Public:a.props.selectedWorld.Public,loaded:!0})}))}))},a.importSelectedTemplates=function(){var e=Object(X.a)(a.state.selectedTemplateIDs);if(e.length>0){var t=Object(H.a)({},a.props.templates.filter((function(t){return t._id===e[0]}))[0]);a.importDumbTypesRecursive(0,t.Types,[],{},t.Attributes,t.Name)}},a.importDumbTypesRecursive=function(e,t,r,n,i,s){var o=Object(H.a)({},t[e]),l=o.typeID,c=a.props.types.filter((function(e){return e.Name.trim().toLowerCase()===o.Name.trim().toLowerCase()}));c.length>0?(c=c[0],n[l]=c._id,r.push(c),c.Description!==o.Description||!c.Major&&o.Major?(c.Description!==o.Description&&(c.Description+=" From Template (".concat(s,") ").concat(o.Description)),o.Major&&(c.Major=!0),void 0!==c.PluralName&&""!==c.PluralName||(c.PluralName=o.PluralName),a.api.updateType(c).then((function(o){e++,t.length===e?a.compareAndFixAttributes(t,r,n,i,s):a.importDumbTypesRecursive(e,t,r,n,i,s)}))):(e++,t.length===e?a.compareAndFixAttributes(t,r,n,i,s):a.importDumbTypesRecursive(e,t,r,n,i,s))):(delete o.typeID,o.Attributes=[],o.worldID=a.props.selectedWorldID,a.api.createType(o).then((function(c){void 0===c.error?(n[l]=c.typeID,o._id=c.typeID,r.push(o),e++,t.length===e?a.compareAndFixAttributes(t,r,n,i,s):a.importDumbTypesRecursive(e,t,r,n,i,s)):console.log(c.error)})))},a.compareAndFixAttributes=function(e,t,r,n,i){var s=[],o={};n.forEach((function(e){var t=Object(H.a)({},e);delete t.attrID,("Type"===t.AttributeType||"List"===t.AttributeType&&"Type"===t.ListType)&&(t.DefinedType=r[t.DefinedType]);var n=a.props.attributesByName[t.Name];if(void 0!==n)if(t.AttributeType!==n.AttributeType||"List"===t.AttributeType&&t.ListType!==n.ListType)t.Name+=" From Template (".concat(i,")"),o[n.Name]=t.Name;else if(t._id=n._id,"Options"===t.AttributeType||"List"===t.AttributeType&&"Options"===t.ListType){var l=t.Options;t.Options=n.Options,l.forEach((function(e){t.Options.includes(e)||t.Options.push(e)}))}t.worldID=a.props.selectedWorldID,s.push(t)})),a.api.upsertAttributes(a.props.selectedWorldID,s).then((function(s){var l={};n.forEach((function(e){void 0!==o[e.Name]?l[e.attrID]=s.attributes[o[e.Name]]:l[e.attrID]=s.attributes[e.Name]})),a.addAttributesToDumbTypesRecursive(0,e,t,r,n,l,i)}))},a.addAttributesToDumbTypesRecursive=function(e,t,r,n,i,s,o){var l=t[e],c=r[e];if(l.Name!==c.Name)console.log("Names don't match");else{var u=!1;if(0===c.Attributes.length){var p=0;l.Attributes.forEach((function(e){var t=s[e.attrID];c.Attributes.push({attrID:t,index:p}),p++,u=!0}))}else{var d=c.Attributes.length;l.Attributes.forEach((function(e){var t=s[e.attrID];0===c.Attributes.filter((function(e){return e.attrID===t})).length&&(c.Attributes.push({attrID:t,index:d}),d++,u=!0)}))}u?a.api.updateType(c).then((function(l){void 0===l.error?(e++,t.length===e?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things);var t=Object(X.a)(a.state.selectedTemplateIDs);t.splice(0),0===t.length?a.setState({waiting:!1,redirectTo:"/world/details/".concat(a.props.selectedWorldID),selectedTemplateIDs:t}):a.setState({selectedTemplateIDs:t})})):a.addAttributesToDumbTypesRecursive(e,t,r,n,i,s,o)):console.log(l.error)})):(e++,t.length===e?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things);var t=Object(X.a)(a.state.selectedTemplateIDs);t.splice(0),0===t.length?a.setState({waiting:!1,redirectTo:"/world/details/".concat(a.props.selectedWorldID),selectedTemplateIDs:t}):a.setState({selectedTemplateIDs:t})})):a.addAttributesToDumbTypesRecursive(e,t,r,n,i,s,o))}},a.state={_id:null,Name:"",Description:"",Public:!1,AcceptingCollaborators:!1,fieldValidation:{Name:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,loaded:!0,importMode:!1,selectedTemplateIDs:[],tempSelectedTemplateIDs:[]},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;this.props.fromLogin&&this.props.notFromLogin();var t=this.props.match.params.id;return void 0===t&&(t=null),this.state._id!==t?(this.load(t),n.a.createElement("span",null,"Loading...")):this.state.loaded?null!==this.state.redirectTo?n.a.createElement(he.a,{to:this.state.redirectTo}):null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user?null!==this.props.selectedWorld&&this.props.selectedWorld.Owner!==this.props.user._id?n.a.createElement(he.a,{to:"/"}):this.state.importMode?n.a.createElement(at,{templates:this.props.templates,selectedTemplateIDs:this.state.tempSelectedTemplateIDs,onSubmit:function(t){e.setState({tempSelectedTemplateIDs:t,importMode:!1})},onCancel:function(t){e.setState({importMode:!1})}}):this.state.selectedTemplateIDs.length>0?(setTimeout((function(){e.importSelectedTemplates()}),500),n.a.createElement("span",null,"Importing ",this.props.templates.filter((function(t){return t._id===e.state.selectedTemplateIDs[0]}))[0].Name,".  Please Wait.")):n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(Ve.Helmet,null,n.a.createElement("title",null,null===this.state._id?"Author's Notebook: Create New World":"Author's Notebook: Edit ".concat(this.props.selectedWorld.Name))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:1},null!==this.props.selectedWorld&&n.a.createElement(ne.a,{title:"Back to ".concat(this.props.selectedWorld.Name," Details")},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/world/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(it.a,null)))),n.a.createElement(B.a,{item:!0,xs:11},n.a.createElement("h2",null,null===this.state._id?"Create New World":"Edit World"))),n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"name"},"Name"),n.a.createElement(te.a,{id:"name",name:"Name",type:"text",autoComplete:"Off",error:!this.state.fieldValidation.Name.valid,value:this.state.Name,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:43,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.Name.message))),n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"description"},"Description"),n.a.createElement(te.a,{id:"description",name:"Description",type:"text",autoComplete:"Off",multiline:!0,value:this.state.Description,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:80,fullWidth:!0}))),n.a.createElement(B.a,{item:!0},n.a.createElement(Qe.a,{control:n.a.createElement(Xe.a,{checked:this.state.Public,onChange:this.handleUserInput,name:"Public",color:"primary"}),label:"Public"}),this.state.Public?n.a.createElement(Qe.a,{control:n.a.createElement(Xe.a,{checked:this.state.AcceptingCollaborators,onChange:this.handleUserInput,name:"AcceptingCollaborators",color:"primary"}),label:"Accepting Collaborator Requests"}):""),n.a.createElement(B.a,{item:!0},this.state.message),void 0!==this.state.tempSelectedTemplateIDs&&this.state.tempSelectedTemplateIDs.length>0&&n.a.createElement(B.a,{item:!0},"Templates will be imported on submit"),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12,sm:4},n.a.createElement(Be.a,{variant:"contained",fullWidth:!0,color:"primary",disabled:this.state.waiting,onClick:function(t){e.setState({importMode:!0})},type:"submit"},"Import Templates")),n.a.createElement(B.a,{item:!0,xs:12,sm:4},n.a.createElement(Be.a,{variant:"contained",fullWidth:!0,color:"primary",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(B.a,{item:!0,xs:12,sm:4},n.a.createElement(Be.a,{variant:"contained",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.setState({redirectTo:null===e.state._id?"/":"/world/details/".concat(e.state._id)})},type:"button"},"Cancel"))),n.a.createElement(B.a,{item:!0},Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""})))):(setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")):n.a.createElement("span",null,"Loading...")}}]),t}(r.Component),ot=Object(m.b)((function(e){return{selectedPage:e.app.selectedPage,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,worlds:e.app.worlds,user:e.app.user,fromLogin:e.app.fromLogin,templates:e.app.templates,types:e.app.types,attributesByName:e.app.attributesByName}}),(function(e){return{selectWorld:function(t){return e(O(t))},addWorld:function(t){return e({type:"ADD_WORLD",payload:t})},updateWorld:function(t){return e(I(t))},notFromLogin:function(){return e(R({}))},toggleLogin:function(){return e(P({}))},setAttributes:function(t){return e(S(t))},setTypes:function(t){return e(x(t))},setThings:function(t){return e(k(t))},logout:function(){return e(w({}))}}}))(st),lt=a(277),ct=a(69),ut=a.n(ct),pt=a(70),dt=a.n(pt),mt=a(278),ht=a(162);var ft=function(e){function t(e){var a;Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=function(){a.state.email&&(a.validateField("email"),a.validateField("password"),a.setState({remember:!0}))},a.handleUserInput=function(e){var t=e.target.name,r="checkbox"===e.target.type?e.target.checked:e.target.value;a.setState(Object(Q.a)({},t,r))},a.inputBlur=function(e){var t=e.target.name,r=a.validateField(t),n=a.state.fieldValidation;n[t].valid!==r.valid&&(n[t].valid=r.valid,n[t].message=r.message,a.setState({fieldValidation:n}))},a.handleClickShowPassword=function(){a.setState({showPassword:!a.state.showPassword})},a.handleMouseDownPassword=function(e){e.preventDefault()},a.validateField=function(e){var t=!0,r="",n=a.state[e];switch(e){case"email":r=(t=null!==n.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid";break;case"password":r=(t=n.length>=6)?"":"Password is too short";break;case"confirmEmail":r=(t=n===a.state.email)?"":"Confirm Email doesn't match Email";break;case"confirmPassword":r=(t=n===a.state.password)?"":"Confirm Password doesn't match Password";break;case"username":r=(t=n.length>=2)?"":"Username is too short",t&&0!==a.state.allUsers.filter((function(e){return e.username===n})).length&&(t=!1,r="This Username is taken")}return{valid:t,message:r}},a.validateForm=function(e){var t=a.validateField("email"),r={valid:!0,message:""},n={valid:!0,message:""},i={valid:!0,message:""},s={valid:!0,message:""};switch(a.state.formMode){case"Login":n=a.validateField("password");break;case"Register":r=a.validateField("confirmEmail"),n=a.validateField("password"),i=a.validateField("confirmPassword"),s=a.validateField("username")}var o=t.valid&&n.valid&&r.valid&&i.valid&&s.valid,l=a.state.fieldValidation;l.email=t,l.password=n,l.confirmEmail=r,l.confirmPassword=i,l.username=s,a.setState({formValid:o,fieldValidation:l},e)},a.onSubmit=function(){a.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},a.submitThroughAPI=function(){var e={email:a.state.email.trim(),password:a.state.password,username:a.state.username.trim(),followingWorlds:a.props.followingWorlds};"login"===a.state.formMode?a.api.login(e,a.state.remember).then((function(e){if(null===e.user){var t=a.state.fieldValidation;t.loginError={message:e.error,valid:!1,show:!0},a.setState({fieldValidation:t,waiting:!1})}else a.props.userLogin(e.user),a.api.getWorldsForUser(e.user._id).then((function(e){a.props.setWorlds(e.worlds),a.props.onLogin(e.user)}))})).catch((function(e){return console.log(e)})):"register"===a.state.formMode?a.api.register(e).then((function(e){void 0===e.error?a.setState({message:e.message,formMode:"login",fieldValidation:{email:{valid:!0,message:""},password:{valid:!0,message:""},confirmEmail:{valid:!0,message:""},confirmPassword:{valid:!0,message:""},username:{valid:!0,message:""}},waiting:!1}):a.setState({message:e.error,waiting:!1})})).catch((function(e){return console.log(e)})):"password"===a.state.formMode&&a.api.sendReset(e).then((function(e){a.setState({message:e.message,formMode:"login",fieldValidation:{email:{valid:!0,message:""},password:{valid:!0,message:""},confirmEmail:{valid:!0,message:""},confirmPassword:{valid:!0,message:""},username:{valid:!0,message:""}},waiting:!1})})).catch((function(e){return console.log(e)}))},a.loginClick=function(){a.setState({formMode:"login"})},a.registerClick=function(){a.setState({formMode:"register"})},a.passwordClick=function(){a.setState({formMode:"password"})};var r=new ht.a,n=r.get("email"),i=r.get("password");return a.state={formMode:"login",email:void 0===n?"":n,password:void 0===i?"":i,confirmEmail:"",confirmPassword:"",fieldValidation:{email:{valid:!0,message:""},password:{valid:!0,message:""},confirmEmail:{valid:!0,message:""},confirmPassword:{valid:!0,message:""},username:{valid:!0,message:""}},formValid:!1,remember:!1,message:"",username:"",allUsers:null},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return null===this.state.allUsers?(this.api.getAllUsers().then((function(t){e.setState({allUsers:t})})),n.a.createElement("div",null)):"login"===this.state.formMode?n.a.createElement("div",null,n.a.createElement("h2",null,"Login"),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"email"},"Email"),n.a.createElement(te.a,{id:"email",name:"email",type:"email",error:!this.state.fieldValidation.email.valid,value:this.state.email,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:40,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.email.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"outlined-adornment-password"},"Password"),n.a.createElement(te.a,{id:"outlined-adornment-password",name:"password",type:this.state.showPassword?"text":"password",value:this.state.password,error:!this.state.fieldValidation.password.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(lt.a,{position:"end"},n.a.createElement(b.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ut.a,null):n.a.createElement(dt.a,null))),labelWidth:70,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.password.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(Qe.a,{control:n.a.createElement(Xe.a,{checked:this.state.remember,onChange:this.handleUserInput,name:"remember",color:"primary"}),label:"Stay Signed In"}))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"float-left"},n.a.createElement(mt.a,{onClick:this.registerClick},"Register")," ",n.a.createElement(mt.a,{onClick:this.passwordClick},"Forgot Password")),n.a.createElement("div",{className:"float-right"},n.a.createElement(Be.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")))),this.state.message,Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))):"register"===this.state.formMode?n.a.createElement("div",null,n.a.createElement("h2",null,"Register"),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-6"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"username"},"Username"),n.a.createElement(te.a,{id:"username",name:"username",type:"text",value:this.state.username,error:!this.state.fieldValidation.username.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:80,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.username.message))))),n.a.createElement("div",{className:"col-sm-6"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"email"},"Email"),n.a.createElement(te.a,{id:"email",name:"email",type:"email",value:this.state.email,error:!this.state.fieldValidation.email.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:40,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.email.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"confirmEmail"},"Confirm Email"),n.a.createElement(te.a,{id:"confirmEmail",name:"confirmEmail",type:"email",error:!this.state.fieldValidation.confirmEmail.valid,value:this.state.confirmEmail,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:100,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.confirmEmail.message)))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"outlined-adornment-password"},"Password"),n.a.createElement(te.a,{id:"outlined-adornment-password",name:"password",type:this.state.showPassword?"text":"password",value:this.state.password,error:!this.state.fieldValidation.password.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(lt.a,{position:"end"},n.a.createElement(b.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ut.a,null):n.a.createElement(dt.a,null))),labelWidth:70,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.password.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"confirm-password"},"Confirm Password"),n.a.createElement(te.a,{id:"confirm-password",name:"confirmPassword",type:this.state.showPassword?"text":"password",value:this.state.confirmPassword,error:!this.state.fieldValidation.confirmPassword.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(lt.a,{position:"end"},n.a.createElement(b.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ut.a,null):n.a.createElement(dt.a,null))),labelWidth:130,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.confirmPassword.message)))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"float-left"},n.a.createElement(mt.a,{onClick:this.loginClick},"Login")," ",n.a.createElement(mt.a,{onClick:this.passwordClick},"Forgot Password")," "),n.a.createElement("div",{className:"float-right"},n.a.createElement(Be.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")))),this.state.message,Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))):"password"===this.state.formMode?n.a.createElement("div",null,n.a.createElement("h2",null,"Forgot Password?"),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"email"},"Email"),n.a.createElement(te.a,{id:"email",name:"email",type:"email",value:this.state.email,error:!this.state.fieldValidation.email.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:40,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.email.message)))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"float-left"},n.a.createElement(mt.a,{onClick:this.registerClick},"Register")," ",n.a.createElement(mt.a,{onClick:this.loginClick},"Login")),n.a.createElement("div",{className:"float-right"},n.a.createElement(Be.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")))),this.state.message,Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))):void 0}}]),t}(r.Component),bt=Object(m.b)((function(e){return{user:e.app.user,loginError:e.app.loginError,followingWorlds:e.app.followingWorlds}}),(function(e){return{userLogin:function(t){return e({type:"LOGIN",payload:t})},setWorlds:function(t){return e(D(t))},setFollowingWorlds:function(t){return e(M(t))}}}))(ft);var yt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=function(){},a.accept=function(){null===a.props.user?a.setState({waiting:!1,accepted:!0}):a.setState({waiting:!0},a.submitAccept)},a.submitAccept=function(){a.api.acceptCollabInvite(a.state.worldID,a.state.collabID).then((function(e){a.setState({waiting:!1,accepted:!0},a.getWorlds)}))},a.getWorlds=function(){a.api.getWorldsForUser().then((function(e){void 0!==e.worlds&&a.props.setWorlds(e.worlds),a.refreshWorld()}))},a.refreshWorld=function(){a.api.getWorld(a.state.worldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things)}))},a.onLoginAccept=function(e){a.setState({waiting:!0},a.submitAccept)},a.decline=function(){a.setState({waiting:!0},a.submitDecline)},a.submitDecline=function(){a.api.declineCollabInvite(a.state.worldID,a.state.collabID).then((function(e){a.setState({waiting:!1,accepted:!1},a.refreshWorld)}))},a.state={worldID:null,collabID:null,codeValid:!1,accepted:null,message:"Please wait.  Validating code.",world:null},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;if(null===this.state.collabID){var t=this.props.match.params,a=t.worldID,r=t.collabID;return setTimeout((function(){e.api.checkCollabID(a,r).then((function(t){void 0!==t.error?e.setState({collabID:r,worldID:a,codeValid:!1,message:t.error}):e.setState({collabID:r,worldID:a,world:t.world,codeValid:!0,message:""})}))}),500),n.a.createElement("div",null,n.a.createElement("h2",null,this.state.message))}return this.state.codeValid?null===this.state.accepted?n.a.createElement(B.a,{container:!0,spacing:1},n.a.createElement(B.a,{item:!0,xs:12},n.a.createElement("h2",null,"You've been invited to collaborate on ",this.state.world.Name)),n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.accept,type:"button"},"Accept")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.decline,type:"button"},"Decline")))):this.state.accepted?null===this.props.user?n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement("h2",null,"Please log in (or register and then log in if you're new) so we can add you as a collaborator on ",this.state.world.Name,".")),n.a.createElement(B.a,{item:!0},n.a.createElement(bt,{onLogin:this.onLoginAccept}))):n.a.createElement(B.a,{container:!0,spacing:1},n.a.createElement(B.a,{item:!0,xs:12},n.a.createElement("h2",null,"Congratulations! You can now collaborate on ",this.state.world.Name))):n.a.createElement(B.a,{container:!0,spacing:1},n.a.createElement(B.a,{item:!0,xs:12},"Okay.  Well, we hope you enjoy working on other worlds.")):n.a.createElement("div",null,n.a.createElement("h2",null,this.state.message))}}]),t}(r.Component),gt=Object(m.b)((function(e){return{user:e.app.user}}),(function(e){return{setWorlds:function(t){return e(D(t))},setAttributes:function(t){return e(S(t))},setTypes:function(t){return e(x(t))},setThings:function(t){return e(k(t))}}}))(yt),vt=a(289),Tt=a(279),Et=a(290),wt=a(280),Dt=a(281);function At(e){var t=e.children,a=e.value,r=e.index;return n.a.createElement("div",null,a===r&&n.a.createElement(U.a,{p:3},t))}var It=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleUserInput=function(e){var t=e.target.name,r="checkbox"===e.target.type?e.target.checked:e.target.value;a.setState(Object(Q.a)({},t,r))},a.inputBlur=function(e){var t=e.target.name,r=a.validateField(t),n=a.state.fieldValidation;void 0!==n[t]&&n[t].valid!==r.valid&&(n[t].valid=r.valid,n[t].message=r.message,a.setState({fieldValidation:n}))},a.a11yProps=function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}},a.validateField=function(e){var t=a.state[e],r=!0,n="";switch(e){case"inviteEmail":n=(r=null!==t.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid"}return{valid:r,message:n}},a.addNewCollaborator=function(){a.setState({waiting:!0},(function(){var e=this;this.api.addNewCollaborator(this.props.selectedWorldID,this.state.selectedUser._id,this.state.selectedUser.email).then((function(t){if(void 0===t.error){var a=Object(X.a)(e.state.Collaborators);a.push(t);var r=e.props.selectedWorld;r.Collaborators=a,e.props.updateWorld(r),e.setState({Collaborators:a,inviteMessage:"Invite Sent",selectedUser:"",waiting:!1})}else e.setState({message:t.error,waiting:!1},(function(){e.props.logout()}))}))}))},a.emailCollaborator=function(){if(a.validateField("inviteEmail")){a.setState({waiting:!0},(function(){var e=this;this.api.emailCollaborator(this.props.selectedWorldID,this.state.inviteEmail).then((function(t){if(void 0===t.error){var a=Object(X.a)(e.state.Collaborators);a.push(t);var r=e.props.selectedWorld;r.Collaborators=a,e.props.updateWorld(r),e.setState({Collaborators:a,inviteMessage:"Email Sent",inviteEmail:"",waiting:!1})}else e.setState({message:t.error,waiting:!1},(function(){e.props.logout()}))}))}))}},a.updateCollaboratorPermission=function(e,t){e.editPermission=t,a.setState({waiting:!0},(function(){var a=this;this.api.updateCollaboratorPermission(this.props.selectedWorldID,e.collabID,t).then((function(r){if(void 0===r.error){var n=Object(X.a)(a.state.Collaborators);n.filter((function(t){return t.collabID===e.collabID}))[0].editPermission=t;var i=a.props.selectedWorld;i.Collaborators=n,a.props.updateWorld(i),a.setState({Collaborators:n,waiting:!1})}else a.setState({message:r.error,waiting:!1},(function(){a.props.logout()}))}))}))},a.generateCollabLink=function(){a.setState({waiting:!0},(function(){var e=this;this.api.generateCollabLink(this.props.selectedWorldID).then((function(t){if(void 0===t.error){var a=Object(X.a)(e.state.Collaborators);a.push(t);var r=e.props.selectedWorld;r.Collaborators=a,e.props.updateWorld(r),e.setState({collabLink:t.collabLink,collabLinkCopied:!1,Collaborators:a,waiting:!1})}else e.setState({message:t.error,waiting:!1},(function(){e.props.logout()}))}))}))},a.deleteCollab=function(e){a.setState({waiting:!0},(function(){var t=this;this.api.deleteCollab(this.props.selectedWorldID,e.collabID).then((function(a){if(void 0===a.error){var r=t.state.Collaborators.filter((function(t){return t.collabID!==e.collabID})),n=t.props.selectedWorld;n.Collaborators=r,t.props.updateWorld(n),t.setState({collabLink:a.collabLink,collabLinkCopied:!1,Collaborators:r,waiting:!1})}else t.setState({message:a.error,waiting:!1},(function(){t.props.logout()}))}))}))},a.acceptCollab=function(e){a.setState({waiting:!0},(function(){var t=this;this.api.acceptCollabRequest(this.props.selectedWorldID,e.collabID).then((function(a){if(void 0===a.error){var r=Object(X.a)(t.state.Collaborators);r.filter((function(t){return t.collabID===e.collabID}))[0].type="collab";var n=t.props.selectedWorld;n.Collaborators=r,t.props.updateWorld(n),t.setState({Collaborators:r,waiting:!1})}else t.setState({message:a.error,waiting:!1},(function(){t.props.logout()}))}))}))},a.copyCollabLink=function(){a.generatedLink.children[0].select(),document.execCommand("copy"),a.setState({collabLinkCopied:!0})},a.load=function(e){a.props.fromLogin&&a.props.notFromLogin(),setTimeout((function(){a.setState({_id:e,loaded:!1},a.finishLoading)}),500)},a.finishLoading=function(){a.api.selectWorld(a.state._id),a.props.selectWorld(a.state._id),a.api.getWorld(a.state._id).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things),a.api.getAllUsers().then((function(e){a.setState({allUsers:e,loaded:!0},a.actuallyFinishLoading)}))}))},a.actuallyFinishLoading=function(){var e=a.props.worlds.filter((function(e){return e._id===a.state._id}));e.length>0&&(e=e[0],a.setState({Name:e.Name,Public:e.Public,AcceptingCollaborators:void 0!==e.AcceptingCollaborators&&null!==e.AcceptingCollaborators&&e.AcceptingCollaborators,Collaborators:void 0===e.Collaborators?[]:e.Collaborators}))},a.state={_id:null,Collaborators:[],allUsers:null,fieldValidation:{inviteEmail:{valid:!0,message:""}},message:"",redirectTo:null,newCollaborators:!1,newCollabTab:0,collabTab:0,collabLink:null,collabLinkCopied:!1,selectedUser:"",inviteEmail:"",inviteMessage:"",waiting:!1},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;this.props.fromLogin&&this.props.notFromLogin();var t=this.props.match.params.id;if(void 0===t&&(t=null),this.state._id!==t)return this.load(t),n.a.createElement("span",null,"Loading...");if(this.state.loaded){if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null!==this.props.selectedWorld&&null===this.props.user)return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login");if(null!==this.props.selectedWorld&&this.props.selectedWorld.Owner!==this.props.user._id)return n.a.createElement(he.a,{to:"/"});var a=this.state.Collaborators.filter((function(e){return"collab"===e.type})),r=this.state.Collaborators.filter((function(e){return"invite"===e.type})),i=this.state.Collaborators.filter((function(e){return"request"===e.type})),s=this.state.allUsers.filter((function(t){return t._id!==e.props.selectedWorld.Owner&&0===e.state.Collaborators.filter((function(e){return e.userID===t._id})).length})).map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e},e.username)}));return n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(Ve.Helmet,null,n.a.createElement("title",null,null===this.state._id?"Author's Notebook: Create New World":"Author's Notebook: Edit ".concat(this.props.selectedWorld.Name," Collaborators"))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:1},n.a.createElement(ne.a,{title:"Back to ".concat(this.props.selectedWorld.Name," Details")},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/world/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(it.a,null)))),n.a.createElement(B.a,{item:!0,xs:11},n.a.createElement("h2",null,"Edit Collaborators"))),n.a.createElement(B.a,{item:!0},n.a.createElement(y.a,{style:{maxWidth:"200px"}},n.a.createElement(g.a,{primary:"Collaborators"}),this.state.newCollaborators?n.a.createElement(ne.a,{title:"Manage Existing Collaborators"},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({newCollaborators:!1})}},n.a.createElement(it.a,null))):n.a.createElement(ne.a,{title:"Add New Collaborators"},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({newCollaborators:!0})}},n.a.createElement(oe.a,null))))),this.state.newCollaborators?n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement(h.a,{position:"static"},n.a.createElement(vt.a,{value:this.state.newCollabTab,onChange:function(t,a){e.setState({newCollabTab:a,inviteMessage:""})},"aria-label":"Add Collaborator Method"},n.a.createElement(Tt.a,Object.assign({label:"Find Existing User"},this.a11yProps(0))),n.a.createElement(Tt.a,Object.assign({label:"Invite via Email"},this.a11yProps(1))),n.a.createElement(Tt.a,Object.assign({label:"Get an Invite Link"},this.a11yProps(2))))),n.a.createElement(At,{value:this.state.newCollabTab,index:0},n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"user-select",id:"user-select-label"},"Select a User"),n.a.createElement(Et.a,{labelId:"user-select-label",id:"user-select",value:this.state.selectedUser,onChange:function(t){e.setState({selectedUser:t.target.value,inviteMessage:""})},labelWidth:90},s))),n.a.createElement(B.a,{item:!0},n.a.createElement(Be.a,{variant:"contained",color:"primary",disabled:""===this.state.selectedUser||this.state.waiting,onClick:this.addNewCollaborator},"Send Invite"),this.state.inviteMessage))),n.a.createElement(At,{value:this.state.newCollabTab,index:1},n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"inviteEmail"},"Collaborator Email"),n.a.createElement(te.a,{id:"inviteEmail",name:"inviteEmail",type:"email",autoComplete:"Off",error:!this.state.fieldValidation.inviteEmail.valid,value:this.state.inviteEmail,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:140,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.inviteEmail.message))),n.a.createElement(B.a,{item:!0},n.a.createElement(Be.a,{variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.emailCollaborator},"Send Invite"),this.state.inviteMessage))),n.a.createElement(At,{value:this.state.newCollabTab,index:2},n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"Generate a single use link to send someone yourself"),n.a.createElement(B.a,{item:!0},n.a.createElement(Be.a,{variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.generateCollabLink},"Generate Link")),null!==this.state.collabLink&&n.a.createElement(B.a,{item:!0},n.a.createElement(te.a,{id:"generatedLink",name:"generatedLink",ref:function(t){return e.generatedLink=t},type:"text",multiline:!0,value:this.state.collabLink,endAdornment:n.a.createElement(lt.a,{position:"end"},n.a.createElement(b.a,{"aria-label":"copy to clipboard",onClick:this.copyCollabLink,edge:"end"},n.a.createElement(wt.a,null))),labelWidth:70,fullWidth:!0}),this.state.collabLinkCopied&&n.a.createElement("span",{style:{fontColor:"red"}},"Link Copied to Clipboard")))))):n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement(h.a,{position:"static"},n.a.createElement(vt.a,{value:this.state.collabTab,onChange:function(t,a){e.setState({collabTab:a})},"aria-label":"Collaborators"},n.a.createElement(Tt.a,Object.assign({label:"Collaborators (".concat(a.length,")")},this.a11yProps(0))),n.a.createElement(Tt.a,Object.assign({label:"Invites (".concat(r.length,")")},this.a11yProps(1))),n.a.createElement(Tt.a,Object.assign({label:"Requests (".concat(i.length,")")},this.a11yProps(2))))),n.a.createElement(At,{value:this.state.collabTab,index:0},n.a.createElement(B.a,{container:!0,spacing:3,direction:"column"},a.map((function(t,a){return n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direcion:"row",key:a},n.a.createElement(B.a,{item:!0,xs:12,sm:3},e.state.allUsers.filter((function(e){return e._id===t.userID}))[0].username),n.a.createElement(B.a,{item:!0,xs:12,sm:6},n.a.createElement(Qe.a,{control:n.a.createElement(Xe.a,{checked:t.editPermission,disabled:e.state.waiting,onChange:function(a){e.updateCollaboratorPermission(t,a.target.checked)},color:"primary"}),label:"Full Permissions"})),n.a.createElement(B.a,{item:!0,xs:12,sm:3},n.a.createElement(ne.a,{title:"Remove Collaborator"},n.a.createElement(re.a,{size:"small",color:"primary",disabled:e.state.waiting,onClick:function(a){e.deleteCollab(t)}},n.a.createElement(Ke.a,null)))))})))),n.a.createElement(At,{value:this.state.collabTab,index:1},n.a.createElement(B.a,{container:!0,spacing:3,direction:"column"},r.map((function(t,a){var r=e.state.allUsers.filter((function(e){return e._id===t.userID}));return r=0===r.length?null:r[0],n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row",key:a},n.a.createElement(B.a,{item:!0,xs:12,sm:9,container:!0,spacing:1,direction:"column"},null!==r&&n.a.createElement(B.a,{item:!0},"Username: ",r.username),""!==t.email&&n.a.createElement(B.a,{item:!0},"Email: ",t.email),n.a.createElement(B.a,{item:!0},"Invite Link: ",t.collabLink)),n.a.createElement(B.a,{item:!0,xs:12,sm:3},n.a.createElement(ne.a,{title:"Delete Invite"},n.a.createElement(re.a,{size:"small",color:"primary",disabled:e.state.waiting,onClick:function(a){e.deleteCollab(t)}},n.a.createElement(Ke.a,null)))))})))),n.a.createElement(At,{value:this.state.collabTab,index:2},n.a.createElement(B.a,{container:!0,spacing:3,direction:"column"},i.map((function(t,a){return n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direcion:"row",key:a},n.a.createElement(B.a,{item:!0,xs:12,sm:6},e.state.allUsers.filter((function(e){return e._id===t.userID}))[0].username),n.a.createElement(B.a,{item:!0,xs:12,sm:3},n.a.createElement(ne.a,{title:"Accept Request"},n.a.createElement(re.a,{size:"small",color:"primary",disabled:e.state.waiting,onClick:function(a){e.acceptCollab(t)}},n.a.createElement(Dt.a,null)))),n.a.createElement(B.a,{item:!0,xs:12,sm:3},n.a.createElement(ne.a,{title:"Delete Request"},n.a.createElement(re.a,{size:"small",color:"primary",disabled:e.state.waiting,onClick:function(a){e.deleteCollab(t)}},n.a.createElement(Ke.a,null)))))})))))),n.a.createElement(B.a,{item:!0},this.state.message),n.a.createElement(B.a,{item:!0},Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))))}return n.a.createElement("span",null,"Loading...")}}]),t}(r.Component),Nt=Object(m.b)((function(e){return{selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,worlds:e.app.worlds,user:e.app.user,fromLogin:e.app.fromLogin}}),(function(e){return{updateWorld:function(t){return e(I(t))},selectWorld:function(t){return e(O(t))},notFromLogin:function(){return e(R({}))},toggleLogin:function(){return e(P({}))},logout:function(){return e(w({}))},setAttributes:function(t){return e(S(t))},setTypes:function(t){return e(x(t))},setThings:function(t){return e(k(t))}}}))(It);var Ot=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).getModalStyle=function(){var e=Math.round(window.innerHeight/2)-50,t=Math.round(window.innerWidth/2)-200;return{top:"".concat(e,"%"),left:"".concat(t,"%"),transform:"translate(".concat(t,"px, ").concat(e,"px)")}},a.delete=function(e){a.api.deleteType(a.props.selectedWorldID,a.state._id).then((function(e){void 0===e.error?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things),a.setState({redirectTo:"/world/details/".concat(a.props.selectedWorldID)})})):a.setState({waiting:!1,message:e.error},(function(){a.props.logout()}))}))},a.load=function(e){setTimeout((function(){a.setState({_id:e,redirectTo:null},a.finishLoading)}),500)},a.finishLoading=function(){a.props.fromLogin&&a.props.notFromLogin();var e=a.state._id;void 0!==e?a.api.getWorld(a.props.selectedWorldID).then((function(t){if(a.props.setAttributes(t.attributes),a.props.setTypes(t.types),a.props.setThings(t.things),null!==e){var r=t.types.filter((function(t){return t._id===e}));r.length>0?(r=r[0],a.props.updateSelectedType(r)):a.setState({message:"Invalid ID",loaded:!0})}else a.props.updateSelectedType({_id:null,Name:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}})})):a.props.updateSelectedType({_id:null,Name:"",Description:"",Supers:[],AttributesArr:[],Attributes:[],Major:!1})},a.redirectToNext=function(){for(var e=0;a.props.types[e]._id!==a.props.selectedType._id;)e++;++e===a.props.types.length&&(e=0),a.setState({redirectTo:"/type/details/".concat(a.props.types[e]._id)})},a.state={_id:null,fieldValidation:{Name:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,modalOpen:!1},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;if(this.state._id!==t&&this.load(t),null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user){if(null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type})).length){if(void 0===this.props.selectedType||null===this.props.selectedType)return n.a.createElement("span",null,"Loading");var a=this.props.types.filter((function(t){return void 0!==t.ReferenceIDs&&t.ReferenceIDs.includes(e.state._id)})),r=[];return this.props.selectedType.Supers.forEach((function(e){e.AttributesArr.forEach((function(e){0===r.filter((function(t){return t.attrID===e.attrID})).length&&r.push(e)}))})),n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},null===this.props.selectedWorld?"":n.a.createElement("div",null,n.a.createElement(Ve.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(B.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12,sm:8,container:!0,spacing:0,direction:"column"},n.a.createElement(B.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(B.a,{item:!0,xs:1},n.a.createElement(ne.a,{title:"Back to ".concat(this.props.selectedWorld.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/world/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(it.a,null)))),n.a.createElement(B.a,{item:!0,xs:11},n.a.createElement("h2",null,this.props.selectedType.Name))),n.a.createElement(B.a,{item:!0},n.a.createElement("h3",null,this.props.selectedType.Major?"Major Type":"")),n.a.createElement(B.a,{item:!0},this.props.selectedType.Description)),n.a.createElement(B.a,{item:!0,xs:12,sm:4},n.a.createElement(ae.a,null,null!==this.props.user&&null!==this.props.selectedWorld&&(this.props.selectedWorld.Owner===this.props.user._id||this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length>0)&&n.a.createElement(y.a,null,n.a.createElement(B.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:4,sm:12},n.a.createElement(ne.a,{title:"Create New ".concat(this.props.selectedType.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/thing/create/type_id_".concat(e.state._id)})}},n.a.createElement(oe.a,null)))),n.a.createElement(B.a,{item:!0,xs:4,sm:12},n.a.createElement(ne.a,{title:"Edit ".concat(this.props.selectedType.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/type/edit/".concat(e.state._id)})}},n.a.createElement(Me.a,null)))),n.a.createElement(B.a,{item:!0,xs:4,sm:12},n.a.createElement(ne.a,{title:"Delete ".concat(this.props.selectedType.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({modalOpen:!0})}},n.a.createElement(Ke.a,null)))))),n.a.createElement(y.a,null,n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(g.a,{primary:"Next Type"})))))),n.a.createElement(B.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12,sm:8,container:!0,spacing:0,direction:"column"},n.a.createElement(B.a,{item:!0},"Attributes"),n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,null!==this.props.selectedType&&void 0!==this.props.selectedType&&r.map((function(t,a){var r=e.props.types.filter((function(e){return e._id===t.DefinedType}));r=0===r.length?{Name:""}:r[0];var i=e.props.selectedType.DefaultsHash[t.attrID];return n.a.createElement(y.a,{key:a},n.a.createElement(g.a,null,t.Name,":\xa0","Options"===t.AttributeType?n.a.createElement("span",null,"Options:",t.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&" (Default: ".concat(i.DefaultValue,")")):"Type"===t.AttributeType?n.a.createElement("span",null,n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t.DefinedType)})}},n.a.createElement(g.a,{primary:r.Name})),void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&e.props.things.filter((function(e){return i.DefaultValue===e._id})).length>0&&" (Default: ".concat(e.props.things.filter((function(e){return e._id===i.DefaultValue}))[0].Name,")")):"List"===t.AttributeType?n.a.createElement("span",null,"List:\xa0","Options"===t.ListType?n.a.createElement("span",null,"Options:",t.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),")")):"Type"===t.ListType?n.a.createElement("span",null,n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t.DefinedType)})}},n.a.createElement(g.a,{primary:r.Name})),void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&e.props.things.filter((function(e){return i.DefaultListValues.includes(e._id)})).length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(t,a){var r=e.props.things.filter((function(e){return e._id===t}));return 0===r.length?n.a.createElement("span",{key:a}):(r=r[0],n.a.createElement("span",{key:a},0===a?" ":", ",n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t)})}},n.a.createElement(g.a,{primary:r.Name}))))})),")")):n.a.createElement("span",null,t.ListType,void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),")"))):"True/False"===t.AttributeType?n.a.createElement("span",null,t.AttributeType,void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue?" (Default: ".concat(i.DefaultValue,")"):" (Default: False)"):n.a.createElement("span",null,t.AttributeType,void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&" (Default: ".concat(i.DefaultValue,")"))))})),null!==this.props.selectedType&&void 0!==this.props.selectedType&&this.props.selectedType.AttributesArr.map((function(t,a){var r=e.props.types.filter((function(e){return e._id===t.DefinedType}));r=0===r.length?{Name:""}:r[0];var i=e.props.selectedType.DefaultsHash[t.attrID];return n.a.createElement(y.a,{key:a},n.a.createElement(g.a,null,t.Name,":\xa0","Options"===t.AttributeType?n.a.createElement("span",null,"Options:",t.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&" (Default: ".concat(i.DefaultValue,")")):"Type"===t.AttributeType?n.a.createElement("span",null,n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t.DefinedType)})}},n.a.createElement(g.a,{primary:r.Name})),void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&e.props.things.filter((function(e){return i.DefaultValue===e._id})).length>0&&" (Default: ".concat(e.props.things.filter((function(e){return e._id===i.DefaultValue}))[0].Name,")")):"List"===t.AttributeType?n.a.createElement("span",null,"List:\xa0","Options"===t.ListType?n.a.createElement("span",null,"Options:",t.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),")")):"Type"===t.ListType?n.a.createElement("span",null,n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t.DefinedType)})}},n.a.createElement(g.a,{primary:r.Name})),void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&e.props.things.filter((function(e){return i.DefaultListValues.includes(e._id)})).length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(t,a){var r=e.props.things.filter((function(e){return e._id===t}));return 0===r.length?n.a.createElement("span",{key:a}):(r=r[0],n.a.createElement("span",{key:a},0===a?" ":", ",n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t)})}},n.a.createElement(g.a,{primary:r.Name}))))})),")")):n.a.createElement("span",null,t.ListType,void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),")"))):"True/False"===t.AttributeType?n.a.createElement("span",null,t.AttributeType,void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue?" (Default: ".concat(i.DefaultValue,")"):" (Default: False)"):n.a.createElement("span",null,t.AttributeType,void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&" (Default: ".concat(i.DefaultValue,")"))))}))))),n.a.createElement(B.a,{item:!0,xs:12,sm:4,container:!0,spacing:0,direction:"column"},this.props.selectedType.Supers.length>0&&n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,n.a.createElement(y.a,null,n.a.createElement(g.a,{primary:"Super Types"})),this.props.selectedType.Supers.map((function(t,a){return n.a.createElement(y.a,{key:a},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},n.a.createElement(g.a,{primary:t.Name})))})))),this.props.subTypes.length>0&&n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,n.a.createElement(y.a,null,n.a.createElement(g.a,{primary:"Sub Types"})),this.props.subTypes.map((function(t,a){return n.a.createElement(y.a,{key:a},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},n.a.createElement(g.a,{primary:t.Name})))})))),a.length>0&&n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,n.a.createElement(y.a,null,n.a.createElement(g.a,{primary:"Referenced in:"})),a.map((function(t,a){return n.a.createElement(y.a,{key:a},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},n.a.createElement(g.a,{primary:t.Name})))})))),this.props.instances.length>0&&n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,n.a.createElement(y.a,null,n.a.createElement(g.a,{primary:"Instances"})),this.props.instances.map((function(t,a){return n.a.createElement(y.a,{key:a},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t._id)})}},n.a.createElement(g.a,{primary:t.Name})))})))))),n.a.createElement(Ze.a,{"aria-labelledby":"delete-type-modal","aria-describedby":"delete-type-modal-description",open:this.state.modalOpen,onClose:function(t){e.setState({modalOpen:!1})}},n.a.createElement("div",{style:this.getModalStyle(),className:"paper"},n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"Are you sure you want to delete"," ",this.props.selectedType.Name,"?"),n.a.createElement(B.a,{item:!0},"(All references to it will be left alone and may not work correctly)"),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:this.delete},"Yes")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({modalOpen:!1})}},"Cancel"))))))))}return n.a.createElement(he.a,{to:"/"})}return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")}}]),t}(r.Component),St=Object(m.b)((function(e){var t=e.app.selectedType,a=null===t?[]:e.app.types.filter((function(e){return e.SuperIDs.includes(t._id)})),r=null===t?[]:e.app.things.filter((function(e){return e.TypeIDs.includes(t._id)}));return{selectedPage:e.app.selectedPage,selectedType:t,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,types:e.app.types,subTypes:a,instances:r,user:e.app.user,things:e.app.things,attributesByID:e.app.attributesByID,attributesByName:e.app.attributesByName,fromLogin:e.app.fromLogin}}),(function(e){return{updateSelectedType:function(t){return e(_(t))},addType:function(t){return e(W(t))},updateType:function(t){return e(L(t))},setTypes:function(t){return e(x(t))},setAttributes:function(t){return e(S(t))},setThings:function(t){return e(k(t))},notFromLogin:function(){return e(R({}))},toggleLogin:function(){return e(P({}))},logout:function(){return e(w({}))}}}))(Ot),xt=a(90),Wt=a.n(xt),kt=a(48),Ct=a(53),Lt=a.n(Ct),_t=function(e,t){var a=t.attribute;a.DefinedType=e.target.value,"new"===e.target.value?t.onNewType(a):t.onChange(a)},jt=function(e,t){var a=t.attribute;a.Options=e,t.onChange(a)};function Ft(e){var t=Object(r.useState)(e.attribute.Name),a=Object(we.a)(t,2),i=a[0],s=a[1],o=["Text","Number","True/False","Options","Type","List"],l=["Text","Options","Type"],c=void 0===e.attribute.AttributeType||null===e.attribute.AttributeType||""===e.attribute.AttributeType?o[0]:e.attribute.AttributeType,u=void 0===e.attribute.ListType||""===e.attribute.ListType?l[0]:e.attribute.ListType,p=void 0===e.attribute.DefinedType||""===e.attribute.DefinedType?"":e.attribute.DefinedType,d=void 0===e.attribute.FromTypeIDs?[]:e.types.filter((function(t){return e.attribute.FromTypeIDs.includes(t._id)}));return n.a.createElement(B.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,sm:3,xs:12},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"AttrName_".concat(e.attribute.attrID,"_").concat(e.attribute.index)},"Name"),n.a.createElement(te.a,{disabled:e.disabled,id:"AttrName_".concat(e.attribute.attrID,"_").concat(e.attribute.index),name:"AttrName_".concat(e.attribute.attrID,"_").concat(e.attribute.index),type:"text",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a=e.attribute;a.Name=i,e.onChange(a)},labelWidth:43,fullWidth:!0}),n.a.createElement($e.a,null,e.message))),n.a.createElement(B.a,{item:!0,sm:3,xs:12},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"attribute-type",id:"attribute-type-label"},"Attribute Type"),n.a.createElement(Et.a,{labelId:"attribute-type-label",id:"attribute-type",disabled:e.disabled,value:c,onChange:function(t){!function(e,t){var a=t.attribute;a.AttributeType=e.target.value,a.ListType="Text",t.onChange(a)}(t,e)},fullWidth:!0,labelWidth:100},o.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e},e)}))))),n.a.createElement(B.a,{item:!0,sm:3,xs:12},"Options"===c?n.a.createElement(Lt.a,{variant:"outlined",disabled:e.disabled,defaultValue:e.attribute.Options,onChange:function(t){return jt(t,e)}}):"Type"===c?n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"definedType",id:"definedType-label"},"Defined Type"),n.a.createElement(Et.a,{labelId:"definedType-label",id:"definedType",disabled:e.disabled,value:p,onChange:function(t){_t(t,e)},fullWidth:!0,labelWidth:100},n.a.createElement(Ie.a,{value:"new"},"+ Create New Type"),e.types.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e._id},e.Name)})))):"List"===c?n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"list-type",id:"list-type-label"},"List Type"),n.a.createElement(Et.a,{labelId:"list-type-label",id:"list-type",disabled:e.disabled,value:u,onChange:function(t){!function(e,t){var a=t.attribute;a.ListType=e.target.value,t.onChange(a)}(t,e)},fullWidth:!0,labelWidth:70},l.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e},e)}))))),"Type"===e.attribute.ListType?n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"definedType",id:"definedType-label"},"Defined Type"),n.a.createElement(Et.a,{labelId:"definedType-label",id:"definedType",disabled:e.disabled,value:p,onChange:function(t){_t(t,e)},fullWidth:!0,labelWidth:100},n.a.createElement(Ie.a,{value:"new"},"+ Create New Type"),e.types.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e._id},e.Name)}))))):"Options"===e.attribute.ListType?n.a.createElement(B.a,{item:!0},n.a.createElement(Lt.a,{variant:"outlined",disabled:e.disabled,defaultValue:e.attribute.Options,onChange:function(t){return jt(t,e)}})):""):""),n.a.createElement(B.a,{item:!0,xs:3},1===d.length?"From Type: ".concat(d[0].Name):d.length>1?n.a.createElement("span",null,"From Types:",d.map((function(e,t){return n.a.createElement("span",{key:t},t>0&&", ",e.Name)}))):n.a.createElement(ne.a,{title:"Delete Attribute"},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){return e.onDelete(e.attribute)}},n.a.createElement(Ke.a,null)))))}function Vt(e){var t=Object(r.useState)(e.def.DefaultValue),a=Object(we.a)(t,2),i=a[0],s=a[1],o=""===e.attribute.AttributeType?"Text":e.attribute.AttributeType,l="Type"!==o||void 0===e.def.DefaultValue||""===e.def.DefaultValue?"":e.def.DefaultValue,c=[],u=[];if("List"===o&&"Options"===e.attribute.ListType)e.attribute.Options.forEach((function(e){c.push({Name:e})})),e.def.DefaultListValues.forEach((function(e){u.push({Name:e})}));else if("List"===o&&"Type"===e.attribute.ListType){var p=e.types.filter((function(t){return t._id===e.attribute.DefinedType}))[0];c.push({Name:"+ Create New ".concat(p.Name),_id:"new"}),e.things.filter((function(t){return t.TypeIDs.includes(e.attribute.DefinedType)})).forEach((function(e){c.push({Name:e.Name,_id:e._id})})),c.filter((function(t){return e.def.DefaultListValues.includes(t._id)})).forEach((function(e){u.push(e)}))}return n.a.createElement(B.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12},"Text"===o?n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"attribute_name_".concat(e.attribute.attrID)},e.attribute.Name," Default Value"),n.a.createElement(te.a,{id:"attribute_name_".concat(e.attribute.attrID),name:"attribute_name_".concat(e.attribute.attrID),type:"text",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a=e.def;a.DefaultValue=i,e.onChange(a)},labelWidth:9*e.attribute.Name.length+100,fullWidth:!0}),n.a.createElement($e.a,null,e.message)):"Number"===o?n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"numField"},e.attribute.Name," Default Value"),n.a.createElement(te.a,{id:"numField",name:"numField",type:"number",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a=e.def;a.DefaultValue=i,e.onChange(a)},labelWidth:9*e.attribute.Name.length+100,fullWidth:!0}),n.a.createElement($e.a,null,e.message)):"True/False"===o?n.a.createElement(Qe.a,{control:n.a.createElement(Xe.a,{checked:"True"===e.def.DefaultValue,onChange:function(t){var a=e.def;a.DefaultValue=t.target.checked?"True":"False",e.onChange(a)},color:"primary"}),label:"".concat(e.attribute.Name," Default True")}):"Options"===o?n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"options-select",id:"options-select-label"},e.attribute.Name," Default Value"),n.a.createElement(Et.a,{labelId:"options-select-label",id:"options-select",value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){var a=e.def;a.DefaultValue=i,e.onChange(a)},fullWidth:!0,labelWidth:9*e.attribute.Name.length+100},e.attribute.Options.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e},e)})))):"Type"===o?n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"type-select",id:"type-select-label"},e.attribute.Name," Default Value"),n.a.createElement(Et.a,{labelId:"type-select-label",id:"type-select",value:l,onChange:function(t){!function(e,t){var a=t.attribute;"new"===e.target.value?t.onNewThing(a):(a.DefaultValue=e.target.value,t.onChange(a))}(t,e)},fullWidth:!0,labelWidth:9*e.attribute.Name.length+100},n.a.createElement(Ie.a,{value:"new"},"+ Create New"," ",e.types.filter((function(t){return t._id===e.attribute.DefinedType}))[0].Name),e.things.filter((function(t){return t.TypeIDs.includes(e.attribute.DefinedType)})).map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e._id},e.Name)})))):"List"===o?n.a.createElement("span",null,"Text"===e.attribute.ListType?n.a.createElement(Lt.a,{placeholder:"".concat(e.attribute.Name," Default Values"),variant:"outlined",defaultValue:e.def.DefaultListValues,onChange:function(t){return function(e,t){var a=t.def;a.DefaultListValues=e,t.onChange(a)}(t,e)}}):"Options"===e.attribute.ListType?n.a.createElement(kt.Multiselect,{placeholder:"".concat(e.attribute.Name," Default Values"),options:c,selectedValues:u,onSelect:function(t,a){!function(e,t){var a=t.def;a.DefaultListValues.push(e.Name),t.onChange(a)}(a,e)},onRemove:function(t,a){!function(e,t){var a=t.def;a.DefaultListValues=[],e.forEach((function(e){a.DefaultListValues.push(e.Name)})),t.onChange(a)}(t,e)},displayValue:"Name"}):"Type"===e.attribute.ListType?n.a.createElement(kt.Multiselect,{placeholder:"".concat(e.attribute.Name," Default Values"),options:c,selectedValues:u,onSelect:function(t,a){!function(e,t){if("new"===e._id)setTimeout((function(){var e=t.attribute;t.onNewThing(e)}),500);else{var a=t.def;a.DefaultListValues.push(e._id),t.onChange(a)}}(a,e)},onRemove:function(t,a){!function(e,t){var a=t.def;a.DefaultListValues=[],e.forEach((function(e){a.DefaultListValues.push(e._id)})),t.onChange(a)}(t,e)},displayValue:"Name"}):""):""))}var Pt=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).newAttribute=function(){var e=a.props.selectedType;e.AttributesArr.push({index:e.AttributesArr.length,attrID:"null_".concat(Wt()()),Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:""}),a.props.updateSelectedType(e)},a.changeAttribute=function(e){var t=a.props.selectedType;t.AttributesArr[e.index]={index:e.index,attrID:e.attrID,Name:e.Name,AttributeType:e.AttributeType,Options:e.Options,DefinedType:e.DefinedType,ListType:e.ListType},a.props.updateSelectedType(t)},a.changeDefault=function(e){var t=a.props.selectedType;t.DefaultsHash[e.attrID]={attrID:e.attrID,DefaultValue:e.DefaultValue,DefaultListValues:e.DefaultListValues,FromTypeIDs:e.FromTypeIDs},a.props.updateSelectedType(t)},a.blurAttribute=function(e){},a.deleteAttribute=function(e){var t=a.props.selectedType,r=[];t.AttributesArr.forEach((function(t){t.index!==e.index&&(t.index>e.index&&t.index--,r.push(t))})),t.AttributesArr=[];var n=Object(H.a)({},t.DefaultsHash);void 0!==n[e.attrID]&&delete n[e.attrID],t.DefaultsHash={},a.props.updateSelectedType(t),setTimeout((function(){t.AttributesArr=r,t.DefaultsHash=n,a.props.updateSelectedType(t)}),500)},a.addNewType=function(e){a.props.addNewType(e)},a.addNewThing=function(e){a.props.addNewThing(e)},a.state={message:"",waiting:!1,defaultsMode:!1},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=[];return this.props.selectedType.SuperIDs.forEach((function(a){var r=e.props.types.filter((function(e){return e._id===a}));r.length>0&&(r=r[0]).AttributesArr.forEach((function(e){var a=t.filter((function(t){return t.attrID===e.attrID}));0===a.length?(e.FromTypeIDs=[r._id],t.push(e)):(a=a[0]).FromTypeIDs.push(r._id)}))})),n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,null!==this.props.selectedType&&void 0!==this.props.selectedType&&t.map((function(t,a){var r=e.props.selectedType.DefaultsHash[t.attrID];return void 0===r&&(r={attrID:t.attrID,DefaultValue:"",DefaultListValues:[]}),n.a.createElement(y.a,{key:a},e.props.defaultsMode?n.a.createElement(Vt,{typeID:e.props.selectedType._id,attribute:t,def:r,onChange:e.changeDefault,types:e.props.types,things:e.props.things,onNewThing:e.addNewThing}):n.a.createElement(Ft,{typeID:e.props.selectedType._id,disabled:!0,attribute:t,types:e.props.types,things:e.props.things,onNewType:e.addNewType}))})),null!==this.props.selectedType&&void 0!==this.props.selectedType&&this.props.selectedType.AttributesArr.map((function(t,a){var r=e.props.selectedType.DefaultsHash[t.attrID];return void 0===r&&(r={attrID:t.attrID,DefaultValue:"",DefaultListValues:[]}),n.a.createElement(y.a,{key:a},e.props.defaultsMode?n.a.createElement(Vt,{typeID:e.props.selectedType._id,attribute:t,def:r,onChange:e.changeDefault,onBlur:e.blurAttribute,types:e.props.types,things:e.props.things,onNewThing:e.addNewThing}):n.a.createElement(Ft,{typeID:e.props.selectedType._id,attribute:t,onChange:e.changeAttribute,onDelete:e.deleteAttribute,onBlur:e.blurAttribute,types:e.props.types,things:e.props.things,onNewType:e.addNewType}))})))))}}]),t}(r.Component),Rt=Object(m.b)((function(e){return{selectedType:e.app.selectedType,types:e.app.types,things:e.app.things,selectedWorldID:e.app.selectedWorldID}}),(function(e){return{updateSelectedType:function(t){return e(_(t))},addType:function(t){return e(W(t))},addThing:function(t){return e(C(t))}}}))(Pt);function Mt(e){var t=Object(r.useState)(""),a=Object(we.a)(t,2),i=a[0],s=a[1],o=Object(r.useState)(""),l=Object(we.a)(o,2),c=l[0],u=l[1],p=Object(r.useState)(!1),d=Object(we.a)(p,2),m=d[0],h=d[1];return n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"Just give the new Type a name."),n.a.createElement(B.a,{item:!0},"(You can do the rest later.)"),n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"name"},"Name"),n.a.createElement(te.a,{id:"name",name:"Name",type:"text",autoComplete:"Off",error:""!==c,value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){!function(e,t,a){a(0===t.types.filter((function(t){return t.Name===e})).length?"":"This Type Name is already in use")}(i,e,u)},labelWidth:43,fullWidth:!0}),n.a.createElement($e.a,null,c))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:m,onClick:function(t){h(!0),function(e,t,a,r,n){var i={_id:null,Name:e.trim(),Description:"",SuperIDs:[],AttributesArr:[],Attributes:[],worldID:t.selectedWorldID,Major:!1};t.api.createType(i).then((function(e){void 0!==e.typeID?(i._id=e.typeID,i.Supers=[],t.addType&&t.addType(i),n(!1),t.onSave&&(a(""),t.onSave(i))):void 0!==e.error&&(n(!1),r(e.error),t.logout())})).catch((function(e){return console.log(e)}))}(i,e,s,u,h)}},m?"Please Wait":"Submit")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){void 0!==e.onCancel&&null!==e.onCancel&&e.onCancel()}},"Cancel"))))}function Bt(e){var t=Object(r.useState)(""),a=Object(we.a)(t,2),i=a[0],s=a[1],o=Object(r.useState)(""),l=Object(we.a)(o,2),c=l[0],u=l[1],p=Object(r.useState)(!1),d=Object(we.a)(p,2),m=d[0],h=d[1];return n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"Just give the new ",void 0===e.newThingType.Name?"Thing":e.newThingType.Name," a name."),n.a.createElement(B.a,{item:!0},"(You can do the rest later.)"),n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"name"},"Name"),n.a.createElement(te.a,{id:"name",name:"Name",type:"text",autoComplete:"Off",error:""!==c,value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){!function(e,t,a){a(0===t.things.filter((function(t){return t.Name===e})).length?"":"This Thing Name is already in use")}(i,e,u)},labelWidth:43,fullWidth:!0}),n.a.createElement($e.a,null,c))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:m,onClick:function(t){h(!0),function(e,t,a,r,n){n(!0);var i={_id:null,Name:e.trim(),Description:"",TypeIDs:void 0===t.newThingType?[]:[t.newThingType._id],Attributes:[],worldID:t.selectedWorldID,ReferenceIDs:[]};t.api.createThing(i).then((function(e){void 0!==e.thingID?(i._id=e.thingID,i.Types=void 0===t.newThingType?[]:[t.newThingType],i.AttributesArr=[],t.addThing(i),a(""),n(!1),t.onSave(i)):void 0!==e.error&&(r(e.error),n(!1),t.logout())})).catch((function(e){return console.log(e)}))}(i,e,s,u,h)}},m?"Please Wait":"Submit")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){void 0!==e.onCancel&&null!==e.onCancel&&e.onCancel()}},"Cancel"))))}var Ut=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).resetForm=function(){setTimeout((function(){void 0!==a.props.match.params.id?a.setState({resetting:!1,loaded:!0,redirectTo:"/type/create"}):a.setState({resetting:!1,loaded:!0})}),500)},a.inputBlur=function(e){var t=e.target.name,r=a.validateField(t),n=a.state.fieldValidation;void 0!==n[t]&&n[t].valid!==r.valid&&(n[t].valid=r.valid,n[t].message=r.message,a.setState({fieldValidation:n}))},a.validateField=function(e){var t=null,r=!0,n="";switch(e){case"Name":(r=null!==(t=a.props.selectedType[e]).match(/^[a-zA-Z0-9 ]*$/i))?t.length<2?(r=!1,n="Type Name is too short"):(r=0===a.props.types.filter((function(e){return e.Name===t&&e._id!==a.state._id})).length)||(n="This Type Name is already in use"):n="Only Letters, Numbers, and Spaces allowed in Type Names";break;case"AttributesArr":r=!0,t=a.props.selectedType[e],n="";for(var i=0;i<t.length;i++){var s=a.props.attributesByName[t[i].Name];if(void 0!==s&&s._id!==t[i].attrID){r=!1,n="An attribute with the name '".concat(t[i].Name,"' already exists");break}if(("Type"===t[i].AttributeType||"List"===t[i].AttributeType&&"Type"===t[i].ListType)&&(void 0===t[i].DefinedType||null===t[i].DefinedType||""===t[i].DefinedType)){r=!1,n="A Defined Type must be selected for ".concat(t[i].Name,".");break}if(("Options"===t[i].AttributeType||"List"===t[i].AttributeType&&"Options"===t[i].ListType)&&(void 0===t[i].Options||null===t[i].Options||0===t[i].Options.length)){r=!1,n="At least one Option must be set for ".concat(t[i].Name,".");break}}break;case"Attributes":r=!0,t=a.props.selectedType[e],n="";for(var o=0;o<t.length;o++){var l=a.props.attributesByName[t[o].Name];if(void 0!==l&&l._id!==t[o].attrID){r=!1,n="An attribute with this name already exists";break}if(("Type"===t[o].AttributeType||"List"===t[o].AttributeType&&"Type"===t[o].ListType)&&(void 0===t[o].DefinedType||null===t[o].DefinedType||""===t[o].DefinedType)){r=!1,n="A Defined Type must be selected for ".concat(t[o].Name,".");break}if(("Options"===t[o].AttributeType||"List"===t[o].AttributeType&&"Options"===t[o].ListType)&&(void 0===t[o].Options||null===t[o].Options||0===t[o].Options.length)){r=!1,n="At least one Option must be set for ".concat(t[o].Name,".");break}}}return{valid:r,message:n}},a.validateForm=function(e){var t=a.validateField("Name"),r=a.validateField("AttributesArr"),n=t.valid&&r.valid,i=a.state.fieldValidation;i.Name=t,i.AttributesArr=r,a.setState({formValid:n,fieldValidation:i},e)},a.onSubmit=function(e){a.validateForm((function(){this.state.formValid&&this.setState({waiting:!0,addMore:e},this.submitThroughAPI)}))},a.submitThroughAPI=function(){var e=a.props.selectedType.Supers.map((function(e){return e._id})),t=a.props.selectedType.AttributesArr.map((function(e){return{_id:e.attrID,Name:e.Name.trim(),AttributeType:e.AttributeType,Options:e.Options,DefinedType:e.DefinedType,ListType:e.ListType}}));a.api.upsertAttributes(a.props.selectedWorldID,t).then((function(t){var r=[];a.props.selectedType.AttributesArr.forEach((function(e){var a=e.attrID.includes("null")?t.attributes[e.Name]:e.attrID;r.push({attrID:a,index:e.index})}));var n={_id:a.state._id,Name:a.props.selectedType.Name.trim(),PluralName:void 0===a.props.selectedType.PluralName?"":a.props.selectedType.PluralName.trim(),Description:a.props.selectedType.Description,SuperIDs:e,Attributes:r,Defaults:[],worldID:a.props.selectedWorld._id,Major:a.props.selectedType.Major,ReferenceIDs:[],DefaultReferenceIDs:[]};a.props.selectedType.AttributesArr.filter((function(e){return"Type"===e.AttributeType||"List"===e.AttributeType&&"Type"===e.ListType})).forEach((function(e){n.ReferenceIDs.includes(e.DefinedType)||n.ReferenceIDs.push(e.DefinedType)})),a.props.selectedType.Supers.forEach((function(e){e.AttributesArr.filter((function(e){return"Type"===e.AttributeType||"List"===e.AttributeType&&"Type"===e.ListType})).forEach((function(e){n.ReferenceIDs.includes(e.DefinedType)||n.ReferenceIDs.push(e.DefinedType)}))})),Object.keys(a.props.selectedType.DefaultsHash).forEach((function(e){var t=a.props.selectedType.DefaultsHash[e];n.Defaults.push({attrID:e,FromTypeID:t.FromTypeID,DefaultValue:t.DefaultValue,DefaultListValues:t.DefaultListValues})})),null===n._id?a.api.createType(n).then((function(e){void 0!==e.typeID?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things),"add"===a.state.addMore?(a.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),a.setState({_id:null,fieldValidation:{Name:{valid:!0,message:""},AttributesArr:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,addMore:!1,resetting:!0,loaded:!1},a.resetForm)):"next"===a.state.addMore?a.redirectToNext():a.setState({waiting:!1,redirectTo:"/world/details/".concat(a.props.selectedWorld._id)})})):void 0!==e.error&&a.setState({waiting:!1,message:e.error},(function(){a.props.logout()}))})).catch((function(e){return console.log(e)})):a.api.updateType(n).then((function(e){void 0===e.error?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things),"add"===a.state.addMore?(a.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),a.setState({_id:null,fieldValidation:{Name:{valid:!0,message:""},AttributesArr:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,addMore:!1,resetting:!0,loaded:!1},a.resetForm)):"next"===a.state.addMore?a.redirectToNext():a.setState({waiting:!1,redirectTo:"/world/details/".concat(a.props.selectedWorld._id)})})):a.setState({waiting:!1,message:e.error},(function(){a.props.logout()}))})).catch((function(e){return console.log(e)}))}))},a.supersChange=function(e,t){for(var r=[],n=0;n<t.length;n++){var i=t[n];r.push(i),r=r.concat(i.Supers)}var s=a.props.selectedType;s.Supers=r,a.props.updateSelectedType(s)},a.addSuper=function(e,t){var r=a.props.selectedType;r.SuperIDs.push(t._id),t.Supers.forEach((function(t){0===e.filter((function(e){return e._id===t._id})).length&&(e.push(t),r.SuperIDs.push(t._id))}));var n=[];e.forEach((function(e){n=n.concat(r.AttributesArr.filter((function(t){return t.TypeIDs.includes(e._id)})))})),r.AttributesArr=r.AttributesArr.filter((function(e){return 0===n.filter((function(t){return t.attrID===e.attrID})).length})),r.Supers=e,a.props.updateSelectedType(r)},a.newAttribute=function(){var e=a.props.selectedType;e.AttributesArr.push({index:e.AttributesArr.length,attrID:"null_".concat(Wt()()),Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:"",TypeIDs:[]}),a.props.updateSelectedType(e)},a.addSelectedAttribute=function(){var e=a.props.attributesByID[a.state.browseAttributesSelected],t=a.props.selectedType;t.AttributesArr.push({index:t.AttributesArr.length,attrID:e._id,Name:e.Name,AttributeType:e.AttributeType,Options:e.Options,DefinedType:e.DefinedType,ListType:e.ListType,TypeIDs:e.TypeIDs}),a.props.updateSelectedType(t),a.setState({browseAttributesSelected:"",browseTypesSelected:""})},a.addBrowsedType=function(e){var t=a.props.selectedType,r=a.props.types.filter((function(t){return t._id===e}))[0];t.SuperIDs.push(r._id);var n=t.Supers;n.push(r),r.Supers.forEach((function(e){0===n.filter((function(t){return t._id===e._id})).length&&(n.push(e),t.SuperIDs.push(e._id))}));var i=[];n.forEach((function(e){i=i.concat(t.AttributesArr.filter((function(t){return t.TypeIDs.includes(e._id)})))})),t.AttributesArr=t.AttributesArr.filter((function(e){return 0===i.filter((function(t){return t.attrID===e.attrID})).length})),t.Supers=[],a.props.updateSelectedType(t),setTimeout((function(){t.Supers=n,a.props.updateSelectedType(t),a.setState({browseAttributesSelected:"",browseTypesSelected:""})}),500)},a.removeSuper=function(e,t){for(var r=[],n=[],i=[t._id],s=a.props.selectedType,o=function(e){var o=a.props.types.filter((function(t){return t._id===s.Supers[e]._id}))[0];o._id===t._id||o.SuperIDs.includes(t._id)?i.push(o._id):(r.push(o),n.push(o._id))},l=0;l<s.Supers.length;l++)o(l);s.Supers=[],s.SuperIDs=[],a.props.updateSelectedType(s),a.setState({loaded:!1}),setTimeout((function(){s.Supers=r,s.SuperIDs=n,a.props.updateSelectedType(s),a.setState({loaded:!0})}),500)},a.redirectToNext=function(){var e=0;if(void 0===a.props.selectedType||null!==a.props.selectedType._id){for(;a.props.types[e]._id!==a.props.selectedType._id;)e++;e++}e===a.props.types.length&&(e=0),a.setState({waiting:!1,redirectTo:"/type/edit/".concat(a.props.types[e]._id)})},a.load=function(e){setTimeout((function(){a.setState({_id:e,redirectTo:null,loaded:!1,message:"Loading..."},a.finishLoading)}),500)},a.finishLoading=function(){var e=a.state._id;a.props.fromLogin?(a.props.notFromLogin(),a.setState({_id:e,loaded:!0,message:""})):a.api.getWorld(a.props.selectedWorldID).then((function(t){if(a.props.setAttributes(t.attributes),a.props.setTypes(t.types),a.props.setThings(t.things),null!==e){var r=t.types.filter((function(t){return t._id===e}));if(r.length>0){r=r[0];var n=a.props.types.filter((function(e){return r.SuperIDs.includes(e._id)}));r.Supers=n,a.props.updateSelectedType(r),a.setState({_id:e,loaded:!0,message:""})}else a.api.getWorld(a.props.selectedWorldID,!0).then((function(t){if(a.props.setAttributes(t.attributes),a.props.setTypes(t.types),a.props.setThings(t.things),null!==e){var r=t.types.filter((function(t){return t._id===e}));if(r.length>0){r=r[0];var n=a.props.types.filter((function(e){return r.SuperIDs.includes(e._id)}));r.Supers=n,a.props.updateSelectedType(r),a.setState({_id:e,loaded:!0,message:""})}else a.setState({message:"Invalid ID: ".concat(e),loaded:!0})}else a.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),a.setState({message:"",loaded:!0})}))}else a.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),a.setState({message:"",loaded:!0})}))},a.changeDefault=function(e){var t=a.props.selectedType;t.DefaultsHash[e.attrID]={attrID:e.attrID,DefaultValue:e.DefaultValue,DefaultListValues:e.DefaultListValues,FromTypeIDs:e.FromTypeIDs},a.props.updateSelectedType(t)},a.newAttribute=function(){var e=a.props.selectedType;e.AttributesArr.push({index:e.AttributesArr.length,attrID:"null_".concat(Wt()()),Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:""}),a.props.updateSelectedType(e)},a.changeAttribute=function(e){var t=a.props.selectedType;t.AttributesArr[e.index]={index:e.index,attrID:e.attrID,Name:e.Name,AttributeType:e.AttributeType,Options:e.Options,DefinedType:e.DefinedType,ListType:e.ListType},a.props.updateSelectedType(t)},a.deleteAttribute=function(e){var t=a.props.selectedType,r=[];t.AttributesArr.forEach((function(t){t.index!==e.index&&(t.index>e.index&&t.index--,r.push(t))})),t.AttributesArr=[];var n=Object(H.a)({},t.DefaultsHash);void 0!==n[e.attrID]&&delete n[e.attrID],t.DefaultsHash={},a.props.updateSelectedType(t),setTimeout((function(){t.AttributesArr=r,t.DefaultsHash=n,a.props.updateSelectedType(t)}),500)},a.renderAttributes=function(){return n.a.createElement(Rt,{defaultsMode:a.state.defaultsMode,addNewType:function(e){a.setState({typeModalOpen:!0,putTypeOnAttribute:e})},addNewThing:function(e){a.setState({thingModalOpen:!0,newThingType:a.props.types.filter((function(t){return t._id===e.DefinedType}))[0],putThingOnAttribute:e})}})},a.state={_id:void 0,Major:!1,fieldValidation:{Name:{valid:!0,message:""},AttributesArr:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,addMore:"",resetting:!1,browseAttributes:!1,browseAttributesSelected:"",browseTypesSelected:"",newThingType:{}},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;if(void 0===t&&(t=null),this.state._id!==t)return this.load(t),n.a.createElement("span",null,"Loading...");if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user){if(null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length){if(null===this.props.selectedType||this.props.selectedType._id!==t)return n.a.createElement("span",null,this.state.message);if(this.state.typeModalOpen)return n.a.createElement(Mt,{types:this.props.types,selectedWorldID:this.props.selectedWorldID,onCancel:function(t){e.setState({typeModalOpen:!1})},addType:function(t){e.props.addType(t)},onSave:function(t){var a=e.props.selectedType;a.AttributesArr.filter((function(t){return t.attrID===e.state.putTypeOnAttribute.attrID}))[0].DefinedType=t._id,e.props.updateSelectedType(a),e.setState({typeModalOpen:!1})},api:this.api,logout:function(){e.props.logout()}});if(this.state.thingModalOpen)return n.a.createElement(Bt,{things:this.props.things,newThingType:this.state.newThingType,selectedWorldID:this.props.selectedWorldID,onCancel:function(t){e.setState({thingModalOpen:!1})},addThing:function(t){e.props.addThing(t)},onSave:function(t){e.setState({thingModalOpen:!1},(function(a){var r=e.props.selectedType,n=r.AttributesArr.filter((function(t){return t.attrID===e.state.putThingOnAttribute.attrID}))[0],i=e.props.selectedType.DefaultsHash[n.attrID];void 0===i&&(i={attrID:n.attrID,DefaultValue:"",DefaultListValues:[]}),"Type"===n.AttributeType?i.DefaultValue=t._id:i.DefaultListValues.push(t._id),e.props.updateSelectedType(r)}))},api:this.api,logout:function(){e.props.logout()}});var a=void 0===this.props.types||null===this.state._id?this.props.types:this.props.types.filter((function(t){return t._id!==e.state._id})),r=[],i=[],s="";return this.state.browseAttributes&&(Object.keys(this.props.attributesByID).forEach((function(t){var a=e.props.attributesByID[t];if(!a.TypeIDs.includes(e.props.selectedType._id)&&0===e.props.selectedType.AttributesArr.filter((function(e){return e.attrID===a._id})).length){for(var n=!1,i=0;i<e.props.selectedType.Supers.length;i++)if(a.TypeIDs.includes(e.props.selectedType.Supers[i]._id)){n=!0;break}n||r.push({_id:a._id,Name:a.Name})}})),""!==this.state.browseAttributesSelected&&(s=this.props.attributesByID[this.state.browseAttributesSelected].Name,i=this.props.types.filter((function(t){return e.props.attributesByID[e.state.browseAttributesSelected].TypeIDs.includes(t._id)})))),n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},null===this.props.selectedWorld?"":n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(Ve.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:1},n.a.createElement(ne.a,{title:"Back to ".concat(this.props.selectedWorld.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/world/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(it.a,null)))),n.a.createElement(B.a,{item:!0,xs:7,sm:9},n.a.createElement("h2",null,null===this.state._id?"Create New Type":"Edit Type")),this.props.types.length>1&&n.a.createElement(B.a,{item:!0,xs:4,sm:2},n.a.createElement(y.a,null,n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(g.a,{primary:"Next Type"}))))),n.a.createElement(B.a,{item:!0},this.state.loaded&&n.a.createElement(et,{Value:this.props.selectedType.Name,fieldName:"Name",message:this.state.fieldValidation.Name.message,onBlur:function(t){var a=e.props.selectedType;a.Name=t,e.props.updateSelectedType(a),e.validateForm()},labelWidth:43})),n.a.createElement(B.a,{item:!0},this.state.loaded&&n.a.createElement(et,{Value:this.props.selectedType.PluralName,fieldName:"PluralName",displayName:"Plural Name",onBlur:function(t){var a=e.props.selectedType;a.PluralName=t,e.props.updateSelectedType(a),e.validateForm()},labelWidth:85})),n.a.createElement(B.a,{item:!0},this.state.loaded&&n.a.createElement(et,{Value:this.props.selectedType.Description,fieldName:"Description",multiline:!0,onBlur:function(t){var a=e.props.selectedType;a.Description=t,e.props.updateSelectedType(a)},labelWidth:82})),n.a.createElement(B.a,{item:!0},n.a.createElement(Qe.a,{control:n.a.createElement(Xe.a,{checked:this.props.selectedType.Major,onChange:function(t){var a=t.target.checked,r=e.props.selectedType;r.Major=a,e.props.updateSelectedType(r)},name:"Major",color:"primary"}),label:"Major Type"})),!this.state.resetting&&n.a.createElement(B.a,{item:!0},n.a.createElement(kt.Multiselect,{placeholder:"Super Types",options:a,selectedValues:this.props.selectedType.Supers,onSelect:this.addSuper,onRemove:this.removeSuper,displayValue:"Name"})),n.a.createElement(B.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement("span",null,"Attributes\xa0",n.a.createElement(ne.a,{title:"Add New Attribute"},n.a.createElement("span",null,n.a.createElement(re.a,{size:"small",color:"primary",disabled:this.state.defaultsMode,onClick:function(t){e.newAttribute()}},n.a.createElement(oe.a,null)))),n.a.createElement(ne.a,{title:"Browse Additional Attributes"},n.a.createElement("span",null,n.a.createElement(re.a,{size:"small",color:"primary",disabled:this.state.defaultsMode,onClick:function(t){e.setState({browseAttributes:!e.state.browseAttributes})}},n.a.createElement(se.a,null)))))),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(t){e.setState({defaultsMode:!e.state.defaultsMode})}},this.state.defaultsMode?"Set Attribute Types":"Set Defaults"))),this.state.browseAttributes&&n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12,sm:6},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"browseForAttributes",id:"browseForAttributes-label"},"Browse Attributes"),n.a.createElement(Et.a,{labelId:"browseForAttributes-label",id:"browseForAttributes",value:this.state.browseAttributesSelected,onChange:function(t){e.setState({browseAttributesSelected:t.target.value})},fullWidth:!0,labelWidth:130},r.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e._id},e.Name)}))))),n.a.createElement(B.a,{item:!0,xs:12,sm:6},n.a.createElement(Be.a,{variant:"contained",color:"primary",disabled:""===this.state.browseAttributesSelected,onClick:function(t){e.addSelectedAttribute()},type:"submit"},"Add Attribute")),1===i.length?n.a.createElement(B.a,{style:{color:"red"},item:!0,xs:12,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12},"This Attribute is also found on the Type '",i[0].Name,"'.  You may want to add '",i[0].Name,"' as a Super Type instead of adding the Attribute."),n.a.createElement(B.a,{item:!0,xs:12,sm:6},n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(t){e.addBrowsedType(i[0]._id)},type:"submit"},"Add ",i[0].Name))):i.length>1&&n.a.createElement(B.a,{style:{color:"red"},item:!0,xs:12,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12},"This Attribute is also found on other Types.  You may want to add one as a Super Type instead of adding the Attribute."),n.a.createElement(B.a,{item:!0,xs:12,sm:6},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"browseTypesWithAttribute",id:"browseTypesWithAttribute-label"},"Browse Types with ",s),n.a.createElement(Et.a,{labelId:"browseTypesWithAttribute-label",id:"browseTypesWithAttribute",value:this.state.browseTypesSelected,onChange:function(t){e.setState({browseTypesSelected:t.target.value})},fullWidth:!0,labelWidth:140+9*s.length},i.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e._id},e.Name)}))))),n.a.createElement(B.a,{item:!0,xs:12,sm:6},n.a.createElement(Be.a,{variant:"contained",color:"primary",disabled:""===this.state.browseTypesSelected,onClick:function(t){e.addBrowsedType(e.state.browseTypesSelected)},type:"submit"},"Add Type")))),n.a.createElement(B.a,{item:!0},this.state.loaded&&this.renderAttributes()),n.a.createElement(B.a,{item:!0},Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))),n.a.createElement(B.a,{item:!0},n.a.createElement("div",{className:"float-right"},this.props.types.length>0&&n.a.createElement(Be.a,{variant:"contained",color:"primary",disabled:this.state.waiting,onClick:function(t){e.onSubmit("next")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Edit Next"),n.a.createElement(Be.a,{variant:"contained",color:"primary",style:{marginLeft:"4px"},disabled:this.state.waiting,onClick:function(t){e.onSubmit("add")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Create Another"),n.a.createElement(Be.a,{variant:"contained",color:"primary",style:{marginLeft:"4px"},className:"w-200",disabled:this.state.waiting,onClick:function(t){e.onSubmit("")},type:"submit"},this.state.waiting?"Please Wait":"Submit"),n.a.createElement(Be.a,{variant:"contained",style:{marginLeft:"4px"},disabled:this.state.waiting,onClick:function(t){null===e.props.selectedType._id?e.setState({redirectTo:"/world/details/".concat(e.props.selectedWorldID)}):e.setState({redirectTo:"/type/details/".concat(e.props.selectedType._id)})},type:"button"},"Cancel"))),n.a.createElement(B.a,{item:!0,style:{color:"red"}},this.state.message)))}return n.a.createElement(he.a,{to:"/"})}return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")}}]),t}(r.Component),Ht=Object(m.b)((function(e){return{selectedPage:e.app.selectedPage,selectedType:e.app.selectedType,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,types:e.app.types,things:e.app.things,user:e.app.user,attributesByID:e.app.attributesByID,attributesByName:e.app.attributesByName,fromLogin:e.app.fromLogin}}),(function(e){return{updateSelectedType:function(t){return e(_(t))},addType:function(t){return e(W(t))},updateType:function(t){return e(L(t))},addAttributes:function(t){return e({type:"ADD_ATTRIBUTES",payload:t})},setAttributes:function(t){return e(S(t))},setTypes:function(t){return e(x(t))},setThings:function(t){return e(k(t))},notFromLogin:function(){return e(R({}))},addThing:function(t){return e(C(t))},toggleLogin:function(){return e(P({}))},logout:function(){return e(w({}))}}}))(Ut),zt=a(285),Jt=a(12),Gt=a(287),Yt=a(288),qt=a(284),Kt=a(286),Zt=a(282),Qt=a(297),Xt=a(283),$t=a(296),ea=a(71),ta=a(233),aa=[];function ra(e,t,a){return t[a]<e[a]?-1:t[a]>e[a]?1:0}function na(e){var t=e.classes,a=e.order,r=e.orderBy,i=e.onRequestSort,s=e.columnMap;return n.a.createElement(Zt.a,null,n.a.createElement(Xt.a,null,s.map((function(e){return n.a.createElement(qt.a,{key:e.id,align:e.numeric?"right":"left",padding:e.disablePadding?"none":"default",sortDirection:r===e.id&&a},n.a.createElement($t.a,{active:r===e.id,direction:r===e.id?a:"asc",onClick:(s=e.id,function(e){i(e,s)})},e.label,r===e.id?n.a.createElement("span",{className:t.visuallyHidden},"desc"===a?"sorted descending":"sorted ascending"):null));var s}))))}var ia=Object(zt.a)((function(e){return{root:{paddingLeft:e.spacing(2),paddingRight:e.spacing(1)},highlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:Object(Jt.e)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},title:{flex:"1 1 100%"}}})),sa=function(e){var t=ia(),a=e.label;return n.a.createElement(f.a,null,n.a.createElement(ea.a,{className:t.title,variant:"h6",id:"tableTitle",component:"div"},a))},oa=Object(zt.a)((function(e){return{root:{width:"100%"},paper:{width:"100%",marginBottom:e.spacing(2)},table:{},visuallyHidden:{border:0,clip:"rect(0 0 0 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",top:20,width:1}}}));function la(e){var t=[{id:"Name",numeric:!1,disablePadding:!0,label:"Name"},{id:"Description",numeric:!1,disablePadding:!0,label:"Description"}];aa=[],e.things.forEach((function(a){var r={_id:a._id,Name:a.Name,Description:a.Description};a.Attributes.forEach((function(a){var n=e.attributesByID[a.attrID];if("Type"===n.AttributeType){var i=e.allThings.filter((function(e){return e._id===a.Value}));i.length>0&&(i=i[0],r[a.attrID]=i.Name)}else"List"===n.AttributeType?(r[a.attrID]="","Type"===n.ListType?a.ListValues.forEach((function(t){var n=e.allThings.filter((function(e){return e._id===t}));n.length>0&&(n=n[0],r[a.attrID]+=(r[a.attrID].length>0?", ":"")+n.Name)})):a.ListValues.forEach((function(e){r[a.attrID]+=(r[a.attrID].length>0?", ":"")+e}))):r[a.attrID]=a.Value;0===t.filter((function(e){return e.id===a.attrID})).length&&t.push({id:n._id,numeric:"Number"===n.Type,disablePadding:!0,label:n.Name})})),aa.push(r)}));var a=oa(),r=n.a.useState("asc"),i=Object(we.a)(r,2),s=i[0],o=i[1],l=n.a.useState("Name"),c=Object(we.a)(l,2),u=c[0],p=c[1],d=n.a.useState([]),m=Object(we.a)(d,2),h=m[0],f=m[1],b=n.a.useState(0),y=Object(we.a)(b,2),v=y[0],T=y[1],E=n.a.useState(5),w=Object(we.a)(E,2),D=w[0],A=w[1];return n.a.createElement("div",{className:a.root},n.a.createElement(U.a,{display:{xs:"none",sm:"block"}},n.a.createElement(ta.a,{className:a.paper},n.a.createElement(sa,{label:e.label}),n.a.createElement(Kt.a,null,n.a.createElement(Gt.a,{className:a.table,"aria-labelledby":"tableTitle",size:"small","aria-label":"enhanced table"},n.a.createElement(na,{classes:a,numSelected:h.length,order:s,orderBy:u,onSelectAllClick:function(e){if(e.target.checked){var t=aa.map((function(e){return e.name}));f(t)}else f([])},onRequestSort:function(e,t){o(u===t&&"asc"===s?"desc":"asc"),p(t)},rowCount:aa.length,columnMap:t}),n.a.createElement(Yt.a,null,function(e,t){var a=e.map((function(e,t){return[e,t]}));return a.sort((function(e,a){var r=t(e[0],a[0]);return 0!==r?r:e[1]-a[1]})),a.map((function(e){return e[0]}))}(aa,function(e,t){return"desc"===e?function(e,a){return ra(e,a,t)}:function(e,a){return-ra(e,a,t)}}(s,u)).slice(v*D,v*D+D).map((function(a,r){var i,s=(i=a.name,-1!==h.indexOf(i));return n.a.createElement(Xt.a,{hover:!0,role:"checkbox","aria-checked":s,tabIndex:-1,key:r,selected:s},t.map((function(t,r){return n.a.createElement(qt.a,{key:r},"Name"===t.id?n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(t){e.buttonClick(a._id)}},n.a.createElement(g.a,{primary:a.Name})):n.a.createElement("span",null,a[t.id]))})))}))))),aa.length>5&&n.a.createElement(Qt.a,{rowsPerPageOptions:[5,10,25],component:"div",count:aa.length,rowsPerPage:D,page:v,onChangePage:function(e,t){T(t)},onChangeRowsPerPage:function(e){A(parseInt(e.target.value,10)),T(0)}}))),n.a.createElement(U.a,{display:{xs:"block",sm:"none"}},e.label,":",e.things.map((function(t,a){return n.a.createElement(Be.a,{key:a,style:{marginLeft:"4px"},variant:"contained",color:"primary",onClick:function(a){e.buttonClick(t._id)}},n.a.createElement(g.a,{primary:t.Name}))}))))}var ca=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).getModalStyle=function(){var e=Math.round(window.innerHeight/2)-50,t=Math.round(window.innerWidth/2)-200;return{top:"".concat(e,"%"),left:"".concat(t,"%"),transform:"translate(".concat(t,"px, ").concat(e,"px)")}},a.delete=function(e){a.setState({waiting:!0},a.finishDelete)},a.finishDelete=function(e){a.api.deleteThing(a.props.selectedWorldID,a.state._id).then((function(e){void 0===e.error?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things),a.setState({waiting:!1,redirectTo:"/world/details/".concat(a.props.selectedWorldID)})})):a.setState({waiting:!1,message:e.error},(function(){a.props.logout()}))}))},a.redirectToNext=function(){for(var e=null===a.state.majorType?a.props.things:a.props.things.filter((function(e){return e.TypeIDs.includes(a.state.majorType._id)})),t=0;e[t]._id!==a.props.selectedThing._id;)t++;++t===e.length&&(t=0),a.setState({waiting:!1,redirectTo:"/thing/details/".concat(e[t]._id)})},a.load=function(e){setTimeout((function(){a.setState({_id:e,redirectTo:null},a.finishLoading)}),500)},a.finishLoading=function(){a.props.fromLogin&&a.props.notFromLogin();var e=a.state._id;a.api.getWorld(a.props.selectedWorldID).then((function(t){if(a.props.setAttributes(t.attributes),a.props.setTypes(t.types),a.props.setThings(t.things),void 0!==e){var r=t.things.filter((function(t){return t._id===e}));if(0===r.length)a.setState({message:"Invalid Thing ID"});else if((r=r[0]).AttributesArr=[],r.Attributes.forEach((function(e){var t=a.props.attributesByID[e.attrID];r.AttributesArr.push({index:r.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,TypeIDs:t.TypeIDs})})),null===a.state.majorType){var n=r.Types.filter((function(e){return e.Major}));n.length>0?(n=n[0],a.setState({Name:r.Name,Description:r.Description,_id:e,Types:r.Types,majorType:n})):a.setState({Name:r.Name,Description:r.Description,_id:e,Types:r.Types})}else a.setState({Name:r.Name,Description:r.Description,_id:e,Types:r.Types});a.props.updateSelectedThing(r)}else a.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:[],Attributes:[],AttributesArr:[]})}))},a.state={_id:null,Name:"",Description:"",Types:[],AttributesArr:[],fieldValidation:{Name:{valid:!0,message:""},AttributesArr:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,modalOpen:!1,majorType:null},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;if(this.state._id!==t&&this.load(t),null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user){if(null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type})).length){var a=this.props.things.filter((function(t){return void 0!==t.ReferenceIDs&&t.ReferenceIDs.includes(e.state._id)}));return n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},null===this.props.selectedWorld?"":n.a.createElement("div",null,n.a.createElement(Ve.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(B.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12,sm:8,container:!0,spacing:0,direction:"column"},n.a.createElement(B.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(B.a,{item:!0,xs:1},n.a.createElement(ne.a,{title:"Back to ".concat(this.props.selectedWorld.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/world/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(it.a,null)))),n.a.createElement(B.a,{item:!0,xs:11},n.a.createElement("h2",null,this.state.Name))),n.a.createElement(B.a,{item:!0},this.state.Description)),n.a.createElement(B.a,{item:!0,xs:12,sm:4},n.a.createElement(ae.a,null,null!==this.props.user&&null!==this.props.selectedWorld&&(this.props.selectedWorld.Owner===this.props.user._id||this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length>0)&&n.a.createElement(y.a,null,n.a.createElement(B.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:3,sm:0},"\xa0"),n.a.createElement(B.a,{item:!0,xs:4,sm:12},n.a.createElement(ne.a,{title:"Edit ".concat(this.state.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/thing/edit/".concat(e.state._id)})}},n.a.createElement(Me.a,null)))),n.a.createElement(B.a,{item:!0,xs:5,sm:12},n.a.createElement(ne.a,{title:"Delete ".concat(this.state.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({modalOpen:!0})}},n.a.createElement(Ke.a,null)))))),n.a.createElement(y.a,null,null===this.state.majorType?n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(g.a,{primary:"Next"})):n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(g.a,{primary:"Next ".concat(this.state.majorType.Name)})))))),n.a.createElement(B.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12,sm:8},"Attributes",n.a.createElement(ae.a,null,null!==this.props.selectedThing&&void 0!==this.props.selectedThing&&this.props.selectedThing.AttributesArr.map((function(t,a){return n.a.createElement(y.a,{key:a},"Type"===t.AttributeType&&""!==t.Value?n.a.createElement(la,{attributesByID:e.props.attributesByID,label:t.Name,things:e.props.things.filter((function(e){return e._id===t.Value})),allThings:e.props.things}):"List"===t.AttributeType&&"Type"===t.ListType?n.a.createElement(la,{attributesByID:e.props.attributesByID,label:t.Name,things:e.props.things.filter((function(e){return t.ListValues.includes(e._id)})),allThings:e.props.things,buttonClick:function(t){e.setState({redirectTo:"/thing/details/".concat(t)})}}):"List"===t.AttributeType?t.ListValues.map((function(e,t){return n.a.createElement("span",{key:t},t>0?", ".concat(e):"".concat(e))})):n.a.createElement("span",null,t.Name,":\xa0",t.Value))})))),n.a.createElement(B.a,{item:!0,xs:12,sm:4,container:!0,spacing:0,direction:"column"},this.state.Types.length>0&&n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,n.a.createElement(y.a,null,n.a.createElement(g.a,{primary:"Types"})),this.state.Types.map((function(t,a){return n.a.createElement(y.a,{key:a},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},n.a.createElement(g.a,{primary:t.Name})))})))),a.length>0&&n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,n.a.createElement(y.a,null,n.a.createElement(g.a,{primary:"Referenced in:"})),a.map((function(t,a){return n.a.createElement(y.a,{key:a},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t._id)})}},n.a.createElement(g.a,{primary:t.Name})))})))))),n.a.createElement(Ze.a,{"aria-labelledby":"delete-thing-modal","aria-describedby":"delete-thing-modal-description",open:this.state.modalOpen,onClose:function(t){e.setState({modalOpen:!1})}},n.a.createElement("div",{style:this.getModalStyle(),className:"paper"},n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"Are you sure you want to delete ",this.state.Name,"?"),n.a.createElement(B.a,{item:!0},"(All references to it will be left alone and may not work correctly)"),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:this.delete},"Yes")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({modalOpen:!1})}},"Cancel"))))))))}return n.a.createElement(he.a,{to:"/"})}return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")}}]),t}(r.Component),ua=Object(m.b)((function(e){var t=e.app.selectedThing;return{selectedPage:e.app.selectedPage,selectedThing:t,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,types:e.app.types,things:e.app.things,user:e.app.user,attributesByID:e.app.attributesByID,fromLogin:e.app.fromLogin}}),(function(e){return{updateSelectedThing:function(t){return e(F(t))},addThing:function(t){return e(C(t))},updateThing:function(t){return e(j(t))},setAttributes:function(t){return e(S(t))},setTypes:function(t){return e(x(t))},setThings:function(t){return e(k(t))},notFromLogin:function(){return e(R({}))},toggleLogin:function(){return e(P({}))},logout:function(){return e(w({}))}}}))(ca),pa=a(161),da=a.n(pa);function ma(e){var t=Object(r.useState)(e.attribute.Value),a=Object(we.a)(t,2),i=a[0],s=a[1],o=""===e.attribute.AttributeType?"Text":e.attribute.AttributeType,l=[],c=[];if("List"===o&&"Options"===e.attribute.ListType)e.attribute.Options.forEach((function(e){l.push({Name:e})})),e.attribute.ListValues.forEach((function(e){c.push({Name:e})}));else if("List"===o&&"Type"===e.attribute.ListType){var u=e.types.filter((function(t){return t._id===e.attribute.DefinedType}))[0];void 0!==u&&(l.push({Name:"+ Create New ".concat(u.Name),_id:"new"}),e.things.filter((function(t){return t.TypeIDs.includes(e.attribute.DefinedType)})).forEach((function(e){l.push({Name:e.Name,_id:e._id})})),l.filter((function(t){return e.attribute.ListValues.includes(t._id)})).forEach((function(e){c.push(e)})))}return n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:11},"Text"===o?n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"attribute_name_".concat(e.attribute.attrID)},e.attribute.Name),n.a.createElement(te.a,{id:"attribute_name_".concat(e.attribute.attrID),name:"attribute_name_".concat(e.attribute.attrID),type:"text",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a={index:e.attribute.index,attrID:e.attribute.attrID,Name:e.attribute.Name,AttributeType:e.attribute.AttributeType,Options:e.attribute.Options,DefinedType:e.attribute.DefinedType,ListType:e.attribute.ListType,FromTypes:e.attribute.FromTypes,Value:i,ListValues:e.attribute.ListValues};e.onChange(a)},labelWidth:9*e.attribute.Name.length,fullWidth:!0}),n.a.createElement($e.a,null,e.message)):"Number"===o?n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"numField"},e.attribute.Name),n.a.createElement(te.a,{id:"numField",name:"numField",type:"number",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a={index:e.attribute.index,attrID:e.attribute.attrID,Name:e.attribute.Name,AttributeType:e.attribute.AttributeType,Options:e.attribute.Options,DefinedType:e.attribute.DefinedType,ListType:e.attribute.ListType,FromTypes:e.attribute.FromTypes,Value:i,ListValues:e.attribute.ListValues};e.onChange(a)},labelWidth:9*e.attribute.Name.length,fullWidth:!0}),n.a.createElement($e.a,null,e.message)):"True/False"===o?n.a.createElement(Qe.a,{control:n.a.createElement(Xe.a,{checked:"True"===e.attribute.Value,onChange:function(t){var a=e.attribute;a.Value=t.target.checked?"True":"False",e.onChange(a)},color:"primary"}),label:e.attribute.Name}):"Options"===o?n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"options-select",id:"options-select-label"},e.attribute.Name),n.a.createElement(Et.a,{labelId:"options-select-label",id:"options-select",value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){var a={index:e.attribute.index,attrID:e.attribute.attrID,Name:e.attribute.Name,AttributeType:e.attribute.AttributeType,Options:e.attribute.Options,DefinedType:e.attribute.DefinedType,ListType:e.attribute.ListType,FromTypes:e.attribute.FromTypes,Value:i,ListValues:e.attribute.ListValues};e.onChange(a)},fullWidth:!0,labelWidth:9*e.attribute.Name.length},e.attribute.Options.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e},e)})))):"Type"===o?n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"type-select",id:"type-select-label"},e.attribute.Name),n.a.createElement(Et.a,{labelId:"type-select-label",id:"type-select",value:i,onChange:function(t){!function(e,t,a){if("new"===e.target.value){var r=t.attribute;t.onNewThing(r)}else a(e.target.value)}(t,e,s)},onBlur:function(t){var a={index:e.attribute.index,attrID:e.attribute.attrID,Name:e.attribute.Name,AttributeType:e.attribute.AttributeType,Options:e.attribute.Options,DefinedType:e.attribute.DefinedType,ListType:e.attribute.ListType,FromTypes:e.attribute.FromTypes,Value:i,ListValues:e.attribute.ListValues};e.onChange(a)},fullWidth:!0,labelWidth:9*e.attribute.Name.length},n.a.createElement(Ie.a,{value:"new"},"+ Create New"," ",e.types.filter((function(t){return t._id===e.attribute.DefinedType}))[0].Name),e.things.filter((function(t){return t.TypeIDs.includes(e.attribute.DefinedType)})).map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e._id},e.Name)})))):"List"===o?n.a.createElement("span",null,"Text"===e.attribute.ListType?n.a.createElement(Lt.a,{placeholder:e.attribute.Name,variant:"outlined",defaultValue:e.attribute.ListValues,onChange:function(t){return function(e,t){var a=t.attribute;a.ListValues=e,t.onChange(a)}(t,e)}}):"Options"===e.attribute.ListType?n.a.createElement(kt.Multiselect,{placeholder:e.attribute.Name,options:l,selectedValues:c,onSelect:function(t,a){!function(e,t){var a=t.attribute;a.ListValues.push(e.Name),t.onChange(a)}(a,e)},onRemove:function(t,a){!function(e,t){var a=t.attribute;a.ListValues=[],e.forEach((function(e){a.ListValues.push(e.Name)})),t.onChange(a)}(t,e)},displayValue:"Name"}):"Type"===e.attribute.ListType?n.a.createElement(kt.Multiselect,{placeholder:e.attribute.Name,options:l,selectedValues:c,onSelect:function(t,a){!function(e,t){if("new"===e._id)setTimeout((function(){var e=t.attribute;t.onNewThing(e)}),500);else{var a=t.attribute;a.ListValues.push(e._id),t.onChange(a)}}(a,e)},onRemove:function(t,a){!function(e,t){var a=t.attribute;a.ListValues=[],e.forEach((function(e){a.ListValues.push(e._id)})),t.onChange(a)}(t,e)},displayValue:"Name"}):""):""),n.a.createElement(B.a,{item:!0,xs:1},n.a.createElement(da.a,{style:{cursor:"pointer"},onClick:function(t){e.infoModal(e.attribute)}})))}var ha=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).newAttribute=function(){var e=a.props.selectedThing;e.AttributesArr.push({index:e.AttributesArr.length,_id:null,Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:"Text",FromTypes:[],Value:"",ListValues:[],FromTypeIDs:[],TypeIDs:[]}),a.props.updateSelectedThing(e)},a.changeAttribute=function(e){var t=a.props.selectedThing,r=t.AttributesArr.filter((function(t){return t.attrID===e.attrID}))[0];r.Value=e.Value,r.ListValues=e.ListValues,a.props.updateSelectedThing(t)},a.blurAttribute=function(e){},a.deleteAttribute=function(e){var t=a.props.selectedThing;t.AttributesArr.splice(e.index),a.props.updateSelectedThing(t)},a.optionsChange=function(e,t){},a.addNewThing=function(e){a.props.addNewThing(e)},a.infoModal=function(e){a.props.onInfo(e)},a.getModalStyle=function(){var e=Math.round(window.innerHeight/2)-100,t=Math.round(window.innerWidth/2)-200;return{top:"".concat(e,"%"),left:"".concat(t,"%"),transform:"translate(".concat(t,"px, ").concat(e,"px)")}},a.handleUserInput=function(e){var t=e.target.name,r="checkbox"===e.target.type?e.target.checked:e.target.value;a.setState(Object(Q.a)({},t,r))},a.inputBlur=function(e){var t=e.target.name,r=a.validateField(t),n=a.state.fieldValidation;void 0!==n[t]&&n[t].valid!==r.valid&&(n[t].valid=r.valid,n[t].message=r.message,a.setState({fieldValidation:n}))},a.validateField=function(e){var t=null,r=!0,n="";switch(e){case"Name":(r=null!==(t=a.state[e]).match(/^[a-zA-Z0-9 ]*$/i))?t.length<2?(r=!1,n="Thing Name is too short"):(r=0===a.props.things.filter((function(e){return e.Name===t&&e._id!==a.state._id})).length)||(n="This Thing Name is already in use"):n="Only Letters, Numbers, and Spaces allowed in Thing Names"}return{valid:r,message:n}},a.validateForm=function(e){var t=a.validateField("Name"),r=t.valid,n=a.state.fieldValidation;n.Name=t,a.setState({formValid:r,fieldValidation:n},e)},a.saveNewThing=function(){a.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},a.submitThroughAPI=function(){var e=a.props.types.filter((function(e){return e._id===a.state.newThingType._id||a.state.newThingType.SuperIDs.includes(e._id)})),t=e.map((function(e){return e._id})),r={_id:a.state._id,Name:a.state.Name.trim(),Description:"",TypeIDs:t,Attributes:[],worldID:a.props.selectedWorldID};a.api.createThing(r).then((function(t){void 0!==t.thingID?(r._id=t.thingID,r.Types=e,r.AttributesArr=[],a.props.addThing(r),a.state.modalSubmit(r),a.setState({waiting:!1,modalOpen:!1})):void 0!==t.error&&a.setState({waiting:!1,message:t.error},(function(){a.props.logout()}))})).catch((function(e){return console.log(e)}))},a.state={modalOpen:!1,infoModalOpen:!1,Name:"",fieldValidation:{Name:{valid:!0,message:""}},formValid:!1,message:"",waiting:!1,newThingType:null},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},null!==this.props.selectedThing&&void 0!==this.props.selectedThing&&this.props.selectedThing.AttributesArr.map((function(t,a){return n.a.createElement(ma,{key:a,thingID:e.props.selectedThing._id,attribute:t,onChange:e.changeAttribute,onDelete:e.deleteAttribute,onBlur:e.blurAttribute,things:e.props.things,types:e.props.types,onNewThing:e.addNewThing,infoModal:e.infoModal})})),n.a.createElement(Ze.a,{"aria-labelledby":"new-thing-modal","aria-describedby":"new-thing-modal-description",open:this.state.modalOpen,onClose:function(t){e.setState({modalOpen:!1})}},n.a.createElement("div",{style:this.getModalStyle(),className:"paper"},n.a.createElement(B.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},"Just give the new ",null===this.state.newThingType?"":this.state.newThingType.Name," a name."),n.a.createElement(B.a,{item:!0},"(You can do the rest later.)"),n.a.createElement(B.a,{item:!0},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"name"},"Name"),n.a.createElement(te.a,{id:"name",name:"Name",type:"text",autoComplete:"Off",error:!this.state.fieldValidation.Name.valid,value:this.state.Name,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:43,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.Name.message))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.saveNewThing},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({modalOpen:!1})}},"Cancel")))))))}}]),t}(r.Component),fa=Object(m.b)((function(e){return{selectedThing:e.app.selectedThing,things:e.app.things,types:e.app.types,selectedWorldID:e.app.selectedWorldID}}),(function(e){return{updateSelectedThing:function(t){return e(F(t))},addThing:function(t){return e(C(t))},logout:function(){return e(w({}))}}}))(ha);var ba=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).createThingFromType=function(e){var t=[];t.push(e),e.Supers.forEach((function(e){if(0===t.filter((function(t){return t._id===e._id})).length){var r=a.props.types.filter((function(t){return t._id===e._id}));r.length>0&&t.push(r[0])}}));var r={_id:null,Name:"",Description:"",Types:[],Attributes:[]},n=[];t.forEach((function(e){for(var t=function(t){var a=Object(H.a)({},e.Attributes[t]),i=r.Attributes.filter((function(e){return e.attrID===a.attrID}));0===i.length?(a.FromTypeIDs=[e._id],a.index=e.Attributes.length+n.length,n.push(a)):(void 0!==(i=i[0]).FromTypeIDs&&null!==i.FromTypeIDs||(i.FromTypeIDs=[]),i.FromTypeIDs.push(e._id))},a=0;a<e.Attributes.length;a++)t(a)})),t.forEach((function(e){n.forEach((function(t){void 0===e.DefaultsHash[t.attrID]||void 0===e.DefaultsHash[t.attrID].DefaultValue?(t.Value="",t.ListValues=[]):(t.Value=e.DefaultsHash[t.attrID].DefaultValue,t.ListValues=e.DefaultsHash[t.attrID].DefaultListValues)}))}));var i=[].concat(Object(X.a)(r.Attributes),n);r.Attributes=i,r.AttributesArr=[],r.Attributes.forEach((function(e){var t=a.props.attributesByID[e.attrID];r.AttributesArr.push({index:r.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:t.TypeIDs})})),r.Types=t,a.props.updateSelectedThing(r),a.setState({_id:null,loaded:!0,majorType:e})},a.resetForm=function(){setTimeout((function(){var e=a.props.match.params.id;void 0===e||e.includes("type_id_")?a.setState({resetting:!1},a.finishResettingForm):a.setState({resetting:!1,redirectTo:"/thing/create"})}),500)},a.finishResettingForm=function(){var e=a.props.match.params.id;if(void 0!==e&&e.includes("type_id_")){var t=e.substring(8),r=a.props.types.filter((function(e){return e._id===t}));r.length>0?(r=r[0],a.createThingFromType(r)):a.setState({message:"Invalid Type"})}},a.handleInfoAttrNameChange=function(e){var t=a.state.infoAttribute;t.Name=e.target.value,a.setState({infoAttribute:t})},a.inputBlur=function(e){var t=e.target.name,r=a.validateField(t),n=a.state.fieldValidation;void 0===n[t]||n[t].valid===r.valid&&n[t].message===r.message||(n[t].valid=r.valid,n[t].message=r.message,a.setState({fieldValidation:n}))},a.inputBlur2=function(e){var t="infoAttributeName",r=a.validateField(t),n=a.state.fieldValidation;void 0===n[t]||n[t].valid===r.valid&&n[t].message===r.message||(n[t].valid=r.valid,n[t].message=r.message,a.setState({fieldValidation:n}))},a.addSelectedAttribute=function(){var e=a.props.selectedThing,t=a.props.attributesByID[a.state.browseAttributesSelected],r=e.Attributes,n=e.AttributesArr;r.push({attrID:a.state.browseAttributesSelected,Value:"",ListValues:[],index:r.length,FromTypeIDs:[]}),n.push({attrID:a.state.browseAttributesSelected,index:n.length,Value:"",ListValues:[],Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,FromTypeIDs:[],TypeIDs:t.TypeIDs}),e.Attributes=[],e.AttributesArr=[],a.props.updateSelectedThing(e),setTimeout((function(){e.Attributes=r,e.AttributesArr=n,a.props.updateSelectedThing(e),a.setState({browseAttributesSelected:""})}),500)},a.validateField=function(e){var t=null,r=!0,n="";switch(e){case"Name":t=a.props.selectedThing[e].trim(),(r=null!==t.match(/^[a-zA-Z0-9 ]*$/i))?t.length<2?(r=!1,n="Thing Name is too short"):(r=0===a.props.things.filter((function(e){return e.Name===t&&e._id!==a.state._id})).length)||(n="This Thing Name is already in use"):n="Only Letters, Numbers, and Spaces allowed in Thing Names";break;case"infoAttributeName":if(t=a.state.infoAttribute.Name.trim(),r=null!==t.match(/^[a-zA-Z0-9 ]*$/i))if(t.length<2)r=!1,n="Attribute Name is too short";else{var i=a.props.attributesByName[t];(r=void 0===i||i._id===a.state.infoAttribute.attrID)||(n="There is another Attribute with this name.")}else n="Only Letters, Numbers, and Spaces allowed in Attribute Names";break;case"AttributesArr":r=!0,(t=a.props.selectedThing[e]).forEach((function(e){r&&t.filter((function(t){return t.Name===e.Name})).length>1&&(r=!1)})),n=r?"":"Attribute Names must be unique"}return{valid:r,message:n}},a.validateForm=function(e){var t=a.validateField("Name"),r=a.validateField("AttributesArr"),n=t.valid&&r.valid,i=a.state.fieldValidation;i.Name=t,i.Attributes=r,a.setState({formValid:n,fieldValidation:i},e)},a.validateAttrForm=function(e){var t=a.validateField("infoAttributeName"),r=a.state.fieldValidation;r.infoAttributeName=t,a.setState({fieldValidation:r},e)},a.onSubmit=function(e){a.validateForm((function(){this.state.formValid&&this.setState({waiting:!0,addMore:e},this.submitThroughAPI)}))},a.submitThroughAPI=function(){var e=a.props.selectedThing.Types.map((function(e){return e._id})),t={_id:a.state._id,Name:a.props.selectedThing.Name.trim(),Description:a.props.selectedThing.Description.trim(),TypeIDs:e,Attributes:[],worldID:a.props.selectedWorld._id,ReferenceIDs:[]};a.props.selectedThing.AttributesArr.forEach((function(e){t.Attributes.push({attrID:e.attrID,index:e.index,Value:e.Value.trim(),ListValues:e.ListValues}),"Type"===e.AttributeType&&(t.ReferenceIDs.includes(e.Value)||t.ReferenceIDs.push(e.Value)),"List"===e.AttributeType&&"Type"===e.ListType&&e.ListValues.forEach((function(e){t.ReferenceIDs.includes(e)||t.ReferenceIDs.push(e)}))})),null===t._id?a.api.createThing(t).then((function(e){void 0===e.error?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things),"add"===a.state.addMore?(a.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:[],Attributes:[],AttributesArr:[]}),a.setState({_id:null,fieldValidation:{Name:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",waiting:!1,resetting:!0},a.resetForm)):"next"===a.state.addMore?a.redirectToNext():a.setState({waiting:!1,redirectTo:"/world/details/".concat(a.props.selectedWorld._id)})})):a.setState({message:e.error},(function(){a.props.logout()}))})).catch((function(e){return console.log(e)})):a.api.updateThing(t).then((function(e){void 0===e.error?a.api.getWorld(a.props.selectedWorldID,!0).then((function(e){a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things),"add"===a.state.addMore?(a.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:[],Attributes:[],AttributesArr:[]}),a.setState({fieldValidation:{Name:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",waiting:!1,addMore:!1,resetting:!0},a.resetForm)):"next"===a.state.addMore?a.redirectToNext():a.setState({waiting:!1,redirectTo:"/world/details/".concat(a.props.selectedWorld._id)})})):a.setState({message:e.error},(function(){a.props.logout()}))})).catch((function(e){return console.log(e)}))},a.typesChange=function(e,t){for(var r=[],n=0;n<t.length;n++){var i=t[n];r.push(i),r=r.concat(i.Types)}var s=a.props.selectedThing;s.Types=r,a.props.updateSelectedThing(s)},a.addType=function(e,t){var r=a.props.selectedThing,n={};n[t._id]=t,t.Supers.forEach((function(t){if(0===e.filter((function(e){return e._id===t._id})).length){var r=a.props.types.filter((function(e){return e._id===t._id}));r.length>0&&0===e.filter((function(e){return e._id===r[0]._id})).length&&(e.push(r[0]),n[r[0]._id]=r[0])}0===a.props.selectedThing.Types.filter((function(e){return e._id===t._id})).length&&(n[t._id]=t)}));var i=[];Object.keys(n).forEach((function(e){var t=n[e];t.Attributes.forEach((function(e){var a=Object(H.a)({},e),n=r.Attributes.filter((function(e){return e.attrID===a.attrID}));0===n.length?(a.FromTypeIDs=[t._id],a.index=t.Attributes.length+i.length,i.push(a)):(void 0!==(n=n[0]).FromTypeIDs&&null!==n.FromTypeIDs||(n.FromTypeIDs=[]),n.FromTypeIDs.push(t._id))}))})),Object.keys(n).forEach((function(e){var t=n[e];i.forEach((function(e){void 0===t.DefaultsHash||void 0===t.DefaultsHash[e.attrID]||void 0===t.DefaultsHash[e.attrID].DefaultValue?(e.Value="",e.ListValues=[]):(void 0===e.Value&&(e.Value="",e.ListValues=[]),""===e.Value&&(e.Value=t.DefaultsHash[e.attrID].DefaultValue),t.DefaultsHash[e.attrID].DefaultListValues.forEach((function(t){e.ListValues.includes(t)||e.ListValues.push(t)})))}))}));var s=[].concat(Object(X.a)(r.Attributes),i);r.Types=e,r.Attributes=s,r.AttributesArr=[];var o=[];r.Attributes.forEach((function(e){var t=a.props.attributesByID[e.attrID];o.push({index:r.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:t.TypeIDs})})),a.props.updateSelectedThing(r),setTimeout((function(){r.Attributes=s,r.AttributesArr=o,a.props.updateSelectedThing(r)}),500)},a.addType2=function(e){var t=a.props.selectedThing.Types;t.push(e);var r=[e],n=a.props.selectedThing;e.Supers.forEach((function(e){if(0===t.filter((function(t){return t._id===e._id})).length){var n=a.props.types.filter((function(t){return t._id===e._id}));n.length>0&&0===t.filter((function(e){return e._id===n[0]._id})).length&&(t.push(n[0]),r.push(n[0]))}0===a.props.selectedThing.Types.filter((function(t){return t._id===e._id})).length&&r.push(e)}));var i=[];r.forEach((function(e){e.Attributes.forEach((function(t){var a=Object(H.a)({},t),r=n.Attributes.filter((function(e){return e.attrID===a.attrID}));0===r.length?(a.FromTypeIDs=[e._id],a.index=e.Attributes.length+i.length,i.push(a)):(void 0!==(r=r[0]).FromTypeIDs&&null!==r.FromTypeIDs||(r.FromTypeIDs=[]),r.FromTypeIDs.push(e._id))}))})),r.forEach((function(e){i.forEach((function(t){void 0===e.DefaultsHash||void 0===e.DefaultsHash[t.attrID]||void 0===e.DefaultsHash[t.attrID].DefaultValue?(t.Value="",t.ListValues=[]):(t.Value=e.DefaultsHash[t.attrID].DefaultValue,t.ListValues=e.DefaultsHash[t.attrID].DefaultListValues)}))}));var s=[].concat(Object(X.a)(n.Attributes),i);a.setState({resetting:!0}),n.Types=t,n.Attributes=s,n.AttributesArr=[];var o=[];n.Attributes.forEach((function(e){var t=a.props.attributesByID[e.attrID];o.push({index:n.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:t.TypeIDs})})),a.props.updateSelectedThing(n),setTimeout((function(){n.Attributes=s,n.AttributesArr=o,a.props.updateSelectedThing(n),a.setState({resetting:!1,infoAttribute:null})}),500)},a.selectNewTypeForAttribute=function(e){if("new"===e.target.value){a.setState({typeModalOpen:!0,modalSubmit:function(e){this.setState({newTypeForAttribute:e._id})}})}else a.setState({newTypeForAttribute:e.target.value})},a.saveInfoAttribute=function(){a.validateAttrForm((function(){this.state.fieldValidation.infoAttributeName.valid&&this.setState({waiting:!0},this.submitAttributeThroughAPI)}))},a.submitAttributeThroughAPI=function(){var e=[{_id:a.state.infoAttribute.attrID,Name:a.state.infoAttribute.Name.trim(),AttributeType:a.state.infoAttribute.AttributeType,Options:a.state.infoAttribute.Options,DefinedType:a.state.infoAttribute.DefinedType,ListType:a.state.infoAttribute.ListType}];a.api.upsertAttributes(a.props.selectedWorldID,e).then((function(e){void 0===e.error?a.api.getWorld(a.props.selectedWorldID,!0).then((function(t){a.props.setAttributes(t.attributes),a.props.setTypes(t.types),a.props.setThings(t.things);var r=a.state.infoAttribute;""!==a.state.newTypeForAttribute&&(r.TypeIDs.push(a.state.newTypeForAttribute),r.FromTypeIDs.push(a.state.newTypeForAttribute));var n=a.props.selectedThing;if(null===r.attrID){r.attrID=e.attributes[r.Name];var i={attrID:r.attrID,index:n.Attributes.length,Value:"",ListValues:[]};n.Attributes.push(i),n.AttributesArr.push({attrID:r.attrID,index:i.index,Value:"",ListValues:[],Name:r.Name,AttributeType:r.AttributeType,Options:r.Options,DefinedType:r.DefinedType,ListType:r.ListType,FromTypeIDs:r.FromTypeIDs,TypeIDs:r.TypeIDs})}else{var s=n.AttributesArr.filter((function(e){return e.attrID===r.attrID}))[0];s.Name=r.Name,s.AttributeType=r.AttributeType,s.Options=r.Options,s.DefinedType=r.DefinedType,s.ListType=r.ListType,s.FromTypeIDs=r.FromTypeIDs,s.TypeIDs=r.TypeIDs}if(0===r.FromTypeIDs.length)a.props.updateSelectedThing(n),a.setState({infoAttribute:null,waiting:!1});else{var o=a.props.types.filter((function(e){return e._id===r.FromTypeIDs[0]}))[0],l={_id:o._id,Name:o.Name,Description:o.Description,SuperIDs:o.SuperIDs,Attributes:o.Attributes,Defaults:o.Defaults,worldID:a.props.selectedWorld._id,Major:o.Major,ReferenceIDs:o.ReferenceIDs,DefaultReferenceIDs:o.DefaultReferenceIDs};l.Attributes.push({attrID:r.attrID,index:l.Attributes.length}),a.api.updateType(l).then((function(e){if(void 0===e.error){l.Supers=[],l.SuperIDs.forEach((function(e){l.Supers=l.Supers.concat(a.props.types.filter((function(t){return t._id===e})))})),l.AttributesArr=[],l.Attributes.forEach((function(e){var t=a.props.attributesByID[e.attrID];l.AttributesArr.push({index:l.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID})}));var t={};void 0!==l.Defaults&&l.Defaults.forEach((function(e){t[e.attrID]=e})),l.DefaultsHash=t,a.props.updateType(l),a.setState({infoAttribute:null,waiting:!1},(function(){this.addType2(l)}))}else a.setState({waiting:!1,message:e.error},(function(){a.props.logout()}))})).catch((function(e){return console.log(e)}))}})):a.setState({message:e.error,waiting:!1},(function(){a.props.logout()}))}))},a.removeType=function(e,t){var r=[],n=[];a.props.selectedThing.Types.forEach((function(e){e._id===t._id||e.SuperIDs.includes(t._id)?n.push(e._id):r.push(e)}));var i=a.props.selectedThing,s=Object(X.a)(i.Attributes);s.forEach((function(e){var t=[];e.FromTypeIDs.forEach((function(e){n.includes(e)||t.push(e)})),e.FromTypeIDs=t})),i.Types=r,i.Attributes=s,i.AttributesArr=[],i.Attributes.forEach((function(e){var t=a.props.attributesByID[e.attrID];i.AttributesArr.push({index:i.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:t.TypeIDs})})),a.props.updateSelectedThing(i)},a.redirectToNext=function(){var e=null===a.state.majorType?a.props.things:a.props.things.filter((function(e){return e.TypeIDs.includes(a.state.majorType._id)})),t=0;if(void 0===a.props.selectedThing||null!==a.props.selectedThing._id){for(;e[t]._id!==a.props.selectedThing._id;)t++;t++}t===e.length&&(t=0),a.setState({waiting:!1,redirectTo:"/thing/edit/".concat(e[t]._id)})},a.load=function(e){setTimeout((function(){a.setState({_id:e,redirectTo:null,loaded:!1},a.finishLoading)}),500)},a.finishLoading=function(){a.api.getWorld(a.props.selectedWorldID).then((function(e){if(a.props.setAttributes(e.attributes),a.props.setTypes(e.types),a.props.setThings(e.things),a.props.fromLogin)a.props.notFromLogin(),a.setState({loaded:!0,message:""});else if(null!==a.state._id){var t=e.things.filter((function(e){return e._id===a.state._id}));if(0===t.length)a.setState({message:"Invalid ID"});else{t=t[0];var r=[];t.TypeIDs.forEach((function(e){r=r.concat(a.props.types.filter((function(t){return t._id===e})))}));var n=[];r.forEach((function(e){for(var a=function(a){var r=Object(H.a)({},e.Attributes[a]),i=t.Attributes.filter((function(e){return e.attrID===r.attrID}));0===i.length?(r.FromTypeIDs=[e._id],r.index=t.Attributes.length+n.length,n.push(r)):(void 0!==(i=i[0]).FromTypeIDs&&null!==i.FromTypeIDs||(i.FromTypeIDs=[]),i.FromTypeIDs.push(e._id))},r=0;r<e.Attributes.length;r++)a(r)})),r.forEach((function(e){n.forEach((function(t){void 0===e.DefaultsHash[t.attrID]||void 0===e.DefaultsHash[t.attrID].DefaultValue?(t.Value="",t.ListValues=[]):(t.Value=e.DefaultsHash[t.attrID].DefaultValue,t.ListValues=e.DefaultsHash[t.attrID].DefaultListValues)}))}));var i=[].concat(Object(X.a)(t.Attributes),n);if(t.Attributes=i,t.AttributesArr=[],t.Attributes.forEach((function(e){var r=a.props.attributesByID[e.attrID];t.AttributesArr.push({index:t.AttributesArr.length,Name:r.Name,AttributeType:r.AttributeType,Options:r.Options,DefinedType:r.DefinedType,ListType:r.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:r.TypeIDs})})),t.Types=r,a.props.updateSelectedThing(t),null===a.state.majorType){var s=t.Types.filter((function(e){return e.Major}));s.length>0?(s=s[0],a.setState({loaded:!0,majorType:s})):a.setState({loaded:!0})}else a.setState({loaded:!0})}}else{var o=a.props.match.params.id;if(void 0!==o&&o.includes("type_id_")){var l=o.substring(8),c=a.props.types.filter((function(e){return e._id===l}));c.length>0?(c=c[0],a.createThingFromType(c)):a.setState({message:"Invalid Type",loaded:!0})}else a.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:[],Attributes:[],AttributesArr:[]}),a.setState({loaded:!0})}}))},a.state={_id:void 0,fieldValidation:{Name:{valid:!0,message:""},Attributes:{valid:!0,message:""},infoAttributeName:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,addMore:"",resetting:!1,loaded:!0,errors:[],infoAttribute:null,typeModalOpen:!1,newTypeForAttribute:"",browseAttributes:!1,browseAttributesFilter:"",browseAttributesSelected:"",thingModalOpen:!1,newThingType:null,putThingOnAttribute:null,majorType:null},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"renderHeader",value:function(){var e="Thing";return this.props.selectedThing.Types.forEach((function(t){t.Major&&("Thing"===e?e=t.Name:e+="/"+t.Name)})),n.a.createElement("h2",null,null===this.state._id?"Create New ".concat(e):"Edit ".concat(e))}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;if((void 0===t||t.includes("type_id_"))&&(t=null),this.state._id!==t)return this.load(t),n.a.createElement("span",null,"Loading...");if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user){if(null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length){if(null===this.props.selectedThing||this.props.selectedThing._id!==t)return n.a.createElement("span",null,"Loading...");if(this.state.typeModalOpen)return n.a.createElement(Mt,{types:this.props.types,selectedWorldID:this.props.selectedWorldID,onCancel:function(t){e.setState({typeModalOpen:!1})},addType:function(t){e.props.addType(t)},onSave:function(t){e.setState({typeModalOpen:!1,newTypeForAttribute:t._id})},api:this.api,logout:function(){e.props.logout()}});if(null!==this.state.infoAttribute){var a=this.props.types.filter((function(t){return e.state.infoAttribute.FromTypeIDs.includes(t._id)})),r=this.props.types.filter((function(t){return!e.state.infoAttribute.FromTypeIDs.includes(t._id)&&e.state.infoAttribute.TypeIDs.includes(t._id)}));if(0===a.length){if(0===r.length){return n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,n.a.createElement(y.a,{style:{fontSize:"30px"}},"Attribute Info"),n.a.createElement(y.a,null,n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"infoAttributeName"},"Name"),n.a.createElement(te.a,{id:"infoAttributeName",name:"infoAttributeName",type:"text",autoComplete:"Off",error:!this.state.fieldValidation.infoAttributeName.valid,value:this.state.infoAttribute.Name,onChange:this.handleInfoAttrNameChange,onBlur:this.inputBlur2,labelWidth:43,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.infoAttributeName.message))),n.a.createElement(y.a,null,n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"attribute-type",id:"attribute-type-label"},"Attribute Type"),n.a.createElement(Et.a,{labelId:"attribute-type-label",id:"attribute-type",disabled:this.state.waiting,value:this.state.infoAttribute.AttributeType,onChange:function(t){var a=e.state.infoAttribute;a.AttributeType=t.target.value,e.setState({infoAttribute:a})},fullWidth:!0,labelWidth:100},["Text","Number","True/False","Options","Type","List"].map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e},e)}))))),"List"===this.state.infoAttribute.AttributeType&&n.a.createElement(y.a,null,n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"list-type",id:"list-type-label"},"List Type"),n.a.createElement(Et.a,{labelId:"list-type-label",id:"list-type",disabled:this.state.waiting,value:this.state.infoAttribute.ListType,onChange:function(t){var a=e.state.infoAttribute;a.ListType=t.target.value,e.setState({infoAttribute:a})},fullWidth:!0,labelWidth:70},["Text","Options","Type"].map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e},e)}))))),("Type"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Type"===this.state.infoAttribute.ListType)&&n.a.createElement(y.a,null,n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"definedType",id:"definedType-label"},"Defined Type"),n.a.createElement(Et.a,{labelId:"definedType-label",id:"definedType",disabled:this.state.waiting,value:this.state.infoAttribute.DefinedType,onChange:function(t){var a=e.state.infoAttribute;if(a.DefinedType=t.target.value,"new"===t.target.value){e.setState({typeModalOpen:!0,modalSubmit:function(e){a.DefinedType=e._id,this.setState({typeModalOpen:!1,infoAttribute:a})}})}else e.setState({infoAttribute:a})},fullWidth:!0,labelWidth:100},n.a.createElement(Ie.a,{value:"new"},"+ Create New Type"),this.props.types.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e._id},e.Name)}))))),("Options"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Options"===this.state.infoAttribute.ListType)&&n.a.createElement(y.a,null,n.a.createElement(Lt.a,{variant:"outlined",disabled:this.state.waiting,defaultValue:this.state.infoAttribute.Options,onChange:function(t){var a=e.state.infoAttribute;a.Options=t,e.setState({infoAttribute:a})}})),n.a.createElement(y.a,null,"Select a Type to add this attribute to, and to add to ",this.props.selectedThing.Name),n.a.createElement(y.a,null,n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"newTypeForAttribute",id:"newTypeForAttribute-label"},"Type For Attribute"),n.a.createElement(Et.a,{labelId:"newTypeForAttribute-label",id:"newTypeForAttribute",value:this.state.newTypeForAttribute,onChange:function(t){e.selectNewTypeForAttribute(t)},fullWidth:!0,labelWidth:125},n.a.createElement(Ie.a,{value:"new"},"+ Create New Type"),this.props.types.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e._id},e.Name)}))))))),n.a.createElement(B.a,{item:!0},this.state.message),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.saveInfoAttribute},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({infoAttribute:null})}},"Cancel"))))}return n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,n.a.createElement(y.a,{style:{fontSize:"30px"}},"Attribute Info"),n.a.createElement(y.a,null,"Name: ",this.state.infoAttribute.Name),n.a.createElement(y.a,null,"Type: ",this.state.infoAttribute.AttributeType),"List"===this.state.infoAttribute.AttributeType&&n.a.createElement(y.a,null,"List Type: ",this.state.infoAttribute.ListType),("Type"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Type"===this.state.infoAttribute.ListType)&&n.a.createElement(y.a,null,"Defined Type:",n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(t){e.setState({redirectTo:"/type/details/".concat(e.state.infoAttribute.DefinedType)})}},this.props.types.filter((function(t){return t._id===e.state.infoAttribute.DefinedType}))[0].Name)),("Options"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Options"===this.state.infoAttribute.ListType)&&n.a.createElement(y.a,null,"Options:",this.state.infoAttribute.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)}))),n.a.createElement(y.a,null,1===r.length?"Type associated with this attribute:":"Types associated with this attribute:",n.a.createElement(ae.a,null,r.map((function(t,a){return n.a.createElement("span",{key:a},n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},t.Name),n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.addType2(t)}},"Add ",t.Name," to ",e.props.selectedThing.Name))})))))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:6}),n.a.createElement(B.a,{item:!0,xs:6},n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({infoAttribute:null})}},"Cancel"))))}return n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement(ae.a,null,n.a.createElement(y.a,{style:{fontSize:"30px"}},"Attribute Info"),n.a.createElement(y.a,null,"Name: ",this.state.infoAttribute.Name),n.a.createElement(y.a,null,"Type: ",this.state.infoAttribute.AttributeType),"List"===this.state.infoAttribute.AttributeType&&n.a.createElement(y.a,null,"List Type: ",this.state.infoAttribute.ListType),("Type"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Type"===this.state.infoAttribute.ListType)&&n.a.createElement(y.a,null,"Defined Type:",n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(t){e.setState({redirectTo:"/type/details/".concat(e.state.infoAttribute.DefinedType)})}},this.props.types.filter((function(t){return t._id===e.state.infoAttribute.DefinedType}))[0].Name)),("Options"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Options"===this.state.infoAttribute.ListType)&&n.a.createElement(y.a,null,"Options:",this.state.infoAttribute.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)}))),a.length>0&&n.a.createElement(y.a,null,1===a.length?"From Type:":"From Types:",a.map((function(t,a){return n.a.createElement("span",{key:a},0===a?" ":", ",n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},t.Name))}))),r.length>0&&n.a.createElement(y.a,null,1===r.length?"Other Associated Type:":"Other Associated Types:",r.map((function(t,a){return n.a.createElement("span",{key:a},0===a?" ":", ",n.a.createElement(Be.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},t.Name))}))))),n.a.createElement(B.a,{item:!0},n.a.createElement(Be.a,{variant:"contained",onClick:function(t){e.setState({infoAttribute:null})}},"Cancel")))}if(this.state.thingModalOpen)return n.a.createElement(Bt,{things:this.props.things,newThingType:this.state.newThingType,selectedWorldID:this.props.selectedWorldID,onCancel:function(t){e.setState({thingModalOpen:!1})},addThing:function(t){e.props.addThing(t)},onSave:function(t){e.setState({thingModalOpen:!1},(function(a){var r=e.props.selectedThing,n=r.AttributesArr.filter((function(t){return t.attrID===e.state.putThingOnAttribute.attrID}))[0];"Type"===n.AttributeType?n.Value=t._id:n.ListValues.push(t._id),e.props.updateSelectedThing(r)}))},api:this.api,logout:function(){e.props.logout()}});var i=[];return this.state.browseAttributes&&Object.keys(this.props.attributesByID).forEach((function(t){0===e.props.selectedThing.Attributes.filter((function(e){return e.attrID===t})).length&&i.push(e.props.attributesByID[t])})),n.a.createElement(B.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},null!==this.props.selectedWorld&&n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(Ve.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:1},n.a.createElement(ne.a,{title:"Back to ".concat(this.props.selectedWorld.Name)},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/world/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(it.a,null)))),n.a.createElement(B.a,{item:!0,xs:7,sm:9},this.renderHeader()),n.a.createElement(B.a,{item:!0,xs:4,sm:2},n.a.createElement(y.a,null,null===this.state.majorType&&this.props.things.length>1?n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(g.a,{primary:"Next"})):this.props.things.filter((function(t){return t.TypeIDs.includes(e.state.majorType._id)})).length>1&&n.a.createElement(Be.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(g.a,{primary:"Next ".concat(this.state.majorType.Name)}))))),n.a.createElement(B.a,{item:!0},this.state.loaded&&n.a.createElement(et,{Value:this.props.selectedThing.Name,fieldName:"Name",message:this.state.fieldValidation.Name.message,onBlur:function(t){var a=e.props.selectedThing;a.Name=t,e.props.updateSelectedThing(a),e.validateForm()},labelWidth:43})),n.a.createElement(B.a,{item:!0},this.state.loaded&&n.a.createElement(et,{Value:this.props.selectedThing.Description,fieldName:"Description",multiline:!0,onBlur:function(t){var a=e.props.selectedThing;a.Description=t,e.props.updateSelectedThing(a)},labelWidth:82})),n.a.createElement(B.a,{item:!0},!this.state.resetting&&n.a.createElement(kt.Multiselect,{placeholder:"Types",options:this.props.types,selectedValues:this.props.selectedThing.Types,onSelect:this.addType,onRemove:this.removeType,displayValue:"Name"})),n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(B.a,{item:!0},n.a.createElement("span",null,"Attributes\xa0",n.a.createElement(ne.a,{title:"Add New Attribute"},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({infoAttribute:{index:e.props.selectedThing.AttributesArr.length,Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:"",attrID:null,Value:"",ListValues:[],FromTypeIDs:[],TypeIDs:[]}})}},n.a.createElement(oe.a,null))),n.a.createElement(ne.a,{title:"Browse Additional Attributes"},n.a.createElement(re.a,{size:"small",color:"primary",onClick:function(t){e.setState({browseAttributes:!e.state.browseAttributes})}},n.a.createElement(se.a,null))))),this.state.browseAttributes&&n.a.createElement(B.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(B.a,{item:!0,xs:12,sm:6},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"browseForAttributes",id:"browseForAttributes-label"},"Browse Additional Attributes"),n.a.createElement(Et.a,{labelId:"browseForAttributes-label",id:"browseForAttributes",value:this.state.browseAttributesSelected,onChange:function(t){e.setState({browseAttributesSelected:t.target.value})},fullWidth:!0,labelWidth:200},i.map((function(e,t){return n.a.createElement(Ie.a,{key:t,value:e._id},e.Name)}))))),n.a.createElement(B.a,{item:!0,xs:12,sm:6},n.a.createElement(Be.a,{variant:"contained",color:"primary",disabled:""===this.state.browseAttributesSelected,onClick:function(t){e.addSelectedAttribute()},type:"submit"},"Add Attribute"))),!this.state.resetting&&this.state.loaded&&n.a.createElement(fa,{addNewThing:function(t){e.setState({thingModalOpen:!0,newThingType:e.props.types.filter((function(e){return e._id===t.DefinedType}))[0],putThingOnAttribute:t})},onInfo:function(t){e.setState({infoAttribute:t})}}),n.a.createElement($e.a,null,this.state.fieldValidation.Attributes.message)),n.a.createElement(B.a,{item:!0},n.a.createElement("div",{className:"float-right"},(null===this.state.majorType&&this.props.things.length>0||null!==this.state.majorType&&this.props.things.filter((function(t){return t.TypeIDs.includes(e.state.majorType._id)})).length>0)&&n.a.createElement(Be.a,{variant:"contained",color:"primary",disabled:this.state.waiting,onClick:function(t){e.onSubmit("next")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Edit Next"),n.a.createElement(Be.a,{variant:"contained",color:"primary",style:{marginLeft:"4px"},disabled:this.state.waiting,onClick:function(t){e.onSubmit("add")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Create Another"),n.a.createElement(Be.a,{variant:"contained",color:"primary",style:{marginLeft:"4px"},className:"w200",disabled:this.state.waiting,onClick:function(t){e.onSubmit("")},type:"submit"},this.state.waiting?"Please Wait":"Submit"),n.a.createElement(Be.a,{variant:"contained",style:{marginLeft:"4px"},disabled:this.state.waiting,onClick:function(t){null===e.props.selectedThing._id?e.setState({redirectTo:"/world/details/".concat(e.props.selectedWorldID)}):e.setState({redirectTo:"/thing/details/".concat(e.props.selectedThing._id)})},type:"button"},"Cancel"))),n.a.createElement(B.a,{item:!0},this.state.message),n.a.createElement(B.a,{item:!0},this.state.errors.map((function(e,t){return n.a.createElement("div",{key:t},e)}))),n.a.createElement(B.a,{item:!0},Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""})))))}return n.a.createElement(he.a,{to:"/"})}return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")}}]),t}(r.Component),ya=Object(m.b)((function(e){return{selectedPage:e.app.selectedPage,selectedThing:e.app.selectedThing,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,things:e.app.things,types:e.app.types,user:e.app.user,attributesByID:e.app.attributesByID,attributesByName:e.app.attributesByName,fromLogin:e.app.fromLogin}}),(function(e){return{updateSelectedThing:function(t){return e(F(t))},addThing:function(t){return e(C(t))},updateThing:function(t){return e(j(t))},updateType:function(t){return e(L(t))},addType:function(t){return e(W(t))},setAttributes:function(t){return e(S(t))},setTypes:function(t){return e(x(t))},setThings:function(t){return e(k(t))},notFromLogin:function(){return e(R({}))},toggleLogin:function(){return e(P({}))},logout:function(){return e(w({}))}}}))(ba),ga=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=function(){},a.handleUserInput=function(e){var t=e.target.name,r="checkbox"===e.target.type?e.target.checked:e.target.value;a.setState(Object(Q.a)({},t,r))},a.inputBlur=function(e){var t=e.target.name,r=a.validateField(t),n=a.state.fieldValidation;n[t].valid!==r.valid&&(n[t].valid=r.valid,n[t].message=r.message,a.setState({fieldValidation:n}))},a.handleClickShowPassword=function(){a.setState({showPassword:!a.state.showPassword})},a.handleMouseDownPassword=function(e){e.preventDefault()},a.validateField=function(e){var t=!0,r="",n=a.state[e];switch(e){case"email":r=(t=null!==n.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid";break;case"password":r=(t=n.length>=6)?"":"Password is too short";break;case"confirmEmail":r=(t=n===a.state.email)?"":"Confirm Email doesn't match Email";break;case"confirmPassword":r=(t=n===a.state.password)?"":"Confirm Password doesn't match Password";break;case"username":r=(t=n.length>=2)?"":"Username is too short"}return{valid:t,message:r}},a.validateForm=function(e){var t=a.validateField("password"),r=a.validateField("confirmPassword"),n=t.valid&&r.valid,i=a.state.fieldValidation;i.password=t,i.confirmPassword=r,a.setState({formValid:n,fieldValidation:i},e)},a.onSubmit=function(){a.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},a.submitThroughAPI=function(){a.api.resetPassword(a.state.resetPasswordCode,a.state.password).then((function(e){a.setState({message:e.message,waiting:!1})})).catch((function(e){return console.log(e)}))},a.state={resetPasswordCode:null,codeValid:!1,password:"",confirmPassword:"",fieldValidation:{password:{valid:!0,message:""},confirmPassword:{valid:!0,message:""}},formValid:!1,message:"Please wait.  Validating code."},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;if(null===this.state.resetPasswordCode){var t=this.props.match.params.id;return setTimeout((function(){e.api.checkResetPasswordCode(t).then((function(a){void 0!==a.error?e.setState({resetPasswordCode:t,codeValid:!1,message:a.error}):e.setState({resetPasswordCode:t,codeValid:!0,message:""})}))}),500),n.a.createElement("div",null,n.a.createElement("h2",null,"Reset Password"),this.state.message)}return this.state.codeValid?n.a.createElement("div",null,n.a.createElement("h2",null,"Reset Password"),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"outlined-adornment-password"},"Password"),n.a.createElement(te.a,{id:"outlined-adornment-password",name:"password",type:this.state.showPassword?"text":"password",value:this.state.password,error:!this.state.fieldValidation.password.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(lt.a,{position:"end"},n.a.createElement(b.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ut.a,null):n.a.createElement(dt.a,null))),labelWidth:70,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.password.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($.a,{variant:"outlined",fullWidth:!0},n.a.createElement(ee.a,{htmlFor:"confirm-password"},"Confirm Password"),n.a.createElement(te.a,{id:"confirm-password",name:"confirmPassword",type:this.state.showPassword?"text":"password",value:this.state.confirmPassword,error:!this.state.fieldValidation.confirmPassword.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(lt.a,{position:"end"},n.a.createElement(b.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ut.a,null):n.a.createElement(dt.a,null))),labelWidth:130,fullWidth:!0}),n.a.createElement($e.a,null,this.state.fieldValidation.confirmPassword.message)))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"float-right"},n.a.createElement(Be.a,{className:"w200",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")))),this.state.message,Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))):n.a.createElement("div",null,n.a.createElement("h2",null,"Reset Password"),this.state.message)}}]),t}(r.Component),va=Object(m.b)()(ga),Ta=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).componentDidMount=function(){},a.state={confirmEmailCode:null,codeValid:!1,message:"Please wait.  Validating code."},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;if(null===this.state.confirmEmailCode){var t=this.props.match.params.id;setTimeout((function(){e.api.confirmEmail(t).then((function(a){void 0!==a.error?e.setState({confirmEmailCode:t,codeValid:!1,message:a.error}):e.setState({confirmEmailCode:t,codeValid:!0,message:a.message})}))}),500)}return n.a.createElement("div",null,n.a.createElement("h2",null,"Confirming Email"),this.state.message)}}]),t}(r.Component),Ea=Object(m.b)()(Ta);var wa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={version:"0"},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return n.a.createElement(B.a,{item:!0,xs:12,className:"h-100 margined"},this.props.loginOpen?n.a.createElement(bt,{onLogin:function(t){e.props.toggleLogin()}}):n.a.createElement(he.d,null,n.a.createElement(he.b,{exact:!0,path:"/",component:be}),n.a.createElement(he.b,{exact:!0,path:"/home",component:be}),n.a.createElement(he.b,{exact:!0,path:"/User/Profile",component:Re}),n.a.createElement(he.b,{exact:!0,path:"/User/resetPassword/:id",component:va}),n.a.createElement(he.b,{exact:!0,path:"/User/confirmEmail/:id",component:Ea}),n.a.createElement(he.b,{exact:!0,path:"/forums",component:Fe}),n.a.createElement(he.b,{exact:!0,path:"/world/details/:id",component:nt}),n.a.createElement(he.b,{exact:!0,path:"/world/create",component:ot}),n.a.createElement(he.b,{exact:!0,path:"/world/edit/:id",component:ot}),n.a.createElement(he.b,{exact:!0,path:"/world/collaborators/:id",component:Nt}),n.a.createElement(he.b,{exact:!0,path:"/world/collaborate/:worldID/:collabID",component:gt}),n.a.createElement(he.b,{exact:!0,path:"/type/create",component:Ht}),n.a.createElement(he.b,{exact:!0,path:"/type/details/:id",component:St}),n.a.createElement(he.b,{exact:!0,path:"/type/edit/:id",component:Ht}),n.a.createElement(he.b,{exact:!0,path:"/thing/create",component:ya}),n.a.createElement(he.b,{exact:!0,path:"/thing/create/:id",component:ya}),n.a.createElement(he.b,{exact:!0,path:"/thing/details/:id",component:ua}),n.a.createElement(he.b,{exact:!0,path:"/thing/edit/:id",component:ya})))}}]),t}(r.Component),Da=Object(m.b)((function(e){return{loginOpen:e.app.loginOpen}}),(function(e){return{toggleLogin:function(){return e(P({}))}}}))(wa);var Aa=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(c.a)(this,Object(u.a)(t).call(this,e))).state={version:"0",width:0,marginLeft:220},a.api=Z.getInstance(),a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.updateDimensions(),window.addEventListener("resize",this.updateDimensions.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions.bind(this))}},{key:"updateDimensions",value:function(){var e=window.innerWidth;e>=600?(e-=200,this.props.setWidth(e),this.setState({width:e,marginLeft:220,innerWidth:window.innerWidth})):(this.props.setWidth(e),this.setState({width:e,marginLeft:0,innerWidth:window.innerWidth}))}},{key:"render",value:function(){return null===this.props.api&&this.props.setAPI(this.api),n.a.createElement(d.a,null,this.props.menuOpen?n.a.createElement(U.a,{display:{xs:"none",sm:"inline"},className:"Sidebar"},n.a.createElement(_e,{className:"",logoText:"Author's Notebook"})):"",n.a.createElement(B.a,{container:!0},n.a.createElement(B.a,{item:!0,xs:12,style:{marginLeft:"".concat(this.props.menuOpen?this.state.marginLeft:0,"px"),width:"".concat(this.props.menuOpen?this.state.width:this.state.innerWidth,"px")}},n.a.createElement(xe,null)),n.a.createElement(B.a,{item:!0,xs:12,style:{marginLeft:"".concat(this.props.menuOpen?this.state.marginLeft+10:10,"px"),width:"".concat(this.props.menuOpen?this.state.width-20:this.state.innerWidth-20,"px"),marginRight:"10px",marginTop:"10px"}},n.a.createElement(Da,null))))}}]),t}(r.Component),Ia=Object(m.b)((function(e){return{menuOpen:e.app.menuOpen,api:e.app.api}}),(function(e){return{setWidth:function(t){return e({type:"SET_WIDTH",payload:t})},setAPI:function(t){return e({type:"SET_API",payload:t})}}}))(Aa);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Na=a(87),Oa=a(128),Sa={indexExpandedPanel:!1,api:null,articles:[],user:null,redirectToURL:null,loginError:"",worlds:[],publicWorlds:[],followingWorlds:[],selectedWorld:null,selectedWorldID:null,types:[],things:[],selectedType:null,attributesByID:{},attributesByName:{},selectedThing:null,loadIt:!0,menuOpen:!0,loginOpen:!1,fromLogin:!1,width:0,templates:[]};var xa={app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Sa,t=arguments.length>1?arguments[1]:void 0;if("UPDATE_INDEX_EXPANDED_PANEL"===t.type)return Object.assign({},e,{indexExpandedPanel:t.payload});if("LOAD_FROM_STORAGE"===t.type){var a=JSON.parse(sessionStorage.getItem("user"));a=void 0!==a&&null!==a&&void 0!==a.body&&void 0!==a.body.user?a.body.user:null;var r=JSON.parse(sessionStorage.getItem("selectedWorld")),n=sessionStorage.getItem("selectedWorldID"),i=JSON.parse(sessionStorage.getItem("types")),s=JSON.parse(sessionStorage.getItem("things")),o=JSON.parse(sessionStorage.getItem("followingWorlds")),l=JSON.parse(sessionStorage.getItem("attributesByID")),c=JSON.parse(sessionStorage.getItem("attributesByName"));return Object.assign({},e,{user:a,selectedWorld:r,selectedWorldID:n,types:null===i?[]:i,things:null===s?[]:s,followingWorlds:null===o?[]:o,attributesByID:null===l?{}:l,attributesByName:null===c?{}:c})}if("SET_API"===t.type)return Object.assign({},e,{api:t.payload});if("ADD_ARTICLE"===t.type)return Object.assign({},e,{articles:e.articles.concat(t.payload)});if("LOGIN"===t.type)return sessionStorage.setItem("followingWorlds",JSON.stringify(t.payload.followingWorlds)),Object.assign({},e,{user:t.payload,followingWorlds:t.payload.followingWorlds});if("LOGOUT"===t.type)return Object.assign({},e,{user:null});if("REDIRECT_TO"===t.type)return Object.assign({},e,{redirectToURL:t.payload});if("SET_WORLDS"===t.type){if(void 0!==t.payload&&void 0===t.payload.error){if(null!==e.selectedWorldID&&null===e.selectedWorld){var u=t.payload.filter((function(t){return t._id===e.selectedWorldID}));if(u.length>0){var p=u[0];return sessionStorage.setItem("selectedWorld",JSON.stringify(p)),Object.assign({},e,{worlds:t.payload,selectedWorld:p})}return Object.assign({},e,{worlds:t.payload})}return Object.assign({},e,{worlds:t.payload})}return Object.assign({},e,{})}if("SET_PUBLIC_WORLDS"===t.type){if(void 0===t.payload.error){if(null!==e.selectedWorldID&&null===e.selectedWorld){var d=t.payload.filter((function(t){return t._id===e.selectedWorldID}));if(d.length>0){var m=d[0];return sessionStorage.setItem("selectedWorld",JSON.stringify(m)),Object.assign({},e,{publicWorlds:t.payload,selectedWorld:m})}return Object.assign({},e,{publicWorlds:t.payload})}return Object.assign({},e,{publicWorlds:t.payload})}return Object.assign({},e,{})}if("SET_TEMPLATES"===t.type)return Object.assign({},e,{templates:t.payload});if("ADD_WORLD"===t.type){if(t.payload.Public){var h=e.worlds.concat(t.payload),f=e.publicWorlds.concat(t.payload);return Object.assign({},e,{worlds:h,publicWorlds:f})}return Object.assign({},e,{worlds:e.worlds.concat(t.payload)})}if("UPDATE_WORLD"===t.type){var b=Object(X.a)(e.worlds),y=Object(X.a)(e.publicWorlds),g=b.filter((function(e){return e._id===t.payload._id}))[0];g.Name=t.payload.Name,g.Description=t.payload.Description;var v=g.Public;if(g.Public=t.payload.Public,g.AcceptingCollaborators=t.payload.AcceptingCollaborators,g.Collaborators=t.payload.Collaborators,g.Public){if(v){var T=y.filter((function(e){return e._id===g._id}))[0];T.Name=g.Name}else y=y.concat(g);return Object.assign({},e,{worlds:b,publicWorlds:y})}return v?(y=y.filter((function(e){return e._id!==g._id})),Object.assign({},e,{worlds:b,publicWorlds:y})):Object.assign({},e,{worlds:b})}if("UPDATE_PUBLIC_WORLD_COLLAB"===t.type){var E=Object(X.a)(e.publicWorlds),w=E.filter((function(e){return e._id===t.payload._id}))[0];return w.Collaborators=t.payload.Collaborators,Object.assign({},e,{publicWorlds:E})}if("SELECT_WORLD"===t.type){var D=e.worlds.filter((function(e){return e._id===t.payload}));return 0===D.length&&(D=e.publicWorlds.filter((function(e){return e._id===t.payload}))),D.length>0?(sessionStorage.setItem("selectedWorldID",t.payload),sessionStorage.setItem("selectedWorld",JSON.stringify(D[0])),Object.assign({},e,{selectedWorldID:t.payload,selectedWorld:D[0],attributesByID:{},attributesByName:{}})):(sessionStorage.setItem("selectedWorldID",t.payload),sessionStorage.removeItem("selectedWorld"),Object.assign({},e,{selectedWorldID:t.payload,selectedWorld:null,attributesByID:{},attributesByName:{}}))}if("SET_ATTRIBUTES"===t.type){var A={},I={};return t.payload.forEach((function(e){A[e._id]=e,I[e.Name]=e})),sessionStorage.setItem("attributesByID",JSON.stringify(A)),sessionStorage.setItem("attributesByName",JSON.stringify(I)),Object.assign({},e,{attributesByID:A,attributesByName:I})}if("UPDATE_ATTRIBUTES"===t.type){var N=e.attributesByID,O=e.attributesByName;return t.payload.forEach((function(e){N[e._id]=e,O[e.Name]=e})),sessionStorage.setItem("attributesByID",JSON.stringify(N)),sessionStorage.setItem("attributesByName",JSON.stringify(O)),Object.assign({},e,{attributesByID:N,attributesByName:O})}if("ADD_ATTRIBUTES"===t.type){var S=e.attributesByID,x=e.attributesByName;return t.payload.forEach((function(e){S[e._id]=e,x[e.Name]=e})),sessionStorage.setItem("attributesByID",JSON.stringify(S)),sessionStorage.setItem("attributesByName",JSON.stringify(x)),Object.assign({},e,{attributesByID:S,attributesByName:x})}if("SET_TYPES"===t.type)return sessionStorage.setItem("types",JSON.stringify(t.payload)),Object.assign({},e,{types:t.payload});if("ADD_TYPE"===t.type){var W=e.types.concat(t.payload);return sessionStorage.setItem("types",JSON.stringify(W)),Object.assign({},e,{types:W})}if("SET_THINGS"===t.type)return sessionStorage.setItem("things",JSON.stringify(t.payload)),Object.assign({},e,{things:t.payload});if("ADD_THING"===t.type){var k=e.things.concat(t.payload);return sessionStorage.setItem("things",JSON.stringify(k)),Object.assign({},e,{things:k})}if("UPDATE_SELECTED_TYPE"===t.type){var C=Object(H.a)({},t.payload,{changedAt:Date.now()});return Object.assign({},e,{selectedType:C})}if("UPDATE_TYPE"===t.type){var L=Object(X.a)(e.types),_=L.filter((function(e){return e._id===t.payload._id}))[0];return _.Name=t.payload.Name,_.Description=t.payload.Description,_.Supers=t.payload.Supers,_.AttributesArr=t.payload.AttributesArr,_.Attributes=t.payload.Attributes,sessionStorage.setItem("types",JSON.stringify(L)),Object.assign({},e,{types:L})}if("UPDATE_SELECTED_THING"===t.type){var j=Object(H.a)({},t.payload,{changedAt:Date.now()});return Object.assign({},e,{selectedThing:j})}if("UPDATE_THING"===t.type){var F=Object(X.a)(e.things),V=F.filter((function(e){return e._id===t.payload._id}))[0];return V.Name=t.payload.Name,V.Description=t.payload.Description,V.Types=t.payload.Types,V.Attributes=t.payload.Attributes,sessionStorage.setItem("things",JSON.stringify(F)),Object.assign({},e,{things:F})}return"TOGGLE_MENU"===t.type?Object.assign({},e,{menuOpen:!e.menuOpen}):"TOGGLE_LOGIN"===t.type?Object.assign({},e,{fromLogin:e.loginOpen,loginOpen:!e.loginOpen}):"NOT_FROM_LOGIN"===t.type?Object.assign({},e,{fromLogin:!1}):"SET_WIDTH"===t.type?Object.assign({},e,{width:t.payload}):"SET_FOLLOWING_WORLDS"===t.type?(sessionStorage.setItem("followingWorlds",JSON.stringify(t.payload)),Object.assign({},e,{followingWorlds:t.payload})):e},session:Oa.sessionReducer},Wa=Object(Na.b)(xa),ka=Object(Na.c)(Wa),Ca={refreshFromLocalStorage:!0,refreshOnCheckAuth:!0,redirectPath:"/home",driver:"COOKIES",validateSession:function(e){return!0}};Oa.sessionService.initSessionService(ka,Ca).then((function(){return console.log("Redux React Session is ready and a session was refreshed from your storage")})).catch((function(){return console.log("Redux React Session is ready and there is no session in your storage")}));var La=ka;s.a.render(n.a.createElement(m.a,{store:La},n.a.createElement(Ia,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[180,1,2]]]);
//# sourceMappingURL=main.a61d6c27.chunk.js.map