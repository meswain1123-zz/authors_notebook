(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{156:function(e,t,a){},196:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA9CAYAAAAeYmHpAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAmRSURBVGhD7dpHqC1ZFQbg916bszZiwCyCICqCrag4cKSIIuJE0B4IQjsQDAOH4sDUKGob0BbFnDHQ2tqKiqHNophzzjnn8FzfvvXXW7denXPvfTg794f/VtWuvdZea+20dp178vTp0yd2Daem607h2OldwbHTu4Jjp3cFO+n0kZKTkydPTnf78ILi3Yu/Kz5Qwf874Vm2exj9W2U8HIYNLy7+qPjj4i+Lfy/+p/jP4nuLA2s6zoUNVxSfs3d7sP4Jzy6yd2B+1ytuYsPbi38p/nfiv4oczvNfix8sDqzpOgobvl78U/EPxTcrgANkXl78TfH3xWcpmOt0gSUXuLKoVzkaJ1HFTu/VHVjTexg2fKn45+LfinS73+fEitwri0ajKaf+d4sDo85SKGx4RfELxd8WOU3Jr4qibkjraQKd/yi+r7iq+yA2mEJ0aUfb6PmjxU0ylxXZZ9TFvn8Xv13cQxdcUfDJ4jeLFD2t+JRixxeLoh9nQyNAzzyzuNrGJjZYLxjbSSfuG0kNnytylE2uZDiNgvWp4tkGNViUzKUXjqcJi3reURxHXUPPPysO9Da2ccJPivR2492npz9e7HhJ8ftFvdvXmNynt60LF681CO8vcvjS8VTo9Rb143Qi6j70PHplTX6NEz5W/HXRVOJojI8Dny0GhrrFNQFyTV30HNv+WLxsTk7avvaa4k2LevoiBc2YJZ5XjA4KVNRQoOyO42Z9j9+E+xQ5fl6xC7qnX4/Cp4tyBDYY9gLFsW5w7snSd/4wuBlkLxwJRuFx/mxxGAj2CvT1Z++vXfzEeDiE4629hxT1HBBMW3rsusUfFu9cNNLYfb3izYuvKlrIyApQZOFqxfN6I+8u2tdUNPbHu22cQLkHcsgoz2GGlRG0qmeNEyxm5jC9aUN7etqwZe+85jS51xbVERDtd9uumId34bZF3Q/XKj517/ZAmE9riPOifNXivYtHHeZ0dBsJX6V49aK5/tLiY3ugpusji9aDDi9w3rMhUfVCVN5QnCO/xgmSgMj0K12Jsl6xr7+juKpryQk/L/be8gL19lhkt8ga/uqRjQ6BmqP4+uL5RVGM4tsXN6L1mPm1ht6lRpDeuYeHI/S2ObiGbxUvag5uQlbuBOw7xdlpQ7tbotKt3KwZ2MokAxaqIFa40qFiKhvi1yladA6LTLclOH0Qrl/UZmyyTt3JTZw2RBMRYOgNi8skoDtshbxrsc85DcRhib5Ie47z1yxeUNza2+2dkUf/svKm0RXZtxW1FTl2vMuN0RGDf1o0B/PsqsG7FS+NEc0Y8/8GRfOUXJCoCqCkwT5qXgV06u2PjKeDkU6ABBRWp16z757F7PF8+V7xwrXpkFw3yhkuQjb8Dumecimm5MTioD4Ds3BIFJ5bBKNFWfSq5/AykMWnc4I83ylJfYXdtq8WN8kB/eS0e1YqnJ4FPaNSIEpomFvmLy9y+CZF28HNio8v6r0goaYn97aqHxTTa8olEiM9bb2zRJ+P0G3to2eJZxQtgBSTf2NxX1BOtYeHFfWQghTGolsXH1C8RVGDby2C3owxZNxHJk7C7Yo9PVTP1HFs3YauD2IbO2cI3BQ8+h5TNJ/Vk6CMTunBHQY3x2U4kg0FaiHjI6GxdxYfPZ5OnLhD8Yy2MzJgOHbdcnnTAtS5RlGquam3uy5KZkWF4XRzFhxzH16UWKXQznJh0doyI70UmENxOPBssfpK0aop2wkojUHdSMN7ON3AIB8F+jCnzyKz5rgeshhFP6RSzwKlnNmODOv4lLqeb7R3u4el004sry6as2nIEDEv7uJBz7Xey7awtLgb2uubFn0kccqU+UZx6XjWin26Cu6zT7+s+OAiOwI+dRkdI/Ga9c9ON8MMwQwRDvua+KhirxP0xgKV+nzueFLRiOm9zYbbFB0lu+OxLQ54Ed1PLIJ1yIInz5D0WDBTH8ggO9+iYGDRc2CJp1jhxq1lwteKaSRbClmJyfi0tCID3qcNV4G257+pGPh8a+7Sa/FUD5VdUmSn8jE9Gmyx9GWbjP5fFPewMOjLRY0QUFnSMtCNb/VtYR6iHN3PJ5wNcs7X2kl9Vw7I8mw58OSitUS91EXTQ2eo70Ay0HQ7iAhMfEDy5v34bj6G0DSknHfl4KlIaO9D2maMBH7CPC4L87TZgHsVBUY7QNYcli+PFb3Q8+6u28HFPm/R9YVndni6+trz+WIPKpLzkeHEqTaHHlS0+iVkMq2HumlRXGJ8bGhQMZFdlWtlDEtvKGSI+WkbtC3eeCqD7rT6ZCVJm2yTEGUnAvKCeEsP6ZFsRyopyxzb5jAwcA3pwW24X9ECFKcDPS4Rum9xuZiBQF/ArgOC6jwdeU5rZ9/816sKMyQ4bU8dSpacYO6oF4OQrN6Tx6/Khg0SIu0uh2MWI3PXO8+z4Ws6wwm2WfWRf/P8F4kXFUVX7UTGVcbUt5CB6dli84hikofAyxi9Fc04v49xDOI0sIk+jkP0Zv8+CM4LkbGwCe7c7nuKmVuhZxV9UekGgp9mrZ6ibx9ncIxFz+Nklshv4wQ2RFd6NPqUK0vPW+FXdYUNpgIZ9sznafDTTR9aUW67MEwdHwOHc4oMF/PRgpKjZcjwjVvWkg0fKMbB7jTb2MImnNeaTWywBXPYl96BvJcJ2fs0hOm5UK/ar52S9D4n8wvDh4uMjIHqMxBHZGFp1JINPi7EweikX7ucVz7y7jU92CCB8Yun7+ADvY4f5zgUJ9ciLRAZzv0TEucZEllkdBKIzxT3GbWJDUZPbKBbkNO+MjYcpMOnYdni6j8JWLC8dI2TSQqixTuN6+3XFcf36wkcTFDivPoSAYnG+Lh4GDSjnbPH6l+wkLEHs6K6v6QvsO7bs4XZdmeVv7+CRUBm5FtWDHcV7dBZdUZT4muLnkjaJwDofqyWkAgfhhP8akEvW5YUaKOhQ57/9KKkxolt6z8FdEgp4zRHs8xfXhxYETQHBYshGYZ45J9owwb/ZsEOhd1pQdWeQ4uV3KIZWwXDcXNgTT/u/TkDQ8J8pNBwdkAfOEtwD3501yhDOE12fLSDpcxROEHPCWJ3GvuI9N48/1BxxprO8MzNHi4u2hI47WPCQBdY1AeZDxnOz//isCZzFDY4YjoWZtq4ctQ9WoS3/vPNkvsf9uBX/Xlv7u+XbGDY+B8TWKt7rpzgnG0kcVivSinlCUbm84urspt40p9gmXL2d5twLjJHQdNv37cj2CafoCA4apv7nN4V2FN3DsdO7wqOnd4VHDu9Kzh2ejdw4sT/AKg3OUKQFc+/AAAAAElFTkSuQmCC"},218:function(e,t,a){e.exports=a(355)},223:function(e,t,a){},224:function(e,t,a){},248:function(e,t,a){},348:function(e,t,a){},355:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(22),s=a.n(i),o=(a(223),a(12)),l=a(13),c=a(15),u=a(14),p=(a(224),a(23)),d=a(16),m=a(403),f=a(404),h=a(392),g=a(360),b=a(395),y=a(394),v=a(195),T=a.n(v);function E(e){return{type:"LOGOUT",payload:e}}function D(e){return{type:"SET_WORLDS",payload:e}}function w(e){return{type:"SET_TEMPLATES",payload:e}}function I(e){return{type:"SET_ALL_USERS",payload:e}}function A(e){return{type:"ADD_AND_SELECT_WORLD",payload:e}}function S(e){return{type:"UPDATE_WORLD",payload:e}}function N(e){return{type:"SET_PUBLIC_WORLDS",payload:e}}function O(e){return{type:"SELECT_WORLD",payload:e}}function x(e){return{type:"SET_ATTRIBUTES",payload:e}}function W(e){return{type:"SET_TYPES",payload:e}}function k(e){return{type:"ADD_TYPE",payload:e}}function C(e){return{type:"SET_THINGS",payload:e}}function _(e){return{type:"ADD_THING",payload:e}}function j(e){return{type:"UPDATE_TYPE",payload:e}}function L(e){return{type:"UPDATE_SELECTED_TYPE",payload:e}}function V(e){return{type:"UPDATE_THING",payload:e}}function P(e){return{type:"UPDATE_SELECTED_THING",payload:e}}function F(e){return{type:"TOGGLE_MENU",payload:e}}function B(e){return{type:"TOGGLE_LOGIN",payload:e}}function M(e){return{type:"NOT_FROM_LOGIN",payload:e}}function R(e){return{type:"SET_FOLLOWING_WORLDS",payload:e}}var U=a(390),H=a(428),z=a(10),J=a(2),G=a.n(J),Y=a(6);function q(e){this.name="UnauthorizedError",this.message=e}q.prototype=new Error;var K=function(){var e;return{getInstance:function(){return e||(e=new Q),e}}}(),Q=function e(){var t=this;Object(o.a)(this,e),this.logErrorReason=function(e){return console.log("Response error reason:",e),Promise.reject(e)},this.checkStatus=function(e){if(e.status>=200&&e.status<300)return e;if(401===e.status){var t=new q(e.statusText);return t.response=e,Promise.reject(t)}var a=new Error(e.statusText);return a.response=e,Promise.reject(a)},this.getVersion=Object(Y.a)(G.a.mark((function e(){var a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.fetchData("/version");case 3:return a=e.sent,e.abrupt("return",t.processResponse(a));case 7:return e.abrupt("return",{version:"0.0.1"});case 8:case"end":return e.stop()}}),e)}))),this.getAllUsers=Object(Y.a)(G.a.mark((function e(){var a,r=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0&&void 0!==r[0]&&r[0])){e.next=5;break}return e.abrupt("return",t.getAllUsersFromAPI());case 5:if(null===(a=t.getSessionData("allUsers"))){e.next=10;break}return e.abrupt("return",a);case 10:return e.abrupt("return",t.getAllUsersFromAPI());case 11:case"end":return e.stop()}}),e)}))),this.getAllUsersFromAPI=Object(Y.a)(G.a.mark((function e(){var a,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/user/getAllUsers");case 3:return a=e.sent,r=t.processResponse(a,null,"allUsers"),e.abrupt("return",r);case 8:return e.abrupt("return",[{_id:-1,OwnerID:-1,Name:"Alice in Wonderland",Public:!0}]);case 9:case"end":return e.stop()}}),e)}))),this.login=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return r&&(n={body:a,expiresAt:"never"},localStorage.setItem("loginUser",JSON.stringify(n))),e.next=4,t.postData("/api/user/login",a);case 4:return i=e.sent,e.abrupt("return",t.processResponse(i,null,"user",r));case 8:return e.abrupt("return",{_id:"-1",email:"fake@fakemail.com",username:"Liar Liar"});case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.logout=function(){var e=Object(Y.a)(G.a.mark((function e(a){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=4;break}return e.next=3,t.postData("/api/user/logout");case 3:localStorage.removeItem("user");case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.register=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/user/register",a);case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return",-1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.confirmEmail=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.patchData("/api/user/confirmEmail",{code:a});case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return",{_id:"-1",email:"fake@fakemail.com",username:"Liar Liar"});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.sendReset=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/user/sendReset",a);case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.checkResetPasswordCode=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/user/checkResetPasswordCode",{code:a});case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.resetPassword=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.patchData("/api/user/resetPassword",{code:a,newPassword:r});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n));case 7:return e.abrupt("return",{_id:"-1",email:"fake@fakemail.com",username:"Liar Liar"});case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.emailTest=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/user/emailTest",a);case 3:return r=e.sent,e.abrupt("return",t.processResponse(r));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateUser=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/user/update",a);case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/user/update",a);case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",{_id:"-1",email:"fake@fakemail.com",username:"Liar Liar"});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createTemplate=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createTemplate",{template:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createTemplate",{template:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getTemplates=Object(Y.a)(G.a.mark((function e(){var a,r=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0&&void 0!==r[0]&&r[0])){e.next=5;break}return e.abrupt("return",t.getTemplatesFromAPI());case 5:if(null===(a=t.getSessionData("templates"))){e.next=10;break}return e.abrupt("return",a);case 10:return e.abrupt("return",t.getTemplatesFromAPI());case 11:case"end":return e.stop()}}),e)}))),this.getTemplatesFromAPI=Object(Y.a)(G.a.mark((function e(){var a,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getTemplates/");case 3:return a=e.sent,r=function(){var e=Object(Y.a)(G.a.mark((function e(){var a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getTemplates/");case 4:return a=e.sent,e.abrupt("return",t.processResponse(a,null,"templates"));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(a,r,"templates"));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Alice"}]);case 9:case"end":return e.stop()}}),e)}))),this.getWorlds=Object(Y.a)(G.a.mark((function e(){var a,r,n,i,s,o=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>0&&void 0!==o[0]&&o[0],e.prev=1,e.next=4,t.getPublicWorlds(a);case 4:return r=e.sent,e.next=7,t.getWorldsForUser(a);case 7:return n=e.sent,e.next=10,t.getTemplates(a);case 10:return i=e.sent,e.next=13,t.getAllUsers(a);case 13:return s=e.sent,e.abrupt("return",{publicWorlds:r,userWorlds:n,templates:i,allUsers:s});case 17:return e.prev=17,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",{error:e.t0});case 21:case"end":return e.stop()}}),e,null,[[1,17]])}))),this.getWorldsForUser=Object(Y.a)(G.a.mark((function e(){var a,r=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0&&void 0!==r[0]&&r[0])){e.next=5;break}return e.abrupt("return",t.getWorldsForUserFromAPI());case 5:if(null===(a=t.getSessionData("worlds"))){e.next=10;break}return e.abrupt("return",a);case 10:return e.abrupt("return",t.getWorldsForUserFromAPI());case 11:case"end":return e.stop()}}),e)}))),this.getWorldsForUserFromAPI=Object(Y.a)(G.a.mark((function e(){var a,r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=9;break}return e.next=3,t.fetchData("/api/world/getWorldsForUser");case 3:return a=e.sent,r=function(){var e=Object(Y.a)(G.a.mark((function e(){var a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getWorldsForUser");case 4:return a=e.sent,e.abrupt("return",t.processResponse(a,null,"worlds"));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n=t.processResponse(a,r,"worlds"),e.abrupt("return",n);case 9:return e.abrupt("return",[{_id:-1,OwnerID:-1,Name:"Alice in Wonderland",Public:!0}]);case 10:case"end":return e.stop()}}),e)}))),this.getPublicWorlds=Object(Y.a)(G.a.mark((function e(){var a,r=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0&&void 0!==r[0]&&r[0])){e.next=5;break}return e.abrupt("return",t.getPublicWorldsFromAPI());case 5:if(null===(a=t.getSessionData("publicWorlds"))){e.next=10;break}return e.abrupt("return",a);case 10:return e.abrupt("return",t.getPublicWorldsFromAPI());case 11:case"end":return e.stop()}}),e)}))),this.getPublicWorldsFromAPI=Object(Y.a)(G.a.mark((function e(){var a,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getPublicWorlds");case 3:return a=e.sent,r=function(){var e=Object(Y.a)(G.a.mark((function e(){var a;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getPublicWorlds");case 4:return a=e.sent,e.abrupt("return",t.processResponse(a,null,"publicWorlds"));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(a,r,"publicWorlds"));case 8:return e.abrupt("return",[{_id:-1,OwnerID:-1,Name:"Alice in Wonderland",Public:!0}]);case 9:case"end":return e.stop()}}),e)}))),this.getWorld=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n,i,s,o,l,c=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]&&c[1],e.prev=1,e.next=4,t.getAttributesForWorld(a,r);case 4:return n=(n=e.sent).attributes,e.next=8,t.getTypesForWorld(a,r);case 8:return i=(i=e.sent).types,e.next=12,t.getThingsForWorld(a,r);case 12:return s=(s=e.sent).things,o={},l={},n.forEach((function(e){e.TypeIDs=[],o[e._id]=e,l[e.Name]=e})),i.forEach((function(e){e.Supers=[],e.SuperIDs.forEach((function(t){e.Supers=e.Supers.concat(i.filter((function(e){return e._id===t})))})),e.AttributesArr=[],e.Attributes.forEach((function(t){var a=o[t.attrID];void 0===a||(a.TypeIDs.push(e._id),e.AttributesArr.push({index:e.AttributesArr.length,Name:a.Name.trim(),AttributeType:a.AttributeType,Options:a.Options,DefinedType:a.DefinedType,ListType:a.ListType,attrID:t.attrID,TypeIDs:a.TypeIDs}))}));var t={};void 0!==e.Defaults&&e.Defaults.forEach((function(e){t[e.attrID]=e})),e.DefaultsHash=t})),s.forEach((function(e){e.Types=[],e.TypeIDs.forEach((function(t){e.Types=e.Types.concat(i.filter((function(e){return e._id===t})))}))})),e.abrupt("return",{attributes:n,attributesByID:o,attributesByName:l,types:i,things:s});case 22:return e.prev=22,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",{error:e.t0});case 26:case"end":return e.stop()}}),e,null,[[1,22]])})));return function(t){return e.apply(this,arguments)}}(),this.getWorldByTypeID=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n,i,s,o,l,c,u=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]&&u[1],e.prev=1,e.next=4,t.getWorldIDByTypeID(a);case 4:return n=(n=e.sent).worldID,console.log(n),e.next=9,t.getAttributesForWorld(n,r);case 9:return i=(i=e.sent).attributes,e.next=13,t.getTypesForWorld(n,r);case 13:return s=(s=e.sent).types,e.next=17,t.getThingsForWorld(n,r);case 17:return o=(o=e.sent).things,l={},c={},i.forEach((function(e){e.TypeIDs=[],l[e._id]=e,c[e.Name]=e})),s.forEach((function(e){e.Supers=[],e.SuperIDs.forEach((function(t){e.Supers=e.Supers.concat(s.filter((function(e){return e._id===t})))})),e.AttributesArr=[],e.Attributes.forEach((function(t){var a=l[t.attrID];void 0===a||(a.TypeIDs.push(e._id),e.AttributesArr.push({index:e.AttributesArr.length,Name:a.Name.trim(),AttributeType:a.AttributeType,Options:a.Options,DefinedType:a.DefinedType,ListType:a.ListType,attrID:t.attrID,TypeIDs:a.TypeIDs}))}));var t={};void 0!==e.Defaults&&e.Defaults.forEach((function(e){t[e.attrID]=e})),e.DefaultsHash=t})),o.forEach((function(e){e.Types=[],e.TypeIDs.forEach((function(t){e.Types=e.Types.concat(s.filter((function(e){return e._id===t})))}))})),e.abrupt("return",{worldID:n,attributes:i,attributesByID:l,attributesByName:c,types:s,things:o});case 27:return e.prev=27,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",{error:e.t0});case 31:case"end":return e.stop()}}),e,null,[[1,27]])})));return function(t){return e.apply(this,arguments)}}(),this.getWorldIDByTypeID=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getWorldIDByTypeID/".concat(a));case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getWorldIDByTypeID/".concat(a));case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Character"}]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getWorldByThingID=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n,i,s,o,l,c,u=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]&&u[1],e.prev=1,e.next=4,t.getWorldIDByThingID(a);case 4:return n=(n=e.sent).worldID,console.log(n),e.next=9,t.getAttributesForWorld(n,r);case 9:return i=(i=e.sent).attributes,e.next=13,t.getTypesForWorld(n,r);case 13:return s=(s=e.sent).types,e.next=17,t.getThingsForWorld(n,r);case 17:return o=(o=e.sent).things,l={},c={},i.forEach((function(e){e.TypeIDs=[],l[e._id]=e,c[e.Name]=e})),s.forEach((function(e){e.Supers=[],e.SuperIDs.forEach((function(t){e.Supers=e.Supers.concat(s.filter((function(e){return e._id===t})))})),e.AttributesArr=[],e.Attributes.forEach((function(t){var a=l[t.attrID];void 0===a||(a.TypeIDs.push(e._id),e.AttributesArr.push({index:e.AttributesArr.length,Name:a.Name.trim(),AttributeType:a.AttributeType,Options:a.Options,DefinedType:a.DefinedType,ListType:a.ListType,attrID:t.attrID,TypeIDs:a.TypeIDs}))}));var t={};void 0!==e.Defaults&&e.Defaults.forEach((function(e){t[e.attrID]=e})),e.DefaultsHash=t})),o.forEach((function(e){e.Types=[],e.TypeIDs.forEach((function(t){e.Types=e.Types.concat(s.filter((function(e){return e._id===t})))}))})),e.abrupt("return",{worldID:n,attributes:i,attributesByID:l,attributesByName:c,types:s,things:o});case 27:return e.prev=27,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",{error:e.t0});case 31:case"end":return e.stop()}}),e,null,[[1,27]])})));return function(t){return e.apply(this,arguments)}}(),this.getWorldIDByThingID=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getWorldIDByThingID/".concat(a));case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getWorldIDByThingID/".concat(a));case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Character"}]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.createWorld=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createWorld",{world:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createWorld",{world:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteWorld=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/deleteWorld",{worldID:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/deleteWorld",{worldID:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateWorld=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/updateWorld",{world:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/updateWorld",{world:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.generateCollabLink=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/generateCollabLink",{worldID:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/generateCollabLink",{worldID:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.addNewCollaborator=function(){var e=Object(Y.a)(G.a.mark((function e(a,r,n){var i,s;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/addNewCollaborator",{worldID:a,userID:r,email:n});case 3:return i=e.sent,s=function(){var e=Object(Y.a)(G.a.mark((function e(){var i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/addNewCollaborator",{worldID:a,userID:r,email:n});case 4:return i=e.sent,e.abrupt("return",t.processResponse(i));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(i,s));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),this.emailCollaborator=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/emailCollaborator",{worldID:a,email:r});case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/emailCollaborator",{worldID:a,email:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.deleteCollab=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/deleteCollab",{worldID:a,collabID:r});case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/deleteCollab",{worldID:a,collabID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.updateCollaboratorPermission=function(){var e=Object(Y.a)(G.a.mark((function e(a,r,n){var i,s;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/updateCollaboratorPermission",{worldID:a,collabID:r,editPermission:n});case 3:return i=e.sent,s=function(){var e=Object(Y.a)(G.a.mark((function e(){var i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/updateCollaboratorPermission",{worldID:a,collabID:r,editPermission:n});case 4:return i=e.sent,e.abrupt("return",t.processResponse(i));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(i,s));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),this.checkCollabID=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.postData("/api/world/checkCollabID",{worldID:a,collabID:r});case 3:return n=e.sent,e.abrupt("return",t.processResponse(n));case 7:return e.abrupt("return","success");case 8:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.requestToCollaborate=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/requestToCollaborate",{worldID:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/requestToCollaborate",{worldID:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.declineCollabInvite=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/declineCollabInvite",{worldID:a,collabID:r});case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/declineCollabInvite",{worldID:a,collabID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.acceptCollabInvite=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/acceptCollabInvite",{worldID:a,collabID:r});case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/acceptCollabInvite",{worldID:a,collabID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.acceptCollabRequest=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/acceptCollabRequest",{worldID:a,collabID:r});case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/acceptCollabRequest",{worldID:a,collabID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.selectWorld=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/selectWorld",{worldID:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/selectWorld",{worldID:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getAttributesForWorld=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>1&&void 0!==n[1]&&n[1])){e.next=5;break}return e.abrupt("return",t.getAttributesForWorldFromAPI(a));case 5:if(null===(r=t.getSessionData("attributes_".concat(a)))){e.next=10;break}return e.abrupt("return",r);case 10:return e.abrupt("return",t.getAttributesForWorldFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getAttributesForWorldFromAPI=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getAttributesForWorld/".concat(a));case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getAttributesForWorld/".concat(a));case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null,"attributes_".concat(a)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n,"attributes_".concat(a)));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Character"}]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getAttribute=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getAttribute/".concat(a,"/").concat(r));case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getAttribute/".concat(a,"/").concat(r));case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return",{_id:-1,worldID:-1,Name:"Character",Description:"",Attributes:{}});case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.createAttribute=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createAttribute",{attribute:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createAttribute",{attribute:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.upsertAttributes=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/upsertAttributes",{worldID:a,attributes:r});case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/upsertAttributes",{worldID:a,attributes:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.getTypesForWorld=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>1&&void 0!==n[1]&&n[1])){e.next=5;break}return e.abrupt("return",t.getTypesForWorldFromAPI(a));case 5:if(null===(r=t.getSessionData("types_".concat(a)))){e.next=10;break}return e.abrupt("return",r);case 10:return e.abrupt("return",t.getTypesForWorldFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getTypesForWorldFromAPI=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getTypesForWorld/".concat(a));case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getTypesForWorld/".concat(a));case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null,"types_".concat(a)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n,"types_".concat(a)));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Character"}]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getType=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getType/".concat(a,"/").concat(r));case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getType/".concat(a,"/").concat(r));case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return",{_id:-1,worldID:-1,Name:"Character",Description:"",Attributes:{}});case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.createType=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createType",{type:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createType",{type:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteType=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/deleteType",{worldID:a,typeID:r});case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/deleteType",{worldID:a,typeID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.updateType=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/updateType",{type:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/updateType",{type:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getThingsForWorld=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>1&&void 0!==n[1]&&n[1])){e.next=5;break}return e.abrupt("return",t.getThingsForWorldFromAPI(a));case 5:if(null===(r=t.getSessionData("things_".concat(a)))){e.next=10;break}return e.abrupt("return",r);case 10:return e.abrupt("return",t.getThingsForWorldFromAPI(a));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getThingsForWorldFromAPI=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getThingsForWorld/".concat(a));case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getThingsForWorld/".concat(a));case 4:return r=e.sent,e.abrupt("return",t.processResponse(r,null,"things_".concat(a)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n,"things_".concat(a)));case 8:return e.abrupt("return",[{_id:-1,worldID:-1,Name:"Alice"}]);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getThing=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.fetchData("/api/world/getThing/".concat(a,"/").concat(r));case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.fetchData("/api/world/getThing/".concat(a,"/").concat(r));case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return",{_id:-1,worldID:-1,Types:[-1],Name:"Alice",Description:""});case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.createThing=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/createThing",{thing:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/createThing",{thing:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.deleteThing=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.deleteData("/api/world/deleteThing",{worldID:a,thingID:r});case 3:return n=e.sent,i=function(){var e=Object(Y.a)(G.a.mark((function e(){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.deleteData("/api/world/deleteThing",{worldID:a,thingID:r});case 4:return n=e.sent,e.abrupt("return",t.processResponse(n));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(n,i));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.updateThing=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/updateThing",{thing:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/updateThing",{thing:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return","success");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getComments=function(){var e=Object(Y.a)(G.a.mark((function e(a,r,n){var i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=7;break}return e.next=3,t.fetchData("/api/world/getComments/".concat(a,"/").concat(r,"/").concat(n));case 3:return i=e.sent,e.abrupt("return",t.processResponse(i));case 7:return e.abrupt("return",{_id:-1,worldID:-1,Types:[-1],Name:"Alice",Description:""});case 8:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),this.addComment=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.postData("/api/world/addComment",{comment:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.postData("/api/world/addComment",{comment:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.updateComment=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.real){e.next=8;break}return e.next=3,t.patchData("/api/world/updateComment",{comment:a});case 3:return r=e.sent,n=function(){var e=Object(Y.a)(G.a.mark((function e(){var r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.relogin();case 2:return e.next=4,t.patchData("/api/world/updateComment",{comment:a});case 4:return r=e.sent,e.abrupt("return",t.processResponse(r));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.abrupt("return",t.processResponse(r,n));case 8:return e.abrupt("return",-1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.fetchData=function(){var e=Object(Y.a)(G.a.mark((function e(a){var r,n=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.next=3,fetch("".concat(a),Object(z.a)(Object(z.a)({mode:"cors",credentials:"include"},r),{},{headers:Object(z.a)({Accept:"application/json"},r.headers)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.postData=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(z.a)(Object(z.a)({mode:"cors",credentials:"include"},n),{},{headers:Object(z.a)({Accept:"application/json","Content-Type":"application/json"},n.headers),method:"POST",body:JSON.stringify(r)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.putData=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(z.a)(Object(z.a)({mode:"cors",credentials:"include"},n),{},{headers:Object(z.a)({Accept:"application/json","Content-Type":"application/json"},n.headers),method:"PUT",body:JSON.stringify(r)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.patchData=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(z.a)(Object(z.a)({mode:"cors",credentials:"include"},n),{},{headers:Object(z.a)({Accept:"application/json","Content-Type":"application/json"},n.headers),method:"PATCH",body:JSON.stringify(r)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.deleteData=function(){var e=Object(Y.a)(G.a.mark((function e(a,r){var n,i=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,fetch("".concat(a),Object(z.a)(Object(z.a)({mode:"cors",credentials:"include"},n),{},{headers:Object(z.a)({Accept:"application/json","Content-Type":"application/json"},n.headers),method:"DELETE",body:JSON.stringify(r)})).then(t.checkStatus).catch(t.logErrorReason);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.processResponse=function(){var e=Object(Y.a)(G.a.mark((function e(t){var a,r,n,i,s,o,l=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>1&&void 0!==l[1]?l[1]:null,r=l.length>2&&void 0!==l[2]?l[2]:null,n=l.length>3&&void 0!==l[3]&&l[3],e.next=5,t.json();case 5:if(i=e.sent,200===t.status){e.next=10;break}throw Error(i.message);case 10:if(void 0===i.error||null===a){e.next=14;break}return e.abrupt("return",a());case 14:return null!==r&&(s=new Date,n?s="never":s.setHours(s.getHours()+1),o={expiresAt:s,body:i},localStorage.setItem(r,JSON.stringify(o))),e.abrupt("return",i);case 16:case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.relogin=Object(Y.a)(G.a.mark((function e(){var a,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null===(a=t.getSessionData("loginUser"))){e.next=7;break}return e.next=5,t.postData("/api/user/login",a);case 5:r=e.sent,t.processResponse(r,null,"user",!0);case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(0);case 11:case"end":return e.stop()}}),e,null,[[0,9]])}))),this.getSessionData=function(e){var t=localStorage.getItem(e);if(null!==t){var a=JSON.parse(t);if(void 0!==a.expiresAt&&("never"===a.expiresAt||a.expiresAt>new Date))return a.body}return null},this.real=!0},X=K,Z=a(31),$=a(11),ee=(a(156),a(171)),te=a(182),ae=a(183),re=a(396),ne=a(397),ie=a(429),se=a(398),oe=a(400),le=a(401),ce=a(124),ue=a.n(ce),pe=a(192),de=a.n(pe),me=a(193),fe=a.n(me),he=a(67),ge=a(385),be=a(387),ye=a(388),ve=a(389),Te=a(76),Ee=a(185),De=a.n(Ee);function we(e){return console.log(e),n.a.createElement(De.a,{url:"https://youtu.be/kksVfoN2bR8",width:"100%"})}var Ie=Object(ge.a)({root:{}});function Ae(e){var t=Ie();return n.a.createElement(be.a,{className:t.root},n.a.createElement(ye.a,null,n.a.createElement(ve.a,null,n.a.createElement(Te.a,{gutterBottom:!0,variant:"h5",component:"h2"},e.title),n.a.createElement(we,{url:"urlGoesHere.mov"}),n.a.createElement(Te.a,{variant:"body2",color:"textSecondary",component:"p"},e.description))))}var Se=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).state={version:"0",redirectTo:null},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return this.props.fromLogin&&this.props.notFromLogin(),null!==this.state.redirectTo?n.a.createElement(he.a,{to:this.state.redirectTo}):n.a.createElement("div",null,n.a.createElement("h3",null,"Author's Notebook"),n.a.createElement(Ae,{title:"Getting Started",description:"This video explains the basics of how to use the website and its tools.  It covers the basic concepts, navigation, creating a project, importing templates, creating types, creating attributes, and creating things."}))}}]),a}(r.Component),Ne=Object(d.b)((function(e){return{fromLogin:e.app.fromLogin}}),(function(e){return{notFromLogin:function(){return e(M({}))}}}))(Se),Oe=a(18),xe=a(393),We=a(391),ke=a(146),Ce=a.n(ke),_e=a(147),je=a.n(_e),Le=a(191),Ve=a.n(Le),Pe=a(172),Fe=(a(248),a(190)),Be=a.n(Fe),Me=a(88),Re=a.n(Me),Ue=a(145),He=a.n(Ue),ze=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;Object(o.a)(this,a),(r=t.call(this,e)).dirtyProps=["modules","formats","bounds","theme","children"],r.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],r.state={generation:0},r.editor=null,r.editingArea=null,r.value=null,r.refInput=null,r.selection=null,r.lastDeltaChangeSet=null,r.regenerationSnapshot={},r.unprivilegedEditor=null,r.onEditorChange=function(e,t,a,n){"text-change"===e?r.onEditorChangeText(r.editor.root.innerHTML,t,n,r.unprivilegedEditor):"selection-change"===e&&r.onEditorChangeSelection(t,n,r.unprivilegedEditor)};var i=r.isControlled()?e.value:e.defaultValue;return r.value=null!==i&&void 0!==i?i:"",r.refInput=n.a.createRef(),r}return Object(l.a)(a,[{key:"validateProps",value:function(e){if(n.a.Children.count(e.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(n.a.Children.count(e.children)){var t=n.a.Children.only(e.children);if(null!==t&&"textarea"===t.type)throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.")}if(this.lastDeltaChangeSet&&e.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")}},{key:"shouldComponentUpdate",value:function(e,t){var a=this;if(this.validateProps(e),!this.editor||this.state.generation!==t.generation)return!0;if("value"in e){var r,n=this.getEditorContents(),i=null!==(r=e.value)&&void 0!==r?r:"";this.isEqualValue(i,n)||this.setEditorContents(this.editor,i)}return e.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,!e.readOnly),[].concat(Object($.a)(this.cleanProps),Object($.a)(this.dirtyProps)).some((function(t){return!Re()(e[t],a.props[t])}))}},{key:"shouldComponentRegenerate",value:function(e){var t=this;return this.dirtyProps.some((function(a){return!Re()(e[a],t.props[a])}))}},{key:"componentDidMount",value:function(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())}},{key:"componentWillUnmount",value:function(){this.destroyEditor()}},{key:"componentDidUpdate",value:function(e,t){var a=this;if(this.editor&&this.shouldComponentRegenerate(e)){var r=this.editor.getContents(),n=this.editor.getSelection();this.regenerationSnapshot={delta:r,selection:n},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==t.generation){var i=this.regenerationSnapshot,s=i.delta,o=i.selection;delete this.regenerationSnapshot,this.instantiateEditor();var l=this.editor;l.setContents(s),Je((function(){return a.setEditorSelection(l,o)}))}}},{key:"instantiateEditor",value:function(){this.editor||(this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig()))}},{key:"destroyEditor",value:function(){this.editor&&(this.unhookEditor(this.editor),delete this.editor)}},{key:"isControlled",value:function(){return"value"in this.props}},{key:"getEditorConfig",value:function(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,scrollingContainer:this.props.scrollingContainer,tabIndex:this.props.tabIndex,theme:this.props.theme}}},{key:"getEditor",value:function(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor}},{key:"createEditor",value:function(e,t){var a=new He.a(e,t);return null!=t.tabIndex&&this.setEditorTabIndex(a,t.tabIndex),this.hookEditor(a),a}},{key:"hookEditor",value:function(e){this.unprivilegedEditor=this.makeUnprivilegedEditor(e),e.on("editor-change",this.onEditorChange)}},{key:"unhookEditor",value:function(e){e.off("editor-change",this.onEditorChange)}},{key:"getEditorContents",value:function(){return this.value}},{key:"getEditorSelection",value:function(){return this.selection}},{key:"isDelta",value:function(e){return e&&e.ops}},{key:"isEqualValue",value:function(e,t){return this.isDelta(e)&&this.isDelta(t)?Re()(e.ops,t.ops):Re()(e,t)}},{key:"setEditorContents",value:function(e,t){var a=this;this.value=t;var r=this.getEditorSelection();"string"===typeof t?e.setContents(e.clipboard.convert(t)):e.setContents(t),Je((function(){return a.setEditorSelection(e,r)}))}},{key:"setEditorSelection",value:function(e,t){if(this.selection=t,t){var a=e.getLength();t.index=Math.max(0,Math.min(t.index,a-1)),t.length=Math.max(0,Math.min(t.length,a-1-t.index)),e.setSelection(t)}}},{key:"setEditorTabIndex",value:function(e,t){var a;(null===e||void 0===e||null===(a=e.scroll)||void 0===a?void 0:a.domNode)&&(e.scroll.domNode.tabIndex=t)}},{key:"setEditorReadOnly",value:function(e,t){t?e.disable():e.enable()}},{key:"makeUnprivilegedEditor",value:function(e){var t=e;return{getHTML:function(){return t.root.innerHTML},getLength:t.getLength.bind(t),getText:t.getText.bind(t),getContents:t.getContents.bind(t),getSelection:t.getSelection.bind(t),getBounds:t.getBounds.bind(t),setSelection:t.setSelection.bind(t)}}},{key:"getEditingArea",value:function(){if(!this.editingArea)throw new Error("Instantiating on missing editing area");var e=s.a.findDOMNode(this.editingArea);if(!e)throw new Error("Cannot find element for editing area");if(3===e.nodeType)throw new Error("Editing area cannot be a text node");return e}},{key:"renderEditingArea",value:function(){var e=this,t=this.props,a=t.children,r=t.preserveWhitespace,i={key:this.state.generation,ref:function(t){e.editingArea=t}};return n.a.Children.count(a)?n.a.cloneElement(n.a.Children.only(a),i):r?n.a.createElement("pre",i):n.a.createElement("div",i)}},{key:"render",value:function(){var e,t=this;return n.a.createElement("div",{ref:this.refInput,id:this.props.id,style:this.props.style,key:this.state.generation,className:"quill ".concat(null!==(e=this.props.className)&&void 0!==e?e:""),onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp,onBlur:function(e){void 0!==t.props.onBlur2&&t.props.onBlur2()}},this.renderEditingArea())}},{key:"onEditorChangeText",value:function(e,t,a,r){if(this.editor){var n=this.isDelta(this.value)?r.getContents():r.getHTML();n!==this.getEditorContents()&&(this.lastDeltaChangeSet=t,this.value=n,this.props.onChange(e,t,a,r))}}},{key:"onEditorChangeSelection",value:function(e,t,a){if(this.editor){var r=this.getEditorSelection(),n=!r&&e,i=r&&!e;Re()(e,r)||(this.selection=e,void 0!==this.props.onChangeSelection&&this.props.onChangeSelection(e,t,a),n?void 0!==this.props.onFocus&&this.props.onFocus(e,t,a):i&&void 0!==this.props.onBlur&&this.props.onBlur(r,t,a))}}},{key:"focus",value:function(){this.editor&&this.editor.focus()}},{key:"blur",value:function(){this.editor&&(this.selection=null,this.editor.blur())}}]),a}(n.a.Component);function Je(e){Promise.resolve().then(e)}ze.displayName="React Quill",ze.Quill=He.a,ze.defaultProps={theme:"snow",modules:{},readOnly:!1};var Ge=ze,Ye={toolbar:[[],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image"],["clean"]]},qe=["header","bold","italic","underline","strike","blockquote","list","bullet","indent","link","image"],Ke=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleKeyDown=function(e){var t=n.state,a=t.helperVisible,r=t.options,i=t.selection,s=n.props.onKeyDown;if(a)switch(e.keyCode){case 27:e.preventDefault(),n.resetHelper();break;case 38:e.preventDefault(),n.setState({selection:(r.length+i-1)%r.length});break;case 40:e.preventDefault(),n.setState({selection:(i+1)%r.length});break;case 14:case 13:case 9:e.preventDefault(),n.handleSelection(i);break;default:s(e)}else s(e)},n.setValue=function(e){n.setState({value:e},(function(t){n.handleChange(e)}))},n.sanitizeConf={allowedTags:["b","i","em","strong","a","p","h1"],allowedAttributes:{a:["href"]}},n.sanitize=function(e){n.setState({html:Be()(n.state.html,n.sanitizeConf)},e)},n.state={helperVisible:!1,left:0,matchLength:0,matchStart:0,options:[],selection:0,top:0,value:e.value},n.recentValue=e.defaultValue,n.refInput=Object(r.createRef)(),n}return Object(l.a)(a,[{key:"componentDidUpdate",value:function(e){var t=this.props.options,a=this.state.caret;t.length!==e.options.length&&this.updateHelper(this.recentValue,a,t)}},{key:"getMatch",value:function(e,t,a){for(var r=this.props,n=r.trigger,i=r.matchAny,s=r.regex,o=new RegExp(s),l=n.length,c=n.match(o),u=e[t-1];">"===u;){for(;"<"!==u;)t--,u=e[t-1];t--,u=e[t-1]}"\t"===u&&(t--,u=e[t-1]);for(var p=t-1;p>=0;--p){var d=e.substring(p,t).match(o),m=-1;if(l>0){var f=c?p:p-l+1;if(f<0)return null;if(this.isTrigger(e,f)&&(m=f+l),!d&&m<0)return null}else{if(d&&p>0)continue;if(t-(m=0===p&&d?0:p+1)===0)return null}if(m>=0){var h=function(){var r=e.substring(m,t),n=a.filter((function(e){var t=e.Display.toLowerCase().indexOf(r.toLowerCase());return-1!==t&&(i||0===t)})),s=r.length;return{v:{matchStart:m,matchLength:s,options:n}}}();if("object"===typeof h)return h.v}}return null}},{key:"isTrigger",value:function(e,t){var a=this.props.trigger;return!a||!a.length||e.substr(t,a.length)===a}},{key:"handleChange",value:function(e){var t=this.props,a=t.onChange,r=t.options,n=t.spaceRemovers,i=t.spacer,s=t.value,o=this.recentValue,l=void 0===e.target||void 0===e.target.value?this.state.value:e.target.value,c=-1;if(0===o.length)c=l.length-1;else if(0===l.length)c=0;else{var u=o.trim(),p=l.trim();if("&nbsp;"===u.substring(u.length-6)&&(u=u.substring(0,u.length-6)),"&nbsp;"===p.substring(p.length-6)&&(p=p.substring(0,p.length-6)),u!==p)for(var d=1;d<=Math.min(p.length,u.length);d++)if(p.length<d||u.length<d||p[p.length-d]!==u[u.length-d]){c=p.length-d;break}}var m=c+1;if(l.length||this.setState({helperVisible:!1}),this.recentValue=l,this.setState({caret:m,value:e}),!l.length||!m)return a(e);if(this.enableSpaceRemovers&&n.length&&l.length>2&&i.length){for(var f=0;f<Math.max(o.length,l.length);++f)if(o[f]!==l[f]){if(f>=2&&l[f-1]===i&&-1===n.indexOf(l[f-2])&&-1!==n.indexOf(l[f])&&this.getMatch(l.substring(0,f-2),m-3,r)){var h="".concat(l.slice(0,f-1)).concat(l.slice(f,f+1)).concat(l.slice(f-1,f)).concat(l.slice(f+1));return this.refInput.current.value=h,s||this.setState({value:h}),a(h)}break}this.enableSpaceRemovers=!1}return this.updateHelper(l,m,r),s||this.setState({value:e}),a(e)}},{key:"handleSelection",value:function(e){var t=this.state,a=t.matchStart,r=t.matchLength,n=t.options,i="<a href='/".concat(n[e].suggestionType,"/details/").concat(n[e]._id,'\' rel="noopener noreferrer" target="_blank">').concat(n[e].Display,"</a>"),s=this.recentValue,o=s.substring(0,a-1),l=s.substring(a+r);""===l&&(i+="&nbsp;"),this.setState({value:"".concat(o).concat(i).concat(l)});for(var c=0,u=0,p=o;u<o.length;){var d=p.indexOf("<");if(d>-1){d>0&&(c+=d),u+=d;var m=(p=p.substring(d)).indexOf(">");if(-1===m)throw Error("What the Pizza Sauce");u+=m+1,p=p.substring(m+1)}else p.length>0&&(u+=p.length,c+=p.length,p="");if(0===p.length&&u<o.length)throw Error("OMGOSH")}c+=n[e].Display.length,this.updateCaretPosition(c)}},{key:"updateCaretPosition",value:function(e){var t=this;setTimeout((function(){var a=t.refInput.current,r=a.getEditor(),n=a.makeUnprivilegedEditor(r),i=n.getLength(),s={index:Math.max(0,Math.min(e,i-1)),length:0};n.setSelection(s)}),500)}},{key:"updateHelper",value:function(e,t,a){var r=this.getMatch(e,t,a);if(r){var n=this.refInput.current.refInput.current.clientHeight,i=this.props,s=i.minChars,o=i.onRequestOptions,l=i.requestOnlyIfNoOptions;r.matchLength>=s&&(r.options.length>1||1===r.options.length&&r.options[0].Display.length!==r.matchLength)?this.setState(Object(z.a)({helperVisible:!0,top:n,left:0},r)):(l&&r.options.length||o(e.substr(r.matchStart,r.matchLength)),this.resetHelper())}else this.resetHelper()}},{key:"resetHelper",value:function(){this.setState({helperVisible:!1,selection:0})}},{key:"renderAutocompleteList",value:function(){var e=this,t=this.state,a=t.helperVisible,r=t.left,i=t.matchStart,s=t.matchLength,o=t.options,l=t.selection,c=t.top,u=t.value;if(!a)return null;var p=this.props,d=p.maxOptions,m=p.offsetX,f=p.offsetY;if(0===o.length)return null;if(l>=o.length)return this.setState({selection:0}),null;var h=0===d?o.length:d,g=o.slice(0,h).map((function(t,a){var r=t.Display.toLowerCase().indexOf(u.substr(i,s).toLowerCase());return n.a.createElement("li",{className:a===l?"active":null,key:t.Display,onClick:function(){e.handleSelection(a)},onMouseEnter:function(){e.setState({selection:a})}},t.Display.slice(0,r),n.a.createElement("strong",null,t.Display.substr(r,s)),t.Display.slice(r+s))}));return n.a.createElement("ul",{className:"react-autocomplete-input",style:{left:r+m,top:c+f}},g)}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{style:{position:"relative"}},n.a.createElement(Ge,{theme:"snow",modules:Ye,formats:qe,value:this.state.value,onChange:function(t){e.setValue(t)},onBlur:function(t){void 0!==e.props.onBlur&&e.props.onBlur(e.state.value.trim())},onBlur2:function(t){void 0!==e.props.onBlur&&e.props.onBlur(e.state.value.trim())},onKeyDown:this.handleKeyDown,ref:this.refInput}),this.renderAutocompleteList())}}]),a}(n.a.Component);Ke.defaultProps={Component:"textarea",defaultValue:"",disabled:!1,maxOptions:6,onBlur:function(){},onChange:function(){},onKeyDown:function(){},onRequestOptions:function(){},options:[],regex:"^[A-Za-z0-9\\-_]+$",matchAny:!1,minChars:0,requestOnlyIfNoOptions:!0,spaceRemovers:[",",".","!","?"],spacer:" ",trigger:"@",offsetX:0,offsetY:-10,value:null};var Qe=Ke;var Xe=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).getValue=function(){return r.state.value},r.state={value:e.Value},r}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=void 0===this.props.displayName?this.props.fieldName:this.props.displayName;return void 0!==this.props.options?n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(te.a,{htmlFor:"text_field_".concat(this.props.fieldName)},t)),n.a.createElement(U.a,{item:!0},n.a.createElement(Qe,{id:"text_field_".concat(this.props.fieldName),name:"text_field_".concat(this.props.fieldName),type:"text",autoComplete:"Off",error:this.props.message,value:this.state.value,onChange:function(t){e.setState({value:t}),void 0!==e.props.onChange&&e.props.onChange(t)},onKeyDown:function(t){void 0!==e.props.onKeyPress&&e.props.onKeyPress(t)},onBlur:function(t){console.log(t),void 0!==e.props.onBlur&&e.props.onBlur(e.state.value)},options:this.props.options}))):n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"text_field_".concat(this.props.fieldName)},t),void 0!==this.props.multiline&&this.props.multiline?n.a.createElement(ae.a,{id:"text_field_".concat(this.props.fieldName),name:"text_field_".concat(this.props.fieldName),type:"text",autoComplete:"Off",multiline:!0,error:void 0!==this.props.message&&""!==this.props.message,value:this.state.value,onChange:function(t){e.setState({value:t.target.value})},onBlur:function(t){e.props.onBlur(e.state.value.trim())},labelWidth:this.props.labelWidth,fullWidth:!0}):n.a.createElement(ae.a,{id:"text_field_".concat(this.props.fieldName),name:"text_field_".concat(this.props.fieldName),type:"text",autoComplete:"Off",error:void 0!==this.props.message&&""!==this.props.message,value:this.state.value,onChange:function(t){e.setState({value:t.target.value})},onBlur:function(t){e.props.onBlur(e.state.value.trim())},labelWidth:this.props.labelWidth,fullWidth:!0}),n.a.createElement(Pe.a,null,this.props.message))}}]),a}(r.Component),Ze=Object(d.b)((function(e){return{}}),(function(e){return{}}))(Xe),$e=Object(ge.a)({root:{}}),et=function(e,t,a){if(null!==a.user){a.changeWaiting(!0),void 0!==e.votes[a.user._id]&&e.votes[a.user._id]!==t?delete e.votes[a.user._id]:e.votes[a.user._id]=t;var r=Object(z.a)({},a.rootComment);delete r.user,r.replies=[],a.rootComment.replies.forEach((function(e){r.replies.push(tt(e))})),a.api.updateComment(r).then((function(e){void 0===e.error?a.api.getComments(a.world._id,a.objectType,a.object._id).then((function(e){e.comments.forEach((function(e){at(e,a)})),a.changeComments(e.comments),a.changeWaiting(!1)})):console.log(e.error),a.changeWaiting(!1)})).catch((function(e){return console.log(e)}))}},tt=function e(t){var a=Object(z.a)({},t);delete a.user,delete a.voteSum,a.replies=[];for(var r=0;r<t.replies.length;r++)a.replies.push(e(t.replies[r]));return a},at=function e(t,a){t.user=a.allUsers.filter((function(e){return e._id===t.userID}))[0],void 0!==t.user&&null!==t.user||(t.user={_id:t.userID,username:"Unknown"}),t.time=new Date(t.time),t.voteSum=Object.values(t.votes).reduce((function(e,t){return e+t}),0),t.replies.forEach((function(t){e(t,a)}))};function rt(e){var t=$e(),a=Object(r.useState)(""),i=Object(Oe.a)(a,2),s=i[0],o=i[1],l=Object(r.useState)(!1),c=Object(Oe.a)(l,2),u=c[0],p=c[1];return n.a.createElement(U.a,{container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(be.a,{className:t.root},n.a.createElement(ve.a,null,n.a.createElement(Te.a,{variant:"body2",color:"textSecondary"},e.comment.user.username,": ",e.comment.time.toLocaleDateString()," ",e.comment.time.toLocaleTimeString()),n.a.createElement(Te.a,{component:"p"},n.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.comment.text}}))),n.a.createElement(We.a,{disableSpacing:!0},null===e.user||1!==e.comment.votes[e.user._id]?n.a.createElement(h.a,{"aria-label":"upvote comment",onClick:function(t){null!==e.user&&(e.world.Owner===e.user._id||void 0!==e.world.Collaborators&&0===e.world.Collaborators.filter((function(t){return t.userID===e.user._id&&"collab"===t.type})).length)&&et(e.comment,1,e)}},n.a.createElement(Ce.a,null)):n.a.createElement(h.a,{"aria-label":"upvote comment",color:"primary",onClick:function(e){}},n.a.createElement(Ce.a,null)),n.a.createElement("span",{style:{fontWeight:"bold",color:null===e.user||void 0===e.comment.votes[e.user._id]?"black":1===e.comment.votes[e.user._id]?"blue":-1===e.comment.votes[e.user._id]?"red":"black"}},e.comment.voteSum),null===e.user||-1!==e.comment.votes[e.user._id]?n.a.createElement(h.a,{"aria-label":"downvote comment",onClick:function(t){null!==e.user&&(e.world.Owner===e.user._id||void 0!==e.world.Collaborators&&0===e.world.Collaborators.filter((function(t){return t.userID===e.user._id&&"collab"===t.type})).length)&&et(e.comment,-1,e)}},n.a.createElement(je.a,null)):n.a.createElement(h.a,{"aria-label":"downvote comment",color:"secondary",onClick:function(e){}},n.a.createElement(je.a,null)),n.a.createElement(h.a,{style:{marginLeft:"auto"},onClick:function(t){null!==e.user&&(e.world.Owner===e.user._id||void 0!==e.world.Collaborators&&0===e.world.Collaborators.filter((function(t){return t.userID===e.user._id&&"collab"===t.type})).length)&&p(!u)},"aria-label":"reply"},n.a.createElement(Ve.a,null))))),e.comment.replies.length>0&&n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:2},"\xa0"),n.a.createElement(U.a,{item:!0,xs:10,container:!0,spacing:0,direction:"column"},e.comment.replies.map((function(t,a){return n.a.createElement(U.a,{item:!0,key:a,style:{marginTop:"4px"}},n.a.createElement(rt,{comment:t,user:e.user,world:e.world,object:e.object,objectType:e.objectType,api:e.api,rootComment:e.rootComment,allUsers:e.allUsers,changeComments:function(t){e.changeComments(t)},changeWaiting:function(t){e.changeWaiting(t)},suggestions:e.suggestions}))})))),u&&n.a.createElement(U.a,{item:!0},n.a.createElement(Ze,{Value:s,fieldName:"New Reply",multiline:!0,onChange:function(e){o(e)},onKeyPress:function(t){"Enter"!==t.key||t.shiftKey||function(e,t,a,r){if(null!==t.user){t.changeWaiting(!0);var n,i=Object(z.a)({},t.rootComment);t.comment.replies.push({time:new Date,user:t.user,userID:t.user._id,text:(n=e,n.endsWith("<p><br></p>")&&(n=n.substring(0,n.length-11)),n),votes:{},voteSum:0,replies:[]}),r(""),a(!1),t.changeWaiting(!0);var s=Object(z.a)({},i);delete s.user,s.replies=[],i.replies.forEach((function(e){s.replies.push(tt(e))})),t.api.updateComment(s).then((function(e){void 0===e.error?t.api.getComments(t.world._id,t.objectType,t.object._id).then((function(e){e.comments.forEach((function(e){at(e,t)})),t.changeComments(e.comments),t.changeWaiting(!1)})):console.log(e.error),t.changeWaiting(!1)})).catch((function(e){return console.log(e)}))}}(s,e,p,o)},options:e.suggestions,labelWidth:110})))}function nt(e){var t=Object(r.useState)(""),a=Object(Oe.a)(t,2),i=a[0],s=a[1],o=Object(r.useState)(!1),l=Object(Oe.a)(o,2),c=l[0],u=l[1],p=Object(r.useState)([]),d=Object(Oe.a)(p,2),m=d[0],f=d[1],h=Object(r.useState)(!0),g=Object(Oe.a)(h,2),b=g[0],y=g[1];return b&&e.allUsers.length>0&&(y(!1),setTimeout((function(){e.api.getComments(e.world._id,e.objectType,e.object._id).then((function(t){t.comments.forEach((function(t){!function e(t,a){t.user=a.filter((function(e){return e._id===t.userID}))[0],void 0!==t.user&&null!==t.user||(t.user={_id:t.userID,username:"Unknown"}),t.time=new Date(t.time),t.voteSum=Object.values(t.votes).reduce((function(e,t){return e+t}),0),t.replies.forEach((function(t){e(t,a)}))}(t,e.allUsers)})),f(t.comments)}))}),500)),n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},"General"!==e.objectType&&n.a.createElement(U.a,{item:!0},n.a.createElement("b",null,"Comments:")),m.map((function(t,a){return n.a.createElement(U.a,{item:!0,key:a,container:!0,spacing:1,direction:"column"},n.a.createElement(rt,{comment:t,rootComment:t,user:e.user,world:e.world,object:e.object,objectType:e.objectType,allUsers:e.allUsers,api:e.api,changeComments:function(e){f(e)},changeWaiting:u,suggestions:e.suggestions}))})),"General"===e.objectType&&0===m.length?n.a.createElement(U.a,{item:!0},"No discussions yet"):0===m.length&&n.a.createElement(U.a,{item:!0},"No comments yet"),!c&&n.a.createElement(U.a,{item:!0},null!==e.user&&(e.world.Owner===e.user._id||void 0!==e.world.Collaborators&&0===e.world.Collaborators.filter((function(t){return t.userID===e.user._id&&"collab"===t.type})).length)?n.a.createElement(Ze,{Value:i,fieldName:"New Comment",multiline:!0,onChange:function(e){s(e)},onBlur:function(e){s(e)},options:e.suggestions,labelWidth:110}):null!==e.user&&"General"===e.objectType?n.a.createElement(Ze,{Value:i,fieldName:"New Discussion",multiline:!0,onBlur:function(e){s(e)},options:e.suggestions,labelWidth:110}):null===e.user&&"General"===e.objectType?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"fake_comments_label"},"You have to log in to start a discussion"),n.a.createElement(ae.a,{id:"fake_comments_label",name:"fake_comments_label",type:"text",autoComplete:"Off",disabled:!0,fullWidth:!0})):n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"fake_comments_label"},"You have to log in to leave comments"),n.a.createElement(ae.a,{id:"fake_comments_label",name:"fake_comments_label",type:"text",autoComplete:"Off",disabled:!0,fullWidth:!0}))),n.a.createElement(U.a,{item:!0},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:c||""===i,onClick:function(t){!function(e,t,a,r,n,i){a(!0);var s,o={_id:null,time:new Date,userID:t.user._id,worldID:t.world._id,objectType:t.objectType,objectID:t.object._id,text:(s=e,s.endsWith("<p><br></p>")&&(s=s.substring(0,s.length-11)),s),votes:{},replies:[]};t.api.addComment(o).then((function(e){if(void 0===e.error){o._id=e.commentID,o.user=t.user,o.voteSum=0;var s=Object($.a)(r);s.push(o),n(s),i("")}else console.log(e.error);a(!1)})).catch((function(e){return console.log(e)}))}(i,e,u,m,f,s)}},c?"Please Wait":"Submit")))}var it=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).state={},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return this.props.fromLogin&&this.props.notFromLogin(),n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement("h3",null,"General Discussion Board")),n.a.createElement(U.a,{item:!0},"This is a place where anyone can discuss anything related to writing in general, or to look for collaborators, or something to collaborate on."),n.a.createElement(U.a,{item:!0},"I plan to add filtering capabilities in the future."),n.a.createElement(U.a,{item:!0},n.a.createElement(nt,{user:this.props.user,allUsers:this.props.allUsers,object:{_id:"General"},objectType:"General",world:{_id:"General"},api:this.api,onChange:this.commentsChange})))}}]),a}(r.Component),st=Object(d.b)((function(e){return{publicWorlds:e.app.publicWorlds,user:e.app.user,fromLogin:e.app.fromLogin,templates:e.app.templates,allUsers:e.app.allUsers,userSuggestions:e.app.userSuggestions,worldSuggestions:e.app.worldSuggestions}}),(function(e){return{notFromLogin:function(){return e(M({}))},toggleLogin:function(){return e(B({}))}}}))(it),ot=[{path:"/",name:"Home",icon:de.a,component:Ne},{path:"/discussion",name:"Discussion",icon:fe.a,component:st}];var lt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).toggleFollow=function(e,t){var a=Object($.a)(r.props.followingWorlds);if(t)a.push(e);else{var n=a.indexOf(e);a.splice(n,1)}if(null!==r.props.user){var i=Object(z.a)({},r.props.user);i.followingWorlds=a,r.props.setFollowingWorlds(a),r.api.updateUser(i)}else r.props.setFollowingWorlds(a)},r.handleUserInput=function(e){var t=e.target.name,a="checkbox"===e.target.type?e.target.checked:e.target.value;r.setState(Object(Z.a)({},t,a))},r.state={browse:!1,Filter:""},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.api.getWorlds(!0).then((function(t){e.props.setPublicWorlds(t.publicWorlds.worlds),e.props.setTemplates(t.templates.templates),e.props.setAllUsers(t.allUsers),null!==e.props.user&&(void 0===t.userWorlds.worlds?e.props.logout():e.props.setWorlds(t.userWorlds.worlds))}))}},{key:"links",value:function(){var e=this;return n.a.createElement("div",null,ot.map((function(t,a){return n.a.createElement(g.a,{key:a,className:"curvedButton"},n.a.createElement(p.b,{to:t.path,onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width,"px")},className:"MyButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},"string"===typeof t.icon?n.a.createElement(y.a,{className:"marginLeft"},t.icon):n.a.createElement(t.icon,{className:"marginLeft"}),"\xa0",n.a.createElement(b.a,{primary:t.name,className:"marginLeft"}))))})))}},{key:"publicWorlds",value:function(){var e=this,t=[],a=[];return void 0!==this.props.publicWorlds&&null!==this.props.publicWorlds&&void 0===this.props.publicWorlds.error&&this.props.publicWorlds.forEach((function(r){e.state.browse?(""===e.state.Filter||r.Name.toLowerCase().includes(e.state.Filter.toLowerCase()))&&(e.props.followingWorlds.includes(r._id)?t.push(r):a.push(r)):e.props.followingWorlds.includes(r._id)&&t.push(r)})),this.state.browse?n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"filter"},"Filter"),n.a.createElement(ae.a,{id:"filter",name:"Filter",type:"text",autoComplete:"Off",value:this.state.Filter,onChange:this.handleUserInput,labelWidth:43,fullWidth:!0}))),n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,t.map((function(t,a){return n.a.createElement(g.a,{key:a,className:"curvedButton"},n.a.createElement(p.b,{to:"/project/details/".concat(t._id),onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width-80,"px")},className:"MySmallerButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(b.a,{primary:t.Name,className:"marginLeft"}))),n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(a){e.toggleFollow(t._id,!1)}},n.a.createElement(se.a,null)))})),a.map((function(t,a){return n.a.createElement(g.a,{key:a,className:"curvedButton"},n.a.createElement(p.b,{to:"/project/details/".concat(t._id),onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width-80,"px")},className:"MySmallerButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(b.a,{primary:t.Name,className:"marginLeft"}))),n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(a){e.toggleFollow(t._id,!0)}},n.a.createElement(ue.a,null)))}))))):t.map((function(t,a){return n.a.createElement(g.a,{key:a,className:"curvedButton"},n.a.createElement(p.b,{to:"/project/details/".concat(t._id),onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width,"px")},className:"MyButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(b.a,{primary:t.Name,className:"marginLeft"}))))}))}},{key:"myWorlds",value:function(){var e=this;return null===this.props.user||void 0===this.props.user||void 0===this.props.worlds?"":this.props.worlds.map((function(t,a){return n.a.createElement(g.a,{key:a,className:"curvedButton"},n.a.createElement(p.b,{to:"/project/details/".concat(t._id),onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(e.props.width,"px")},className:"MyButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(b.a,{primary:t.Name,className:"marginLeft"}))))}))}},{key:"render",value:function(){var e=this;return n.a.createElement(re.a,null,this.links(),n.a.createElement(g.a,null,n.a.createElement(b.a,{display:"none",primary:"Public Projects"}),n.a.createElement(ie.a,{title:"Browse Public Projects"},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({browse:!e.state.browse})}},n.a.createElement(oe.a,null)))),this.publicWorlds(),null!==this.props.user&&n.a.createElement(g.a,null,n.a.createElement(b.a,{primary:"My Projects"})),null!==this.props.user&&n.a.createElement(g.a,{className:"curvedButton"},n.a.createElement(p.b,{to:"/project/create",onClick:function(t){e.props.toggleMenu()},style:{width:"".concat(this.props.width,"px")},className:"MyButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(le.a,null),n.a.createElement(b.a,{primary:"Create New"})))),this.myWorlds())}}]),a}(r.Component),ct=Object(d.b)((function(e){return{selectedPage:e.app.selectedPage,worlds:e.app.worlds,publicWorlds:e.app.publicWorlds,user:e.app.user,followingWorlds:e.app.followingWorlds,width:e.app.width}}),(function(e){return{setWorlds:function(t){return e(D(t))},setPublicWorlds:function(t){return e(N(t))},setTemplates:function(t){return e(w(t))},setAllUsers:function(t){return e(I(t))},setFollowingWorlds:function(t){return e(R(t))},toggleMenu:function(){return e(F({}))},logout:function(){return e(E({}))}}}))(lt),ut=a(5),pt=a(201),dt=a(402),mt=Object(ut.a)({paper:{border:"1px solid #d3d4d5"}})((function(e){return n.a.createElement(pt.a,Object.assign({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},e))}));function ft(e){var t=n.a.useState(null),a=Object(Oe.a)(t,2),r=a[0],i=a[1];return n.a.createElement("span",{className:"float-right blue whiteFont"},n.a.createElement(g.a,{"aria-controls":"user-menu","aria-haspopup":"true",style:{cursor:"pointer"},onClick:function(e){i(e.currentTarget)},className:"curvedButton float-right"},n.a.createElement(y.a,null,"person"),n.a.createElement(b.a,{primary:" ".concat(e.username)})),n.a.createElement(mt,{id:"customized-menu",anchorEl:r,keepMounted:!0,open:Boolean(r),onClose:function(e){i(null)}},n.a.createElement(dt.a,{onClick:function(e){i(null)}},n.a.createElement(p.b,{to:"/User/Profile",style:{color:"black"}},n.a.createElement(b.a,{primary:"Profile"}))),n.a.createElement(dt.a,{style:{color:"black"},onClick:function(t){void 0!==e.onLogout&&e.onLogout(),i(null)}},n.a.createElement(b.a,{primary:"Logout"}))))}var ht=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).state={},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.props.loadFromStorage()}},{key:"render",value:function(){var e=this;return n.a.createElement(m.a,{position:"static"},n.a.createElement(f.a,null,n.a.createElement(U.a,{container:!0,spacing:0},n.a.createElement(U.a,{item:!0,xs:!0},n.a.createElement(h.a,{style:{color:"white"},"aria-label":"Menu",onClick:function(t){e.props.toggleMenu()}},n.a.createElement(T.a,null))),n.a.createElement(U.a,{item:!0,xs:!0},n.a.createElement(g.a,{className:"curvedButton"},n.a.createElement(b.a,{primary:null===this.props.selectedWorld?"Welcome!":this.props.selectedWorld.Name}))),n.a.createElement(U.a,{item:!0,xs:!0},null===this.props.user||void 0===this.props.user.username?n.a.createElement("span",{style:{cursor:"pointer"},onClick:function(t){e.props.toggleLogin()},className:"float-right blue whiteFont"},n.a.createElement(g.a,{className:"curvedButton float-right"},n.a.createElement(y.a,null,"person"),n.a.createElement(b.a,{primary:" Login/Register"}))):n.a.createElement(ft,{username:this.props.user.username,onLogout:function(t){e.api.logout().then((function(t){e.props.logout()}))}})))),this.props.mobileMenuOpen&&n.a.createElement(H.a,{display:{xs:"inline",sm:"none"}},n.a.createElement(ct,null)))}}]),a}(r.Component),gt=Object(d.b)((function(e){return{selectedPage:e.app.selectedPage,user:e.app.user,selectedWorld:e.app.selectedWorld,mobileMenuOpen:!e.app.menuOpen}}),(function(e){return{setWorlds:function(t){return e(D(t))},loadFromStorage:function(){return e({type:"LOAD_FROM_STORAGE",payload:{}})},toggleMenu:function(){return e(F({}))},toggleLogin:function(){return e(B({}))},logout:function(){return e(E({}))},redirectTo:function(t){return e({type:"REDIRECT_TO",payload:t})}}}))(ht),bt=a(196),yt=a.n(bt),vt=a(406);var Tt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).toggleFollow=function(e,t){var a=Object($.a)(r.props.followingWorlds);if(t)a.push(e);else{var n=a.indexOf(e);a.splice(n,1)}if(null!==r.props.user){var i=Object(z.a)({},r.props.user);i.followingWorlds=a,r.props.setFollowingWorlds(a),r.api.updateUser(i)}else r.props.setFollowingWorlds(a)},r.handleUserInput=function(e){var t=e.target.name,a="checkbox"===e.target.type?e.target.checked:e.target.value;r.setState(Object(Z.a)({},t,a))},r.state={browse:!1,Filter:""},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.api.getWorlds(!0).then((function(t){e.props.setPublicWorlds(t.publicWorlds.worlds),e.props.setTemplates(t.templates.templates),e.props.setAllUsers(t.allUsers),null!==e.props.user&&(void 0===t.userWorlds.worlds?e.props.logout():e.props.setWorlds(t.userWorlds.worlds))}))}},{key:"links",value:function(){return ot.map((function(e,t){return n.a.createElement(g.a,{key:t,className:"curvedButton"},n.a.createElement(p.b,{to:e.path,className:"MyButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},"string"===typeof e.icon?n.a.createElement(y.a,{className:"marginLeft"},e.icon):n.a.createElement(e.icon,{className:"marginLeft"}),"\xa0",n.a.createElement(b.a,{primary:e.name,className:"marginLeft"}))))}))}},{key:"brand",value:function(){return n.a.createElement(p.b,{to:"/",className:"BlackTextButton",activeClassName:"active"},n.a.createElement(g.a,null,n.a.createElement("img",{src:yt.a,alt:"logo",className:"App-logo"}),n.a.createElement(b.a,{primary:this.props.logoText})))}},{key:"publicWorlds",value:function(){var e=this,t=[],a=[];return void 0!==this.props.publicWorlds&&null!==this.props.publicWorlds&&void 0===this.props.publicWorlds.error&&this.props.publicWorlds.forEach((function(r){e.state.browse?(""===e.state.Filter||r.Name.toLowerCase().includes(e.state.Filter.toLowerCase()))&&(e.props.followingWorlds.includes(r._id)?t.push(r):a.push(r)):e.props.followingWorlds.includes(r._id)&&t.push(r)})),this.state.browse?n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"filter"},"Filter"),n.a.createElement(ae.a,{id:"filter",name:"Filter",type:"text",autoComplete:"Off",value:this.state.Filter,onChange:this.handleUserInput,labelWidth:43,fullWidth:!0}))),n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,t.map((function(t,a){return n.a.createElement(g.a,{key:a,className:"curvedButton"},n.a.createElement(p.b,{to:"/project/details/".concat(t._id),className:"MySmallerButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(b.a,{primary:t.Name,className:"marginLeft"}))),n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(a){e.toggleFollow(t._id,!1)}},n.a.createElement(se.a,null)))})),a.map((function(t,a){return n.a.createElement(g.a,{key:a,className:"curvedButton"},n.a.createElement(p.b,{to:"/project/details/".concat(t._id),className:"MySmallerButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(b.a,{primary:t.Name,className:"marginLeft"}))),n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(a){e.toggleFollow(t._id,!0)}},n.a.createElement(ue.a,null)))}))))):t.map((function(e,t){return n.a.createElement(g.a,{key:t,className:"curvedButton"},n.a.createElement(p.b,{to:"/project/details/".concat(e._id),className:"MyButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(b.a,{primary:e.Name,className:"marginLeft"}))))}))}},{key:"myWorlds",value:function(){return null===this.props.user||void 0===this.props.user||void 0===this.props.worlds?"":this.props.worlds.map((function(e,t){return n.a.createElement(g.a,{key:t,className:"curvedButton"},n.a.createElement(p.b,{to:"/project/details/".concat(e._id),className:"MyButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(b.a,{primary:e.Name,className:"marginLeft"}))))}))}},{key:"render",value:function(){var e=this;return n.a.createElement(re.a,null,this.brand(),n.a.createElement(vt.a,{light:!0}),this.links(),n.a.createElement(g.a,null,n.a.createElement(b.a,{display:"none",primary:"Public Projects"}),n.a.createElement(ie.a,{title:"Browse Public Projects"},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({browse:!e.state.browse})}},n.a.createElement(oe.a,null)))),this.publicWorlds(),null!==this.props.user&&n.a.createElement(g.a,null,n.a.createElement(b.a,{primary:"My Projects"})),null!==this.props.user&&n.a.createElement(g.a,{className:"curvedButton"},n.a.createElement(p.b,{to:"/project/create",className:"MyButton",activeClassName:"active"},n.a.createElement(g.a,{button:!0},n.a.createElement(le.a,null),n.a.createElement(b.a,{primary:"Create New"})))),this.myWorlds())}}]),a}(r.Component),Et=Object(d.b)((function(e){return{selectedPage:e.app.selectedPage,worlds:e.app.worlds,publicWorlds:e.app.publicWorlds,user:e.app.user,followingWorlds:e.app.followingWorlds}}),(function(e){return{setWorlds:function(t){return e(D(t))},setPublicWorlds:function(t){return e(N(t))},setFollowingWorlds:function(t){return e(R(t))},setTemplates:function(t){return e(w(t))},setAllUsers:function(t){return e(I(t))},logout:function(){return e(E({}))}}}))(Tt),Dt=a(32);var wt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).inputBlur=function(e){var t=e.target.name,a=r.validateField(t),n=r.state.fieldValidation;void 0!==n[t]&&n[t].valid!==a.valid&&(n[t].valid=a.valid,n[t].message=a.message,r.setState({fieldValidation:n}))},r.validateField=function(e){var t=null,a=!0,n="";switch(e){case"username":(t=r.state.username).length<2?(a=!1,n="Username is too short"):0!==r.props.allUsers.filter((function(e){return e.username===t&&e._id!==r.props.user._id})).length&&(a=!1,n="This Username is taken");break;case"email":n=(a=null!==(t=r.state.email).match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid",a&&t!==r.props.user.email&&(n="You will be sent a confirmation email at your new email upon submission.  Please use the link.")}return{valid:a,message:n}},r.validateForm=function(e){var t=r.validateField("username"),a=r.validateField("email"),n=t.valid&&a.valid,i=r.state.fieldValidation;i.Name=t,r.setState({formValid:n,fieldValidation:i},e)},r.onSubmit=function(){r.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},r.submitThroughAPI=function(){var e={_id:r.props.user._id,username:r.state.username.trim(),email:r.state.email.trim()};r.api.updateUser(e).then((function(e){if(null===e.user){var t=r.state.fieldValidation;t.loginError={message:e.error,valid:!1,show:!0},r.setState({fieldValidation:t,waiting:!1})}else r.props.userLogin(e.user),r.api.getWorldsForUser(e.user._id).then((function(e){r.props.setWorlds(e.worlds),r.props.onLogin(e.user)}))}))},r.load=function(){setTimeout((function(){r.setState({redirectTo:null,message:"Loading..."},r.finishLoading)}),500)},r.finishLoading=function(){r.props.fromLogin&&r.props.notFromLogin(),r.setState({username:r.props.user.username,email:r.props.user.email,loaded:!0,message:""})},r.state={username:"",email:"",fieldValidation:{username:{valid:!0,message:""},email:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,loaded:!1},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return this.state.loaded||this.load(),null!==this.state.redirectTo?n.a.createElement(he.a,{to:this.state.redirectTo}):null===this.props.user?n.a.createElement("span",null,"Please log in to be able to access your profile."):n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(Dt.Helmet,null,n.a.createElement("title",null,"Author's Notebook: User Profile")),n.a.createElement(U.a,{item:!0},n.a.createElement("h2",null,"User Profile")),n.a.createElement(U.a,{item:!0},"Username: ",this.props.user.username),n.a.createElement(U.a,{item:!0},"Email: ",this.props.user.email),n.a.createElement(U.a,{item:!0},"I'll add more profile elements here as the website grows"))}}]),a}(r.Component),It=Object(d.b)((function(e){return{types:e.app.types,user:e.app.user,fromLogin:e.app.fromLogin,allUsers:e.app.allUsers}}),(function(e){return{setAttributes:function(t){return e(x(t))},setTypes:function(t){return e(W(t))},setThings:function(t){return e(C(t))},notFromLogin:function(){return e(M({}))},setAllUsers:function(t){return e(I(t))}}}))(wt),At=a(407),St=a(72),Nt=a.n(St),Ot=a(73),xt=a.n(Ot);var Wt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).handleChange=function(e){r.props.updateIndexExpandedPanel(r.props.indexExpandedPanel!==e&&e)},r.state={redirectTo:null},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"renderListForType",value:function(e){var t=this,a=this.props.things.filter((function(t){return t.TypeIDs.includes(e._id)}));return n.a.createElement("div",{className:"Things"},n.a.createElement(re.a,{style:{width:"240px"}},n.a.createElement(g.a,null,n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){t.setState({redirectTo:"/thing/create/type_id_".concat(e._id)})}},n.a.createElement(le.a,null),"Create New ".concat(e.Name))),a.map((function(e,a){return n.a.createElement(g.a,{key:a},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){t.setState({redirectTo:"/thing/details/".concat(e._id)})}},e.Name))}))))}},{key:"render",value:function(){var e=this;if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});var t=this.props.things.filter((function(e){return 0===e.Types.filter((function(e){return e.Major})).length})),a=null!==this.props.selectedWorld&&null!==this.props.user&&(this.props.selectedWorld.Owner===this.props.user._id||this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length>0);return n.a.createElement("div",null,n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"TYPES"===this.props.indexExpandedPanel?n.a.createElement(ie.a,{title:"Collapse Types"},n.a.createElement(xe.a,{onClick:function(t){e.handleChange("TYPES")}},n.a.createElement(Nt.a,null))):n.a.createElement(ie.a,{title:"Expand Types"},n.a.createElement(xe.a,{onClick:function(t){e.handleChange("TYPES")}},n.a.createElement(xt.a,null))),n.a.createElement("span",{className:"MuiTypography-root MuiListItemText-primary MuiTypography-body1"},"Types (".concat(this.props.types.length,")")),a&&n.a.createElement(ie.a,{title:"Create New Type"},n.a.createElement(ne.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(t){e.setState({redirectTo:"/type/create"})}},n.a.createElement(le.a,null)))),"TYPES"===this.props.indexExpandedPanel&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,{style:{maxWidth:"380px"}},this.props.types.map((function(t,r){return n.a.createElement(g.a,{key:r},n.a.createElement(U.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:8},n.a.createElement(ie.a,{title:"Details for ".concat(t.Name)},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},t.Name))),a&&n.a.createElement(U.a,{item:!0,xs:2},n.a.createElement(ie.a,{title:"Create New ".concat(t.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/thing/create/type_id_".concat(t._id)})}},n.a.createElement(le.a,null)))),a&&n.a.createElement(U.a,{item:!0,xs:2},n.a.createElement(ie.a,{title:"Edit ".concat(t.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/type/edit/".concat(t._id)})}},n.a.createElement(At.a,null))))))})))),this.props.types.filter((function(e){return e.Major})).map((function(t,r){var i=e.props.things.filter((function(e){return e.TypeIDs.includes(t._id)}));return n.a.createElement(U.a,{key:r,item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},e.props.indexExpandedPanel===t._id?n.a.createElement(ie.a,{title:"Collapse ".concat(void 0===t.PluralName||""===t.PluralName?"".concat(t.Name,"s"):t.PluralName)},n.a.createElement(xe.a,{onClick:function(a){e.handleChange(t._id)}},n.a.createElement(Nt.a,null))):n.a.createElement(ie.a,{title:"Expand ".concat(void 0===t.PluralName||""===t.PluralName?"".concat(t.Name,"s"):t.PluralName)},n.a.createElement(xe.a,{onClick:function(a){e.handleChange(t._id)}},n.a.createElement(xt.a,null))),n.a.createElement(ie.a,{title:"Details for ".concat(t.Name)},n.a.createElement(xe.a,{variant:"contained",color:"primary",style:{width:"180px"},onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},void 0===t.PluralName||""===t.PluralName?"".concat(t.Name,"s"):t.PluralName," (",i.length,")")),a&&n.a.createElement("span",null,n.a.createElement(ie.a,{title:"Create New ".concat(t.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/thing/create/type_id_".concat(t._id)})}},n.a.createElement(le.a,null))),n.a.createElement(ie.a,{title:"Edit ".concat(t.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/type/edit/".concat(t._id)})}},n.a.createElement(At.a,null))))),e.props.indexExpandedPanel===t._id&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,{style:{maxWidth:"380px"}},i.map((function(t,r){return n.a.createElement(g.a,{key:r},n.a.createElement(U.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:10},n.a.createElement(ie.a,{title:"Details for ".concat(t.Name)},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t._id)})}},t.Name))),a&&n.a.createElement(U.a,{item:!0,xs:2},n.a.createElement(ie.a,{title:"Edit ".concat(t.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/thing/edit/".concat(t._id)})}},n.a.createElement(At.a,null))))))})))))})),n.a.createElement(U.a,{item:!0},"OTHER"===this.props.indexExpandedPanel?n.a.createElement(ie.a,{title:"Collapse Other Things"},n.a.createElement(xe.a,{onClick:function(t){e.handleChange("OTHER")}},n.a.createElement(Nt.a,null))):n.a.createElement(ie.a,{title:"Expand Other Things"},n.a.createElement(xe.a,{onClick:function(t){e.handleChange("OTHER")}},n.a.createElement(xt.a,null))),n.a.createElement("span",{className:"MuiTypography-root MuiListItemText-primary MuiTypography-body1"},"Other Things (".concat(t.length,")")),a&&n.a.createElement(ie.a,{title:"Create New Thing"},n.a.createElement(ne.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(t){e.setState({redirectTo:"/thing/create"})}},n.a.createElement(le.a,null)))),"OTHER"===this.props.indexExpandedPanel&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,{style:{maxWidth:"380px"}},t.map((function(t,r){return n.a.createElement(g.a,{key:r},n.a.createElement(U.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:10},n.a.createElement(ie.a,{title:"Details for ".concat(t.Name)},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t._id)})}},t.Name))),a&&n.a.createElement(U.a,{item:!0,xs:2},n.a.createElement(ie.a,{title:"Edit ".concat(t.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",style:{marginLeft:"8px"},onClick:function(a){e.setState({redirectTo:"/thing/edit/".concat(t._id)})}},n.a.createElement(At.a,null))))))}))))))}}]),a}(r.Component),kt=Object(d.b)((function(e){return{things:e.app.things,types:e.app.types,selectedWorld:e.app.selectedWorld,user:e.app.user,indexExpandedPanel:e.app.indexExpandedPanel}}),(function(e){return{updateIndexExpandedPanel:function(t){return e({type:"UPDATE_INDEX_EXPANDED_PANEL",payload:t})}}}))(Wt),Ct=a(408),_t=a(409),jt=a(427),Lt=a(425);function Vt(e){var t=e.type,a=e.types,r=e.things;void 0===t.typeID&&(t.typeID=t._id),a.forEach((function(e){void 0===e.typeID&&(e.typeID=e._id)})),r.forEach((function(e){void 0===e.thingID&&(e.thingID=e._id)})),console.log(t.Defaults);var i=t.Defaults.filter((function(e){return""!==e.DefaultValue||e.DefaultListValues.length>0})),s=a.filter((function(e){return t.SuperIDs.includes(e.typeID)}));return n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},t.Name),s.length>0&&n.a.createElement(U.a,{item:!0},n.a.createElement("div",{style:{marginLeft:"10px"}},"Super Types (",s.map((function(e,t){return n.a.createElement("span",{key:t},t>0&&n.a.createElement("span",null,",\xa0"),e.Name)})),")")),t.Attributes.length>0&&n.a.createElement(U.a,{item:!0},n.a.createElement("div",{style:{marginLeft:"10px"}},"Attributes (",t.Attributes.map((function(t,r){var i=e.attributesByID[t.attrID];if(void 0!==i){var s="";return s="Type"===i.AttributeType?"Type - ".concat(a.filter((function(e){return e.typeID===i.DefinedType}))[0].Name):"List"===i.AttributeType?"Type"===i.ListType?"List: Type - ".concat(a.filter((function(e){return e.typeID===i.DefinedType}))[0].Name):"List: ".concat(i.ListType):i.AttributeType,n.a.createElement("span",{key:r},r>0&&n.a.createElement("span",null,",\xa0"),i.Name,"\xa0(",s,")")}return n.a.createElement("span",{key:r})})),")")),void 0!==i&&i.length>0&&n.a.createElement(U.a,{item:!0},n.a.createElement("div",{style:{marginLeft:"10px"}},"Defaults (",i.map((function(t,a){var i=e.attributesByID[t.attrID];if(void 0!==i){var s="";if("Type"===i.AttributeType)s=e.thing.filter((function(e){return e.thingID===t.DefaultValue}))[0].Name;else if("List"===i.AttributeType)for(var o=function(e){if("Type"===i.ListType){var a=r.filter((function(a){return a.thingID===t.DefaultListValues[e]}))[0];void 0!==a&&(e>0&&(s+=", "),s+=a.Name)}else e>0&&(s+=", "),s+=t.DefaultListValues[e]},l=0;l<t.DefaultListValues.length;l++)o(l);else s=t.DefaultValue;return n.a.createElement("span",{key:a},a>0&&n.a.createElement("span",null,",\xa0"),i.Name,"\xa0(",s,")")}return n.a.createElement("span",{key:a})})),")")))}function Pt(e){var t=e.types.filter((function(t){return e.thing.TypeIDs.includes(t.typeID)})),a=e.thing,r=e.things;return void 0===a.typeID&&(a.thingID=a._id),t.forEach((function(e){void 0===e.typeID&&(e.typeID=e._id)})),r.forEach((function(e){void 0===e.thingID&&(e.thingID=e._id)})),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},a.Name),t.length>0&&n.a.createElement(U.a,{item:!0},"Types (",t.map((function(e,t){return n.a.createElement("span",{key:t},t>0&&n.a.createElement("span",null,",\xa0"),e.Name)})),")"),n.a.createElement(U.a,{item:!0},"Attributes (",a.Attributes.map((function(t,a){var i=e.attributesByID[t.attrID],s="";if("Type"===i.AttributeType)s=r.filter((function(e){return e.thingID===t.Value}))[0].Name;else if("List"===i.AttributeType)for(var o=function(e){e>0&&(s+=", "),"Type"===i.ListType?s+=r.filter((function(a){return a.thingID===t.ListValues[e]}))[0].Name:s+=t.ListValues[e]},l=0;l<t.ListValues.length;l++)o(l);else s=t.Value;return n.a.createElement("span",{key:a},a>0&&n.a.createElement("span",null,",\xa0"),i.Name,"\xa0(",s,")")})),")"))}var Ft=function e(t,a,r,n,i){var s=Object(z.a)({},i);if(!s.typeIDs.includes(t._id)){s.typeIDs.push(t._id);for(var o=function(i){if(!s.typeIDs.includes(t.SuperIDs[i])){var o=a.filter((function(e){return e._id===t.SuperIDs[i]}));o.length>0&&(o=o[0],s=e(o,a,r,n,s))}},l=0;l<t.SuperIDs.length;l++)o(l);for(var c=function(i){var o=n[t.Attributes[i].attrID];if(void 0!==o&&("Type"===o.AttributeType||"List"===o.AttributeType&&"Type"===o.ListType)&&!s.typeIDs.includes(o.DefinedType)){var l=a.filter((function(e){return e._id===o.DefinedType}));l.length>0&&(l=l[0],s=e(l,a,r,n,s))}},u=0;u<t.Attributes.length;u++)c(u);if(void 0!==t.Defaults&&null!==t.Default)for(var p=function(e){var i=n[t.Defaults[e].attrID];if("Type"===i.AttributeType){if(!s.thingIDs.includes(t.Defaults[e].DefaultValue)){var o=r.filter((function(a){return a._id===t.Defaults[e].DefaultValue}));o.length>0&&(o=o[0],s=Mt(o,a,r,n,s))}}else if("List"===i.AttributeType&&"Type"===i.ListType)for(var l=function(i){if(!s.thingIDs.includes(t.Defaults[e].DefaultListValues[i])){var o=r.filter((function(a){return a._id===t.Defaults[e].DefaultListValues[i]}));o.length>0&&(o=o[0],s=Mt(o,a,r,n,s))}},c=0;c<t.Defaults[e].DefaultListValues.length;c++)l(c)},d=0;d<t.Defaults.length;d++)p(d)}return s},Bt=function e(t,a,r,n,i){var s=Object(z.a)({},i),o=s.typeIDs.indexOf(t._id);if(o>-1){s.typeIDs.splice(o,1);for(var l=a.filter((function(e){return e.SuperIDs.includes(t._id)})),c=0;c<l.length;c++){var u=l[c];u.length>0&&(s=e(u=u[0],a,r,n,s))}for(var p=a.filter((function(e){return void 0!==e.ReferenceIDs&&e.ReferenceIDs.includes(t._id)})),d=0;d<p.length;d++){s=e(p[d],a,r,n,s)}for(var m=r.filter((function(e){return e.TypeIDs.includes(t._id)})),f=0;f<m.length;f++){var h=m[f];s=Rt(h,a,r,n,s)}}return s},Mt=function e(t,a,r,n,i){var s=Object(z.a)({},i);if(!s.thingIDs.includes(t._id)){s.thingIDs.push(t._id);for(var o=function(e){var i=t.TypeIDs[e];if(!s.typeIDs.includes(i)){var o=a.filter((function(e){return e._id===i}));o.length>0&&(o=o[0],s=Ft(o,a,r,n,s))}},l=0;l<t.TypeIDs.length;l++)o(l);for(var c=function(i){var o=n[t.Attributes[i].attrID];if(("Type"===o.AttributeType||"List"===o.AttributeType&&"Type"===o.ListType)&&!s.typeIDs.includes(o.DefinedType)){var l=a.filter((function(e){return e._id===o.DefinedType}));l.length>0&&(l=l[0],s=Ft(l,a,r,n,s))}if("Type"===o.AttributeType){var c=t.Attributes[i];if(!s.thingIDs.includes(c.Value)){var u=r.filter((function(e){return e._id===c.Value}));u.length>0&&(u=u[0],s=e(u,a,r,n,s))}}else"List"===o.AttributeType&&"Type"===o.ListType&&function(){for(var o=t.Attributes[i],l=function(t){if(!s.thingIDs.includes(o.ListValues[t])){var i=r.filter((function(e){return e._id===o.ListValues[t]}));i.length>0&&(i=i[0],s=e(i,a,r,n,s))}},c=0;c<o.ListValues.length;c++)l(c)}()},u=0;u<t.Attributes.length;u++)c(u)}return s},Rt=function e(t,a,r,n,i){var s=Object(z.a)({},i),o=s.thingIDs.indexOf(t._id);if(o>-1){s.thingIDs.splice(o,1);for(var l=a.filter((function(e){return e.Defaults.filter((function(e){return e.DefaultValue===t._id||e.DefaultListValues.includes(t._id)})).length>0})),c=0;c<l.length;c++){var u=l[c];s=Bt(u,a,r,n,s)}for(var p=r.filter((function(e){return void 0!==e.ReferenceIDs&&e.ReferenceIDs.includes(t._id)})),d=0;d<p.length;d++){s=e(p[d],a,r,n,s)}}return s};function Ut(e){var t=0===e.templates.filter((function(t){return t.Name===e.world.Name})).length,a=Object(r.useState)(e.world.Name),i=Object(Oe.a)(a,2),s=i[0],o=i[1],l=Object(r.useState)(""),c=Object(Oe.a)(l,2),u=c[0],p=c[1],d=Object(r.useState)(t?"":"This Template Name is already in use"),m=Object(Oe.a)(d,2),f=m[0],h=m[1],b=Object(r.useState)(!1),y=Object(Oe.a)(b,2),v=y[0],T=y[1],E=Object(r.useState)({typeIDs:[],thingIDs:[]}),D=Object(Oe.a)(E,2),w=D[0],I=D[1],A=Object(r.useState)(t),S=Object(Oe.a)(A,2),N=S[0],O=S[1],x=Object(r.useState)(""),W=Object(Oe.a)(x,2),k=W[0],C=W[1],_=Object(r.useState)({}),j=Object(Oe.a)(_,2),L=j[0],V=j[1],P=Object(r.useState)({}),F=Object(Oe.a)(P,2),B=F[0],M=F[1],R=e.things.filter((function(e){return 0===e.Types.length})),J=R.filter((function(e){return w.thingIDs.includes(e._id)}));return n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Create a template for use in other projects based on this one. The template will be usable by any user."),n.a.createElement(U.a,{item:!0},n.a.createElement(Ze,{Value:s,fieldName:"Template Name",message:f,onBlur:function(t){o(t),O(function(e,t,a){var r=0===t.templates.filter((function(t){return t.Name===e})).length;return a(r?"":"This Template Name is already in use"),r}(t,e,h))},labelWidth:110})),n.a.createElement(U.a,{item:!0,style:{color:"red"}},u),n.a.createElement(U.a,{item:!0},"Choose which data you want to include in the template. Dependencies will automatically be checked/unchecked as appropriate."),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:4},n.a.createElement(xe.a,{variant:"contained",color:"primary",disabled:v,onClick:function(t){T(!0);for(var a=Object(z.a)({},w),r=0;r<e.types.length;r++)a=Ft(e.types[r],e.types,e.things,e.attributesByID,a);I(a),T(!1)}},v?n.a.createElement("span",null,"Please Wait"):n.a.createElement("span",null,n.a.createElement(Lt.a,{disabled:!0,checked:"checked",color:"default"})," All Types"))),n.a.createElement(U.a,{item:!0,xs:4},n.a.createElement(xe.a,{variant:"contained",color:"primary",disabled:v,onClick:function(t){T(!0);var a=[];e.types.forEach((function(e){a.push(e._id)}));var r=[];e.things.forEach((function(e){r.push(e._id)})),I({typeIDs:a,thingIDs:r}),T(!1)}},v?n.a.createElement("span",null,"Please Wait"):n.a.createElement("span",null,n.a.createElement(Lt.a,{disabled:!0,checked:"checked",color:"default"})," All"))),n.a.createElement(U.a,{item:!0,xs:4},n.a.createElement(xe.a,{style:{marginLeft:"4px"},variant:"contained",color:"primary",disabled:v,onClick:function(e){I({typeIDs:[],thingIDs:[]})}},v?n.a.createElement("span",null,"Please Wait"):n.a.createElement("span",null,n.a.createElement(Lt.a,{color:"default",disabled:!0})," All")))),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(H.a,{style:{height:"300px",overflowY:"scroll",overflowX:"hidden"}},n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},e.types.map((function(t,a){var r=e.things.filter((function(e){return e.TypeIDs.includes(t._id)})),i=r.filter((function(e){return w.thingIDs.includes(e._id)}));return n.a.createElement(U.a,{key:a,item:!0,container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0},k===t._id?n.a.createElement(xe.a,{onClick:function(e){C("")}},n.a.createElement(Nt.a,null)):n.a.createElement(xe.a,{onClick:function(e){C(t._id)}},n.a.createElement(xt.a,null)),n.a.createElement(Lt.a,{checked:w.typeIDs.includes(t._id),onChange:function(a){if(!v){T(!0);var r=Object(z.a)({},w);r=a.target.checked?Ft(t,e.types,e.things,e.attributesByID,r):Bt(t,e.types,e.things,e.attributesByID,r),I(r),T(!1)}},name:"include_type_".concat(t._id),color:"primary"}),n.a.createElement(xe.a,{style:{width:"200px"},variant:"contained",color:"primary",onClick:function(e){V(t),M({})}},"".concat(t.Name," (").concat(i.length,"/").concat(r.length,")")),n.a.createElement(xe.a,{variant:"contained",color:"primary",disabled:v,style:{marginLeft:"4px"},onClick:function(t){T(!0);var a=Object(z.a)({},w);r.forEach((function(t){a=Mt(t,e.types,e.things,e.attributesByID,a)})),I(a),T(!1)}},v?n.a.createElement("span",null,"Please Wait"):n.a.createElement("span",null,n.a.createElement(Lt.a,{disabled:!0,checked:"checked",color:"default"})," All"))),k===t._id&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,{style:{marginLeft:"50px",maxWidth:"380px"}},r.map((function(t,a){return n.a.createElement(g.a,{key:a},n.a.createElement(Lt.a,{checked:w.thingIDs.includes(t._id),onChange:function(a){if(!v){T(!0);var r=Object(z.a)({},w);r=a.target.checked?Mt(t,e.types,e.things,e.attributesByID,r):Rt(t,e.types,e.things,e.attributesByID,r),I(r),T(!1)}},name:"include_thing_".concat(t._id),color:"primary"}),n.a.createElement(xe.a,{style:{width:"200px"},variant:"contained",color:"primary",onClick:function(e){V({}),M(t)}},"".concat(t.Name)))})))))})),R.length>0&&n.a.createElement(U.a,{item:!0},"OTHER"===k?n.a.createElement(xe.a,{onClick:function(e){C("")}},n.a.createElement(Nt.a,null)):n.a.createElement(xe.a,{onClick:function(e){C("OTHER")}},n.a.createElement(xt.a,null)),n.a.createElement("span",{className:"MuiTypography-root MuiListItemText-primary MuiTypography-body1"},"Other Things (".concat(J.length,"/").concat(R.length,")"))),"OTHER"===k&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,{style:{maxWidth:"380px"}},R.map((function(e,t){return n.a.createElement(g.a,{key:t},n.a.createElement(U.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:10},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){V({}),M(e)}},e.Name))))}))))))),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(H.a,{style:{height:"300px",overflowY:"scroll",overflowX:"hidden"}},void 0!==L._id?n.a.createElement(Vt,{type:L,types:e.types,things:e.things,attributesByID:e.attributesByID}):void 0!==B._id&&n.a.createElement(Pt,{thing:B,types:e.types,things:e.things,attributesByID:e.attributesByID})))),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:v||!N||0===w.typeIDs.length,onClick:function(t){T(!0),function(e,t,a,r,n){n(!0);var i={_id:null,Name:e.trim(),typeIDs:t.typeIDs,thingIDs:t.thingIDs,worldID:a.world._id};a.api.createTemplate(i).then((function(e){void 0===e.error?(r("Success"),setTimeout((function(){n(!1),a.onSave()}),500)):(r(e.error),n(!1))})).catch((function(e){return console.log(e)}))}(s,w,e,p,T)}},v?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){void 0!==e.onCancel&&null!==e.onCancel&&e.onCancel()}},"Cancel"))))}function Ht(e){var t=Object(z.a)({},e.dingus),a={};return void 0!==e.Attributes&&(t.Attributes=Object($.a)(e.Attributes)),t.Attributes.forEach((function(e){void 0===e.attrID&&(e.attrID=e._id),a[e.attrID]=e})),console.log(e),console.log(a),void 0!==e.Types&&(t.Types=Object($.a)(e.Types),t.Types.forEach((function(e){void 0===e.typeID&&(e.typeID=e._id)}))),void 0===t.Types&&(t.Types=[]),void 0!==e.Things&&(t.Things=Object($.a)(e.Things),t.Things.forEach((function(e){void 0===e.thingID&&(e.thingID=e._id)}))),void 0===t.Things&&(t.Things=[]),n.a.createElement(U.a,{item:!0,xs:9,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},t.Name),n.a.createElement(U.a,{item:!0},"Types:"),t.Types.map((function(e,r){return n.a.createElement(Vt,{key:r,type:e,types:t.Types,things:t.Things,attributesByID:a})})),void 0!==t.Things&&t.Things.length>0&&n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0},"Things:"),t.Things.map((function(e,r){return n.a.createElement(Pt,{key:r,thing:e,types:t.Types,things:t.Things,attributesByID:a})}))))}function zt(e){var t=Object(r.useState)({}),a=Object(Oe.a)(t,2),i=a[0],s=a[1],o=Object(r.useState)(void 0===e.selectedTemplateIDs?[]:e.selectedTemplateIDs),l=Object(Oe.a)(o,2),c=l[0],u=l[1];return n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Click a template to view its contents. Select the templates you want to import into your project. Any which have types or attributes with the same names (either with each other or with what you already have in your project), we will try to merge them if possible. If it's not, then we will append the names of them with the names of the templates they came from, and you can resolve it yourself afterward."),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:3},"Templates:",n.a.createElement(re.a,null,e.templates.map((function(e,t){return n.a.createElement(g.a,{key:t},n.a.createElement(Lt.a,{checked:c.includes(e._id),onChange:function(t){var a=Object($.a)(c);a.push(e._id),u(a)},name:"include_template_".concat(e._id),color:"primary"}),n.a.createElement(ie.a,{title:"Details for ".concat(e.Name)},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){s(e)}},e.Name)))})))),void 0!==i._id&&n.a.createElement(Ht,{dingus:i})),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:0===c.length,onClick:function(t){e.onSubmit(c)}},"OK")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){void 0!==e.onCancel&&null!==e.onCancel&&e.onCancel()}},"Cancel"))))}var Jt=a(198),Gt=a.n(Jt),Yt=a(197),qt=a.n(Yt);var Kt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).takeNextStep=function(){r.state.play&&!r.state.stepInProgress&&r.setState({stepInProgress:!0},r.reallyTakeNextStep)},r.reallyTakeNextStep=function(){var e=r.state.importingTypes,t=e.filter((function(e){return"Pending"===e.status}));if(t.length>0)(t=t[0]).status="Importing",r.setState({importingTypes:e},r.dumbImportType);else if(r.state.importingAttributes.filter((function(e){return"Pending"===e.status})).length>0)r.setState({attributesStatus:"Importing"},r.upsertAttributes);else{var a=r.state.importingThings,n=a.filter((function(e){return"Pending"===e.status}));if(n.length>0){n=n[0];var i=r.props.things.filter((function(e){return e.Name.trim().toLowerCase()===n.Name.trim().toLowerCase()}));if(i.length>0){i=i[0],n.thing=i,n.status="More Pending";var s=r.state.thingMap;s[n.templateThing.thingID]=i,r.setState({importingThings:a,thingMap:s,stepInProgress:!1},r.takeNextStep)}else n.status="Importing",r.setState({importingThings:a},r.dumbImportThing)}else(t=e.filter((function(e){return"More Pending"===e.status}))).length>0?((t=t[0]).status="Importing",r.setState({importingTypes:e},r.importType)):(n=a.filter((function(e){return"More Pending"===e.status}))).length>0?((n=n[0]).status="Importing",r.setState({importingThings:a},r.importThing)):r.props.onComplete&&r.props.onComplete()}},r.upsertAttributes=function(){var e=r.state.importingAttributes.filter((function(e){return"Pending"===e.status})),t=r.state.typeMap,a=r.state.attributeMap,n=r.state.template.Name,i=[];e.forEach((function(e){var s=!1,o=Object(z.a)({},e.templateAttribute);o.worldID=r.props.selectedWorldID,delete o.attrID,("Type"===o.AttributeType||"List"===o.AttributeType&&"Type"===o.ListType)&&(o.DefinedType=t[o.DefinedType]._id);var l=r.props.attributesByName[o.Name];if(void 0!==l)if(o.AttributeType!==l.AttributeType||"List"===o.AttributeType&&o.ListType!==l.ListType)o.Name+=" From Template (".concat(n,")"),s=!0;else{if(o._id=l._id,"Options"===o.AttributeType||"List"===o.AttributeType&&"Options"===o.ListType){var c=o.Options;o.Options=l.Options,c.forEach((function(e){o.Options.includes(e)||(o.Options.push(e),s=!0)}))}s||(e.status="Imported"),e.attribute=o,a[e.templateAttribute.attrID]=o}else s=!0;s&&i.push(o)})),i.length>0?r.api.upsertAttributes(r.props.selectedWorldID,i).then((function(t){e.forEach((function(e){var r=t.attributes[e.templateAttribute.Name],s=i.filter((function(t){return t.Name===e.templateAttribute.Name}));void 0!==r&&null!==r||(r=t.attributes["".concat(e.templateAttribute.Name," From Template (").concat(n,")")],s=i.filter((function(t){return t.Name==="".concat(e.templateAttribute.Name," From Template (").concat(n,")")}))),(s=s[0])._id=r,e.status="Imported",e.attribute=s,a[e.templateAttribute.attrID]=s})),r.setState({importingAttributes:e,attributeMap:a,stepInProgress:!1,attributesStatus:"Imported"},r.takeNextStep)})):r.setState({importingAttributes:e,attributesStatus:"Imported",attributeMap:a,stepInProgress:!1},r.takeNextStep)},r.dumbImportType=function(){var e=r.state.importingTypes,t=e.filter((function(e){return"Importing"===e.status}))[0],a=r.props.types.filter((function(e){return e.Name.trim().toLowerCase()===t.templateType.Name.trim().toLowerCase()}));if(a.length>0)a=a[0],r.api.updateType(a).then((function(n){if(void 0===n.error){t.type=a,t.status="More Pending";var i=r.state.typeMap;i[t.templateType.typeID]=a,r.setState({importingTypes:e,typeMap:i,stepInProgress:!1},r.takeNextStep)}else console.log(n.error)}));else{var n={_id:null,Name:t.templateType.Name,Description:t.templateType.Description,SuperIDs:[],AttributesArr:[],Attributes:[],worldID:r.props.selectedWorldID,Major:t.templateType.Major};r.api.createType(n).then((function(a){if(void 0===a.error){n._id=a.typeID,t.type=n,t.status="More Pending";var i=r.state.typeMap;i[t.templateType.typeID]=n,r.setState({importingTypes:e,typeMap:i,stepInProgress:!1},r.takeNextStep)}else console.log(a.error)}))}},r.dumbImportThing=function(){var e=r.state.importingThings,t=e.filter((function(e){return"Importing"===e.status}))[0],a={_id:null,Name:t.templateThing.Name,Description:t.templateThing.Description,worldID:r.props.selectedWorldID,TypeIDs:[],Attributes:[],ReferenceIDs:[]};r.api.createThing(a).then((function(n){if(void 0===n.error){a._id=n.thingID,t.thing=a,t.status="More Pending";var i=r.state.thingMap;i[t.templateThing.thingID]=a,r.setState({importingThings:e,thingMap:i,stepInProgress:!1},r.takeNextStep)}else console.log(n.error)}))},r.importType=function(){var e=r.state.typeMap,t=r.state.attributeMap,a=r.state.thingMap,n=r.state.importingTypes,i=n.filter((function(e){return"Importing"===e.status}))[0],s=r.props.types.filter((function(e){return e.Name===i.templateType.Name}));s.length>0?(s=s[0],i.templateType.SuperIDs.forEach((function(t){var a=e[t]._id;s.SuperIDs.includes(a)||s.SuperIDs.push(a)})),i.templateType.Attributes.forEach((function(e){var a=t[e.attrID];0===s.Attributes.filter((function(e){return e.attrID===a._id})).length&&s.Attributes.push({attrID:a._id,index:s.Attributes.length})})),i.templateType.Defaults.forEach((function(e){var r=t[e.attrID],n=s.Defaults.filter((function(e){return e.attrID===r._id}));0===n.length?s.Defaults.push({attrID:r._id,DefaultValue:e.DefaultValue,DefaultListValues:e.DefaultListValues}):"List"===r.AttributeType&&(n=n[0],"Type"===r.ListType?e.DefaultListValues.forEach((function(e){var t=a[e]._id;n.DefaultListValues.includes(t)||n.DefaultListValues.push(t)})):e.DefaultListValues.forEach((function(e){n.DefaultListValues.includes(e)||n.DefaultListValues.push(e)})))})),r.api.updateType(s).then((function(e){void 0===e.error?(i.status="Imported",r.setState({importingTypes:n,stepInProgress:!1},r.takeNextStep)):console.log(e.error)}))):(s=i.type,i.templateType.SuperIDs.forEach((function(t){s.SuperIDs.push(e[t]._id)})),i.templateType.Attributes.forEach((function(e){s.Attributes.push({attrID:t[e.attrID]._id,index:s.Attributes.length})})),void 0!==s.Defaults&&null!==s.Defaults||(s.Defaults=[]),i.templateType.Defaults.forEach((function(e){var r=t[e.attrID],n=e.DefaultValue,i=e.DefaultListValues;"Type"===r.AttributeType?n=a[n]._id:"List"===r.AttributeType&&"Type"===r.ListType&&(i=[],e.DefaultListValues.forEach((function(e){i.push(a[e]._id)}))),s.Defaults.push({attrID:r._id,DefaultValue:n,DefaultListValues:i})})),r.api.updateType(s).then((function(e){void 0===e.error?(i.status="Imported",r.setState({importingTypes:n,stepInProgress:!1},r.takeNextStep)):console.log(e.error)})))},r.importThing=function(){var e=r.state.typeMap,t=r.state.attributeMap,a=r.state.thingMap,n=r.state.importingThings,i=n.filter((function(e){return"Importing"===e.status}))[0],s=r.props.things.filter((function(e){return e.Name===i.templateThing.Name}));s.length>0?(s=s[0],i.templateThing.TypeIDs.forEach((function(t){var a=e[t]._id;s.TypeIDS.includes(a)||s.TypeIDs.push(a)})),i.templateThing.Attributes.forEach((function(e){var r=t[e.attrID],n=e.Value,i=e.ListValues;if(s.Attributes.filter((function(e){return e.attrID===r._id})).length>0){if("List"===r.AttributeType){var o=s.Attributes.filter((function(e){return e.attrID===r._id}))[0];i=o.ListValues,e.ListValues.forEach((function(e){if("Type"===r.ListType){var t=a[e]._id;i.includes(t)||(i.push(t),s.ReferenceIDs.push(t))}else i.includes(e)||i.push(e)}))}}else"Type"===r.AttributeType?(n=a[e.Value]._id,s.ReferenceIDs.push(n)):"List"===r.AttributeType&&"Type"===r.ListType&&(i=[],e.ListValues.forEach((function(e){i.push(a[e]._id),s.ReferenceIDs.push(a[e]._id)}))),s.Attributes.push({attrID:r._id,index:s.Attributes.length,Value:n,ListValues:i})})),r.api.updateThing(s).then((function(e){void 0===e.error?(i.status="Imported",r.setState({importingThings:n,stepInProgress:!1},r.takeNextStep)):console.log(e.error)}))):(s=i.thing,i.templateThing.TypeIDs.forEach((function(t){s.TypeIDs.push(e[t]._id)})),i.templateThing.Attributes.forEach((function(e){var r=t[e.attrID],n=e.Value,i=e.ListValues;"Type"===r.AttributeType?(n=a[e.Value]._id,s.ReferenceIDs.push(n)):"List"===e.AttributeType&&"Type"===e.ListType&&(i=[],e.ListValues.forEach((function(e){i.push(a[e]._id),s.ReferenceIDs.push(a[e]._id)}))),s.Attributes.push({attrID:r.attrID,index:e.index,Value:n,ListValues:i})})),r.api.updateThing(s).then((function(e){void 0===e.error?(i.status="Imported",r.setState({importingThings:n,stepInProgress:!1},r.takeNextStep)):console.log(e.error)})))},r.state={templateID:null,template:null,importingTypes:[],importingAttributes:[],attributesStatus:"Pending",importingThings:[],play:!0,stepInProgress:!1},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;if(this.props.templateID!==this.state.templateID){var t=this.props.templates.filter((function(t){return t._id===e.props.templateID}));if(t.length>0){t=t[0];var a=[];t.Types.forEach((function(e){a.push({status:"Pending",templateType:e,type:null})}));var r=[];t.Attributes.forEach((function(e){r.push({status:"Pending",templateAttribute:e,attribute:null})}));var i=[];void 0!==t.Things&&null!==t.Things&&t.Things.forEach((function(e){i.push({status:"Pending",templateThing:e,thing:null})})),this.setState({templateID:this.props.templateID,template:t,importingTypes:a,importingAttributes:r,attributesStatus:"Pending",importingThings:i,play:!0,typeMap:{},attributeMap:{},thingMap:{},stepInProgress:!1},this.takeNextStep)}}return n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,null,this.state.play?n.a.createElement(h.a,{"aria-label":"Pause Import",onClick:function(t){e.setState({play:!1})}},n.a.createElement(qt.a,null)):n.a.createElement(h.a,{"aria-label":"Pause Import",onClick:function(t){e.setState({play:!0},e.takeNextStep)}},n.a.createElement(Gt.a,null))))),n.a.createElement(U.a,{item:!0},"Importing ",this.props.templates.filter((function(t){return t._id===e.props.templateID}))[0].Name,".  Please Wait."),n.a.createElement(U.a,{item:!0},"Types:"),this.state.importingTypes.map((function(e,t){return n.a.createElement(U.a,{item:!0,key:t,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},e.templateType.Name),n.a.createElement(U.a,{item:!0,xs:6,style:{color:"Importing"===e.status?"blue":"Imported"===e.status?"green":"grey"}},e.status))})),n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},"Attributes:"),n.a.createElement(U.a,{item:!0,xs:6,style:{color:"Importing"===this.state.attributesStatus?"blue":"Imported"===this.state.attributesStatus?"green":"grey"}},this.state.attributesStatus)),this.state.importingThings.length>0&&n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Things:"),this.state.importingThings.map((function(e,t){return n.a.createElement(U.a,{item:!0,key:t,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},e.templateThing.Name),n.a.createElement(U.a,{item:!0,xs:6,style:{color:"Importing"===e.status?"blue":"Imported"===e.status?"green":"grey"}},e.status))}))))}}]),a}(r.Component),Qt=Object(d.b)((function(e){return{selectedPage:e.app.selectedPage,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,worlds:e.app.worlds,user:e.app.user,fromLogin:e.app.fromLogin,templates:e.app.templates,types:e.app.types,things:e.app.things,attributesByName:e.app.attributesByName,typeSuggestions:e.app.typeSuggestions,thingSuggestions:e.app.thingSuggestions}}),(function(e){return{selectWorld:function(t){return e(O(t))},addAndSelectWorld:function(t){return e(A(t))},updateWorld:function(t){return e(S(t))},notFromLogin:function(){return e(M({}))},toggleLogin:function(){return e(B({}))},setAttributes:function(t){return e(x(t))},setTypes:function(t){return e(W(t))},setThings:function(t){return e(C(t))},logout:function(){return e(E({}))}}}))(Kt);var Xt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).delete=function(e){r.api.deleteWorld(r.props.selectedWorldID).then((function(e){void 0===e.error?r.api.getWorlds(!0).then((function(e){r.props.setPublicWorlds(e.publicWorlds.worlds),r.props.setWorlds(e.userWorlds.worlds),r.props.setTemplates(e.templates.templates),r.props.setAllUsers(e.allUsers),r.props.selectWorld(null),r.setState({modalOpen:!1,redirectTo:"/"})})):r.setState({waiting:!1,message:e.error})}))},r.getModalStyle=function(){var e=Math.round(window.innerHeight/2)-50,t=Math.round(window.innerWidth/2)-200;return{top:"".concat(e,"%"),left:"".concat(t,"%"),transform:"translate(".concat(t,"px, ").concat(e,"px)")}},r.load=function(e){r.props.fromLogin&&r.props.notFromLogin(),r.state.templateMode||r.state.importMode?r.setState({loading:!0,templateMode:!1,importMode:!1},(function(t){r.props.selectWorld(e),r.api.getWorld(e).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things),r.setState({loading:!1})}))})):r.setState({loading:!0},(function(t){r.props.selectWorld(e),r.api.getWorld(e).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things),r.setState({loading:!1})}))}))},r.requestToCollaborate=function(){r.api.requestToCollaborate(r.props.selectedWorldID).then((function(e){var t=r.props.selectedWorld;t.Collaborators.push(e),r.props.updatePublicWorldForCollab(t)}))},r.respondToInvite=function(){var e=r.props.selectedWorld.Collaborators.filter((function(e){return e.userID===r.props.user._id&&"invite"===e.type}))[0];r.setState({redirectTo:"/project/collaborate/".concat(r.props.selectedWorldID,"/").concat(e.collabID)})},r.updateTemplates=function(){r.api.getTemplates().then((function(e){r.props.setTemplates(e.templates),r.setState({templateMode:!1})}))},r.importSelectedTemplates=function(){var e=Object($.a)(r.state.selectedTemplateIDs);if(e.length>0){var t=Object(z.a)({},r.props.templates.filter((function(t){return t._id===e[0]}))[0]);r.importDumbTypesRecursive(0,t.Types,[],{},t.Attributes,t.Name)}},r.importDumbTypesRecursive=function(e,t,a,n,i,s){var o=Object(z.a)({},t[e]),l=o.typeID,c=r.props.types.filter((function(e){return e.Name.trim().toLowerCase()===o.Name.trim().toLowerCase()}));c.length>0?(c=c[0],n[l]=c._id,a.push(c),c.Description!==o.Description||!c.Major&&o.Major?(c.Description!==o.Description&&(c.Description+=" From Template (".concat(s,") ").concat(o.Description)),o.Major&&(c.Major=!0),void 0!==c.PluralName&&""!==c.PluralName||(c.PluralName=o.PluralName),r.api.updateType(c).then((function(o){e++,t.length===e?r.compareAndFixAttributes(t,a,n,i,s):r.importDumbTypesRecursive(e,t,a,n,i,s)}))):(e++,t.length===e?r.compareAndFixAttributes(t,a,n,i,s):r.importDumbTypesRecursive(e,t,a,n,i,s))):(delete o.typeID,o.Attributes=[],o.worldID=r.props.selectedWorldID,r.api.createType(o).then((function(c){void 0===c.error?(n[l]=c.typeID,o._id=c.typeID,a.push(o),e++,t.length===e?r.compareAndFixAttributes(t,a,n,i,s):r.importDumbTypesRecursive(e,t,a,n,i,s)):console.log(c.error)})))},r.compareAndFixAttributes=function(e,t,a,n,i){var s=[],o={};n.forEach((function(e){var t=Object(z.a)({},e);delete t.attrID,("Type"===t.AttributeType||"List"===t.AttributeType&&"Type"===t.ListType)&&(t.DefinedType=a[t.DefinedType]);var n=r.props.attributesByName[t.Name];if(void 0!==n)if(t.AttributeType!==n.AttributeType||"List"===t.AttributeType&&t.ListType!==n.ListType)t.Name+=" From Template (".concat(i,")"),o[n.Name]=t.Name;else if(t._id=n._id,"Options"===t.AttributeType||"List"===t.AttributeType&&"Options"===t.ListType){var l=t.Options;t.Options=n.Options,l.forEach((function(e){t.Options.includes(e)||t.Options.push(e)}))}t.worldID=r.props.selectedWorldID,s.push(t)})),r.api.upsertAttributes(r.props.selectedWorldID,s).then((function(s){var l={};n.forEach((function(e){void 0!==o[e.Name]?l[e.attrID]=s.attributes[o[e.Name]]:l[e.attrID]=s.attributes[e.Name]})),r.addAttributesToDumbTypesRecursive(0,e,t,a,n,l,i)}))},r.addAttributesToDumbTypesRecursive=function(e,t,a,n,i,s,o){var l=t[e],c=a[e];if(l.Name!==c.Name)console.log("Names don't match");else{var u=!1;if(0===c.Attributes.length){var p=0;l.Attributes.forEach((function(e){var t=s[e.attrID];c.Attributes.push({attrID:t,index:p}),p++,u=!0}))}else{var d=c.Attributes.length;l.Attributes.forEach((function(e){var t=s[e.attrID];0===c.Attributes.filter((function(e){return e.attrID===t})).length&&(c.Attributes.push({attrID:t,index:d}),d++,u=!0)}))}u?r.api.updateType(c).then((function(l){void 0===l.error?(e++,t.length===e?r.api.getWorld(r.props.selectedWorldID,!0).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things);var t=Object($.a)(r.state.selectedTemplateIDs);t.splice(0,1),r.setState({selectedTemplateIDs:t})})):r.addAttributesToDumbTypesRecursive(e,t,a,n,i,s,o)):console.log(l.error)})):(e++,t.length===e?r.api.getWorld(r.props.selectedWorldID,!0).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things);var t=Object($.a)(r.state.selectedTemplateIDs);t.splice(0,1),r.setState({selectedTemplateIDs:t})})):r.addAttributesToDumbTypesRecursive(e,t,a,n,i,s,o))}},r.state={world:null,modalOpen:!1,redirectTo:null,templateMode:!1,importMode:!1,selectedTemplateIDs:[]},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"getAttributes",value:function(){var e=this;this.api.getAttributesForWorld(this.props.selectedWorldID).then((function(t){void 0!==t&&void 0===t.error&&(e.props.setAttributes(t.attributes),e.getTypes())}))}},{key:"getTypes",value:function(){var e=this;this.api.getTypesForWorld(this.props.selectedWorldID).then((function(t){if(void 0!==t&&void 0===t.error){var a=t.types,r=[];a.forEach((function(t){t.Supers=[],t.SuperIDs.forEach((function(e){t.Supers=t.Supers.concat(a.filter((function(t){return t._id===e})))})),t.AttributesArr=[],t.Attributes.forEach((function(a){var n=e.props.attributesByID[a.attrID];n.TypeIDs.push(t._id),r.push(n),t.AttributesArr.push({index:t.AttributesArr.length,Name:n.Name,AttributeType:n.AttributeType,Options:n.Options,DefinedType:n.DefinedType,ListType:n.ListType,attrID:a.attrID,TypeIDs:a.TypeIDs})}));var n={};void 0!==t.Defaults&&t.Defaults.forEach((function(e){n[e.attrID]=e})),t.DefaultsHash=n})),e.props.updateAttributes(r),e.props.setTypes(a),e.getThings()}}))}},{key:"getThings",value:function(){var e=this;this.api.getThingsForWorld(this.props.selectedWorldID).then((function(t){if(void 0!==t&&void 0===t.error){var a=t.things;a.forEach((function(t){t.Types=[],t.TypeIDs.forEach((function(a){t.Types=t.Types.concat(e.props.types.filter((function(e){return e._id===a})))}))})),e.props.setThings(a)}}))}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;if(!(this.props.worlds.length>0||this.props.publicWorlds.length>0)||null!==this.props.selectedWorldID&&this.props.selectedWorldID===t){if(this.state.loading)return n.a.createElement("span",null,"Loading");if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user){if(null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type})).length){if(this.state.templateMode)return n.a.createElement(Ut,{world:this.props.selectedWorld,types:this.props.types,things:this.props.things,attributesByID:this.props.attributesByID,templates:this.props.templates,onSave:function(t){e.updateTemplates()},onCancel:function(t){e.setState({templateMode:!1})},api:this.api});if(this.state.importMode)return n.a.createElement(zt,{templates:this.props.templates,onSubmit:function(t){setTimeout((function(){e.setState({selectedTemplateIDs:t,importMode:!1})}),500)},onCancel:function(t){e.setState({importMode:!1})}});if(this.state.selectedTemplateIDs.length>0)return n.a.createElement(Qt,{templateID:this.state.selectedTemplateIDs[0],onComplete:function(a){e.api.getWorld(t,!0).then((function(t){e.props.setAttributes(t.attributes),e.props.setTypes(t.types),e.props.setThings(t.things),setTimeout((function(){var t=Object($.a)(e.state.selectedTemplateIDs);t.shift(),e.setState({selectedTemplateIDs:t})}),500)}))},onCancel:function(t){e.setState({selectedTemplateIDs:[]})}});var a=[].concat(Object($.a)(this.props.typeSuggestions),Object($.a)(this.props.thingSuggestions));return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},null!==this.props.selectedWorld&&n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(Dt.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(U.a,{item:!0,xs:12,sm:8,container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement("h2",null,this.props.selectedWorld.Name)),n.a.createElement(U.a,{item:!0},n.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.selectedWorld.Description}})),n.a.createElement(U.a,{item:!0},n.a.createElement(H.a,{display:{xs:"none",sm:"block"}},n.a.createElement(kt,null)))),null!==this.props.user&&n.a.createElement(U.a,{item:!0,xs:12,sm:4},this.props.selectedWorld.Owner===this.props.user._id?n.a.createElement(re.a,null,n.a.createElement(g.a,null,n.a.createElement(U.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:4,sm:12},n.a.createElement(ie.a,{title:"Edit ".concat(this.props.selectedWorld.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/project/edit/".concat(e.props.selectedWorldID)})}},n.a.createElement(At.a,null)))),n.a.createElement(U.a,{item:!0,xs:4,sm:12},n.a.createElement(ie.a,{title:"Edit Collaborators"},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/project/collaborators/".concat(e.props.selectedWorldID)})}},n.a.createElement(Ct.a,null)))),n.a.createElement(U.a,{item:!0,xs:4,sm:12},n.a.createElement(ie.a,{title:"Delete ".concat(this.props.selectedWorld.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({modalOpen:!0})}},n.a.createElement(_t.a,null)))))),n.a.createElement(g.a,null,n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.setState({templateMode:!0})}},"Create a Template")),n.a.createElement(g.a,null,n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.setState({importMode:!0})}},"Import Templates"))):n.a.createElement(re.a,null,void 0!==this.props.selectedWorld.Collaborators&&0===this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id})).length?n.a.createElement(g.a,null,this.props.selectedWorld.AcceptingCollaborators&&n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:this.requestToCollaborate,type:"button"},"Request to Collaborate")):this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"request"===t.type})).length>0?n.a.createElement(g.a,null,"Waiting on Collaboration Request"):this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"invite"===t.type})).length>0&&n.a.createElement(g.a,null,n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:this.respondToInvite,type:"button"},"You've been invited to Collaborate")))),n.a.createElement(U.a,{item:!0,xs:12},n.a.createElement(H.a,{display:{xs:"block",sm:"none"}},n.a.createElement(kt,null))),n.a.createElement(U.a,{item:!0,xs:12},n.a.createElement(nt,{user:this.props.user,allUsers:this.props.allUsers,object:this.props.selectedWorld,objectType:"World",world:this.props.selectedWorld,api:this.api,onChange:this.commentsChange,suggestions:a}))),n.a.createElement(jt.a,{"aria-labelledby":"delete-thing-modal","aria-describedby":"delete-thing-modal-description",open:this.state.modalOpen,onClose:function(t){e.setState({modalOpen:!1})}},n.a.createElement("div",{style:this.getModalStyle(),className:"paper"},n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Are you sure you want to delete ",null!==this.props.selectedWorld?this.props.selectedWorld.Name:"","?"),n.a.createElement(U.a,{item:!0},"(All external references to it will be left alone and may not work correctly)"),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:this.delete},"Yes")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({modalOpen:!1})}},"Cancel")))))))}return n.a.createElement(he.a,{to:"/"})}return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")}return this.load(t),n.a.createElement("span",null,"Loading")}}]),a}(r.Component),Zt=Object(d.b)((function(e){return{selectedPage:e.app.selectedPage,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,worlds:e.app.worlds,publicWorlds:e.app.publicWorlds,types:e.app.types,things:e.app.things,user:e.app.user,attributesByID:e.app.attributesByID,attributesByName:e.app.attributesByName,fromLogin:e.app.fromLogin,templates:e.app.templates,allUsers:e.app.allUsers,typeSuggestions:e.app.typeSuggestions,thingSuggestions:e.app.thingSuggestions}}),(function(e){return{selectWorld:function(t){return e(O(t))},setTypes:function(t){return e(W(t))},setThings:function(t){return e(C(t))},setWorlds:function(t){return e(D(t))},setTemplates:function(t){return e(w(t))},setAllUsers:function(t){return e(I(t))},setPublicWorlds:function(t){return e(N(t))},updatePublicWorldForCollab:function(t){return e({type:"UPDATE_PUBLIC_WORLD_COLLAB",payload:t})},setAttributes:function(t){return e(x(t))},updateAttributes:function(t){return e({type:"UPDATE_ATTRIBUTES",payload:t})},notFromLogin:function(){return e(M({}))},toggleLogin:function(){return e(B({}))}}}))(Xt),$t=a(411),ea=a(410);var ta=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).handleUserInput=function(e){var t=e.target.name,a="checkbox"===e.target.type?e.target.checked:e.target.value;r.setState(Object(Z.a)({},t,a))},r.inputBlur=function(e){var t=e.target.name,a=r.validateField(t),n=r.state.fieldValidation;void 0!==n[t]&&n[t].valid!==a.valid&&(n[t].valid=a.valid,n[t].message=a.message,r.setState({fieldValidation:n}))},r.a11yProps=function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}},r.validateField=function(e){var t=r.state[e],a=!0,n="";switch(e){case"Name":(a=null!==t.match(/^[a-zA-Z0-9 ]*$/i))?t.length<4?(a=!1,n="Project Name is too short"):(a=0===r.props.worlds.filter((function(e){return e.Name===t&&e._id!==r.state._id})).length)||(n="This Project Name is already in use"):n="Only Letters, Numbers, and Spaces allowed in Project Names";break;case"inviteEmail":n=(a=null!==t.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid"}return{valid:a,message:n}},r.validateForm=function(e){var t=r.validateField("Name"),a=t.valid,n=r.state.fieldValidation;n.Name=t,r.setState({formValid:a,fieldValidation:n},e)},r.onSubmit=function(){r.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},r.cleanWYSIWYG=function(e){return e.endsWith("<p><br></p>")&&(e=e.substring(0,e.length-11)),e},r.submitThroughAPI=function(){var e={_id:r.state._id,Name:r.state.Name.trim(),Description:r.cleanWYSIWYG(r.state.Description.trim()),Public:r.state.Public,AcceptingCollaborators:r.state.AcceptingCollaborators,Owner:r.props.user._id};null===e._id?r.api.createWorld(e).then((function(t){void 0!==t.error?r.setState({message:t.error},(function(){r.props.logout()})):(e._id=t.worldID,r.props.addAndSelectWorld(e),void 0===r.state.tempSelectedTemplateIDs||0===r.state.tempSelectedTemplateIDs.length?r.setState({waiting:!1,redirectTo:"/project/details/".concat(t.worldID)}):r.setState({selectedTemplateIDs:r.state.tempSelectedTemplateIDs,tempSelectedTemplateIDs:[]}))})).catch((function(e){return console.log(e)})):r.api.updateWorld(e).then((function(t){void 0!==t.error?r.setState({message:t.error},(function(){r.props.logout()})):(r.props.updateWorld(e),void 0===r.state.tempSelectedTemplateIDs||0===r.state.tempSelectedTemplateIDs.length?r.setState({waiting:!1,redirectTo:"/project/details/".concat(r.props.selectedWorldID)}):r.setState({selectedTemplateIDs:r.state.tempSelectedTemplateIDs,tempSelectedTemplateIDs:[]}))})).catch((function(e){return console.log(e)}))},r.load=function(e){setTimeout((function(){r.props.selectedWorldID!==e&&r.props.selectWorld(e),r.setState({_id:e,redirectTo:null,loaded:!1},r.finishLoading)}),500)},r.finishLoading=function(){null===r.state._id?r.setState({Name:"",Description:"",AcceptingCollaborators:!1,Public:!1,loaded:!0}):(r.props.selectWorld(r.state._id),r.api.selectWorld(r.state._id).then((function(e){r.api.getWorld(r.props.selectedWorldID).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things),r.setState({Name:r.props.selectedWorld.Name,Description:void 0===r.props.selectedWorld.Description?"":r.props.selectedWorld.Description,AcceptingCollaborators:void 0!==r.props.selectedWorld.AcceptingCollaborators&&r.props.selectedWorld.AcceptingCollaborators,Public:r.props.selectedWorld.Public,loaded:!0})}))})))},r.state={Name:"",Description:"",Public:!1,AcceptingCollaborators:!1,fieldValidation:{Name:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,loaded:!0,importMode:!1,selectedTemplateIDs:[],tempSelectedTemplateIDs:[]},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;this.props.fromLogin&&this.props.notFromLogin();var t=this.props.match.params.id;if(void 0===t&&(t=null),this.state._id!==t)return this.load(t),n.a.createElement("span",null,"Loading...");if(this.state.loaded){if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null!==this.props.selectedWorld&&null===this.props.user)return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login");if(null===this.state._id||null===this.props.selectedWorld||null!==this.props.user&&this.props.selectedWorld.Owner===this.props.user._id){if(this.state.importMode)return n.a.createElement(zt,{templates:this.props.templates,selectedTemplateIDs:this.state.tempSelectedTemplateIDs,onSubmit:function(t){e.setState({tempSelectedTemplateIDs:t,importMode:!1})},onCancel:function(t){e.setState({importMode:!1})}});if(this.state.selectedTemplateIDs.length>0)return n.a.createElement(Qt,{templateID:this.state.selectedTemplateIDs[0],onComplete:function(t){e.api.getWorld(e.props.selectedWorldID,!0).then((function(t){e.props.setAttributes(t.attributes),e.props.setTypes(t.types),e.props.setThings(t.things),setTimeout((function(){var t=Object($.a)(e.state.selectedTemplateIDs);t.shift(),t.length>0?e.setState({selectedTemplateIDs:t}):e.setState({waiting:!1,redirectTo:"/project/details/".concat(e.props.selectedWorldID)})}),500)}))},onCancel:function(t){e.setState({selectedTemplateIDs:[]})}});var a=[].concat(Object($.a)(this.props.typeSuggestions),Object($.a)(this.props.thingSuggestions));return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(Dt.Helmet,null,n.a.createElement("title",null,null===this.state._id?"Author's Notebook: Create New World":"Author's Notebook: Edit ".concat(this.props.selectedWorld.Name))),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:1},null!==this.props.selectedWorld&&n.a.createElement(ie.a,{title:"Back to ".concat(this.props.selectedWorld.Name," Details")},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(ea.a,null)))),n.a.createElement(U.a,{item:!0,xs:11},n.a.createElement("h2",null,null===this.state._id?"Create New Project":"Edit Project"))),n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"name"},"Name"),n.a.createElement(ae.a,{id:"name",name:"Name",type:"text",autoComplete:"Off",error:!this.state.fieldValidation.Name.valid,value:this.state.Name,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:43,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.Name.message))),n.a.createElement(U.a,{item:!0},n.a.createElement(Ze,{Value:this.state.Description,fieldName:"Description",multiline:!0,onBlur:function(t){e.setState({Description:t})},labelWidth:82,options:a})),n.a.createElement(U.a,{item:!0},n.a.createElement($t.a,{control:n.a.createElement(Lt.a,{checked:this.state.Public,onChange:this.handleUserInput,name:"Public",color:"primary"}),label:"Public"}),this.state.Public?n.a.createElement($t.a,{control:n.a.createElement(Lt.a,{checked:this.state.AcceptingCollaborators,onChange:this.handleUserInput,name:"AcceptingCollaborators",color:"primary"}),label:"Accepting Collaborator Requests"}):""),n.a.createElement(U.a,{item:!0},this.state.message),void 0!==this.state.tempSelectedTemplateIDs&&this.state.tempSelectedTemplateIDs.length>0&&n.a.createElement(U.a,{item:!0},"Templates will be imported on submit"),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(xe.a,{variant:"contained",fullWidth:!0,color:"primary",disabled:this.state.waiting,onClick:function(t){e.setState({importMode:!0})},type:"submit"},"Import Templates")),n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(xe.a,{variant:"contained",fullWidth:!0,color:"primary",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(xe.a,{variant:"contained",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.setState({redirectTo:null===e.state._id?"/":"/project/details/".concat(e.state._id)})},type:"button"},"Cancel"))),n.a.createElement(U.a,{item:!0},Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))))}return n.a.createElement(he.a,{to:"/"})}return n.a.createElement("span",null,"Loading...")}}]),a}(r.Component),aa=Object(d.b)((function(e){return{selectedPage:e.app.selectedPage,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,worlds:e.app.worlds,user:e.app.user,fromLogin:e.app.fromLogin,templates:e.app.templates,types:e.app.types,attributesByName:e.app.attributesByName,typeSuggestions:e.app.typeSuggestions,thingSuggestions:e.app.thingSuggestions}}),(function(e){return{selectWorld:function(t){return e(O(t))},addAndSelectWorld:function(t){return e(A(t))},updateWorld:function(t){return e(S(t))},notFromLogin:function(){return e(M({}))},toggleLogin:function(){return e(B({}))},setAttributes:function(t){return e(x(t))},setTypes:function(t){return e(W(t))},setThings:function(t){return e(C(t))},logout:function(){return e(E({}))}}}))(ta),ra=a(412),na=a(74),ia=a.n(na),sa=a(75),oa=a.n(sa),la=a(413),ca=a(200);var ua=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;Object(o.a)(this,a),(r=t.call(this,e)).componentDidMount=function(){r.state.email&&(r.validateField("email"),r.validateField("password"),r.setState({remember:!0}))},r.handleUserInput=function(e){var t=e.target.name,a="checkbox"===e.target.type?e.target.checked:e.target.value;r.setState(Object(Z.a)({},t,a))},r.inputBlur=function(e){var t=e.target.name,a=r.validateField(t),n=r.state.fieldValidation;n[t].valid!==a.valid&&(n[t].valid=a.valid,n[t].message=a.message,r.setState({fieldValidation:n}))},r.handleClickShowPassword=function(){r.setState({showPassword:!r.state.showPassword})},r.handleMouseDownPassword=function(e){e.preventDefault()},r.validateField=function(e){var t=!0,a="",n=r.state[e];switch(e){case"email":a=(t=null!==n.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid";break;case"password":a=(t=n.length>=6)?"":"Password is too short";break;case"confirmEmail":a=(t=n===r.state.email)?"":"Confirm Email doesn't match Email";break;case"confirmPassword":a=(t=n===r.state.password)?"":"Confirm Password doesn't match Password";break;case"username":a=(t=n.length>=2)?"":"Username is too short",t&&0!==r.props.allUsers.filter((function(e){return e.username===n})).length&&(t=!1,a="This Username is taken")}return{valid:t,message:a}},r.validateForm=function(e){var t=r.validateField("email"),a={valid:!0,message:""},n={valid:!0,message:""},i={valid:!0,message:""},s={valid:!0,message:""};switch(r.state.formMode){case"Login":n=r.validateField("password");break;case"Register":a=r.validateField("confirmEmail"),n=r.validateField("password"),i=r.validateField("confirmPassword"),s=r.validateField("username")}var o=t.valid&&n.valid&&a.valid&&i.valid&&s.valid,l=r.state.fieldValidation;l.email=t,l.password=n,l.confirmEmail=a,l.confirmPassword=i,l.username=s,r.setState({formValid:o,fieldValidation:l},e)},r.onSubmit=function(){r.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},r.submitThroughAPI=function(){var e={email:r.state.email.trim(),password:r.state.password,username:r.state.username.trim(),followingWorlds:r.props.followingWorlds};"login"===r.state.formMode?r.api.login(e,r.state.remember).then((function(e){if(null===e.user){var t=r.state.fieldValidation;t.loginError={message:e.error,valid:!1,show:!0},r.setState({fieldValidation:t,waiting:!1})}else r.props.userLogin(e.user),r.api.getWorldsForUser(e.user._id).then((function(e){r.props.setWorlds(e.worlds),r.props.onLogin(e.user)}))})).catch((function(e){return console.log(e)})):"register"===r.state.formMode?r.api.register(e).then((function(e){void 0===e.error?r.setState({message:e.message,formMode:"login",fieldValidation:{email:{valid:!0,message:""},password:{valid:!0,message:""},confirmEmail:{valid:!0,message:""},confirmPassword:{valid:!0,message:""},username:{valid:!0,message:""}},waiting:!1},(function(e){r.api.getAllUsers(!0).then((function(e){r.props.setAllUsers(e)}))})):r.setState({message:e.error,waiting:!1})})).catch((function(e){return console.log(e)})):"password"===r.state.formMode&&r.api.sendReset(e).then((function(e){r.setState({message:e.message,formMode:"login",fieldValidation:{email:{valid:!0,message:""},password:{valid:!0,message:""},confirmEmail:{valid:!0,message:""},confirmPassword:{valid:!0,message:""},username:{valid:!0,message:""}},waiting:!1})})).catch((function(e){return console.log(e)}))},r.loginClick=function(){r.setState({formMode:"login"})},r.registerClick=function(){r.setState({formMode:"register"})},r.passwordClick=function(){r.setState({formMode:"password"})};var n=new ca.a,i=n.get("email"),s=n.get("password");return r.state={formMode:"login",email:void 0===i?"":i,password:void 0===s?"":s,confirmEmail:"",confirmPassword:"",fieldValidation:{email:{valid:!0,message:""},password:{valid:!0,message:""},confirmEmail:{valid:!0,message:""},confirmPassword:{valid:!0,message:""},username:{valid:!0,message:""}},formValid:!1,remember:!1,message:"",username:""},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return null===this.props.allUsers?(this.api.getAllUsers(!0).then((function(t){e.props.setAllUsers(t)})),n.a.createElement("div",null)):"login"===this.state.formMode?n.a.createElement("div",null,n.a.createElement("h2",null,"Login"),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"email"},"Email"),n.a.createElement(ae.a,{id:"email",name:"email",type:"email",error:!this.state.fieldValidation.email.valid,value:this.state.email,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:40,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.email.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"outlined-adornment-password"},"Password"),n.a.createElement(ae.a,{id:"outlined-adornment-password",name:"password",type:this.state.showPassword?"text":"password",value:this.state.password,error:!this.state.fieldValidation.password.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(ra.a,{position:"end"},n.a.createElement(h.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ia.a,null):n.a.createElement(oa.a,null))),labelWidth:70,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.password.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement($t.a,{control:n.a.createElement(Lt.a,{checked:this.state.remember,onChange:this.handleUserInput,name:"remember",color:"primary"}),label:"Stay Signed In"}))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"float-left"},n.a.createElement(la.a,{onClick:this.registerClick},"Register")," ",n.a.createElement(la.a,{onClick:this.passwordClick},"Forgot Password")),n.a.createElement("div",{className:"float-right"},n.a.createElement(xe.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")))),this.state.message,Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))):"register"===this.state.formMode?n.a.createElement("div",null,n.a.createElement("h2",null,"Register"),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-6"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"username"},"Username"),n.a.createElement(ae.a,{id:"username",name:"username",type:"text",value:this.state.username,error:!this.state.fieldValidation.username.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:80,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.username.message))))),n.a.createElement("div",{className:"col-sm-6"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"email"},"Email"),n.a.createElement(ae.a,{id:"email",name:"email",type:"email",value:this.state.email,error:!this.state.fieldValidation.email.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:40,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.email.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"confirmEmail"},"Confirm Email"),n.a.createElement(ae.a,{id:"confirmEmail",name:"confirmEmail",type:"email",error:!this.state.fieldValidation.confirmEmail.valid,value:this.state.confirmEmail,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:100,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.confirmEmail.message)))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"outlined-adornment-password"},"Password"),n.a.createElement(ae.a,{id:"outlined-adornment-password",name:"password",type:this.state.showPassword?"text":"password",value:this.state.password,error:!this.state.fieldValidation.password.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(ra.a,{position:"end"},n.a.createElement(h.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ia.a,null):n.a.createElement(oa.a,null))),labelWidth:70,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.password.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"confirm-password"},"Confirm Password"),n.a.createElement(ae.a,{id:"confirm-password",name:"confirmPassword",type:this.state.showPassword?"text":"password",value:this.state.confirmPassword,error:!this.state.fieldValidation.confirmPassword.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(ra.a,{position:"end"},n.a.createElement(h.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ia.a,null):n.a.createElement(oa.a,null))),labelWidth:130,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.confirmPassword.message)))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"float-left"},n.a.createElement(la.a,{onClick:this.loginClick},"Login")," ",n.a.createElement(la.a,{onClick:this.passwordClick},"Forgot Password")," "),n.a.createElement("div",{className:"float-right"},n.a.createElement(xe.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")))),this.state.message,Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))):"password"===this.state.formMode?n.a.createElement("div",null,n.a.createElement("h2",null,"Forgot Password?"),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"email"},"Email"),n.a.createElement(ae.a,{id:"email",name:"email",type:"email",value:this.state.email,error:!this.state.fieldValidation.email.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:40,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.email.message)))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"float-left"},n.a.createElement(la.a,{onClick:this.registerClick},"Register")," ",n.a.createElement(la.a,{onClick:this.loginClick},"Login")),n.a.createElement("div",{className:"float-right"},n.a.createElement(xe.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")))),this.state.message,Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))):void 0}}]),a}(r.Component),pa=Object(d.b)((function(e){return{user:e.app.user,loginError:e.app.loginError,followingWorlds:e.app.followingWorlds,allUsers:e.app.allUsers}}),(function(e){return{userLogin:function(t){return e({type:"LOGIN",payload:t})},setWorlds:function(t){return e(D(t))},setFollowingWorlds:function(t){return e(R(t))},setAllUsers:function(t){return e(I(t))}}}))(ua);var da=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).componentDidMount=function(){},r.accept=function(){null===r.props.user?r.setState({waiting:!1,accepted:!0}):r.setState({waiting:!0},r.submitAccept)},r.submitAccept=function(){r.api.acceptCollabInvite(r.state.worldID,r.state.collabID).then((function(e){r.setState({waiting:!1,accepted:!0},r.getWorlds)}))},r.getWorlds=function(){r.api.getWorldsForUser().then((function(e){void 0!==e.worlds&&r.props.setWorlds(e.worlds),r.refreshWorld()}))},r.refreshWorld=function(){r.api.getWorld(r.state.worldID,!0).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things)}))},r.onLoginAccept=function(e){r.setState({waiting:!0},r.submitAccept)},r.decline=function(){r.setState({waiting:!0},r.submitDecline)},r.submitDecline=function(){r.api.declineCollabInvite(r.state.worldID,r.state.collabID).then((function(e){r.setState({waiting:!1,accepted:!1},r.refreshWorld)}))},r.state={worldID:null,collabID:null,codeValid:!1,accepted:null,message:"Please wait.  Validating code.",world:null},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"render",value:function(){var e=this;if(null===this.state.collabID){var t=this.props.match.params,a=t.worldID,r=t.collabID;return setTimeout((function(){e.api.checkCollabID(a,r).then((function(t){void 0!==t.error?e.setState({collabID:r,worldID:a,codeValid:!1,message:t.error}):e.setState({collabID:r,worldID:a,world:t.world,codeValid:!0,message:""})}))}),500),n.a.createElement("div",null,n.a.createElement("h2",null,this.state.message))}return this.state.codeValid?null===this.state.accepted?n.a.createElement(U.a,{container:!0,spacing:1},n.a.createElement(U.a,{item:!0,xs:12},n.a.createElement("h2",null,"You've been invited to collaborate on ",this.state.world.Name)),n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.accept,type:"button"},"Accept")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{className:"w-200",variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.decline,type:"button"},"Decline")))):this.state.accepted?null===this.props.user?n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement("h2",null,"Please log in (or register and then log in if you're new) so we can add you as a collaborator on ",this.state.world.Name,".")),n.a.createElement(U.a,{item:!0},n.a.createElement(pa,{onLogin:this.onLoginAccept}))):n.a.createElement(U.a,{container:!0,spacing:1},n.a.createElement(U.a,{item:!0,xs:12},n.a.createElement("h2",null,"Congratulations! You can now collaborate on ",this.state.world.Name))):n.a.createElement(U.a,{container:!0,spacing:1},n.a.createElement(U.a,{item:!0,xs:12},"Okay.  Well, we hope you enjoy working on other projects.")):n.a.createElement("div",null,n.a.createElement("h2",null,this.state.message))}}]),a}(r.Component),ma=Object(d.b)((function(e){return{user:e.app.user}}),(function(e){return{setWorlds:function(t){return e(D(t))},setAttributes:function(t){return e(x(t))},setTypes:function(t){return e(W(t))},setThings:function(t){return e(C(t))}}}))(da),fa=a(423),ha=a(414),ga=a(424),ba=a(415),ya=a(416);function va(e){var t=e.children,a=e.value,r=e.index;return n.a.createElement("div",null,a===r&&n.a.createElement(H.a,{p:3},t))}var Ta=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).handleUserInput=function(e){var t=e.target.name,a="checkbox"===e.target.type?e.target.checked:e.target.value;r.setState(Object(Z.a)({},t,a))},r.inputBlur=function(e){var t=e.target.name,a=r.validateField(t),n=r.state.fieldValidation;void 0!==n[t]&&n[t].valid!==a.valid&&(n[t].valid=a.valid,n[t].message=a.message,r.setState({fieldValidation:n}))},r.a11yProps=function(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}},r.validateField=function(e){var t=r.state[e],a=!0,n="";switch(e){case"inviteEmail":n=(a=null!==t.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid"}return{valid:a,message:n}},r.addNewCollaborator=function(){r.setState({waiting:!0},(function(){var e=this;this.api.addNewCollaborator(this.props.selectedWorldID,this.state.selectedUser._id,this.state.selectedUser.email).then((function(t){if(void 0===t.error){var a=Object($.a)(e.state.Collaborators);a.push(t);var r=e.props.selectedWorld;r.Collaborators=a,e.props.updateWorld(r),e.setState({Collaborators:a,inviteMessage:"Invite Sent",selectedUser:"",waiting:!1})}else e.setState({message:t.error,waiting:!1},(function(){e.props.logout()}))}))}))},r.emailCollaborator=function(){if(r.validateField("inviteEmail")){r.setState({waiting:!0},(function(){var e=this;this.api.emailCollaborator(this.props.selectedWorldID,this.state.inviteEmail).then((function(t){if(void 0===t.error){var a=Object($.a)(e.state.Collaborators);a.push(t);var r=e.props.selectedWorld;r.Collaborators=a,e.props.updateWorld(r),e.setState({Collaborators:a,inviteMessage:"Email Sent",inviteEmail:"",waiting:!1})}else e.setState({message:t.error,waiting:!1},(function(){e.props.logout()}))}))}))}},r.updateCollaboratorPermission=function(e,t){e.editPermission=t,r.setState({waiting:!0},(function(){var a=this;this.api.updateCollaboratorPermission(this.props.selectedWorldID,e.collabID,t).then((function(r){if(void 0===r.error){var n=Object($.a)(a.state.Collaborators);n.filter((function(t){return t.collabID===e.collabID}))[0].editPermission=t;var i=a.props.selectedWorld;i.Collaborators=n,a.props.updateWorld(i),a.setState({Collaborators:n,waiting:!1})}else a.setState({message:r.error,waiting:!1},(function(){a.props.logout()}))}))}))},r.generateCollabLink=function(){r.setState({waiting:!0},(function(){var e=this;this.api.generateCollabLink(this.props.selectedWorldID).then((function(t){if(void 0===t.error){var a=Object($.a)(e.state.Collaborators);a.push(t);var r=e.props.selectedWorld;r.Collaborators=a,e.props.updateWorld(r),e.setState({collabLink:t.collabLink,collabLinkCopied:!1,Collaborators:a,waiting:!1})}else e.setState({message:t.error,waiting:!1},(function(){e.props.logout()}))}))}))},r.deleteCollab=function(e){r.setState({waiting:!0},(function(){var t=this;this.api.deleteCollab(this.props.selectedWorldID,e.collabID).then((function(a){if(void 0===a.error){var r=t.state.Collaborators.filter((function(t){return t.collabID!==e.collabID})),n=t.props.selectedWorld;n.Collaborators=r,t.props.updateWorld(n),t.setState({collabLink:a.collabLink,collabLinkCopied:!1,Collaborators:r,waiting:!1})}else t.setState({message:a.error,waiting:!1},(function(){t.props.logout()}))}))}))},r.acceptCollab=function(e){r.setState({waiting:!0},(function(){var t=this;this.api.acceptCollabRequest(this.props.selectedWorldID,e.collabID).then((function(a){if(void 0===a.error){var r=Object($.a)(t.state.Collaborators);r.filter((function(t){return t.collabID===e.collabID}))[0].type="collab";var n=t.props.selectedWorld;n.Collaborators=r,t.props.updateWorld(n),t.setState({Collaborators:r,waiting:!1})}else t.setState({message:a.error,waiting:!1},(function(){t.props.logout()}))}))}))},r.copyCollabLink=function(){r.generatedLink.children[0].select(),document.execCommand("copy"),r.setState({collabLinkCopied:!0})},r.load=function(e){r.props.fromLogin&&r.props.notFromLogin(),setTimeout((function(){r.setState({_id:e,loaded:!1},r.finishLoading)}),500)},r.finishLoading=function(){r.api.selectWorld(r.state._id),r.props.selectWorld(r.state._id),r.api.getWorld(r.state._id).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things),0===r.props.allUsers.length?r.api.getAllUsers().then((function(e){r.props.setAllUsers(e),r.setState({loaded:!0},r.actuallyFinishLoading)})):r.setState({loaded:!0},r.actuallyFinishLoading)}))},r.actuallyFinishLoading=function(){var e=r.props.worlds.filter((function(e){return e._id===r.state._id}));e.length>0&&(e=e[0],r.setState({Name:e.Name,Public:e.Public,AcceptingCollaborators:void 0!==e.AcceptingCollaborators&&null!==e.AcceptingCollaborators&&e.AcceptingCollaborators,Collaborators:void 0===e.Collaborators?[]:e.Collaborators}))},r.state={_id:null,Collaborators:[],fieldValidation:{inviteEmail:{valid:!0,message:""}},message:"",redirectTo:null,newCollaborators:!1,newCollabTab:0,collabTab:0,collabLink:null,collabLinkCopied:!1,selectedUser:"",inviteEmail:"",inviteMessage:"",waiting:!1},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;this.props.fromLogin&&this.props.notFromLogin();var t=this.props.match.params.id;if(void 0===t&&(t=null),this.state._id!==t)return this.load(t),n.a.createElement("span",null,"Loading...");if(this.state.loaded){if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null!==this.props.selectedWorld&&null===this.props.user)return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login");if(null!==this.props.selectedWorld&&this.props.selectedWorld.Owner!==this.props.user._id)return n.a.createElement(he.a,{to:"/"});var a=this.state.Collaborators.filter((function(e){return"collab"===e.type})),r=this.state.Collaborators.filter((function(e){return"invite"===e.type})),i=this.state.Collaborators.filter((function(e){return"request"===e.type})),s=this.props.allUsers.filter((function(t){return t._id!==e.props.selectedWorld.Owner&&0===e.state.Collaborators.filter((function(e){return e.userID===t._id})).length})).map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e},e.username)}));return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(Dt.Helmet,null,n.a.createElement("title",null,null===this.state._id?"Author's Notebook: Create New World":"Author's Notebook: Edit ".concat(this.props.selectedWorld.Name," Collaborators"))),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:1},n.a.createElement(ie.a,{title:"Back to ".concat(this.props.selectedWorld.Name," Details")},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(ea.a,null)))),n.a.createElement(U.a,{item:!0,xs:11},n.a.createElement("h2",null,"Edit Collaborators"))),n.a.createElement(U.a,{item:!0},n.a.createElement(g.a,{style:{maxWidth:"200px"}},n.a.createElement(b.a,{primary:"Collaborators"}),this.state.newCollaborators?n.a.createElement(ie.a,{title:"Manage Existing Collaborators"},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({newCollaborators:!1})}},n.a.createElement(ea.a,null))):n.a.createElement(ie.a,{title:"Add New Collaborators"},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({newCollaborators:!0})}},n.a.createElement(le.a,null))))),this.state.newCollaborators?n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(m.a,{position:"static"},n.a.createElement(fa.a,{value:this.state.newCollabTab,onChange:function(t,a){e.setState({newCollabTab:a,inviteMessage:""})},"aria-label":"Add Collaborator Method"},n.a.createElement(ha.a,Object.assign({label:"Find Existing User"},this.a11yProps(0))),n.a.createElement(ha.a,Object.assign({label:"Invite via Email"},this.a11yProps(1))),n.a.createElement(ha.a,Object.assign({label:"Get an Invite Link"},this.a11yProps(2))))),n.a.createElement(va,{value:this.state.newCollabTab,index:0},n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"user-select",id:"user-select-label"},"Select a User"),n.a.createElement(ga.a,{labelId:"user-select-label",id:"user-select",value:this.state.selectedUser,onChange:function(t){e.setState({selectedUser:t.target.value,inviteMessage:""})},labelWidth:90},s))),n.a.createElement(U.a,{item:!0},n.a.createElement(xe.a,{variant:"contained",color:"primary",disabled:""===this.state.selectedUser||this.state.waiting,onClick:this.addNewCollaborator},"Send Invite"),this.state.inviteMessage))),n.a.createElement(va,{value:this.state.newCollabTab,index:1},n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"inviteEmail"},"Collaborator Email"),n.a.createElement(ae.a,{id:"inviteEmail",name:"inviteEmail",type:"email",autoComplete:"Off",error:!this.state.fieldValidation.inviteEmail.valid,value:this.state.inviteEmail,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:140,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.inviteEmail.message))),n.a.createElement(U.a,{item:!0},n.a.createElement(xe.a,{variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.emailCollaborator},"Send Invite"),this.state.inviteMessage))),n.a.createElement(va,{value:this.state.newCollabTab,index:2},n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Generate a single use link to send someone yourself"),n.a.createElement(U.a,{item:!0},n.a.createElement(xe.a,{variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.generateCollabLink},"Generate Link")),null!==this.state.collabLink&&n.a.createElement(U.a,{item:!0},n.a.createElement(ae.a,{id:"generatedLink",name:"generatedLink",ref:function(t){return e.generatedLink=t},type:"text",multiline:!0,value:this.state.collabLink,endAdornment:n.a.createElement(ra.a,{position:"end"},n.a.createElement(h.a,{"aria-label":"copy to clipboard",onClick:this.copyCollabLink,edge:"end"},n.a.createElement(ba.a,null))),labelWidth:70,fullWidth:!0}),this.state.collabLinkCopied&&n.a.createElement("span",{style:{fontColor:"red"}},"Link Copied to Clipboard")))))):n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(m.a,{position:"static"},n.a.createElement(fa.a,{value:this.state.collabTab,onChange:function(t,a){e.setState({collabTab:a})},"aria-label":"Collaborators"},n.a.createElement(ha.a,Object.assign({label:"Collaborators (".concat(a.length,")")},this.a11yProps(0))),n.a.createElement(ha.a,Object.assign({label:"Invites (".concat(r.length,")")},this.a11yProps(1))),n.a.createElement(ha.a,Object.assign({label:"Requests (".concat(i.length,")")},this.a11yProps(2))))),n.a.createElement(va,{value:this.state.collabTab,index:0},n.a.createElement(U.a,{container:!0,spacing:3,direction:"column"},a.map((function(t,a){return n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direcion:"row",key:a},n.a.createElement(U.a,{item:!0,xs:12,sm:3},e.props.allUsers.filter((function(e){return e._id===t.userID}))[0].username),n.a.createElement(U.a,{item:!0,xs:12,sm:6},n.a.createElement($t.a,{control:n.a.createElement(Lt.a,{checked:t.editPermission,disabled:e.state.waiting,onChange:function(a){e.updateCollaboratorPermission(t,a.target.checked)},color:"primary"}),label:"Full Permissions"})),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(ie.a,{title:"Remove Collaborator"},n.a.createElement(ne.a,{size:"small",color:"primary",disabled:e.state.waiting,onClick:function(a){e.deleteCollab(t)}},n.a.createElement(_t.a,null)))))})))),n.a.createElement(va,{value:this.state.collabTab,index:1},n.a.createElement(U.a,{container:!0,spacing:3,direction:"column"},r.map((function(t,a){var r=e.props.allUsers.filter((function(e){return e._id===t.userID}));return r=0===r.length?null:r[0],n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row",key:a},n.a.createElement(U.a,{item:!0,xs:12,sm:9,container:!0,spacing:1,direction:"column"},null!==r&&n.a.createElement(U.a,{item:!0},"Username: ",r.username),""!==t.email&&n.a.createElement(U.a,{item:!0},"Email: ",t.email),n.a.createElement(U.a,{item:!0},"Invite Link: ",t.collabLink)),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(ie.a,{title:"Delete Invite"},n.a.createElement(ne.a,{size:"small",color:"primary",disabled:e.state.waiting,onClick:function(a){e.deleteCollab(t)}},n.a.createElement(_t.a,null)))))})))),n.a.createElement(va,{value:this.state.collabTab,index:2},n.a.createElement(U.a,{container:!0,spacing:3,direction:"column"},i.map((function(t,a){return n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direcion:"row",key:a},n.a.createElement(U.a,{item:!0,xs:12,sm:6},e.props.allUsers.filter((function(e){return e._id===t.userID}))[0].username),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(ie.a,{title:"Accept Request"},n.a.createElement(ne.a,{size:"small",color:"primary",disabled:e.state.waiting,onClick:function(a){e.acceptCollab(t)}},n.a.createElement(ya.a,null)))),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(ie.a,{title:"Delete Request"},n.a.createElement(ne.a,{size:"small",color:"primary",disabled:e.state.waiting,onClick:function(a){e.deleteCollab(t)}},n.a.createElement(_t.a,null)))))})))))),n.a.createElement(U.a,{item:!0},this.state.message),n.a.createElement(U.a,{item:!0},Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))))}return n.a.createElement("span",null,"Loading...")}}]),a}(r.Component),Ea=Object(d.b)((function(e){return{selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,worlds:e.app.worlds,user:e.app.user,fromLogin:e.app.fromLogin,allUsers:e.app.allUsers}}),(function(e){return{updateWorld:function(t){return e(S(t))},selectWorld:function(t){return e(O(t))},notFromLogin:function(){return e(M({}))},toggleLogin:function(){return e(B({}))},logout:function(){return e(E({}))},setAttributes:function(t){return e(x(t))},setTypes:function(t){return e(W(t))},setThings:function(t){return e(C(t))},setAllUsers:function(t){return e(I(t))}}}))(Ta);var Da=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).getModalStyle=function(){var e=Math.round(window.innerHeight/2)-50,t=Math.round(window.innerWidth/2)-200;return{top:"".concat(e,"%"),left:"".concat(t,"%"),transform:"translate(".concat(t,"px, ").concat(e,"px)")}},r.delete=function(e){r.api.deleteType(r.props.selectedWorldID,r.state._id).then((function(e){void 0===e.error?r.api.getWorld(r.props.selectedWorldID,!0).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things),r.setState({redirectTo:"/project/details/".concat(r.props.selectedWorldID)})})):r.setState({waiting:!1,message:e.error},(function(){r.props.logout()}))}))},r.load=function(e){setTimeout((function(){r.setState({_id:e,redirectTo:null,loaded:!1},r.finishLoading)}),500)},r.finishLoading=function(){r.props.fromLogin&&r.props.notFromLogin();var e=r.state._id;void 0!==e?r.props.selectedWorldID?r.api.getWorld(r.props.selectedWorldID).then((function(t){if(r.props.setAttributes(t.attributes),r.props.setTypes(t.types),r.props.setThings(t.things),null!==e){var a=t.types.filter((function(t){return t._id===e}));a.length>0?(a=a[0],r.props.updateSelectedType(a),r.setState({loaded:!0})):r.setState({message:"Invalid ID",loaded:!0})}else r.props.updateSelectedType({_id:null,Name:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}})})):r.api.getWorldByTypeID(e).then((function(t){if(console.log(t),r.props.selectWorld(t.worldID),r.props.setAttributes(t.attributes),r.props.setTypes(t.types),r.props.setThings(t.things),null!==e){var a=t.types.filter((function(t){return t._id===e}));a.length>0?(a=a[0],r.props.updateSelectedType(a),r.setState({loaded:!0})):r.setState({message:"Invalid ID",loaded:!0})}else r.props.updateSelectedType({_id:null,Name:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}})})):r.props.updateSelectedType({_id:null,Name:"",Description:"",Supers:[],AttributesArr:[],Attributes:[],Major:!1})},r.redirectToNext=function(){for(var e=0;r.props.types[e]._id!==r.props.selectedType._id;)e++;++e===r.props.types.length&&(e=0),r.setState({redirectTo:"/type/details/".concat(r.props.types[e]._id)})},r.state={_id:null,fieldValidation:{Name:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,modalOpen:!1},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;if(this.state._id!==t)return this.load(t),n.a.createElement("span",null,"Loading");if(this.state.loaded){if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user){if(null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type})).length){if(void 0===this.props.selectedType||null===this.props.selectedType)return n.a.createElement("span",null,"Loading");var a=this.props.types.filter((function(t){return void 0!==t.ReferenceIDs&&t.ReferenceIDs.includes(e.state._id)})),r=[];this.props.selectedType.Supers.forEach((function(e){e.AttributesArr.forEach((function(e){0===r.filter((function(t){return t.attrID===e.attrID})).length&&r.push(e)}))}));var i=[].concat(Object($.a)(this.props.typeSuggestions),Object($.a)(this.props.thingSuggestions));return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},null!==this.props.selectedWorld&&n.a.createElement("div",null,n.a.createElement(Dt.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:8,container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:1},n.a.createElement(ie.a,{title:"Back to ".concat(this.props.selectedWorld.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(ea.a,null)))),n.a.createElement(U.a,{item:!0,xs:11},n.a.createElement("h2",null,this.props.selectedType.Name))),n.a.createElement(U.a,{item:!0},n.a.createElement("h3",null,this.props.selectedType.Major?"Major Type":"")),n.a.createElement(U.a,{item:!0},n.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.selectedType.Description}}))),n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(re.a,null,null!==this.props.user&&null!==this.props.selectedWorld&&(this.props.selectedWorld.Owner===this.props.user._id||this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length>0)&&n.a.createElement(g.a,null,n.a.createElement(U.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:4,sm:12},n.a.createElement(ie.a,{title:"Create New ".concat(this.props.selectedType.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/thing/create/type_id_".concat(e.state._id)})}},n.a.createElement(le.a,null)))),n.a.createElement(U.a,{item:!0,xs:4,sm:12},n.a.createElement(ie.a,{title:"Edit ".concat(this.props.selectedType.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/type/edit/".concat(e.state._id)})}},n.a.createElement(At.a,null)))),n.a.createElement(U.a,{item:!0,xs:4,sm:12},n.a.createElement(ie.a,{title:"Delete ".concat(this.props.selectedType.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({modalOpen:!0})}},n.a.createElement(_t.a,null)))))),n.a.createElement(g.a,null,n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(b.a,{primary:"Next Type"})))))),n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:8,container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0},"Attributes"),n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,null!==this.props.selectedType&&void 0!==this.props.selectedType&&r.map((function(t,a){var r=e.props.types.filter((function(e){return e._id===t.DefinedType}));r=0===r.length?{Name:""}:r[0];var i=e.props.selectedType.DefaultsHash[t.attrID];return n.a.createElement(g.a,{key:a},n.a.createElement(b.a,null,t.Name,":\xa0","Options"===t.AttributeType?n.a.createElement("span",null,"Options:",t.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&" (Default: ".concat(i.DefaultValue,")")):"Type"===t.AttributeType?n.a.createElement("span",null,n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t.DefinedType)})}},n.a.createElement(b.a,{primary:r.Name})),void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&e.props.things.filter((function(e){return i.DefaultValue===e._id})).length>0&&" (Default: ".concat(e.props.things.filter((function(e){return e._id===i.DefaultValue}))[0].Name,")")):"List"===t.AttributeType?n.a.createElement("span",null,"List:\xa0","Options"===t.ListType?n.a.createElement("span",null,"Options:",t.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),")")):"Type"===t.ListType?n.a.createElement("span",null,n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t.DefinedType)})}},n.a.createElement(b.a,{primary:r.Name})),void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&e.props.things.filter((function(e){return i.DefaultListValues.includes(e._id)})).length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(t,a){var r=e.props.things.filter((function(e){return e._id===t}));return 0===r.length?n.a.createElement("span",{key:a}):(r=r[0],n.a.createElement("span",{key:a},0===a?" ":", ",n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t)})}},n.a.createElement(b.a,{primary:r.Name}))))})),")")):n.a.createElement("span",null,t.ListType,void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),")"))):"True/False"===t.AttributeType?n.a.createElement("span",null,t.AttributeType,void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue?" (Default: ".concat(i.DefaultValue,")"):" (Default: False)"):n.a.createElement("span",null,t.AttributeType,void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&" (Default: ".concat(i.DefaultValue,")"))))})),null!==this.props.selectedType&&void 0!==this.props.selectedType&&this.props.selectedType.AttributesArr.map((function(t,a){var r=e.props.types.filter((function(e){return e._id===t.DefinedType}));r=0===r.length?{Name:""}:r[0];var i=e.props.selectedType.DefaultsHash[t.attrID];return n.a.createElement(g.a,{key:a},n.a.createElement(b.a,null,t.Name,":\xa0","Options"===t.AttributeType?n.a.createElement("span",null,"Options:",t.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&" (Default: ".concat(i.DefaultValue,")")):"Type"===t.AttributeType?n.a.createElement("span",null,n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t.DefinedType)})}},n.a.createElement(b.a,{primary:r.Name})),void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&e.props.things.filter((function(e){return i.DefaultValue===e._id})).length>0&&" (Default: ".concat(e.props.things.filter((function(e){return e._id===i.DefaultValue}))[0].Name,")")):"List"===t.AttributeType?n.a.createElement("span",null,"List:\xa0","Options"===t.ListType?n.a.createElement("span",null,"Options:",t.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),")")):"Type"===t.ListType?n.a.createElement("span",null,n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t.DefinedType)})}},n.a.createElement(b.a,{primary:r.Name})),void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&e.props.things.filter((function(e){return i.DefaultListValues.includes(e._id)})).length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(t,a){var r=e.props.things.filter((function(e){return e._id===t}));return 0===r.length?n.a.createElement("span",{key:a}):(r=r[0],n.a.createElement("span",{key:a},0===a?" ":", ",n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t)})}},n.a.createElement(b.a,{primary:r.Name}))))})),")")):n.a.createElement("span",null,t.ListType,void 0!==i&&void 0!==i.DefaultListValues&&i.DefaultListValues.length>0&&n.a.createElement("span",null,"\xa0(Defaults:",i.DefaultListValues.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)})),")"))):"True/False"===t.AttributeType?n.a.createElement("span",null,t.AttributeType,void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue?" (Default: ".concat(i.DefaultValue,")"):" (Default: False)"):n.a.createElement("span",null,t.AttributeType,void 0!==i&&void 0!==i.DefaultValue&&""!==i.DefaultValue&&" (Default: ".concat(i.DefaultValue,")"))))}))))),n.a.createElement(U.a,{item:!0,xs:12,sm:4,container:!0,spacing:0,direction:"column"},this.props.selectedType.Supers.length>0&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,null,n.a.createElement(b.a,{primary:"Super Types"})),this.props.selectedType.Supers.map((function(t,a){return n.a.createElement(g.a,{key:a},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},n.a.createElement(b.a,{primary:t.Name})))})))),this.props.subTypes.length>0&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,null,n.a.createElement(b.a,{primary:"Sub Types"})),this.props.subTypes.map((function(t,a){return n.a.createElement(g.a,{key:a},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},n.a.createElement(b.a,{primary:t.Name})))})))),a.length>0&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,null,n.a.createElement(b.a,{primary:"Referenced in:"})),a.map((function(t,a){return n.a.createElement(g.a,{key:a},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},n.a.createElement(b.a,{primary:t.Name})))})))),this.props.instances.length>0&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,null,n.a.createElement(b.a,{primary:"Instances"})),this.props.instances.map((function(t,a){return n.a.createElement(g.a,{key:a},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t._id)})}},n.a.createElement(b.a,{primary:t.Name})))})))))),n.a.createElement(U.a,{item:!0,xs:12},n.a.createElement(nt,{user:this.props.user,allUsers:this.props.allUsers,object:this.props.selectedType,objectType:"Type",world:this.props.selectedWorld,api:this.api,onChange:this.commentsChange,suggestions:i})),n.a.createElement(jt.a,{"aria-labelledby":"delete-type-modal","aria-describedby":"delete-type-modal-description",open:this.state.modalOpen,onClose:function(t){e.setState({modalOpen:!1})}},n.a.createElement("div",{style:this.getModalStyle(),className:"paper"},n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Are you sure you want to delete"," ",this.props.selectedType.Name,"?"),n.a.createElement(U.a,{item:!0},"(All references to it will be left alone and may not work correctly)"),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:this.delete},"Yes")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({modalOpen:!1})}},"Cancel"))))))))}return n.a.createElement(he.a,{to:"/"})}return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")}return n.a.createElement("span",null,"Loading")}}]),a}(r.Component),wa=Object(d.b)((function(e){var t=e.app.selectedType,a=null===t?[]:e.app.types.filter((function(e){return e.SuperIDs.includes(t._id)})),r=null===t?[]:e.app.things.filter((function(e){return e.TypeIDs.includes(t._id)}));return{selectedPage:e.app.selectedPage,selectedType:t,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,types:e.app.types,subTypes:a,instances:r,user:e.app.user,things:e.app.things,attributesByID:e.app.attributesByID,attributesByName:e.app.attributesByName,fromLogin:e.app.fromLogin,allUsers:e.app.allUsers,typeSuggestions:e.app.typeSuggestions,thingSuggestions:e.app.thingSuggestions}}),(function(e){return{updateSelectedType:function(t){return e(L(t))},addType:function(t){return e(k(t))},updateType:function(t){return e(j(t))},setTypes:function(t){return e(W(t))},setAttributes:function(t){return e(x(t))},setAllUsers:function(t){return e(I(t))},setThings:function(t){return e(C(t))},notFromLogin:function(){return e(M({}))},toggleLogin:function(){return e(B({}))},logout:function(){return e(E({}))},selectWorld:function(t){return e(O(t))}}}))(Da),Ia=a(98),Aa=a.n(Ia),Sa=a(50),Na=a(55),Oa=a.n(Na),xa=function(e,t){var a=t.attribute;a.DefinedType=e.target.value,"new"===e.target.value?t.onNewType(a):t.onChange(a)},Wa=function(e,t){var a=t.attribute;a.Options=e,t.onChange(a)};function ka(e){var t=Object(r.useState)(e.attribute.Name),a=Object(Oe.a)(t,2),i=a[0],s=a[1],o=["Text","Number","True/False","Options","Type","List"],l=["Text","Options","Type"],c=void 0===e.attribute.AttributeType||null===e.attribute.AttributeType||""===e.attribute.AttributeType?o[0]:e.attribute.AttributeType,u=void 0===e.attribute.ListType||""===e.attribute.ListType?l[0]:e.attribute.ListType,p=void 0===e.attribute.DefinedType||""===e.attribute.DefinedType?"":e.attribute.DefinedType,d=void 0===e.attribute.FromTypeIDs?[]:e.types.filter((function(t){return e.attribute.FromTypeIDs.includes(t._id)}));return n.a.createElement(U.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,sm:3,xs:12},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"AttrName_".concat(e.attribute.attrID,"_").concat(e.attribute.index)},"Name"),n.a.createElement(ae.a,{disabled:e.disabled,id:"AttrName_".concat(e.attribute.attrID,"_").concat(e.attribute.index),name:"AttrName_".concat(e.attribute.attrID,"_").concat(e.attribute.index),type:"text",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a=e.attribute;a.Name=i,e.onChange(a)},labelWidth:43,fullWidth:!0}),n.a.createElement(Pe.a,null,e.message))),n.a.createElement(U.a,{item:!0,sm:3,xs:12},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"attribute-type",id:"attribute-type-label"},"Attribute Type"),n.a.createElement(ga.a,{labelId:"attribute-type-label",id:"attribute-type",disabled:e.disabled,value:c,onChange:function(t){!function(e,t){var a=t.attribute;a.AttributeType=e.target.value,a.ListType="Text",t.onChange(a)}(t,e)},fullWidth:!0,labelWidth:100},o.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e},e)}))))),n.a.createElement(U.a,{item:!0,sm:3,xs:12},"Options"===c?n.a.createElement(Oa.a,{variant:"outlined",disabled:e.disabled,defaultValue:e.attribute.Options,onChange:function(t){return Wa(t,e)}}):"Type"===c?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"definedType",id:"definedType-label"},"Defined Type"),n.a.createElement(ga.a,{labelId:"definedType-label",id:"definedType",disabled:e.disabled,value:p,onChange:function(t){xa(t,e)},fullWidth:!0,labelWidth:100},n.a.createElement(dt.a,{value:"new"},"+ Create New Type"),e.types.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e._id},e.Name)})))):"List"===c?n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"list-type",id:"list-type-label"},"List Type"),n.a.createElement(ga.a,{labelId:"list-type-label",id:"list-type",disabled:e.disabled,value:u,onChange:function(t){!function(e,t){var a=t.attribute;a.ListType=e.target.value,t.onChange(a)}(t,e)},fullWidth:!0,labelWidth:70},l.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e},e)}))))),"Type"===e.attribute.ListType?n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"definedType",id:"definedType-label"},"Defined Type"),n.a.createElement(ga.a,{labelId:"definedType-label",id:"definedType",disabled:e.disabled,value:p,onChange:function(t){xa(t,e)},fullWidth:!0,labelWidth:100},n.a.createElement(dt.a,{value:"new"},"+ Create New Type"),e.types.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e._id},e.Name)}))))):"Options"===e.attribute.ListType?n.a.createElement(U.a,{item:!0},n.a.createElement(Oa.a,{variant:"outlined",disabled:e.disabled,defaultValue:e.attribute.Options,onChange:function(t){return Wa(t,e)}})):""):""),n.a.createElement(U.a,{item:!0,xs:3},1===d.length?"From Type: ".concat(d[0].Name):d.length>1?n.a.createElement("span",null,"From Types:",d.map((function(e,t){return n.a.createElement("span",{key:t},t>0&&", ",e.Name)}))):n.a.createElement(ie.a,{title:"Delete Attribute"},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){return e.onDelete(e.attribute)}},n.a.createElement(_t.a,null)))))}function Ca(e){var t=Object(r.useState)(e.def.DefaultValue),a=Object(Oe.a)(t,2),i=a[0],s=a[1],o=""===e.attribute.AttributeType?"Text":e.attribute.AttributeType,l="Type"!==o||void 0===e.def.DefaultValue||""===e.def.DefaultValue?"":e.def.DefaultValue,c=[],u=[];if("List"===o&&"Options"===e.attribute.ListType)e.attribute.Options.forEach((function(e){c.push({Name:e})})),e.def.DefaultListValues.forEach((function(e){u.push({Name:e})}));else if("List"===o&&"Type"===e.attribute.ListType){var p=e.types.filter((function(t){return t._id===e.attribute.DefinedType}))[0];c.push({Name:"+ Create New ".concat(p.Name),_id:"new"}),e.things.filter((function(t){return t.TypeIDs.includes(e.attribute.DefinedType)})).forEach((function(e){c.push({Name:e.Name,_id:e._id})})),c.filter((function(t){return e.def.DefaultListValues.includes(t._id)})).forEach((function(e){u.push(e)}))}return n.a.createElement(U.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12},"Text"===o?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"attribute_name_".concat(e.attribute.attrID)},e.attribute.Name," Default Value"),n.a.createElement(ae.a,{id:"attribute_name_".concat(e.attribute.attrID),name:"attribute_name_".concat(e.attribute.attrID),type:"text",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a=e.def;a.DefaultValue=i,e.onChange(a)},labelWidth:9*e.attribute.Name.length+100,fullWidth:!0}),n.a.createElement(Pe.a,null,e.message)):"Number"===o?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"numField"},e.attribute.Name," Default Value"),n.a.createElement(ae.a,{id:"numField",name:"numField",type:"number",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a=e.def;a.DefaultValue=i,e.onChange(a)},labelWidth:9*e.attribute.Name.length+100,fullWidth:!0}),n.a.createElement(Pe.a,null,e.message)):"True/False"===o?n.a.createElement($t.a,{control:n.a.createElement(Lt.a,{checked:"True"===e.def.DefaultValue,onChange:function(t){var a=e.def;a.DefaultValue=t.target.checked?"True":"False",e.onChange(a)},color:"primary"}),label:"".concat(e.attribute.Name," Default True")}):"Options"===o?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"options-select",id:"options-select-label"},e.attribute.Name," Default Value"),n.a.createElement(ga.a,{labelId:"options-select-label",id:"options-select",value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){var a=e.def;a.DefaultValue=i,e.onChange(a)},fullWidth:!0,labelWidth:9*e.attribute.Name.length+100},e.attribute.Options.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e},e)})))):"Type"===o?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"type-select",id:"type-select-label"},e.attribute.Name," Default Value"),n.a.createElement(ga.a,{labelId:"type-select-label",id:"type-select",value:l,onChange:function(t){!function(e,t){var a=t.attribute;"new"===e.target.value?t.onNewThing(a):(a.DefaultValue=e.target.value,t.onChange(a))}(t,e)},fullWidth:!0,labelWidth:9*e.attribute.Name.length+100},n.a.createElement(dt.a,{value:"new"},"+ Create New"," ",e.types.filter((function(t){return t._id===e.attribute.DefinedType}))[0].Name),e.things.filter((function(t){return t.TypeIDs.includes(e.attribute.DefinedType)})).map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e._id},e.Name)})))):"List"===o?n.a.createElement("span",null,"Text"===e.attribute.ListType?n.a.createElement(Oa.a,{placeholder:"".concat(e.attribute.Name," Default Values"),variant:"outlined",defaultValue:e.def.DefaultListValues,onChange:function(t){return function(e,t){var a=t.def;a.DefaultListValues=e,t.onChange(a)}(t,e)}}):"Options"===e.attribute.ListType?n.a.createElement(Sa.Multiselect,{placeholder:"".concat(e.attribute.Name," Default Values"),options:c,selectedValues:u,onSelect:function(t,a){!function(e,t){var a=t.def;a.DefaultListValues.push(e.Name),t.onChange(a)}(a,e)},onRemove:function(t,a){!function(e,t){var a=t.def;a.DefaultListValues=[],e.forEach((function(e){a.DefaultListValues.push(e.Name)})),t.onChange(a)}(t,e)},displayValue:"Name"}):"Type"===e.attribute.ListType?n.a.createElement(Sa.Multiselect,{placeholder:"".concat(e.attribute.Name," Default Values"),options:c,selectedValues:u,onSelect:function(t,a){!function(e,t){if("new"===e._id)setTimeout((function(){var e=t.attribute;t.onNewThing(e)}),500);else{var a=t.def;a.DefaultListValues.push(e._id),t.onChange(a)}}(a,e)},onRemove:function(t,a){!function(e,t){var a=t.def;a.DefaultListValues=[],e.forEach((function(e){a.DefaultListValues.push(e._id)})),t.onChange(a)}(t,e)},displayValue:"Name"}):""):""))}var _a=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).newAttribute=function(){var e=r.props.selectedType;e.AttributesArr.push({index:e.AttributesArr.length,attrID:"null_".concat(Aa()()),Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:""}),r.props.updateSelectedType(e)},r.changeAttribute=function(e){var t=r.props.selectedType;t.AttributesArr[e.index]={index:e.index,attrID:e.attrID,Name:e.Name,AttributeType:e.AttributeType,Options:e.Options,DefinedType:e.DefinedType,ListType:e.ListType},r.props.updateSelectedType(t)},r.changeDefault=function(e){var t=r.props.selectedType;t.DefaultsHash[e.attrID]={attrID:e.attrID,DefaultValue:e.DefaultValue,DefaultListValues:e.DefaultListValues,FromTypeIDs:e.FromTypeIDs},r.props.updateSelectedType(t)},r.blurAttribute=function(e){},r.deleteAttribute=function(e){var t=r.props.selectedType,a=[];t.AttributesArr.forEach((function(t){t.index!==e.index&&(t.index>e.index&&t.index--,a.push(t))})),t.AttributesArr=[];var n=Object(z.a)({},t.DefaultsHash);void 0!==n[e.attrID]&&delete n[e.attrID],t.DefaultsHash={},r.props.updateSelectedType(t),setTimeout((function(){t.AttributesArr=a,t.DefaultsHash=n,r.props.updateSelectedType(t)}),500)},r.addNewType=function(e){r.props.addNewType(e)},r.addNewThing=function(e){r.props.addNewThing(e)},r.state={message:"",waiting:!1,defaultsMode:!1},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=[];return this.props.selectedType.SuperIDs.forEach((function(a){var r=e.props.types.filter((function(e){return e._id===a}));r.length>0&&(r=r[0]).AttributesArr.forEach((function(e){var a=t.filter((function(t){return t.attrID===e.attrID}));0===a.length?(e.FromTypeIDs=[r._id],t.push(e)):(a=a[0]).FromTypeIDs.push(r._id)}))})),n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,null!==this.props.selectedType&&void 0!==this.props.selectedType&&t.map((function(t,a){var r=e.props.selectedType.DefaultsHash[t.attrID];return void 0===r&&(r={attrID:t.attrID,DefaultValue:"",DefaultListValues:[]}),n.a.createElement(g.a,{key:a},e.props.defaultsMode?n.a.createElement(Ca,{typeID:e.props.selectedType._id,attribute:t,def:r,onChange:e.changeDefault,types:e.props.types,things:e.props.things,onNewThing:e.addNewThing}):n.a.createElement(ka,{typeID:e.props.selectedType._id,disabled:!0,attribute:t,types:e.props.types,things:e.props.things,onNewType:e.addNewType}))})),null!==this.props.selectedType&&void 0!==this.props.selectedType&&this.props.selectedType.AttributesArr.map((function(t,a){var r=e.props.selectedType.DefaultsHash[t.attrID];return void 0===r&&(r={attrID:t.attrID,DefaultValue:"",DefaultListValues:[]}),n.a.createElement(g.a,{key:a},e.props.defaultsMode?n.a.createElement(Ca,{typeID:e.props.selectedType._id,attribute:t,def:r,onChange:e.changeDefault,onBlur:e.blurAttribute,types:e.props.types,things:e.props.things,onNewThing:e.addNewThing}):n.a.createElement(ka,{typeID:e.props.selectedType._id,attribute:t,onChange:e.changeAttribute,onDelete:e.deleteAttribute,onBlur:e.blurAttribute,types:e.props.types,things:e.props.things,onNewType:e.addNewType}))})))))}}]),a}(r.Component),ja=Object(d.b)((function(e){return{selectedType:e.app.selectedType,types:e.app.types,things:e.app.things,selectedWorldID:e.app.selectedWorldID}}),(function(e){return{updateSelectedType:function(t){return e(L(t))},addType:function(t){return e(k(t))},addThing:function(t){return e(_(t))}}}))(_a);function La(e){var t=Object(r.useState)(""),a=Object(Oe.a)(t,2),i=a[0],s=a[1],o=Object(r.useState)(""),l=Object(Oe.a)(o,2),c=l[0],u=l[1],p=Object(r.useState)(!1),d=Object(Oe.a)(p,2),m=d[0],f=d[1];return n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Just give the new Type a name."),n.a.createElement(U.a,{item:!0},"(You can do the rest later.)"),n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"name"},"Name"),n.a.createElement(ae.a,{id:"name",name:"Name",type:"text",autoComplete:"Off",error:""!==c,value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){!function(e,t,a){a(0===t.types.filter((function(t){return t.Name===e})).length?"":"This Type Name is already in use")}(i,e,u)},labelWidth:43,fullWidth:!0}),n.a.createElement(Pe.a,null,c))),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:m,onClick:function(t){f(!0),function(e,t,a,r,n){var i={_id:null,Name:e.trim(),Description:"",SuperIDs:[],AttributesArr:[],Attributes:[],worldID:t.selectedWorldID,Major:!1};t.api.createType(i).then((function(e){void 0!==e.typeID?(i._id=e.typeID,i.Supers=[],t.addType&&t.addType(i),n(!1),t.onSave&&(a(""),t.onSave(i))):void 0!==e.error&&(n(!1),r(e.error),t.logout())})).catch((function(e){return console.log(e)}))}(i,e,s,u,f)}},m?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){void 0!==e.onCancel&&null!==e.onCancel&&e.onCancel()}},"Cancel"))))}function Va(e){var t=Object(r.useState)(""),a=Object(Oe.a)(t,2),i=a[0],s=a[1],o=Object(r.useState)(""),l=Object(Oe.a)(o,2),c=l[0],u=l[1],p=Object(r.useState)(!1),d=Object(Oe.a)(p,2),m=d[0],f=d[1];return n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Just give the new ",void 0===e.newThingType.Name?"Thing":e.newThingType.Name," a name."),n.a.createElement(U.a,{item:!0},"(You can do the rest later.)"),n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"name"},"Name"),n.a.createElement(ae.a,{id:"name",name:"Name",type:"text",autoComplete:"Off",error:""!==c,value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){!function(e,t,a){a(0===t.things.filter((function(t){return t.Name===e})).length?"":"This Thing Name is already in use")}(i,e,u)},labelWidth:43,fullWidth:!0}),n.a.createElement(Pe.a,null,c))),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:m,onClick:function(t){f(!0),function(e,t,a,r,n){n(!0);var i={_id:null,Name:e.trim(),Description:"",TypeIDs:void 0===t.newThingType?[]:[t.newThingType._id],Attributes:[],worldID:t.selectedWorldID,ReferenceIDs:[]};t.api.createThing(i).then((function(e){void 0!==e.thingID?(i._id=e.thingID,i.Types=void 0===t.newThingType?[]:[t.newThingType],i.AttributesArr=[],t.addThing(i),setTimeout((function(){a(""),n(!1),t.onSave(i)}),500)):void 0!==e.error&&(r(e.error),n(!1),t.logout())})).catch((function(e){return console.log(e)}))}(i,e,s,u,f)}},m?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){void 0!==e.onCancel&&null!==e.onCancel&&e.onCancel()}},"Cancel"))))}var Pa=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).resetForm=function(){setTimeout((function(){void 0!==r.props.match.params.id?r.setState({resetting:!1,loaded:!0,redirectTo:"/type/create"}):r.setState({resetting:!1,loaded:!0})}),500)},r.inputBlur=function(e){var t=e.target.name,a=r.validateField(t),n=r.state.fieldValidation;void 0!==n[t]&&n[t].valid!==a.valid&&(n[t].valid=a.valid,n[t].message=a.message,r.setState({fieldValidation:n}))},r.validateField=function(e){var t=null,a=!0,n="";switch(e){case"Name":(a=null!==(t=r.props.selectedType[e]).match(/^[a-zA-Z0-9 ]*$/i))?t.length<2?(a=!1,n="Type Name is too short"):(a=0===r.props.types.filter((function(e){return e.Name===t&&e._id!==r.state._id})).length)||(n="This Type Name is already in use"):n="Only Letters, Numbers, and Spaces allowed in Type Names";break;case"AttributesArr":a=!0,t=r.props.selectedType[e],n="";for(var i=0;i<t.length;i++){var s=r.props.attributesByName[t[i].Name];if(void 0!==s&&s._id!==t[i].attrID){a=!1,n="An attribute with the name '".concat(t[i].Name,"' already exists");break}if(("Type"===t[i].AttributeType||"List"===t[i].AttributeType&&"Type"===t[i].ListType)&&(void 0===t[i].DefinedType||null===t[i].DefinedType||""===t[i].DefinedType)){a=!1,n="A Defined Type must be selected for ".concat(t[i].Name,".");break}if(("Options"===t[i].AttributeType||"List"===t[i].AttributeType&&"Options"===t[i].ListType)&&(void 0===t[i].Options||null===t[i].Options||0===t[i].Options.length)){a=!1,n="At least one Option must be set for ".concat(t[i].Name,".");break}}break;case"Attributes":a=!0,t=r.props.selectedType[e],n="";for(var o=0;o<t.length;o++){var l=r.props.attributesByName[t[o].Name];if(void 0!==l&&l._id!==t[o].attrID){a=!1,n="An attribute with this name already exists";break}if(("Type"===t[o].AttributeType||"List"===t[o].AttributeType&&"Type"===t[o].ListType)&&(void 0===t[o].DefinedType||null===t[o].DefinedType||""===t[o].DefinedType)){a=!1,n="A Defined Type must be selected for ".concat(t[o].Name,".");break}if(("Options"===t[o].AttributeType||"List"===t[o].AttributeType&&"Options"===t[o].ListType)&&(void 0===t[o].Options||null===t[o].Options||0===t[o].Options.length)){a=!1,n="At least one Option must be set for ".concat(t[o].Name,".");break}}}return{valid:a,message:n}},r.validateForm=function(e){var t=r.validateField("Name"),a=r.validateField("AttributesArr"),n=t.valid&&a.valid,i=r.state.fieldValidation;i.Name=t,i.AttributesArr=a,r.setState({formValid:n,fieldValidation:i},e)},r.onSubmit=function(e){r.validateForm((function(){this.state.formValid&&this.setState({waiting:!0,addMore:e},this.submitThroughAPI)}))},r.cleanWYSIWYG=function(e){return e.endsWith("<p><br></p>")&&(e=e.substring(0,e.length-11)),e},r.submitThroughAPI=function(){var e=r.props.selectedType.Supers.map((function(e){return e._id})),t=r.props.selectedType.AttributesArr.map((function(e){return{_id:e.attrID,Name:e.Name.trim(),AttributeType:e.AttributeType,Options:e.Options,DefinedType:e.DefinedType,ListType:e.ListType}}));r.api.upsertAttributes(r.props.selectedWorldID,t).then((function(t){var a=[];r.props.selectedType.AttributesArr.forEach((function(e){var r=e.attrID.includes("null")?t.attributes[e.Name]:e.attrID;a.push({attrID:r,index:e.index})}));var n={_id:r.state._id,Name:r.props.selectedType.Name.trim(),PluralName:void 0===r.props.selectedType.PluralName?"":r.props.selectedType.PluralName.trim(),Description:r.cleanWYSIWYG(r.props.selectedType.Description),SuperIDs:e,Attributes:a,Defaults:[],worldID:r.props.selectedWorld._id,Major:r.props.selectedType.Major,ReferenceIDs:[],DefaultReferenceIDs:[]};r.props.selectedType.AttributesArr.filter((function(e){return"Type"===e.AttributeType||"List"===e.AttributeType&&"Type"===e.ListType})).forEach((function(e){n.ReferenceIDs.includes(e.DefinedType)||n.ReferenceIDs.push(e.DefinedType)})),r.props.selectedType.Supers.forEach((function(e){e.AttributesArr.filter((function(e){return"Type"===e.AttributeType||"List"===e.AttributeType&&"Type"===e.ListType})).forEach((function(e){n.ReferenceIDs.includes(e.DefinedType)||n.ReferenceIDs.push(e.DefinedType)}))})),Object.keys(r.props.selectedType.DefaultsHash).forEach((function(e){var t=r.props.selectedType.DefaultsHash[e];n.Defaults.push({attrID:e,FromTypeID:t.FromTypeID,DefaultValue:t.DefaultValue,DefaultListValues:t.DefaultListValues})})),null===n._id?r.api.createType(n).then((function(e){void 0!==e.typeID?r.api.getWorld(r.props.selectedWorldID,!0).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things),"add"===r.state.addMore?(r.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),r.setState({_id:null,fieldValidation:{Name:{valid:!0,message:""},AttributesArr:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,addMore:!1,resetting:!0,loaded:!1},r.resetForm)):"next"===r.state.addMore?r.redirectToNext():r.setState({waiting:!1,redirectTo:"/project/details/".concat(r.props.selectedWorld._id)})})):void 0!==e.error&&r.setState({waiting:!1,message:e.error},(function(){r.props.logout()}))})).catch((function(e){return console.log(e)})):r.api.updateType(n).then((function(e){void 0===e.error?r.api.getWorld(r.props.selectedWorldID,!0).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things),"add"===r.state.addMore?(r.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),r.setState({_id:null,fieldValidation:{Name:{valid:!0,message:""},AttributesArr:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,addMore:!1,resetting:!0,loaded:!1},r.resetForm)):"next"===r.state.addMore?r.redirectToNext():r.setState({waiting:!1,redirectTo:"/project/details/".concat(r.props.selectedWorld._id)})})):r.setState({waiting:!1,message:e.error},(function(){r.props.logout()}))})).catch((function(e){return console.log(e)}))}))},r.supersChange=function(e,t){for(var a=[],n=0;n<t.length;n++){var i=t[n];a.push(i),a=a.concat(i.Supers)}var s=r.props.selectedType;s.Supers=a,r.props.updateSelectedType(s)},r.addSuper=function(e,t){var a=r.props.selectedType;a.SuperIDs.push(t._id),t.Supers.forEach((function(t){0===e.filter((function(e){return e._id===t._id})).length&&(e.push(t),a.SuperIDs.push(t._id))}));var n=[];e.forEach((function(e){n=n.concat(a.AttributesArr.filter((function(t){return t.TypeIDs.includes(e._id)})))})),a.AttributesArr=a.AttributesArr.filter((function(e){return 0===n.filter((function(t){return t.attrID===e.attrID})).length})),a.Supers=e,r.props.updateSelectedType(a)},r.newAttribute=function(){var e=r.props.selectedType;e.AttributesArr.push({index:e.AttributesArr.length,attrID:"null_".concat(Aa()()),Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:"",TypeIDs:[]}),r.props.updateSelectedType(e)},r.addSelectedAttribute=function(){var e=r.props.attributesByID[r.state.browseAttributesSelected],t=r.props.selectedType;t.AttributesArr.push({index:t.AttributesArr.length,attrID:e._id,Name:e.Name,AttributeType:e.AttributeType,Options:e.Options,DefinedType:e.DefinedType,ListType:e.ListType,TypeIDs:e.TypeIDs}),r.props.updateSelectedType(t),r.setState({browseAttributesSelected:"",browseTypesSelected:""})},r.addBrowsedType=function(e){var t=r.props.selectedType,a=r.props.types.filter((function(t){return t._id===e}))[0];t.SuperIDs.push(a._id);var n=t.Supers;n.push(a),a.Supers.forEach((function(e){0===n.filter((function(t){return t._id===e._id})).length&&(n.push(e),t.SuperIDs.push(e._id))}));var i=[];n.forEach((function(e){i=i.concat(t.AttributesArr.filter((function(t){return t.TypeIDs.includes(e._id)})))})),t.AttributesArr=t.AttributesArr.filter((function(e){return 0===i.filter((function(t){return t.attrID===e.attrID})).length})),t.Supers=[],r.props.updateSelectedType(t),setTimeout((function(){t.Supers=n,r.props.updateSelectedType(t),r.setState({browseAttributesSelected:"",browseTypesSelected:""})}),500)},r.removeSuper=function(e,t){for(var a=[],n=[],i=[t._id],s=r.props.selectedType,o=function(e){var o=r.props.types.filter((function(t){return t._id===s.Supers[e]._id}))[0];o._id===t._id||o.SuperIDs.includes(t._id)?i.push(o._id):(a.push(o),n.push(o._id))},l=0;l<s.Supers.length;l++)o(l);s.Supers=[],s.SuperIDs=[],r.props.updateSelectedType(s),r.setState({loaded:!1}),setTimeout((function(){s.Supers=a,s.SuperIDs=n,r.props.updateSelectedType(s),r.setState({loaded:!0})}),500)},r.redirectToNext=function(){var e=0;if(void 0===r.props.selectedType||null!==r.props.selectedType._id){for(;r.props.types[e]._id!==r.props.selectedType._id;)e++;e++}e===r.props.types.length&&(e=0),r.setState({waiting:!1,redirectTo:"/type/edit/".concat(r.props.types[e]._id)})},r.load=function(e){setTimeout((function(){r.setState({_id:e,redirectTo:null,loaded:!1,message:"Loading..."},r.finishLoading)}),500)},r.finishLoading=function(){var e=r.state._id;r.props.fromLogin?(r.props.notFromLogin(),r.setState({_id:e,loaded:!0,message:""})):r.props.selectedWorldID?r.api.getWorld(r.props.selectedWorldID).then((function(t){if(r.props.setAttributes(t.attributes),r.props.setTypes(t.types),r.props.setThings(t.things),null!==e){var a=t.types.filter((function(t){return t._id===e}));if(a.length>0){a=a[0];var n=r.props.types.filter((function(e){return a.SuperIDs.includes(e._id)}));a.Supers=n,r.props.updateSelectedType(a),r.setState({_id:e,loaded:!0,message:""})}else r.api.getWorld(r.props.selectedWorldID,!0).then((function(t){if(r.props.setAttributes(t.attributes),r.props.setTypes(t.types),r.props.setThings(t.things),null!==e){var a=t.types.filter((function(t){return t._id===e}));if(a.length>0){a=a[0];var n=r.props.types.filter((function(e){return a.SuperIDs.includes(e._id)}));a.Supers=n,r.props.updateSelectedType(a),r.setState({_id:e,loaded:!0,message:""})}else r.setState({message:"Invalid ID: ".concat(e),loaded:!0})}else r.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),r.setState({message:"",loaded:!0})}))}else r.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),r.setState({message:"",loaded:!0})})):r.api.getWorldByTypeID(e).then((function(t){if(r.props.selectWorld(t.worldID),r.props.setAttributes(t.attributes),r.props.setTypes(t.types),r.props.setThings(t.things),null!==e){var a=t.types.filter((function(t){return t._id===e}));if(a.length>0){a=a[0];var n=r.props.types.filter((function(e){return a.SuperIDs.includes(e._id)}));a.Supers=n,r.props.updateSelectedType(a),r.setState({_id:e,loaded:!0,message:""})}else r.api.getWorld(r.props.selectedWorldID,!0).then((function(t){if(r.props.setAttributes(t.attributes),r.props.setTypes(t.types),r.props.setThings(t.things),null!==e){var a=t.types.filter((function(t){return t._id===e}));if(a.length>0){a=a[0];var n=r.props.types.filter((function(e){return a.SuperIDs.includes(e._id)}));a.Supers=n,r.props.updateSelectedType(a),r.setState({_id:e,loaded:!0,message:""})}else r.setState({message:"Invalid ID: ".concat(e),loaded:!0})}else r.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),r.setState({message:"",loaded:!0})}))}else r.props.updateSelectedType({_id:null,Name:"",PluralName:"",Description:"",Supers:[],SuperIDs:[],AttributesArr:[],Attributes:[],Major:!1,DefaultsHash:{}}),r.setState({message:"",loaded:!0})}))},r.changeDefault=function(e){var t=r.props.selectedType;t.DefaultsHash[e.attrID]={attrID:e.attrID,DefaultValue:e.DefaultValue,DefaultListValues:e.DefaultListValues,FromTypeIDs:e.FromTypeIDs},r.props.updateSelectedType(t)},r.newAttribute=function(){var e=r.props.selectedType;e.AttributesArr.push({index:e.AttributesArr.length,attrID:"null_".concat(Aa()()),Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:""}),r.props.updateSelectedType(e)},r.changeAttribute=function(e){var t=r.props.selectedType;t.AttributesArr[e.index]={index:e.index,attrID:e.attrID,Name:e.Name,AttributeType:e.AttributeType,Options:e.Options,DefinedType:e.DefinedType,ListType:e.ListType},r.props.updateSelectedType(t)},r.deleteAttribute=function(e){var t=r.props.selectedType,a=[];t.AttributesArr.forEach((function(t){t.index!==e.index&&(t.index>e.index&&t.index--,a.push(t))})),t.AttributesArr=[];var n=Object(z.a)({},t.DefaultsHash);void 0!==n[e.attrID]&&delete n[e.attrID],t.DefaultsHash={},r.props.updateSelectedType(t),setTimeout((function(){t.AttributesArr=a,t.DefaultsHash=n,r.props.updateSelectedType(t)}),500)},r.renderAttributes=function(){return n.a.createElement(ja,{defaultsMode:r.state.defaultsMode,addNewType:function(e){r.setState({typeModalOpen:!0,putTypeOnAttribute:e})},addNewThing:function(e){r.setState({thingModalOpen:!0,newThingType:r.props.types.filter((function(t){return t._id===e.DefinedType}))[0],putThingOnAttribute:e})}})},r.state={_id:void 0,Major:!1,fieldValidation:{Name:{valid:!0,message:""},AttributesArr:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,addMore:"",resetting:!1,browseAttributes:!1,browseAttributesSelected:"",browseTypesSelected:"",newThingType:{}},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;if(void 0===t&&(t=null),this.state._id!==t)return this.load(t),n.a.createElement("span",null,"Loading...");if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user){if(null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length){if(null===this.props.selectedType||this.props.selectedType._id!==t)return n.a.createElement("span",null,this.state.message);if(this.state.typeModalOpen)return n.a.createElement(La,{types:this.props.types,selectedWorldID:this.props.selectedWorldID,onCancel:function(t){e.setState({typeModalOpen:!1})},addType:function(t){e.props.addType(t)},onSave:function(t){var a=e.props.selectedType;a.AttributesArr.filter((function(t){return t.attrID===e.state.putTypeOnAttribute.attrID}))[0].DefinedType=t._id,e.props.updateSelectedType(a),e.setState({typeModalOpen:!1})},api:this.api,logout:function(){e.props.logout()}});if(this.state.thingModalOpen)return n.a.createElement(Va,{things:this.props.things,newThingType:this.state.newThingType,selectedWorldID:this.props.selectedWorldID,onCancel:function(t){e.setState({thingModalOpen:!1})},addThing:function(t){e.props.addThing(t)},onSave:function(t){e.setState({thingModalOpen:!1},(function(a){var r=e.props.selectedType,n=r.AttributesArr.filter((function(t){return t.attrID===e.state.putThingOnAttribute.attrID}))[0],i=e.props.selectedType.DefaultsHash[n.attrID];void 0===i&&(i={attrID:n.attrID,DefaultValue:"",DefaultListValues:[]}),"Type"===n.AttributeType?i.DefaultValue=t._id:i.DefaultListValues.push(t._id),e.props.updateSelectedType(r)}))},api:this.api,logout:function(){e.props.logout()}});var a=void 0===this.props.types||null===this.state._id?this.props.types:this.props.types.filter((function(t){return t._id!==e.state._id})),r=[],i=[],s="";this.state.browseAttributes&&(Object.keys(this.props.attributesByID).forEach((function(t){var a=e.props.attributesByID[t];if(!a.TypeIDs.includes(e.props.selectedType._id)&&0===e.props.selectedType.AttributesArr.filter((function(e){return e.attrID===a._id})).length){for(var n=!1,i=0;i<e.props.selectedType.Supers.length;i++)if(a.TypeIDs.includes(e.props.selectedType.Supers[i]._id)){n=!0;break}n||r.push({_id:a._id,Name:a.Name})}})),""!==this.state.browseAttributesSelected&&(s=this.props.attributesByID[this.state.browseAttributesSelected].Name,i=this.props.types.filter((function(t){return e.props.attributesByID[e.state.browseAttributesSelected].TypeIDs.includes(t._id)}))));var o=[].concat(Object($.a)(this.props.typeSuggestions),Object($.a)(this.props.thingSuggestions));return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},null===this.props.selectedWorld?"":n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(Dt.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:1},n.a.createElement(ie.a,{title:"Back to ".concat(this.props.selectedWorld.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(ea.a,null)))),n.a.createElement(U.a,{item:!0,xs:7,sm:9},n.a.createElement("h2",null,null===this.state._id?"Create New Type":"Edit Type")),this.props.types.length>1&&n.a.createElement(U.a,{item:!0,xs:4,sm:2},n.a.createElement(g.a,null,n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(b.a,{primary:"Next Type"}))))),!this.state.resetting&&n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},this.state.loaded&&n.a.createElement(Ze,{Value:this.props.selectedType.Name,fieldName:"Name",message:this.state.fieldValidation.Name.message,onBlur:function(t){var a=e.props.selectedType;a.Name=t,e.props.updateSelectedType(a),e.validateForm()},labelWidth:43})),n.a.createElement(U.a,{item:!0},this.state.loaded&&n.a.createElement(Ze,{Value:this.props.selectedType.PluralName,fieldName:"PluralName",displayName:"Plural Name",onBlur:function(t){var a=e.props.selectedType;a.PluralName=t,e.props.updateSelectedType(a),e.validateForm()},labelWidth:85})),n.a.createElement(U.a,{item:!0},this.state.loaded&&n.a.createElement(Ze,{Value:this.props.selectedType.Description,fieldName:"Description",multiline:!0,onBlur:function(t){var a=e.props.selectedType;a.Description=t,e.props.updateSelectedType(a)},labelWidth:82,options:o})),n.a.createElement(U.a,{item:!0},n.a.createElement($t.a,{control:n.a.createElement(Lt.a,{checked:this.props.selectedType.Major,onChange:function(t){var a=t.target.checked,r=e.props.selectedType;r.Major=a,e.props.updateSelectedType(r)},name:"Major",color:"primary"}),label:"Major Type"})),n.a.createElement(U.a,{item:!0},n.a.createElement(Sa.Multiselect,{placeholder:"Super Types",options:a,selectedValues:this.props.selectedType.Supers,onSelect:this.addSuper,onRemove:this.removeSuper,displayValue:"Name"})),n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement("span",null,"Attributes\xa0",n.a.createElement(ie.a,{title:"Add New Attribute"},n.a.createElement("span",null,n.a.createElement(ne.a,{size:"small",color:"primary",disabled:this.state.defaultsMode,onClick:function(t){e.newAttribute()}},n.a.createElement(le.a,null)))),n.a.createElement(ie.a,{title:"Browse Additional Attributes"},n.a.createElement("span",null,n.a.createElement(ne.a,{size:"small",color:"primary",disabled:this.state.defaultsMode,onClick:function(t){e.setState({browseAttributes:!e.state.browseAttributes})}},n.a.createElement(oe.a,null)))))),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(t){e.setState({defaultsMode:!e.state.defaultsMode})}},this.state.defaultsMode?"Set Attribute Types":"Set Defaults"))),this.state.browseAttributes&&n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:6},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"browseForAttributes",id:"browseForAttributes-label"},"Browse Attributes"),n.a.createElement(ga.a,{labelId:"browseForAttributes-label",id:"browseForAttributes",value:this.state.browseAttributesSelected,onChange:function(t){e.setState({browseAttributesSelected:t.target.value})},fullWidth:!0,labelWidth:130},r.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e._id},e.Name)}))))),n.a.createElement(U.a,{item:!0,xs:12,sm:6},n.a.createElement(xe.a,{variant:"contained",color:"primary",disabled:""===this.state.browseAttributesSelected,onClick:function(t){e.addSelectedAttribute()},type:"submit"},"Add Attribute")),1===i.length?n.a.createElement(U.a,{style:{color:"red"},item:!0,xs:12,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12},"This Attribute is also found on the Type '",i[0].Name,"'.  You may want to add '",i[0].Name,"' as a Super Type instead of adding the Attribute."),n.a.createElement(U.a,{item:!0,xs:12,sm:6},n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(t){e.addBrowsedType(i[0]._id)},type:"submit"},"Add ",i[0].Name))):i.length>1&&n.a.createElement(U.a,{style:{color:"red"},item:!0,xs:12,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12},"This Attribute is also found on other Types.  You may want to add one as a Super Type instead of adding the Attribute."),n.a.createElement(U.a,{item:!0,xs:12,sm:6},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"browseTypesWithAttribute",id:"browseTypesWithAttribute-label"},"Browse Types with ",s),n.a.createElement(ga.a,{labelId:"browseTypesWithAttribute-label",id:"browseTypesWithAttribute",value:this.state.browseTypesSelected,onChange:function(t){e.setState({browseTypesSelected:t.target.value})},fullWidth:!0,labelWidth:140+9*s.length},i.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e._id},e.Name)}))))),n.a.createElement(U.a,{item:!0,xs:12,sm:6},n.a.createElement(xe.a,{variant:"contained",color:"primary",disabled:""===this.state.browseTypesSelected,onClick:function(t){e.addBrowsedType(e.state.browseTypesSelected)},type:"submit"},"Add Type")))),n.a.createElement(U.a,{item:!0},this.state.loaded&&this.renderAttributes()),n.a.createElement(U.a,{item:!0},Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))),this.props.types.length>0?n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("next")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Edit Next")),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("add")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Create Another")),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("")},type:"submit"},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(xe.a,{variant:"contained",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){null===e.props.selectedType._id?e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)}):e.setState({redirectTo:"/type/details/".concat(e.props.selectedType._id)})},type:"button"},"Cancel"))):n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("add")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Create Another")),n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("")},type:"submit"},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(xe.a,{variant:"contained",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){null===e.props.selectedType._id?e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)}):e.setState({redirectTo:"/type/details/".concat(e.props.selectedType._id)})},type:"button"},"Cancel"))),n.a.createElement(U.a,{item:!0,style:{color:"red"}},this.state.message))))}return n.a.createElement(he.a,{to:"/"})}return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")}}]),a}(r.Component),Fa=Object(d.b)((function(e){return{selectedPage:e.app.selectedPage,selectedType:e.app.selectedType,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,types:e.app.types,things:e.app.things,user:e.app.user,attributesByID:e.app.attributesByID,attributesByName:e.app.attributesByName,fromLogin:e.app.fromLogin,typeSuggestions:e.app.typeSuggestions,thingSuggestions:e.app.thingSuggestions}}),(function(e){return{updateSelectedType:function(t){return e(L(t))},addType:function(t){return e(k(t))},updateType:function(t){return e(j(t))},addAttributes:function(t){return e({type:"ADD_ATTRIBUTES",payload:t})},setAttributes:function(t){return e(x(t))},setTypes:function(t){return e(W(t))},setThings:function(t){return e(C(t))},notFromLogin:function(){return e(M({}))},addThing:function(t){return e(_(t))},toggleLogin:function(){return e(B({}))},logout:function(){return e(E({}))},selectWorld:function(t){return e(O(t))}}}))(Pa),Ba=a(17),Ma=a(421),Ra=a(422),Ua=a(419),Ha=a(420),za=a(417),Ja=a(431),Ga=a(418),Ya=a(430),qa=a(203),Ka=[];function Qa(e,t,a){return t[a]<e[a]?-1:t[a]>e[a]?1:0}function Xa(e){var t=e.classes,a=e.order,r=e.orderBy,i=e.onRequestSort,s=e.columnMap;return n.a.createElement(za.a,null,n.a.createElement(Ga.a,null,s.map((function(e){return n.a.createElement(Ua.a,{key:e.id,align:e.numeric?"right":"left",padding:e.disablePadding?"none":"default",sortDirection:r===e.id&&a},n.a.createElement(Ya.a,{active:r===e.id,direction:r===e.id?a:"asc",onClick:(s=e.id,function(e){i(e,s)})},e.label,r===e.id?n.a.createElement("span",{className:t.visuallyHidden},"desc"===a?"sorted descending":"sorted ascending"):null));var s}))))}var Za=Object(ge.a)((function(e){return{root:{paddingLeft:e.spacing(2),paddingRight:e.spacing(1)},highlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:Object(Ba.e)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},title:{flex:"1 1 100%"}}})),$a=function(e){var t=Za(),a=e.label;return n.a.createElement(f.a,null,n.a.createElement(Te.a,{className:t.title,variant:"h6",id:"tableTitle",component:"div"},a))},er=Object(ge.a)((function(e){return{root:{width:"100%"},paper:{width:"100%",marginBottom:e.spacing(2)},table:{},visuallyHidden:{border:0,clip:"rect(0 0 0 0)",height:1,margin:-1,overflow:"hidden",padding:0,position:"absolute",top:20,width:1}}}));function tr(e){var t=[{id:"Name",numeric:!1,disablePadding:!0,label:"Name"},{id:"Description",numeric:!1,disablePadding:!0,label:"Description"}];Ka=[],e.things.forEach((function(a){var r={_id:a._id,Name:a.Name,Description:a.Description};a.Attributes.forEach((function(a){var n=e.attributesByID[a.attrID];if("Type"===n.AttributeType){var i=e.allThings.filter((function(e){return e._id===a.Value}));i.length>0&&(i=i[0],r[a.attrID]=i.Name)}else"List"===n.AttributeType?(r[a.attrID]="","Type"===n.ListType?a.ListValues.forEach((function(t){var n=e.allThings.filter((function(e){return e._id===t}));n.length>0&&(n=n[0],r[a.attrID]+=(r[a.attrID].length>0?", ":"")+n.Name)})):a.ListValues.forEach((function(e){r[a.attrID]+=(r[a.attrID].length>0?", ":"")+e}))):r[a.attrID]=a.Value;0===t.filter((function(e){return e.id===a.attrID})).length&&t.push({id:n._id,numeric:"Number"===n.Type,disablePadding:!0,label:n.Name})})),Ka.push(r)}));var a=er(),r=n.a.useState("asc"),i=Object(Oe.a)(r,2),s=i[0],o=i[1],l=n.a.useState("Name"),c=Object(Oe.a)(l,2),u=c[0],p=c[1],d=n.a.useState([]),m=Object(Oe.a)(d,2),f=m[0],h=m[1],g=n.a.useState(0),y=Object(Oe.a)(g,2),v=y[0],T=y[1],E=n.a.useState(5),D=Object(Oe.a)(E,2),w=D[0],I=D[1];return n.a.createElement("div",{className:a.root},n.a.createElement(H.a,{display:{xs:"none",sm:"block"}},n.a.createElement(qa.a,{className:a.paper},n.a.createElement($a,{label:e.label}),n.a.createElement(Ha.a,null,n.a.createElement(Ma.a,{className:a.table,"aria-labelledby":"tableTitle",size:"small","aria-label":"enhanced table"},n.a.createElement(Xa,{classes:a,numSelected:f.length,order:s,orderBy:u,onSelectAllClick:function(e){if(e.target.checked){var t=Ka.map((function(e){return e.name}));h(t)}else h([])},onRequestSort:function(e,t){o(u===t&&"asc"===s?"desc":"asc"),p(t)},rowCount:Ka.length,columnMap:t}),n.a.createElement(Ra.a,null,function(e,t){var a=e.map((function(e,t){return[e,t]}));return a.sort((function(e,a){var r=t(e[0],a[0]);return 0!==r?r:e[1]-a[1]})),a.map((function(e){return e[0]}))}(Ka,function(e,t){return"desc"===e?function(e,a){return Qa(e,a,t)}:function(e,a){return-Qa(e,a,t)}}(s,u)).slice(v*w,v*w+w).map((function(a,r){var i,s=(i=a.name,-1!==f.indexOf(i));return n.a.createElement(Ga.a,{hover:!0,role:"checkbox","aria-checked":s,tabIndex:-1,key:r,selected:s},t.map((function(t,r){return n.a.createElement(Ua.a,{key:r},"Name"===t.id?n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(t){e.buttonClick(a._id)}},n.a.createElement(b.a,{primary:a.Name})):n.a.createElement("span",null,a[t.id]))})))}))))),Ka.length>5&&n.a.createElement(Ja.a,{rowsPerPageOptions:[5,10,25],component:"div",count:Ka.length,rowsPerPage:w,page:v,onChangePage:function(e,t){T(t)},onChangeRowsPerPage:function(e){I(parseInt(e.target.value,10)),T(0)}}))),n.a.createElement(H.a,{display:{xs:"block",sm:"none"}},e.label,":",e.things.map((function(t,a){return n.a.createElement(xe.a,{key:a,style:{marginLeft:"4px"},variant:"contained",color:"primary",onClick:function(a){e.buttonClick(t._id)}},n.a.createElement(b.a,{primary:t.Name}))}))))}var ar=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).getModalStyle=function(){var e=Math.round(window.innerHeight/2)-50,t=Math.round(window.innerWidth/2)-200;return{top:"".concat(e,"%"),left:"".concat(t,"%"),transform:"translate(".concat(t,"px, ").concat(e,"px)")}},r.delete=function(e){r.setState({waiting:!0},r.finishDelete)},r.finishDelete=function(e){r.api.deleteThing(r.props.selectedWorldID,r.state._id).then((function(e){void 0===e.error?r.api.getWorld(r.props.selectedWorldID,!0).then((function(e){r.props.setAttributes(e.attributes),r.props.setTypes(e.types),r.props.setThings(e.things),r.setState({waiting:!1,redirectTo:"/project/details/".concat(r.props.selectedWorldID)})})):r.setState({waiting:!1,message:e.error},(function(){r.props.logout()}))}))},r.redirectToNext=function(){for(var e=null===r.state.majorType?r.props.things:r.props.things.filter((function(e){return e.TypeIDs.includes(r.state.majorType._id)})),t=0;e[t]._id!==r.props.selectedThing._id;)t++;++t===e.length&&(t=0),r.setState({waiting:!1,redirectTo:"/thing/details/".concat(e[t]._id)})},r.load=function(e){setTimeout((function(){r.setState({_id:e,redirectTo:null,loaded:!1},r.finishLoading)}),500)},r.finishLoading=function(){r.props.fromLogin&&r.props.notFromLogin();var e=r.state._id;r.props.selectedWorldID?r.api.getWorld(r.props.selectedWorldID).then((function(t){if(r.props.setAttributes(t.attributes),r.props.setTypes(t.types),r.props.setThings(t.things),void 0!==e){var a=t.things.filter((function(t){return t._id===e}));if(0===a.length)r.setState({message:"Invalid Thing ID",loaded:!0});else if((a=a[0]).AttributesArr=[],console.log(a),a.Attributes.forEach((function(e){console.log(e);var t=r.props.attributesByID[e.attrID];console.log(t),a.AttributesArr.push({index:a.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,TypeIDs:t.TypeIDs})})),r.props.updateSelectedThing(a),null===r.state.majorType){var n=a.Types.filter((function(e){return e.Major}));n.length>0?(n=n[0],r.setState({Name:a.Name,Description:a.Description,_id:e,Types:a.Types,majorType:n,loaded:!0})):r.setState({Name:a.Name,Description:a.Description,_id:e,Types:a.Types,loaded:!0})}else r.setState({Name:a.Name,Description:a.Description,_id:e,Types:a.Types,loaded:!0})}else r.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:[],Attributes:[],AttributesArr:[]}),r.setState({loaded:!0})})):r.api.getWorldByThingID(e).then((function(t){if(r.props.selectWorld(t.worldID),r.props.setAttributes(t.attributes),r.props.setTypes(t.types),r.props.setThings(t.things),void 0!==e){var a=t.things.filter((function(t){return t._id===e}));if(0===a.length)r.setState({message:"Invalid Thing ID",loaded:!0});else if((a=a[0]).AttributesArr=[],a.Attributes.forEach((function(e){var t=r.props.attributesByID[e.attrID];a.AttributesArr.push({index:a.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,TypeIDs:t.TypeIDs})})),r.props.updateSelectedThing(a),null===r.state.majorType){var n=a.Types.filter((function(e){return e.Major}));n.length>0?(n=n[0],r.setState({Name:a.Name,Description:a.Description,_id:e,Types:a.Types,majorType:n,loaded:!0})):r.setState({Name:a.Name,Description:a.Description,_id:e,Types:a.Types,loaded:!0})}else r.setState({Name:a.Name,Description:a.Description,_id:e,Types:a.Types,loaded:!0})}else r.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:[],Attributes:[],AttributesArr:[]}),r.setState({loaded:!0})}))},r.state={_id:null,Name:"",Description:"",Types:[],AttributesArr:[],fieldValidation:{Name:{valid:!0,message:""},AttributesArr:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,modalOpen:!1,majorType:null},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;if(this.state._id!==t)return this.load(t),n.a.createElement("span",null,"Loading");if(this.state.loaded){if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user){if(null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type})).length){var a=this.props.things.filter((function(t){return void 0!==t.ReferenceIDs&&t.ReferenceIDs.includes(e.state._id)})),r=[].concat(Object($.a)(this.props.typeSuggestions),Object($.a)(this.props.thingSuggestions));return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},null===this.props.selectedWorld?"":n.a.createElement("div",null,n.a.createElement(Dt.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:8,container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:1},n.a.createElement(ie.a,{title:"Back to ".concat(this.props.selectedWorld.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(ea.a,null)))),n.a.createElement(U.a,{item:!0,xs:11},n.a.createElement("h2",null,this.state.Name))),n.a.createElement(U.a,{item:!0},n.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.Description}}))),n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(re.a,null,null!==this.props.user&&null!==this.props.selectedWorld&&(this.props.selectedWorld.Owner===this.props.user._id||this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length>0)&&n.a.createElement(g.a,null,n.a.createElement(H.a,{display:{xs:"block",sm:"none"},width:1},n.a.createElement(U.a,{container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:3},"\xa0"),n.a.createElement(U.a,{item:!0,xs:4},n.a.createElement(ie.a,{title:"Edit ".concat(this.state.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/thing/edit/".concat(e.state._id)})}},n.a.createElement(At.a,null)))),n.a.createElement(U.a,{item:!0,xs:5},n.a.createElement(ie.a,{title:"Delete ".concat(this.state.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({modalOpen:!0})}},n.a.createElement(_t.a,null)))))),n.a.createElement(H.a,{display:{xs:"none",sm:"block"}},n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(ie.a,{title:"Edit ".concat(this.state.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/thing/edit/".concat(e.state._id)})}},n.a.createElement(At.a,null)))),n.a.createElement(U.a,{item:!0},n.a.createElement(ie.a,{title:"Delete ".concat(this.state.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({modalOpen:!0})}},n.a.createElement(_t.a,null))))))),n.a.createElement(g.a,null,null===this.state.majorType?n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(b.a,{primary:"Next"})):n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(b.a,{primary:"Next ".concat(this.state.majorType.Name)})))))),n.a.createElement(U.a,{item:!0,container:!0,spacing:0,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:8},"Attributes",n.a.createElement(re.a,null,null!==this.props.selectedThing&&void 0!==this.props.selectedThing&&this.props.selectedThing.AttributesArr.map((function(t,a){return n.a.createElement(g.a,{key:a},"Type"===t.AttributeType&&""!==t.Value?n.a.createElement(tr,{attributesByID:e.props.attributesByID,label:t.Name,things:e.props.things.filter((function(e){return e._id===t.Value})),allThings:e.props.things}):"List"===t.AttributeType&&"Type"===t.ListType?n.a.createElement(tr,{attributesByID:e.props.attributesByID,label:t.Name,things:e.props.things.filter((function(e){return t.ListValues.includes(e._id)})),allThings:e.props.things,buttonClick:function(t){e.setState({redirectTo:"/thing/details/".concat(t)})}}):"List"===t.AttributeType?n.a.createElement("span",null,t.Name,":\xa0",t.ListValues.map((function(e,t){return n.a.createElement("span",{key:t},t>0?", ".concat(e):"".concat(e))}))):n.a.createElement("span",null,t.Name,":\xa0",t.Value))})))),n.a.createElement(U.a,{item:!0,xs:12,sm:4,container:!0,spacing:0,direction:"column"},this.state.Types.length>0&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,null,n.a.createElement(b.a,{primary:"Types"})),this.state.Types.map((function(t,a){return n.a.createElement(g.a,{key:a},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},n.a.createElement(b.a,{primary:t.Name})))})))),a.length>0&&n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,null,n.a.createElement(b.a,{primary:"Referenced in:"})),a.map((function(t,a){return n.a.createElement(g.a,{key:a},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/thing/details/".concat(t._id)})}},n.a.createElement(b.a,{primary:t.Name})))})))))),null!==this.props.selectedThing&&n.a.createElement(U.a,{item:!0,xs:12},n.a.createElement(nt,{user:this.props.user,allUsers:this.props.allUsers,object:this.props.selectedThing,objectType:"Thing",world:this.props.selectedWorld,api:this.api,onChange:this.commentsChange,suggestions:r})),n.a.createElement(jt.a,{"aria-labelledby":"delete-thing-modal","aria-describedby":"delete-thing-modal-description",open:this.state.modalOpen,onClose:function(t){e.setState({modalOpen:!1})}},n.a.createElement("div",{style:this.getModalStyle(),className:"paper"},n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Are you sure you want to delete ",this.state.Name,"?"),n.a.createElement(U.a,{item:!0},"(All references to it will be left alone and may not work correctly)"),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:this.delete},"Yes")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({modalOpen:!1})}},"Cancel"))))))))}return n.a.createElement(he.a,{to:"/"})}return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")}return n.a.createElement("span",null,"Loading")}}]),a}(r.Component),rr=Object(d.b)((function(e){var t=e.app.selectedThing;return{selectedPage:e.app.selectedPage,selectedThing:t,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,types:e.app.types,things:e.app.things,user:e.app.user,attributesByID:e.app.attributesByID,fromLogin:e.app.fromLogin,allUsers:e.app.allUsers,typeSuggestions:e.app.typeSuggestions,thingSuggestions:e.app.thingSuggestions}}),(function(e){return{updateSelectedThing:function(t){return e(P(t))},addThing:function(t){return e(_(t))},updateThing:function(t){return e(V(t))},setAttributes:function(t){return e(x(t))},setTypes:function(t){return e(W(t))},setThings:function(t){return e(C(t))},setAllUsers:function(t){return e(I(t))},notFromLogin:function(){return e(M({}))},toggleLogin:function(){return e(B({}))},logout:function(){return e(E({}))},selectWorld:function(t){return e(O(t))}}}))(ar),nr=a(199),ir=a.n(nr);function sr(e){var t=Object(r.useState)(e.attribute.Value),a=Object(Oe.a)(t,2),i=a[0],s=a[1],o=""===e.attribute.AttributeType?"Text":e.attribute.AttributeType,l=[],c=[];if("List"===o&&"Options"===e.attribute.ListType)e.attribute.Options.forEach((function(e){l.push({Name:e})})),e.attribute.ListValues.forEach((function(e){c.push({Name:e})}));else if("List"===o&&"Type"===e.attribute.ListType){var u=e.types.filter((function(t){return t._id===e.attribute.DefinedType}))[0];void 0!==u&&(l.push({Name:"+ Create New ".concat(u.Name),_id:"new"}),e.things.filter((function(t){return t.TypeIDs.includes(e.attribute.DefinedType)})).forEach((function(e){l.push({Name:e.Name,_id:e._id})})),l.filter((function(t){return e.attribute.ListValues.includes(t._id)})).forEach((function(e){c.push(e)})))}return n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:11},"Text"===o?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"attribute_name_".concat(e.attribute.attrID)},e.attribute.Name),n.a.createElement(ae.a,{id:"attribute_name_".concat(e.attribute.attrID),name:"attribute_name_".concat(e.attribute.attrID),type:"text",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a={index:e.attribute.index,attrID:e.attribute.attrID,Name:e.attribute.Name,AttributeType:e.attribute.AttributeType,Options:e.attribute.Options,DefinedType:e.attribute.DefinedType,ListType:e.attribute.ListType,FromTypes:e.attribute.FromTypes,Value:i,ListValues:e.attribute.ListValues};e.onChange(a)},labelWidth:9*e.attribute.Name.length,fullWidth:!0,multiline:!0}),n.a.createElement(Pe.a,null,e.message)):"Number"===o?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"numField"},e.attribute.Name),n.a.createElement(ae.a,{id:"numField",name:"numField",type:"number",error:e.error,value:i,autoComplete:"off",onChange:function(e){s(e.target.value)},onBlur:function(t){var a={index:e.attribute.index,attrID:e.attribute.attrID,Name:e.attribute.Name,AttributeType:e.attribute.AttributeType,Options:e.attribute.Options,DefinedType:e.attribute.DefinedType,ListType:e.attribute.ListType,FromTypes:e.attribute.FromTypes,Value:i,ListValues:e.attribute.ListValues};e.onChange(a)},labelWidth:9*e.attribute.Name.length,fullWidth:!0}),n.a.createElement(Pe.a,null,e.message)):"True/False"===o?n.a.createElement($t.a,{control:n.a.createElement(Lt.a,{checked:"True"===e.attribute.Value,onChange:function(t){var a=e.attribute;a.Value=t.target.checked?"True":"False",e.onChange(a)},color:"primary"}),label:e.attribute.Name}):"Options"===o?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"options-select",id:"options-select-label"},e.attribute.Name),n.a.createElement(ga.a,{labelId:"options-select-label",id:"options-select",value:i,onChange:function(e){s(e.target.value)},onBlur:function(t){var a={index:e.attribute.index,attrID:e.attribute.attrID,Name:e.attribute.Name,AttributeType:e.attribute.AttributeType,Options:e.attribute.Options,DefinedType:e.attribute.DefinedType,ListType:e.attribute.ListType,FromTypes:e.attribute.FromTypes,Value:i,ListValues:e.attribute.ListValues};e.onChange(a)},fullWidth:!0,labelWidth:9*e.attribute.Name.length},e.attribute.Options.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e},e)})))):"Type"===o?n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"type-select",id:"type-select-label"},e.attribute.Name),n.a.createElement(ga.a,{labelId:"type-select-label",id:"type-select",value:i,onChange:function(t){!function(e,t,a){if("new"===e.target.value){var r=t.attribute;t.onNewThing(r)}else a(e.target.value)}(t,e,s)},onBlur:function(t){var a={index:e.attribute.index,attrID:e.attribute.attrID,Name:e.attribute.Name,AttributeType:e.attribute.AttributeType,Options:e.attribute.Options,DefinedType:e.attribute.DefinedType,ListType:e.attribute.ListType,FromTypes:e.attribute.FromTypes,Value:i,ListValues:e.attribute.ListValues};e.onChange(a)},fullWidth:!0,labelWidth:9*e.attribute.Name.length},n.a.createElement(dt.a,{value:"new"},"+ Create New"," ",e.types.filter((function(t){return t._id===e.attribute.DefinedType}))[0].Name),e.things.filter((function(t){return t.TypeIDs.includes(e.attribute.DefinedType)})).map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e._id},e.Name)})))):"List"===o?n.a.createElement("span",null,"Text"===e.attribute.ListType?n.a.createElement(Oa.a,{placeholder:e.attribute.Name,variant:"outlined",fullWidth:!0,defaultValue:e.attribute.ListValues,onChange:function(t){return function(e,t){var a=t.attribute;a.ListValues=e,t.onChange(a)}(t,e)},blurBehavior:"add"}):"Options"===e.attribute.ListType?n.a.createElement(Sa.Multiselect,{placeholder:e.attribute.Name,options:l,selectedValues:c,onSelect:function(t,a){!function(e,t){var a=t.attribute;a.ListValues.push(e.Name),t.onChange(a)}(a,e)},onRemove:function(t,a){!function(e,t){var a=t.attribute;a.ListValues=[],e.forEach((function(e){a.ListValues.push(e.Name)})),t.onChange(a)}(t,e)},displayValue:"Name"}):"Type"===e.attribute.ListType?n.a.createElement(Sa.Multiselect,{placeholder:e.attribute.Name,options:l,selectedValues:c,onSelect:function(t,a){!function(e,t){if("new"===e._id){var a=t.attribute;t.onNewThing(a)}else{var r=t.attribute;r.ListValues.push(e._id),t.onChange(r)}}(a,e)},onRemove:function(t,a){!function(e,t){var a=t.attribute;a.ListValues=[],e.forEach((function(e){a.ListValues.push(e._id)})),t.onChange(a)}(t,e)},displayValue:"Name"}):""):""),n.a.createElement(U.a,{item:!0,xs:1},n.a.createElement(ir.a,{style:{cursor:"pointer"},onClick:function(t){e.infoModal(e.attribute)}})))}var or=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).newAttribute=function(){var e=r.props.selectedThing;e.AttributesArr.push({index:e.AttributesArr.length,_id:null,Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:"Text",FromTypes:[],Value:"",ListValues:[],FromTypeIDs:[],TypeIDs:[]}),r.props.updateSelectedThing(e)},r.changeAttribute=function(e){var t=r.props.selectedThing,a=t.AttributesArr.filter((function(t){return t.attrID===e.attrID}))[0];a.Value=e.Value,a.ListValues=e.ListValues,r.props.updateSelectedThing(t)},r.blurAttribute=function(e){},r.deleteAttribute=function(e){var t=r.props.selectedThing;t.AttributesArr.splice(e.index,1),t.AttributesArr.forEach((function(e){e.index>r.state.infoAttribute.index&&e.index--})),r.props.updateSelectedThing(t)},r.optionsChange=function(e,t){},r.addNewThing=function(e){r.props.addNewThing(e)},r.infoModal=function(e){r.props.onInfo(e)},r.getModalStyle=function(){var e=Math.round(window.innerHeight/2)-100,t=Math.round(window.innerWidth/2)-200;return{top:"".concat(e,"%"),left:"".concat(t,"%"),transform:"translate(".concat(t,"px, ").concat(e,"px)")}},r.handleUserInput=function(e){var t=e.target.name,a="checkbox"===e.target.type?e.target.checked:e.target.value;r.setState(Object(Z.a)({},t,a))},r.inputBlur=function(e){var t=e.target.name,a=r.validateField(t),n=r.state.fieldValidation;void 0!==n[t]&&n[t].valid!==a.valid&&(n[t].valid=a.valid,n[t].message=a.message,r.setState({fieldValidation:n}))},r.validateField=function(e){var t=null,a=!0,n="";switch(e){case"Name":(a=null!==(t=r.state[e]).match(/^[a-zA-Z0-9 ]*$/i))?t.length<2?(a=!1,n="Thing Name is too short"):(a=0===r.props.things.filter((function(e){return e.Name===t&&e._id!==r.state._id})).length)||(n="This Thing Name is already in use"):n="Only Letters, Numbers, and Spaces allowed in Thing Names"}return{valid:a,message:n}},r.validateForm=function(e){var t=r.validateField("Name"),a=t.valid,n=r.state.fieldValidation;n.Name=t,r.setState({formValid:a,fieldValidation:n},e)},r.saveNewThing=function(){r.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},r.submitThroughAPI=function(){var e=r.props.types.filter((function(e){return e._id===r.state.newThingType._id||r.state.newThingType.SuperIDs.includes(e._id)})),t=e.map((function(e){return e._id})),a={_id:r.state._id,Name:r.state.Name.trim(),Description:"",TypeIDs:t,Attributes:[],worldID:r.props.selectedWorldID};r.api.createThing(a).then((function(t){void 0!==t.thingID?(a._id=t.thingID,a.Types=e,a.AttributesArr=[],r.props.addThing(a),r.state.modalSubmit(a),r.setState({waiting:!1,modalOpen:!1})):void 0!==t.error&&r.setState({waiting:!1,message:t.error},(function(){r.props.logout()}))})).catch((function(e){return console.log(e)}))},r.state={modalOpen:!1,infoModalOpen:!1,Name:"",fieldValidation:{Name:{valid:!0,message:""}},formValid:!1,message:"",waiting:!1,newThingType:null},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},null!==this.props.selectedThing&&void 0!==this.props.selectedThing&&this.props.selectedThing.AttributesArr.map((function(t,a){return n.a.createElement(sr,{key:a,thingID:e.props.selectedThing._id,attribute:t,onChange:e.changeAttribute,onDelete:e.deleteAttribute,onBlur:e.blurAttribute,things:e.props.things,types:e.props.types,onNewThing:e.addNewThing,infoModal:e.infoModal})})),n.a.createElement(jt.a,{"aria-labelledby":"new-thing-modal","aria-describedby":"new-thing-modal-description",open:this.state.modalOpen,onClose:function(t){e.setState({modalOpen:!1})}},n.a.createElement("div",{style:this.getModalStyle(),className:"paper"},n.a.createElement(U.a,{container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},"Just give the new ",null===this.state.newThingType?"":this.state.newThingType.Name," a name."),n.a.createElement(U.a,{item:!0},"(You can do the rest later.)"),n.a.createElement(U.a,{item:!0},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"name"},"Name"),n.a.createElement(ae.a,{id:"name",name:"Name",type:"text",autoComplete:"Off",error:!this.state.fieldValidation.Name.valid,value:this.state.Name,onChange:this.handleUserInput,onBlur:this.inputBlur,labelWidth:43,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.Name.message))),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.saveNewThing},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({modalOpen:!1})}},"Cancel")))))))}}]),a}(r.Component),lr=Object(d.b)((function(e){return{selectedThing:e.app.selectedThing,things:e.app.things,types:e.app.types,selectedWorldID:e.app.selectedWorldID}}),(function(e){return{updateSelectedThing:function(t){return e(P(t))},addThing:function(t){return e(_(t))},logout:function(){return e(E({}))}}}))(or);var cr=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).createThingFromType=function(e){var t=[];t.push(e),e.Supers.forEach((function(e){if(0===t.filter((function(t){return t._id===e._id})).length){var a=n.props.types.filter((function(t){return t._id===e._id}));a.length>0&&t.push(a[0])}}));var a={_id:null,Name:"",Description:"",Types:[],Attributes:[]},r=[];t.forEach((function(e){for(var t=function(t){var n=Object(z.a)({},e.Attributes[t]),i=a.Attributes.filter((function(e){return e.attrID===n.attrID}));0===i.length?(n.FromTypeIDs=[e._id],n.index=e.Attributes.length+r.length,r.push(n)):(void 0!==(i=i[0]).FromTypeIDs&&null!==i.FromTypeIDs||(i.FromTypeIDs=[]),i.FromTypeIDs.push(e._id))},n=0;n<e.Attributes.length;n++)t(n)})),t.forEach((function(e){r.forEach((function(t){void 0===e.DefaultsHash[t.attrID]||void 0===e.DefaultsHash[t.attrID].DefaultValue?(t.Value="",t.ListValues=[]):(t.Value=e.DefaultsHash[t.attrID].DefaultValue,t.ListValues=e.DefaultsHash[t.attrID].DefaultListValues)}))}));var i=[].concat(Object($.a)(a.Attributes),r);a.Attributes=i,a.AttributesArr=[],a.Attributes.forEach((function(e){var t=n.props.attributesByID[e.attrID];a.AttributesArr.push({index:a.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:t.TypeIDs})})),a.Types=t,n.props.updateSelectedThing(a),n.setState({_id:null,loaded:!0,majorType:e})},n.resetForm=function(){setTimeout((function(){var e=n.props.match.params.id;void 0===e||e.includes("type_id_")?n.setState({resetting:!1},n.finishResettingForm):null===n.state.majorType?n.setState({resetting:!1,redirectTo:"/thing/create"}):n.setState({resetting:!1,redirectTo:"/thing/create/type_id_".concat(n.state.majorType._id)})}),500)},n.finishResettingForm=function(){var e=n.props.match.params.id;if(void 0!==e&&e.includes("type_id_")){var t=e.substring(8),a=n.props.types.filter((function(e){return e._id===t}));a.length>0?(a=a[0],n.createThingFromType(a)):n.setState({message:"Invalid Type"})}},n.handleInfoAttrNameChange=function(e){var t=n.state.infoAttribute;t.Name=e.target.value,n.setState({infoAttribute:t})},n.inputBlur=function(e){var t=e.target.name,a=n.validateField(t),r=n.state.fieldValidation;void 0===r[t]||r[t].valid===a.valid&&r[t].message===a.message||(r[t].valid=a.valid,r[t].message=a.message,n.setState({fieldValidation:r}))},n.inputBlur2=function(e){var t="infoAttributeName",a=n.validateField(t),r=n.state.fieldValidation;void 0===r[t]||r[t].valid===a.valid&&r[t].message===a.message||(r[t].valid=a.valid,r[t].message=a.message,n.setState({fieldValidation:r}))},n.addSelectedAttribute=function(){var e=n.props.selectedThing,t=n.props.attributesByID[n.state.browseAttributesSelected],a=e.Attributes,r=e.AttributesArr;a.push({attrID:n.state.browseAttributesSelected,Value:"",ListValues:[],index:a.length,FromTypeIDs:[]}),r.push({attrID:n.state.browseAttributesSelected,index:r.length,Value:"",ListValues:[],Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,FromTypeIDs:[],TypeIDs:t.TypeIDs}),e.Attributes=[],e.AttributesArr=[],n.props.updateSelectedThing(e),setTimeout((function(){e.Attributes=a,e.AttributesArr=r,n.props.updateSelectedThing(e),n.setState({browseAttributesSelected:""})}),500)},n.validateField=function(e){var t=null,a=!0,r="";switch(e){case"Name":t=n.props.selectedThing[e].trim(),(a=null!==t.match(/^[a-zA-Z0-9 ]*$/i))?t.length<2?(a=!1,r="Thing Name is too short"):(a=0===n.props.things.filter((function(e){return e.Name===t&&e._id!==n.state._id})).length)||(r="This Thing Name is already in use"):r="Only Letters, Numbers, and Spaces allowed in Thing Names";break;case"infoAttributeName":if(t=n.state.infoAttribute.Name.trim(),a=null!==t.match(/^[a-zA-Z0-9 ]*$/i))if(t.length<2)a=!1,r="Attribute Name is too short";else{var i=n.props.attributesByName[t];(a=void 0===i||i._id===n.state.infoAttribute.attrID)||(r="There is another Attribute with this name.")}else r="Only Letters, Numbers, and Spaces allowed in Attribute Names";break;case"AttributesArr":a=!0,(t=n.props.selectedThing[e]).forEach((function(e){a&&t.filter((function(t){return t.Name===e.Name})).length>1&&(a=!1)})),r=a?"":"Attribute Names must be unique"}return{valid:a,message:r}},n.validateForm=function(e){var t=n.validateField("Name"),a=n.validateField("AttributesArr"),r=t.valid&&a.valid,i=n.state.fieldValidation;i.Name=t,i.Attributes=a,n.setState({formValid:r,fieldValidation:i},e)},n.validateAttrForm=function(e){var t=n.validateField("infoAttributeName"),a=n.state.fieldValidation;a.infoAttributeName=t,n.setState({fieldValidation:a},e)},n.onSubmit=function(e){n.validateForm((function(){this.state.formValid&&this.setState({waiting:!0,addMore:e},this.submitThroughAPI)}))},n.submitThroughAPI=function(){var e=n.props.selectedThing.Types.map((function(e){return e._id})),t={_id:n.state._id,Name:n.props.selectedThing.Name.trim(),Description:n.props.selectedThing.Description.trim(),TypeIDs:e,Attributes:[],worldID:n.props.selectedWorld._id,ReferenceIDs:[]};n.props.selectedThing.AttributesArr.forEach((function(e){t.Attributes.push({attrID:e.attrID,index:e.index,Value:e.Value.trim(),ListValues:e.ListValues}),"Type"===e.AttributeType&&(t.ReferenceIDs.includes(e.Value)||t.ReferenceIDs.push(e.Value)),"List"===e.AttributeType&&"Type"===e.ListType&&e.ListValues.forEach((function(e){t.ReferenceIDs.includes(e)||t.ReferenceIDs.push(e)}))})),null===t._id?n.api.createThing(t).then((function(e){void 0===e.error?n.api.getWorld(n.props.selectedWorldID,!0).then((function(e){n.props.setAttributes(e.attributes),n.props.setTypes(e.types),n.props.setThings(e.things),"add"===n.state.addMore?(n.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:null===n.state.majorType?[]:[n.state.majorType],Attributes:[],AttributesArr:[]}),n.setState({_id:null,fieldValidation:{Name:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",waiting:!1,resetting:!0},n.resetForm)):"next"===n.state.addMore?n.redirectToNext():n.setState({waiting:!1,redirectTo:"/project/details/".concat(n.props.selectedWorld._id)})})):n.setState({message:e.error},(function(){n.props.logout()}))})).catch((function(e){return console.log(e)})):n.api.updateThing(t).then((function(e){void 0===e.error?n.api.getWorld(n.props.selectedWorldID,!0).then((function(e){n.props.setAttributes(e.attributes),n.props.setTypes(e.types),n.props.setThings(e.things),"add"===n.state.addMore?(n.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:null===n.state.majorType?[]:[n.state.majorType],Attributes:[],AttributesArr:[]}),n.setState({fieldValidation:{Name:{valid:!0,message:""},Attributes:{valid:!0,message:""}},formValid:!1,message:"",waiting:!1,addMore:!1,resetting:!0},n.resetForm)):"next"===n.state.addMore?n.redirectToNext():n.setState({waiting:!1,redirectTo:"/project/details/".concat(n.props.selectedWorld._id)})})):n.setState({message:e.error},(function(){n.props.logout()}))})).catch((function(e){return console.log(e)}))},n.typesChange=function(e,t){for(var a=[],r=0;r<t.length;r++){var i=t[r];a.push(i),a=a.concat(i.Types)}var s=n.props.selectedThing;s.Types=a,n.props.updateSelectedThing(s)},n.addType=function(e,t){var a=n.props.selectedThing,r={};r[t._id]=t,t.Supers.forEach((function(t){if(0===e.filter((function(e){return e._id===t._id})).length){var a=n.props.types.filter((function(e){return e._id===t._id}));a.length>0&&0===e.filter((function(e){return e._id===a[0]._id})).length&&(e.push(a[0]),r[a[0]._id]=a[0])}0===n.props.selectedThing.Types.filter((function(e){return e._id===t._id})).length&&(r[t._id]=t)}));var i=[];Object.keys(r).forEach((function(e){var t=r[e];t.Attributes.forEach((function(e){var r=Object(z.a)({},e),n=a.Attributes.filter((function(e){return e.attrID===r.attrID}));0===n.length?(r.FromTypeIDs=[t._id],r.index=t.Attributes.length+i.length,i.push(r)):(void 0!==(n=n[0]).FromTypeIDs&&null!==n.FromTypeIDs||(n.FromTypeIDs=[]),n.FromTypeIDs.push(t._id))}))})),Object.keys(r).forEach((function(e){var t=r[e];i.forEach((function(e){void 0===t.DefaultsHash||void 0===t.DefaultsHash[e.attrID]||void 0===t.DefaultsHash[e.attrID].DefaultValue?(e.Value="",e.ListValues=[]):(void 0===e.Value&&(e.Value="",e.ListValues=[]),""===e.Value&&(e.Value=t.DefaultsHash[e.attrID].DefaultValue),t.DefaultsHash[e.attrID].DefaultListValues.forEach((function(t){e.ListValues.includes(t)||e.ListValues.push(t)})))}))}));var s=[].concat(Object($.a)(a.Attributes),i);a.Types=e,a.Attributes=s,a.AttributesArr=[];var o=[];a.Attributes.forEach((function(e){var t=n.props.attributesByID[e.attrID];o.push({index:a.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:t.TypeIDs})})),n.props.updateSelectedThing(a),setTimeout((function(){a.Attributes=s,a.AttributesArr=o,n.props.updateSelectedThing(a)}),500)},n.addType2=function(e){var t=n.props.selectedThing.Types;t.push(e);var a=[e],r=n.props.selectedThing;e.Supers.forEach((function(e){if(0===t.filter((function(t){return t._id===e._id})).length){var r=n.props.types.filter((function(t){return t._id===e._id}));r.length>0&&0===t.filter((function(e){return e._id===r[0]._id})).length&&(t.push(r[0]),a.push(r[0]))}0===n.props.selectedThing.Types.filter((function(t){return t._id===e._id})).length&&a.push(e)}));var i=[];a.forEach((function(e){e.Attributes.forEach((function(t){var a=Object(z.a)({},t),n=r.Attributes.filter((function(e){return e.attrID===a.attrID}));0===n.length?(a.FromTypeIDs=[e._id],a.index=e.Attributes.length+i.length,i.push(a)):(void 0!==(n=n[0]).FromTypeIDs&&null!==n.FromTypeIDs||(n.FromTypeIDs=[]),n.FromTypeIDs.push(e._id))}))})),a.forEach((function(e){i.forEach((function(t){void 0===e.DefaultsHash||void 0===e.DefaultsHash[t.attrID]||void 0===e.DefaultsHash[t.attrID].DefaultValue?(t.Value="",t.ListValues=[]):(t.Value=e.DefaultsHash[t.attrID].DefaultValue,t.ListValues=e.DefaultsHash[t.attrID].DefaultListValues)}))}));var s=[].concat(Object($.a)(r.Attributes),i);n.setState({resetting:!0}),r.Types=t,r.Attributes=s,r.AttributesArr=[];var o=[];r.Attributes.forEach((function(e){var t=n.props.attributesByID[e.attrID];o.push({index:r.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:t.TypeIDs})})),n.props.updateSelectedThing(r),setTimeout((function(){r.Attributes=s,r.AttributesArr=o,n.props.updateSelectedThing(r),n.setState({resetting:!1,infoAttribute:null})}),500)},n.selectNewTypeForAttribute=function(e){if("new"===e.target.value){n.setState({typeModalOpen:!0,modalSubmit:function(e){this.setState({newTypeForAttribute:e._id})}})}else n.setState({newTypeForAttribute:e.target.value})},n.saveInfoAttribute=function(){n.validateAttrForm((function(){this.state.fieldValidation.infoAttributeName.valid&&this.setState({waiting:!0},this.submitAttributeThroughAPI)}))},n.deleteInfoAttribute=function(){var e=n.props.selectedThing;e.AttributesArr.splice(n.state.infoAttribute.index,1),e.AttributesArr.forEach((function(e){e.index>n.state.infoAttribute.index&&e.index--})),n.setState({infoAttribute:null},(function(){this.props.updateSelectedThing(e)}))},n.cleanWYSIWYG=function(e){return e.endsWith("<p><br></p>")&&(e=e.substring(0,e.length-11)),e},n.submitAttributeThroughAPI=function(){var e=[{_id:n.state.infoAttribute.attrID,Name:n.state.infoAttribute.Name.trim(),AttributeType:n.state.infoAttribute.AttributeType,Options:n.state.infoAttribute.Options,DefinedType:n.state.infoAttribute.DefinedType,ListType:n.state.infoAttribute.ListType}];n.api.upsertAttributes(n.props.selectedWorldID,e).then((function(e){void 0===e.error?n.api.getWorld(n.props.selectedWorldID,!0).then((function(t){n.props.setAttributes(t.attributes),n.props.setTypes(t.types),n.props.setThings(t.things);var a=n.state.infoAttribute;""!==n.state.newTypeForAttribute&&(a.TypeIDs.push(n.state.newTypeForAttribute),a.FromTypeIDs.push(n.state.newTypeForAttribute));var r=n.props.selectedThing;if(null===a.attrID){a.attrID=e.attributes[a.Name];var i={attrID:a.attrID,index:r.Attributes.length,Value:"",ListValues:[]};r.Attributes.push(i),r.AttributesArr.push({attrID:a.attrID,index:i.index,Value:"",ListValues:[],Name:a.Name,AttributeType:a.AttributeType,Options:a.Options,DefinedType:a.DefinedType,ListType:a.ListType,FromTypeIDs:a.FromTypeIDs,TypeIDs:a.TypeIDs})}else{var s=r.AttributesArr.filter((function(e){return e.attrID===a.attrID}))[0];s.Name=a.Name,s.AttributeType=a.AttributeType,s.Options=a.Options,s.DefinedType=a.DefinedType,s.ListType=a.ListType,s.FromTypeIDs=a.FromTypeIDs,s.TypeIDs=a.TypeIDs}if(0===a.FromTypeIDs.length)n.props.updateSelectedThing(r),n.setState({infoAttribute:null,waiting:!1});else{var o=n.props.types.filter((function(e){return e._id===a.FromTypeIDs[0]}))[0],l={_id:o._id,Name:o.Name,Description:n.cleanWYSIWYG(o.Description),SuperIDs:o.SuperIDs,Attributes:o.Attributes,Defaults:o.Defaults,worldID:n.props.selectedWorld._id,Major:o.Major,ReferenceIDs:o.ReferenceIDs,DefaultReferenceIDs:o.DefaultReferenceIDs};l.Attributes.push({attrID:a.attrID,index:l.Attributes.length}),n.api.updateType(l).then((function(e){if(void 0===e.error){l.Supers=[],l.SuperIDs.forEach((function(e){l.Supers=l.Supers.concat(n.props.types.filter((function(t){return t._id===e})))})),l.AttributesArr=[],l.Attributes.forEach((function(e){var t=n.props.attributesByID[e.attrID];l.AttributesArr.push({index:l.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID})}));var t={};void 0!==l.Defaults&&l.Defaults.forEach((function(e){t[e.attrID]=e})),l.DefaultsHash=t,n.props.updateType(l),n.setState({infoAttribute:null,waiting:!1},(function(){this.addType2(l)}))}else n.setState({waiting:!1,message:e.error},(function(){n.props.logout()}))})).catch((function(e){return console.log(e)}))}})):n.setState({message:e.error,waiting:!1},(function(){n.props.logout()}))}))},n.removeType=function(e,t){var a=[],r=[];n.props.selectedThing.Types.forEach((function(e){e._id===t._id||e.SuperIDs.includes(t._id)?r.push(e._id):a.push(e)}));var i=n.props.selectedThing,s=Object($.a)(i.Attributes);s.forEach((function(e){var t=[];e.FromTypeIDs.forEach((function(e){r.includes(e)||t.push(e)})),e.FromTypeIDs=t})),i.Types=a,i.Attributes=s,i.AttributesArr=[],i.Attributes.forEach((function(e){var t=n.props.attributesByID[e.attrID];i.AttributesArr.push({index:i.AttributesArr.length,Name:t.Name,AttributeType:t.AttributeType,Options:t.Options,DefinedType:t.DefinedType,ListType:t.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:t.TypeIDs})})),n.props.updateSelectedThing(i)},n.redirectToNext=function(){var e=null===n.state.majorType?n.props.things:n.props.things.filter((function(e){return e.TypeIDs.includes(n.state.majorType._id)})),t=0;if(void 0===n.props.selectedThing||null!==n.props.selectedThing._id){for(;e[t]._id!==n.props.selectedThing._id;)t++;t++}t===e.length&&(t=0),n.setState({waiting:!1,redirectTo:"/thing/edit/".concat(e[t]._id)})},n.load=function(e){setTimeout((function(){n.setState({_id:e,redirectTo:null,loaded:!1},n.finishLoading)}),500)},n.finishLoading=function(){n.props.selectedWorldID?n.api.getWorld(n.props.selectedWorldID).then((function(e){if(n.props.setAttributes(e.attributes),n.props.setTypes(e.types),n.props.setThings(e.things),n.props.fromLogin)n.props.notFromLogin(),n.setState({loaded:!0,message:""});else if(null!==n.state._id){var t=e.things.filter((function(e){return e._id===n.state._id}));if(0===t.length)n.setState({message:"Invalid ID"});else{t=t[0];var a=[];t.TypeIDs.forEach((function(e){a=a.concat(n.props.types.filter((function(t){return t._id===e})))}));var r=[];a.forEach((function(e){for(var a=function(a){var n=Object(z.a)({},e.Attributes[a]),i=t.Attributes.filter((function(e){return e.attrID===n.attrID}));0===i.length?(n.FromTypeIDs=[e._id],n.index=t.Attributes.length+r.length,r.push(n)):(void 0!==(i=i[0]).FromTypeIDs&&null!==i.FromTypeIDs||(i.FromTypeIDs=[]),i.FromTypeIDs.push(e._id))},n=0;n<e.Attributes.length;n++)a(n)})),a.forEach((function(e){r.forEach((function(t){void 0===e.DefaultsHash[t.attrID]||void 0===e.DefaultsHash[t.attrID].DefaultValue?(t.Value="",t.ListValues=[]):(t.Value=e.DefaultsHash[t.attrID].DefaultValue,t.ListValues=e.DefaultsHash[t.attrID].DefaultListValues)}))}));var i=[].concat(Object($.a)(t.Attributes),r);if(i.forEach((function(e){void 0===e.FromTypeIDs&&(e.FromTypeIDs=[])})),t.Attributes=i,t.AttributesArr=[],t.Attributes.forEach((function(e){var a=n.props.attributesByID[e.attrID];t.AttributesArr.push({index:t.AttributesArr.length,Name:a.Name,AttributeType:a.AttributeType,Options:a.Options,DefinedType:a.DefinedType,ListType:a.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:a.TypeIDs})})),t.Types=a,n.props.updateSelectedThing(t),null===n.state.majorType){var s=t.Types.filter((function(e){return e.Major}));s.length>0?(s=s[0],n.setState({loaded:!0,majorType:s})):n.setState({loaded:!0})}else n.setState({loaded:!0})}}else{var o=n.props.match.params.id;if(void 0!==o&&o.includes("type_id_")){var l=o.substring(8),c=n.props.types.filter((function(e){return e._id===l}));c.length>0?(c=c[0],n.createThingFromType(c)):n.setState({message:"Invalid Type",loaded:!0})}else n.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:[],Attributes:[],AttributesArr:[]}),n.setState({loaded:!0})}})):n.api.getWorldByThingID(n.state._id).then((function(e){if(n.props.selectWorld(e.worldID),n.props.setAttributes(e.attributes),n.props.setTypes(e.types),n.props.setThings(e.things),n.props.fromLogin)n.props.notFromLogin(),n.setState({loaded:!0,message:""});else if(null!==n.state._id){var t=e.things.filter((function(e){return e._id===n.state._id}));if(0===t.length)n.setState({message:"Invalid ID"});else{t=t[0];var a=[];t.TypeIDs.forEach((function(e){a=a.concat(n.props.types.filter((function(t){return t._id===e})))}));var r=[];a.forEach((function(e){for(var a=function(a){var n=Object(z.a)({},e.Attributes[a]),i=t.Attributes.filter((function(e){return e.attrID===n.attrID}));0===i.length?(n.FromTypeIDs=[e._id],n.index=t.Attributes.length+r.length,r.push(n)):(void 0!==(i=i[0]).FromTypeIDs&&null!==i.FromTypeIDs||(i.FromTypeIDs=[]),i.FromTypeIDs.push(e._id))},n=0;n<e.Attributes.length;n++)a(n)})),a.forEach((function(e){r.forEach((function(t){void 0===e.DefaultsHash[t.attrID]||void 0===e.DefaultsHash[t.attrID].DefaultValue?(t.Value="",t.ListValues=[]):(t.Value=e.DefaultsHash[t.attrID].DefaultValue,t.ListValues=e.DefaultsHash[t.attrID].DefaultListValues)}))}));var i=[].concat(Object($.a)(t.Attributes),r);if(i.forEach((function(e){void 0===e.FromTypeIDs&&(e.FromTypeIDs=[])})),t.Attributes=i,t.AttributesArr=[],t.Attributes.forEach((function(e){var a=n.props.attributesByID[e.attrID];t.AttributesArr.push({index:t.AttributesArr.length,Name:a.Name,AttributeType:a.AttributeType,Options:a.Options,DefinedType:a.DefinedType,ListType:a.ListType,attrID:e.attrID,Value:e.Value,ListValues:e.ListValues,FromTypeIDs:e.FromTypeIDs,TypeIDs:a.TypeIDs})})),t.Types=a,n.props.updateSelectedThing(t),null===n.state.majorType){var s=t.Types.filter((function(e){return e.Major}));s.length>0?(s=s[0],n.setState({loaded:!0,majorType:s})):n.setState({loaded:!0})}else n.setState({loaded:!0})}}else{var o=n.props.match.params.id;if(void 0!==o&&o.includes("type_id_")){var l=o.substring(8),c=n.props.types.filter((function(e){return e._id===l}));c.length>0?(c=c[0],n.createThingFromType(c)):n.setState({message:"Invalid Type",loaded:!0})}else n.props.updateSelectedThing({_id:null,Name:"",Description:"",Types:[],Attributes:[],AttributesArr:[]}),n.setState({loaded:!0})}}))},n.state={_id:void 0,fieldValidation:{Name:{valid:!0,message:""},Attributes:{valid:!0,message:""},infoAttributeName:{valid:!0,message:""}},formValid:!1,message:"",redirectTo:null,waiting:!1,addMore:"",resetting:!1,loaded:!0,errors:[],infoAttribute:null,typeModalOpen:!1,newTypeForAttribute:"",browseAttributes:!1,browseAttributesFilter:"",browseAttributesSelected:"",thingModalOpen:!1,newThingType:null,putThingOnAttribute:null,majorType:null},n.api=X.getInstance(),n.refDescription=Object(r.createRef)(),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"renderHeader",value:function(){var e="Thing";return this.props.selectedThing.Types.forEach((function(t){t.Major&&("Thing"===e?e=t.Name:e+="/"+t.Name)})),n.a.createElement("h2",null,null===this.state._id?"Create New ".concat(e):"Edit ".concat(e))}},{key:"render",value:function(){var e=this,t=this.props.match.params.id;if((void 0===t||t.includes("type_id_"))&&(t=null),this.state._id!==t)return this.load(t),n.a.createElement("span",null,"Loading...");if(this.state.loaded){if(null!==this.state.redirectTo)return n.a.createElement(he.a,{to:this.state.redirectTo});if(null===this.props.selectedWorld||this.props.selectedWorld.Public||null!==this.props.user){if(null===this.props.selectedWorld||this.props.selectedWorld.Public||this.props.selectedWorld.Owner===this.props.user._id||0!==this.props.selectedWorld.Collaborators.filter((function(t){return t.userID===e.props.user._id&&"collab"===t.type&&t.editPermission})).length){if(null===this.props.selectedThing||this.props.selectedThing._id!==t)return n.a.createElement("span",null,"Loading...");if(this.state.typeModalOpen)return n.a.createElement(La,{types:this.props.types,selectedWorldID:this.props.selectedWorldID,onCancel:function(t){e.setState({typeModalOpen:!1})},addType:function(t){e.props.addType(t)},onSave:function(t){e.setState({typeModalOpen:!1,newTypeForAttribute:t._id})},api:this.api,logout:function(){e.props.logout()}});if(null!==this.state.infoAttribute){var a=this.props.types.filter((function(t){return e.state.infoAttribute.FromTypeIDs.includes(t._id)})),r=this.props.types.filter((function(t){return!e.state.infoAttribute.FromTypeIDs.includes(t._id)&&e.state.infoAttribute.TypeIDs.includes(t._id)}));if(0===a.length){if(0===r.length){return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,{style:{fontSize:"30px"}},"Attribute Info"),n.a.createElement(g.a,null,n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"infoAttributeName"},"Name"),n.a.createElement(ae.a,{id:"infoAttributeName",name:"infoAttributeName",type:"text",autoComplete:"Off",error:!this.state.fieldValidation.infoAttributeName.valid,value:this.state.infoAttribute.Name,onChange:this.handleInfoAttrNameChange,onBlur:this.inputBlur2,labelWidth:43,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.infoAttributeName.message))),n.a.createElement(g.a,null,n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"attribute-type",id:"attribute-type-label"},"Attribute Type"),n.a.createElement(ga.a,{labelId:"attribute-type-label",id:"attribute-type",disabled:this.state.waiting,value:this.state.infoAttribute.AttributeType,onChange:function(t){var a=e.state.infoAttribute;a.AttributeType=t.target.value,e.setState({infoAttribute:a})},fullWidth:!0,labelWidth:100},["Text","Number","True/False","Options","Type","List"].map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e},e)}))))),"List"===this.state.infoAttribute.AttributeType&&n.a.createElement(g.a,null,n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"list-type",id:"list-type-label"},"List Type"),n.a.createElement(ga.a,{labelId:"list-type-label",id:"list-type",disabled:this.state.waiting,value:this.state.infoAttribute.ListType,onChange:function(t){var a=e.state.infoAttribute;a.ListType=t.target.value,e.setState({infoAttribute:a})},fullWidth:!0,labelWidth:70},["Text","Options","Type"].map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e},e)}))))),("Type"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Type"===this.state.infoAttribute.ListType)&&n.a.createElement(g.a,null,n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"definedType",id:"definedType-label"},"Defined Type"),n.a.createElement(ga.a,{labelId:"definedType-label",id:"definedType",disabled:this.state.waiting,value:this.state.infoAttribute.DefinedType,onChange:function(t){var a=e.state.infoAttribute;if(a.DefinedType=t.target.value,"new"===t.target.value){e.setState({typeModalOpen:!0,modalSubmit:function(e){a.DefinedType=e._id,this.setState({typeModalOpen:!1,infoAttribute:a})}})}else e.setState({infoAttribute:a})},fullWidth:!0,labelWidth:100},n.a.createElement(dt.a,{value:"new"},"+ Create New Type"),this.props.types.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e._id},e.Name)}))))),("Options"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Options"===this.state.infoAttribute.ListType)&&n.a.createElement(g.a,null,n.a.createElement(Oa.a,{variant:"outlined",disabled:this.state.waiting,defaultValue:this.state.infoAttribute.Options,onChange:function(t){var a=e.state.infoAttribute;a.Options=t,e.setState({infoAttribute:a})}})),n.a.createElement(g.a,null,"Select a Type to add this attribute to, and to add to ",this.props.selectedThing.Name),n.a.createElement(g.a,null,n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"newTypeForAttribute",id:"newTypeForAttribute-label"},"Type For Attribute"),n.a.createElement(ga.a,{labelId:"newTypeForAttribute-label",id:"newTypeForAttribute",value:this.state.newTypeForAttribute,onChange:function(t){e.selectNewTypeForAttribute(t)},fullWidth:!0,labelWidth:125},n.a.createElement(dt.a,{value:"new"},"+ Create New Type"),this.props.types.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e._id},e.Name)}))))),n.a.createElement(g.a,null,"Or you can also remove this attribute from ",this.props.selectedThing.Name),n.a.createElement(g.a,null,n.a.createElement(ie.a,{title:"Delete Attribute"},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.deleteInfoAttribute},n.a.createElement(_t.a,null)))))),n.a.createElement(U.a,{item:!0},this.state.message),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",disabled:this.state.waiting,onClick:this.saveInfoAttribute},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:6},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({infoAttribute:null})}},"Cancel"))))}return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,{style:{fontSize:"30px"}},"Attribute Info"),n.a.createElement(g.a,null,"Name: ",this.state.infoAttribute.Name),n.a.createElement(g.a,null,"Type: ",this.state.infoAttribute.AttributeType),"List"===this.state.infoAttribute.AttributeType&&n.a.createElement(g.a,null,"List Type: ",this.state.infoAttribute.ListType),("Type"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Type"===this.state.infoAttribute.ListType)&&n.a.createElement(g.a,null,"Defined Type:",n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(t){e.setState({redirectTo:"/type/details/".concat(e.state.infoAttribute.DefinedType)})}},this.props.types.filter((function(t){return t._id===e.state.infoAttribute.DefinedType}))[0].Name)),("Options"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Options"===this.state.infoAttribute.ListType)&&n.a.createElement(g.a,null,"Options:",this.state.infoAttribute.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)}))),n.a.createElement(g.a,null,1===r.length?"Type associated with this attribute:":"Types associated with this attribute:",n.a.createElement(re.a,null,r.map((function(t,a){return n.a.createElement("span",{key:a},n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},t.Name),n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.addType2(t)}},"Add ",t.Name," to ",e.props.selectedThing.Name))})))))),n.a.createElement(U.a,{item:!0},n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",onClick:function(t){e.setState({infoAttribute:null})}},"Cancel")))}return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement(re.a,null,n.a.createElement(g.a,{style:{fontSize:"30px"}},"Attribute Info"),n.a.createElement(g.a,null,"Name: ",this.state.infoAttribute.Name),n.a.createElement(g.a,null,"Type: ",this.state.infoAttribute.AttributeType),"List"===this.state.infoAttribute.AttributeType&&n.a.createElement(g.a,null,"List Type: ",this.state.infoAttribute.ListType),("Type"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Type"===this.state.infoAttribute.ListType)&&n.a.createElement(g.a,null,"Defined Type:",n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(t){e.setState({redirectTo:"/type/details/".concat(e.state.infoAttribute.DefinedType)})}},this.props.types.filter((function(t){return t._id===e.state.infoAttribute.DefinedType}))[0].Name)),("Options"===this.state.infoAttribute.AttributeType||"List"===this.state.infoAttribute.AttributeType&&"Options"===this.state.infoAttribute.ListType)&&n.a.createElement(g.a,null,"Options:",this.state.infoAttribute.Options.map((function(e,t){return n.a.createElement("span",{key:t},0===t?" ":", ",e)}))),a.length>0&&n.a.createElement(g.a,null,1===a.length?"From Type:":"From Types:",a.map((function(t,a){return n.a.createElement("span",{key:a},0===a?" ":", ",n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},t.Name))}))),r.length>0&&n.a.createElement(g.a,null,1===r.length?"Other Associated Type:":"Other Associated Types:",r.map((function(t,a){return n.a.createElement("span",{key:a},0===a?" ":", ",n.a.createElement(xe.a,{variant:"contained",color:"primary",onClick:function(a){e.setState({redirectTo:"/type/details/".concat(t._id)})}},t.Name))}))))),n.a.createElement(U.a,{item:!0},n.a.createElement(xe.a,{variant:"contained",onClick:function(t){e.setState({infoAttribute:null})}},"Cancel")))}if(this.state.thingModalOpen)return n.a.createElement(Va,{things:this.props.things,newThingType:this.state.newThingType,selectedWorldID:this.props.selectedWorldID,onCancel:function(t){e.setState({thingModalOpen:!1})},addThing:function(t){e.props.addThing(t)},onSave:function(t){var a=e.props.selectedThing,r=a.AttributesArr.filter((function(t){return t.attrID===e.state.putThingOnAttribute.attrID}))[0];"Type"===r.AttributeType?r.Value=t._id:r.ListValues.push(t._id),e.props.updateSelectedThing(a),e.setState({thingModalOpen:!1})},api:this.api,logout:function(){e.props.logout()}});var i=[];this.state.browseAttributes&&Object.keys(this.props.attributesByID).forEach((function(t){0===e.props.selectedThing.Attributes.filter((function(e){return e.attrID===t})).length&&i.push(e.props.attributesByID[t])}));var s=[].concat(Object($.a)(this.props.typeSuggestions),Object($.a)(this.props.thingSuggestions));return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:1,direction:"column"},null!==this.props.selectedWorld&&n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(Dt.Helmet,null,n.a.createElement("title",null,"Author's Notebook: ".concat(this.props.selectedWorld.Name))),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:1},n.a.createElement(ie.a,{title:"Back to ".concat(this.props.selectedWorld.Name)},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)})}},n.a.createElement(ea.a,null)))),n.a.createElement(U.a,{item:!0,xs:7,sm:9},this.renderHeader()),n.a.createElement(U.a,{item:!0,xs:4,sm:2},n.a.createElement(g.a,null,null===this.state.majorType&&this.props.things.length>1?n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(b.a,{primary:"Next"})):null!==this.state.majorType&&this.props.things.filter((function(t){return t.TypeIDs.includes(e.state.majorType._id)})).length>1&&n.a.createElement(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:function(t){e.redirectToNext()}},n.a.createElement(b.a,{primary:"Next ".concat(this.state.majorType.Name)}))))),!this.state.resetting&&n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},this.state.loaded&&n.a.createElement(Ze,{Value:this.props.selectedThing.Name,fieldName:"Name",message:this.state.fieldValidation.Name.message,onBlur:function(t){var a=e.props.selectedThing;a.Name=t,e.props.updateSelectedThing(a),e.validateForm()},labelWidth:43})),n.a.createElement(U.a,{item:!0},this.state.loaded&&n.a.createElement(Ze,{Value:this.props.selectedThing.Description,fieldName:"Description",multiline:!0,onBlur:function(t){var a=e.props.selectedThing;a.Description=t,e.props.updateSelectedThing(a)},options:s,labelWidth:82})),n.a.createElement(U.a,{item:!0},n.a.createElement(Sa.Multiselect,{placeholder:"Types",options:this.props.types,selectedValues:this.props.selectedThing.Types,onSelect:this.addType,onRemove:this.removeType,displayValue:"Name"})),n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"column"},n.a.createElement(U.a,{item:!0},n.a.createElement("span",null,"Attributes\xa0",n.a.createElement(ie.a,{title:"Add New Attribute"},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({infoAttribute:{index:e.props.selectedThing.AttributesArr.length,Name:"",AttributeType:"Text",Options:[],DefinedType:"",ListType:"",attrID:null,Value:"",ListValues:[],FromTypeIDs:[],TypeIDs:[]}})}},n.a.createElement(le.a,null))),n.a.createElement(ie.a,{title:"Browse Additional Attributes"},n.a.createElement(ne.a,{size:"small",color:"primary",onClick:function(t){e.setState({browseAttributes:!e.state.browseAttributes})}},n.a.createElement(oe.a,null))))),this.state.browseAttributes&&n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:6},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"browseForAttributes",id:"browseForAttributes-label"},"Browse Additional Attributes"),n.a.createElement(ga.a,{labelId:"browseForAttributes-label",id:"browseForAttributes",value:this.state.browseAttributesSelected,onChange:function(t){e.setState({browseAttributesSelected:t.target.value})},fullWidth:!0,labelWidth:200},i.map((function(e,t){return n.a.createElement(dt.a,{key:t,value:e._id},e.Name)}))))),n.a.createElement(U.a,{item:!0,xs:12,sm:6},n.a.createElement(xe.a,{variant:"contained",color:"primary",disabled:""===this.state.browseAttributesSelected,onClick:function(t){e.addSelectedAttribute()},type:"submit"},"Add Attribute"))),this.state.loaded&&n.a.createElement(lr,{addNewThing:function(t){e.setState({thingModalOpen:!0,newThingType:e.props.types.filter((function(e){return e._id===t.DefinedType}))[0],putThingOnAttribute:t})},onInfo:function(t){e.setState({infoAttribute:t})}}),n.a.createElement(Pe.a,null,this.state.fieldValidation.Attributes.message)),null===this.state.majorType&&this.props.things.length>0||null!==this.state.majorType&&this.props.things.filter((function(t){return t.TypeIDs.includes(e.state.majorType._id)})).length>0?n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("next")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Edit Next")),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("add")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Create Another")),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("")},type:"submit"},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:12,sm:3},n.a.createElement(xe.a,{variant:"contained",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){null===e.props.selectedThing._id?e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)}):e.setState({redirectTo:"/thing/details/".concat(e.props.selectedThing._id)})},type:"button"},"Cancel"))):n.a.createElement(U.a,{item:!0,container:!0,spacing:1,direction:"row"},n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("add")},type:"submit"},this.state.waiting?"Please Wait":"Submit and Create Another")),n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(xe.a,{variant:"contained",color:"primary",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){e.onSubmit("")},type:"submit"},this.state.waiting?"Please Wait":"Submit")),n.a.createElement(U.a,{item:!0,xs:12,sm:4},n.a.createElement(xe.a,{variant:"contained",fullWidth:!0,disabled:this.state.waiting,onClick:function(t){null===e.props.selectedThing._id?e.setState({redirectTo:"/project/details/".concat(e.props.selectedWorldID)}):e.setState({redirectTo:"/thing/details/".concat(e.props.selectedThing._id)})},type:"button"},"Cancel"))),n.a.createElement(U.a,{item:!0},this.state.message),n.a.createElement(U.a,{item:!0},this.state.errors.map((function(e,t){return n.a.createElement("div",{key:t},e)}))),n.a.createElement(U.a,{item:!0},Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))))))}return n.a.createElement(he.a,{to:"/"})}return setTimeout((function(){e.props.toggleLogin()}),500),n.a.createElement("span",null,"Requires Login")}return n.a.createElement("span",null,"Loading...")}}]),a}(r.Component),ur=Object(d.b)((function(e){return{selectedPage:e.app.selectedPage,selectedThing:e.app.selectedThing,selectedWorld:e.app.selectedWorld,selectedWorldID:e.app.selectedWorldID,things:e.app.things,types:e.app.types,user:e.app.user,attributesByID:e.app.attributesByID,attributesByName:e.app.attributesByName,fromLogin:e.app.fromLogin,typeSuggestions:e.app.typeSuggestions,thingSuggestions:e.app.thingSuggestions}}),(function(e){return{updateSelectedThing:function(t){return e(P(t))},addThing:function(t){return e(_(t))},updateThing:function(t){return e(V(t))},updateType:function(t){return e(j(t))},addType:function(t){return e(k(t))},setAttributes:function(t){return e(x(t))},setTypes:function(t){return e(W(t))},setThings:function(t){return e(C(t))},notFromLogin:function(){return e(M({}))},toggleLogin:function(){return e(B({}))},logout:function(){return e(E({}))},selectWorld:function(t){return e(O(t))}}}))(cr),pr=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).componentDidMount=function(){},r.handleUserInput=function(e){var t=e.target.name,a="checkbox"===e.target.type?e.target.checked:e.target.value;r.setState(Object(Z.a)({},t,a))},r.inputBlur=function(e){var t=e.target.name,a=r.validateField(t),n=r.state.fieldValidation;n[t].valid!==a.valid&&(n[t].valid=a.valid,n[t].message=a.message,r.setState({fieldValidation:n}))},r.handleClickShowPassword=function(){r.setState({showPassword:!r.state.showPassword})},r.handleMouseDownPassword=function(e){e.preventDefault()},r.validateField=function(e){var t=!0,a="",n=r.state[e];switch(e){case"email":a=(t=null!==n.match(/^([\w.%+-]+)@([\w-]+\.)+([\w]{2,})$/i))?"":"Email is invalid";break;case"password":a=(t=n.length>=6)?"":"Password is too short";break;case"confirmEmail":a=(t=n===r.state.email)?"":"Confirm Email doesn't match Email";break;case"confirmPassword":a=(t=n===r.state.password)?"":"Confirm Password doesn't match Password";break;case"username":a=(t=n.length>=2)?"":"Username is too short"}return{valid:t,message:a}},r.validateForm=function(e){var t=r.validateField("password"),a=r.validateField("confirmPassword"),n=t.valid&&a.valid,i=r.state.fieldValidation;i.password=t,i.confirmPassword=a,r.setState({formValid:n,fieldValidation:i},e)},r.onSubmit=function(){r.validateForm((function(){this.state.formValid&&this.setState({waiting:!0},this.submitThroughAPI)}))},r.submitThroughAPI=function(){r.api.resetPassword(r.state.resetPasswordCode,r.state.password).then((function(e){r.setState({message:e.message,waiting:!1})})).catch((function(e){return console.log(e)}))},r.state={resetPasswordCode:null,codeValid:!1,password:"",confirmPassword:"",fieldValidation:{password:{valid:!0,message:""},confirmPassword:{valid:!0,message:""}},formValid:!1,message:"Please wait.  Validating code."},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"render",value:function(){var e=this;if(null===this.state.resetPasswordCode){var t=this.props.match.params.id;return setTimeout((function(){e.api.checkResetPasswordCode(t).then((function(a){void 0!==a.error?e.setState({resetPasswordCode:t,codeValid:!1,message:a.error}):e.setState({resetPasswordCode:t,codeValid:!0,message:""})}))}),500),n.a.createElement("div",null,n.a.createElement("h2",null,"Reset Password"),this.state.message)}return this.state.codeValid?n.a.createElement("div",null,n.a.createElement("h2",null,"Reset Password"),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"outlined-adornment-password"},"Password"),n.a.createElement(ae.a,{id:"outlined-adornment-password",name:"password",type:this.state.showPassword?"text":"password",value:this.state.password,error:!this.state.fieldValidation.password.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(ra.a,{position:"end"},n.a.createElement(h.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ia.a,null):n.a.createElement(oa.a,null))),labelWidth:70,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.password.message)))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12 margined"},n.a.createElement(ee.a,{variant:"outlined",fullWidth:!0},n.a.createElement(te.a,{htmlFor:"confirm-password"},"Confirm Password"),n.a.createElement(ae.a,{id:"confirm-password",name:"confirmPassword",type:this.state.showPassword?"text":"password",value:this.state.confirmPassword,error:!this.state.fieldValidation.confirmPassword.valid,onChange:this.handleUserInput,onBlur:this.inputBlur,endAdornment:n.a.createElement(ra.a,{position:"end"},n.a.createElement(h.a,{"aria-label":"toggle password visibility",onClick:this.handleClickShowPassword,onMouseDown:this.handleMouseDownPassword,edge:"end"},this.state.showPassword?n.a.createElement(ia.a,null):n.a.createElement(oa.a,null))),labelWidth:130,fullWidth:!0}),n.a.createElement(Pe.a,null,this.state.fieldValidation.confirmPassword.message)))))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-sm-12"},n.a.createElement("div",{className:"float-right"},n.a.createElement(xe.a,{className:"w200",disabled:this.state.waiting,onClick:this.onSubmit,type:"submit"},this.state.waiting?"Please Wait":"Submit")))),this.state.message,Object.keys(this.state.fieldValidation).map((function(t,a){return void 0!==e.state.fieldValidation[t]&&e.state.fieldValidation[t].message.length>0?n.a.createElement("p",{className:"redFont",key:a},e.state.fieldValidation[t].message):""}))):n.a.createElement("div",null,n.a.createElement("h2",null,"Reset Password"),this.state.message)}}]),a}(r.Component),dr=Object(d.b)()(pr),mr=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).componentDidMount=function(){},r.state={confirmEmailCode:null,codeValid:!1,message:"Please wait.  Validating code."},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"render",value:function(){var e=this;if(null===this.state.confirmEmailCode){var t=this.props.match.params.id;setTimeout((function(){e.api.confirmEmail(t).then((function(a){void 0!==a.error?e.setState({confirmEmailCode:t,codeValid:!1,message:a.error}):e.setState({confirmEmailCode:t,codeValid:!0,message:a.message})}))}),500)}return n.a.createElement("div",null,n.a.createElement("h2",null,"Confirming Email"),this.state.message)}}]),a}(r.Component),fr=Object(d.b)()(mr);var hr=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).state={version:"0"},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return n.a.createElement(U.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column"},n.a.createElement(U.a,{item:!0,className:"h-100 margined"},this.props.loginOpen?n.a.createElement(pa,{onLogin:function(t){e.props.toggleLogin()}}):n.a.createElement(he.d,null,n.a.createElement(he.b,{exact:!0,path:"/",component:Ne}),n.a.createElement(he.b,{exact:!0,path:"/home",component:Ne}),n.a.createElement(he.b,{exact:!0,path:"/User/Profile",component:It}),n.a.createElement(he.b,{exact:!0,path:"/User/resetPassword/:id",component:dr}),n.a.createElement(he.b,{exact:!0,path:"/User/confirmEmail/:id",component:fr}),n.a.createElement(he.b,{exact:!0,path:"/discussion",component:st}),n.a.createElement(he.b,{exact:!0,path:"/project/details/:id",component:Zt}),n.a.createElement(he.b,{exact:!0,path:"/project/create",component:aa}),n.a.createElement(he.b,{exact:!0,path:"/project/edit/:id",component:aa}),n.a.createElement(he.b,{exact:!0,path:"/project/collaborators/:id",component:Ea}),n.a.createElement(he.b,{exact:!0,path:"/project/collaborate/:worldID/:collabID",component:ma}),n.a.createElement(he.b,{exact:!0,path:"/type/create",component:Fa}),n.a.createElement(he.b,{exact:!0,path:"/type/details/:id",component:wa}),n.a.createElement(he.b,{exact:!0,path:"/type/edit/:id",component:Fa}),n.a.createElement(he.b,{exact:!0,path:"/thing/create",component:ur}),n.a.createElement(he.b,{exact:!0,path:"/thing/create/:id",component:ur}),n.a.createElement(he.b,{exact:!0,path:"/thing/details/:id",component:rr}),n.a.createElement(he.b,{exact:!0,path:"/thing/edit/:id",component:ur}))),n.a.createElement(U.a,{item:!0,style:{minHeight:"100px"}},"\xa0"))}}]),a}(r.Component),gr=Object(d.b)((function(e){return{loginOpen:e.app.loginOpen}}),(function(e){return{toggleLogin:function(){return e(B({}))}}}))(hr);a(348);var br=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).state={version:"0",width:0,marginLeft:220},r.api=X.getInstance(),r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.updateDimensions(),window.addEventListener("resize",this.updateDimensions.bind(this))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions.bind(this))}},{key:"updateDimensions",value:function(){var e=window.innerWidth;e>=600?(e-=200,this.props.setWidth(e),this.setState({width:e,marginLeft:220,innerWidth:window.innerWidth})):(this.props.setWidth(e),this.setState({width:e,marginLeft:0,innerWidth:window.innerWidth}))}},{key:"render",value:function(){return null===this.props.api&&this.props.setAPI(this.api),n.a.createElement(p.a,null,this.props.menuOpen&&n.a.createElement(H.a,{display:{xs:"none",sm:"inline"},className:"Sidebar"},n.a.createElement(Et,{className:"",logoText:"Author's Notebook"})),n.a.createElement(U.a,{container:!0},n.a.createElement(U.a,{item:!0,xs:12,style:{marginLeft:"".concat(this.props.menuOpen?this.state.marginLeft:0,"px"),width:"".concat(this.props.menuOpen?this.state.width:this.state.innerWidth,"px")}},n.a.createElement(gt,null)),n.a.createElement(U.a,{item:!0,xs:12,style:{marginLeft:"".concat(this.props.menuOpen?this.state.marginLeft+10:10,"px"),width:"".concat(this.props.menuOpen?this.state.width-20:this.state.innerWidth-20,"px"),marginRight:"10px",marginTop:"10px"}},n.a.createElement(gr,null))))}}]),a}(r.Component),yr=Object(d.b)((function(e){return{menuOpen:e.app.menuOpen,api:e.app.api}}),(function(e){return{setWidth:function(t){return e({type:"SET_WIDTH",payload:t})},setAPI:function(t){return e({type:"SET_API",payload:t})}}}))(br);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var vr=a(94),Tr=a(148),Er={indexExpandedPanel:!1,api:null,articles:[],user:null,redirectToURL:null,loginError:"",worlds:[],publicWorlds:[],followingWorlds:[],selectedWorld:null,selectedWorldID:null,types:[],things:[],selectedType:null,attributesByID:{},attributesByName:{},selectedThing:null,loadIt:!0,menuOpen:!0,loginOpen:!1,fromLogin:!1,width:0,templates:[],allUsers:[],userSuggestions:[],collabSuggestions:[],worldSuggestions:[],typeSuggestions:[],thingSuggestions:[]};var Dr={app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Er,t=arguments.length>1?arguments[1]:void 0;if("UPDATE_INDEX_EXPANDED_PANEL"===t.type)return Object.assign({},e,{indexExpandedPanel:t.payload});if("LOAD_FROM_STORAGE"===t.type){var a=JSON.parse(localStorage.getItem("user"));a=void 0!==a&&null!==a&&void 0!==a.body&&void 0!==a.body.user?a.body.user:null;var r=JSON.parse(localStorage.getItem("selectedWorld")),n=localStorage.getItem("selectedWorldID"),i=JSON.parse(localStorage.getItem("types")),s=JSON.parse(localStorage.getItem("things")),o=JSON.parse(localStorage.getItem("followingWorlds")),l=JSON.parse(localStorage.getItem("attributesByID")),c=JSON.parse(localStorage.getItem("attributesByName")),u=JSON.parse(localStorage.getItem("worldSuggestions")),p=JSON.parse(localStorage.getItem("userSuggestions")),d=JSON.parse(localStorage.getItem("collabSuggestions")),m=JSON.parse(localStorage.getItem("typeSuggestions")),f=JSON.parse(localStorage.getItem("thingSuggestions"));return Object.assign({},e,{user:a,selectedWorld:r,selectedWorldID:n,types:null===i?[]:i,things:null===s?[]:s,followingWorlds:null===o?[]:o,attributesByID:null===l?{}:l,attributesByName:null===c?{}:c,worldSuggestions:null===u?[]:u,userSuggestions:null===p?[]:p,collabSuggestions:null===d?[]:d,typeSuggestions:null===m?[]:m,thingSuggestions:null===f?[]:f})}if("SET_API"===t.type)return Object.assign({},e,{api:t.payload});if("ADD_ARTICLE"===t.type)return Object.assign({},e,{articles:e.articles.concat(t.payload)});if("LOGIN"===t.type)return localStorage.setItem("followingWorlds",JSON.stringify(t.payload.followingWorlds)),Object.assign({},e,{user:t.payload,followingWorlds:t.payload.followingWorlds});if("LOGOUT"===t.type)return Object.assign({},e,{user:null});if("REDIRECT_TO"===t.type)return Object.assign({},e,{redirectToURL:t.payload});if("SET_WORLDS"===t.type){if(void 0!==t.payload&&void 0===t.payload.error){if(null!==e.selectedWorldID&&null===e.selectedWorld){var h=t.payload.filter((function(t){return t._id===e.selectedWorldID}));if(h.length>0){var g=h[0];return localStorage.setItem("selectedWorld",JSON.stringify(g)),Object.assign({},e,{worlds:t.payload,selectedWorld:g})}return Object.assign({},e,{worlds:t.payload})}return Object.assign({},e,{worlds:t.payload})}return Object.assign({},e,{})}if("SET_PUBLIC_WORLDS"===t.type){if(void 0===t.payload.error){var b=[];if(t.payload.forEach((function(e){b.push({_id:e._id,suggestionType:"world",Display:"".concat(e.Name)})})),localStorage.setItem("worldSuggestions",JSON.stringify(b)),null!==e.selectedWorldID&&null===e.selectedWorld){var y=t.payload.filter((function(t){return t._id===e.selectedWorldID}));if(y.length>0){var v=y[0];return localStorage.setItem("selectedWorld",JSON.stringify(v)),Object.assign({},e,{publicWorlds:t.payload,selectedWorld:v,worldSuggestions:b})}return Object.assign({},e,{publicWorlds:t.payload,worldSuggestions:b})}return Object.assign({},e,{publicWorlds:t.payload,worldSuggestions:b})}return Object.assign({},e,{})}if("SET_TEMPLATES"===t.type)return Object.assign({},e,{templates:t.payload});if("SET_ALL_USERS"===t.type){var T=[];if(t.payload.forEach((function(e){T.push({_id:e._id,suggestionType:"user",Display:"".concat(e.username)})})),localStorage.setItem("userSuggestions",JSON.stringify(T)),null!==e.selectedWorld){var E=[];return t.payload.forEach((function(t){(e.selectedWorld.Owner===t._id||void 0!==e.selectedWorld.Collaborators&&null!==e.selectedWorld.Collaborators&&e.selectedWorld.Collaborators.filter((function(e){return e.userID===t._id})).length>0)&&E.push({_id:t._id,suggestionType:"user",Display:"".concat(t.username)})})),localStorage.setItem("collabSuggestions",JSON.stringify(E)),Object.assign({},e,{allUsers:t.payload,userSuggestions:T,collabSuggestions:E})}return Object.assign({},e,{allUsers:t.payload,userSuggestions:T})}if("ADD_WORLD"===t.type){if(t.payload.Public){var D=e.worlds.concat(t.payload),w=e.publicWorlds.concat(t.payload);return Object.assign({},e,{worlds:D,publicWorlds:w})}return Object.assign({},e,{worlds:e.worlds.concat(t.payload)})}if("ADD_AND_SELECT_WORLD"===t.type){if(t.payload.Public){var I=e.worlds.concat(t.payload),A=e.publicWorlds.concat(t.payload),S=t.payload;if(localStorage.setItem("selectedWorldID",t.payload._id),localStorage.setItem("selectedWorld",JSON.stringify(S)),e.allUsers.length>0){var N=[];return e.allUsers.forEach((function(e){S.Owner===e._id&&N.push({_id:e._id,suggestionType:"user",Display:"".concat(e.username)})})),localStorage.setItem("collabSuggestions",JSON.stringify(N)),Object.assign({},e,{selectedWorldID:t.payload._id,selectedWorld:S,attributesByID:{},attributesByName:{},types:[],things:[],selectedType:null,selectedThing:null,collabSuggestions:N,worlds:I,publicWorlds:A})}return Object.assign({},e,{selectedWorldID:t.payload,selectedWorld:S,attributesByID:{},attributesByName:{},types:[],things:[],selectedType:null,selectedThing:null,worlds:I,publicWorlds:A})}var O=t.payload;if(localStorage.setItem("selectedWorldID",t.payload._id),localStorage.setItem("selectedWorld",JSON.stringify(O)),e.allUsers.length>0){var x=[];return e.allUsers.forEach((function(e){O.Owner===e._id&&x.push({_id:e._id,suggestionType:"user",Display:"".concat(e.username)})})),localStorage.setItem("collabSuggestions",JSON.stringify(x)),Object.assign({},e,{selectedWorldID:t.payload._id,selectedWorld:O,attributesByID:{},attributesByName:{},types:[],things:[],selectedType:null,selectedThing:null,collabSuggestions:x,worlds:e.worlds.concat(t.payload)})}return Object.assign({},e,{selectedWorldID:t.payload,selectedWorld:O,attributesByID:{},attributesByName:{},types:[],things:[],selectedType:null,selectedThing:null,worlds:e.worlds.concat(t.payload)})}if("UPDATE_WORLD"===t.type){var W=Object($.a)(e.worlds),k=Object($.a)(e.publicWorlds),C=W.filter((function(e){return e._id===t.payload._id}))[0];C.Name=t.payload.Name,C.Description=t.payload.Description;var _=C.Public;if(C.Public=t.payload.Public,C.AcceptingCollaborators=t.payload.AcceptingCollaborators,C.Collaborators=t.payload.Collaborators,C.Public){if(_){var j=k.filter((function(e){return e._id===C._id}))[0];j.Name=C.Name}else k=k.concat(C);return Object.assign({},e,{worlds:W,publicWorlds:k})}return _?(k=k.filter((function(e){return e._id!==C._id})),Object.assign({},e,{worlds:W,publicWorlds:k})):Object.assign({},e,{worlds:W})}if("UPDATE_PUBLIC_WORLD_COLLAB"===t.type){var L=Object($.a)(e.publicWorlds),V=L.filter((function(e){return e._id===t.payload._id}))[0];return V.Collaborators=t.payload.Collaborators,Object.assign({},e,{publicWorlds:L})}if("SELECT_WORLD"===t.type){var P=e.worlds.filter((function(e){return e._id===t.payload}));if(0===P.length&&(P=e.publicWorlds.filter((function(e){return e._id===t.payload}))),P.length>0){if(P=P[0],localStorage.setItem("selectedWorldID",t.payload),localStorage.setItem("selectedWorld",JSON.stringify(P)),e.allUsers.length>0){var F=[];return e.allUsers.forEach((function(e){(P.Owner===e._id||void 0!==P.Collaborators&&null!==P.Collaborators&&P.Collaborators.filter((function(t){return t.userID===e._id})).length>0)&&F.push({_id:e._id,suggestionType:"user",Display:"".concat(e.username)})})),localStorage.setItem("collabSuggestions",JSON.stringify(F)),Object.assign({},e,{selectedWorldID:t.payload,selectedWorld:P,attributesByID:{},attributesByName:{},types:[],things:[],selectedType:null,selectedThing:null,collabSuggestions:F,thingSuggestions:[],typeSuggestions:[]})}return Object.assign({},e,{selectedWorldID:t.payload,selectedWorld:P,attributesByID:{},attributesByName:{},types:[],things:[],selectedType:null,selectedThing:null,thingSuggestions:[],typeSuggestions:[]})}return localStorage.setItem("selectedWorldID",t.payload),localStorage.removeItem("selectedWorld"),localStorage.removeItem("collabSuggestions"),Object.assign({},e,{selectedWorldID:t.payload,selectedWorld:null,attributesByID:{},attributesByName:{},types:[],things:[],selectedType:null,selectedThing:null,collabSuggestions:[],thingSuggestions:[],typeSuggestions:[]})}if("SET_ATTRIBUTES"===t.type){var B={},M={};return t.payload.forEach((function(e){B[e._id]=e,M[e.Name]=e})),localStorage.setItem("attributesByID",JSON.stringify(B)),localStorage.setItem("attributesByName",JSON.stringify(M)),Object.assign({},e,{attributesByID:B,attributesByName:M})}if("UPDATE_ATTRIBUTES"===t.type){var R=e.attributesByID,U=e.attributesByName;return t.payload.forEach((function(e){R[e._id]=e,U[e.Name]=e})),localStorage.setItem("attributesByID",JSON.stringify(R)),localStorage.setItem("attributesByName",JSON.stringify(U)),Object.assign({},e,{attributesByID:R,attributesByName:U})}if("ADD_ATTRIBUTES"===t.type){var H=e.attributesByID,J=e.attributesByName;return t.payload.forEach((function(e){H[e._id]=e,J[e.Name]=e})),localStorage.setItem("attributesByID",JSON.stringify(H)),localStorage.setItem("attributesByName",JSON.stringify(J)),Object.assign({},e,{attributesByID:H,attributesByName:J})}if("SET_TYPES"===t.type){localStorage.setItem("types",JSON.stringify(t.payload));var G=[];return t.payload.forEach((function(e){G.push({_id:e._id,suggestionType:"type",Display:"".concat(e.Name)})})),localStorage.setItem("typeSuggestions",JSON.stringify(G)),Object.assign({},e,{types:t.payload,typeSuggestions:G})}if("ADD_TYPE"===t.type){var Y=e.types.concat(t.payload);localStorage.setItem("types",JSON.stringify(Y));var q=[];return Y.forEach((function(e){q.push({_id:e._id,suggestionType:"type",Display:"".concat(e.Name)})})),localStorage.setItem("typeSuggestions",JSON.stringify(q)),Object.assign({},e,{types:Y,typeSuggestions:q})}if("SET_THINGS"===t.type){localStorage.setItem("things",JSON.stringify(t.payload));var K=[];return t.payload.forEach((function(e){K.push({_id:e._id,suggestionType:"thing",Display:"".concat(e.Name)}),e.Types.forEach((function(t){K.push({_id:e._id,suggestionType:"thing",Display:"".concat(t.Name,"-").concat(e.Name)})}))})),localStorage.setItem("thingSuggestions",JSON.stringify(K)),Object.assign({},e,{things:t.payload,thingSuggestions:K})}if("ADD_THING"===t.type){var Q=e.things.concat(t.payload);localStorage.setItem("things",JSON.stringify(Q));var X=[];return Q.forEach((function(e){X.push({_id:e._id,suggestionType:"thing",Display:"".concat(e.Name)}),e.Types.forEach((function(t){X.push({_id:e._id,suggestionType:"thing",Display:"".concat(t.Name,"-").concat(e.Name)})}))})),localStorage.setItem("thingSuggestions",JSON.stringify(X)),Object.assign({},e,{things:Q})}if("UPDATE_SELECTED_TYPE"===t.type){var Z=Object(z.a)(Object(z.a)({},t.payload),{},{changedAt:Date.now()});return Object.assign({},e,{selectedType:Z})}if("UPDATE_TYPE"===t.type){var ee=Object($.a)(e.types),te=ee.filter((function(e){return e._id===t.payload._id}))[0];return te.Name=t.payload.Name,te.Description=t.payload.Description,te.Supers=t.payload.Supers,te.AttributesArr=t.payload.AttributesArr,te.Attributes=t.payload.Attributes,localStorage.setItem("types",JSON.stringify(ee)),Object.assign({},e,{types:ee})}if("UPDATE_SELECTED_THING"===t.type){var ae=Object(z.a)(Object(z.a)({},t.payload),{},{changedAt:Date.now()});return Object.assign({},e,{selectedThing:ae})}if("UPDATE_THING"===t.type){var re=Object($.a)(e.things),ne=re.filter((function(e){return e._id===t.payload._id}))[0];return ne.Name=t.payload.Name,ne.Description=t.payload.Description,ne.Types=t.payload.Types,ne.Attributes=t.payload.Attributes,localStorage.setItem("things",JSON.stringify(re)),Object.assign({},e,{things:re})}return"TOGGLE_MENU"===t.type?Object.assign({},e,{menuOpen:!e.menuOpen}):"TOGGLE_LOGIN"===t.type?Object.assign({},e,{fromLogin:e.loginOpen,loginOpen:!e.loginOpen}):"NOT_FROM_LOGIN"===t.type?Object.assign({},e,{fromLogin:!1}):"SET_WIDTH"===t.type?Object.assign({},e,{width:t.payload}):"SET_FOLLOWING_WORLDS"===t.type?(localStorage.setItem("followingWorlds",JSON.stringify(t.payload)),Object.assign({},e,{followingWorlds:t.payload})):e},session:Tr.sessionReducer},wr=Object(vr.b)(Dr),Ir=Object(vr.c)(wr),Ar={refreshFromLocalStorage:!0,refreshOnCheckAuth:!0,redirectPath:"/home",driver:"COOKIES",validateSession:function(e){return!0}};Tr.sessionService.initSessionService(Ir,Ar).then((function(){return console.log("Redux React Session is ready and a session was refreshed from your storage")})).catch((function(){return console.log("Redux React Session is ready and there is no session in your storage")}));var Sr=Ir;s.a.render(n.a.createElement(d.a,{store:Sr},n.a.createElement(yr,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[218,1,2]]]);
//# sourceMappingURL=main.4079d427.chunk.js.map