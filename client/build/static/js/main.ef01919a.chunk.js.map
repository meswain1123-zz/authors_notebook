{"version":3,"sources":["assets/img/ANB.png","redux/actions/index.js","redux/constants/actionTypes.js","smartAPI.js","views/Home.js","components/Inputs/CommentControl.js","components/Inputs/CommentsControl.js","views/Discussion/GeneralDiscussion.js","components/Navigation/routes.js","components/Navigation/MobileMenu.js","components/Navigation/UserMenu.js","components/Navigation/Navbar.js","components/Navigation/Sidebar.js","views/User/Profile.js","views/World/Index.js","components/Inputs/TextBox.js","components/Modals/TemplateModal.js","components/Modals/TemplatesModal.js","views/World/Details.js","views/World/Edit.js","views/User/LoginControl.js","views/World/Collaborate.js","views/World/EditCollaborators.js","views/Type/Details.js","views/Type/AttributeControl.js","views/Type/AttributeDefaultControl.js","views/Type/AttributesControl.js","components/Modals/NewTypeModal.js","components/Modals/NewThingModal.js","views/Type/Edit.js","components/Displays/ThingTable.js","views/Thing/Details.js","views/Thing/AttributeControl.js","views/Thing/AttributesControl.js","views/Thing/Edit.js","views/User/ResetPassword.js","views/User/ConfirmEmail.js","views/MainPage.js","App.js","serviceWorker.js","redux/reducers/index.js","redux/store/index.js","index.js"],"names":["module","exports","logout","payload","type","setWorlds","setTemplates","updateWorld","setPublicWorlds","selectWorld","setAttributes","setTypes","addType","setThings","addThing","updateType","updateSelectedType","updateThing","updateSelectedThing","toggleMenu","toggleLogin","notFromLogin","setFollowingWorlds","UnauthorizedError","message","this","name","prototype","Error","API","instance","getInstance","APIClass","logErrorReason","reason","console","log","Promise","reject","checkStatus","response","status","unauthorizedError","statusText","error","getVersion","a","real","fetchData","processResponse","version","getAllUsers","retry","relogin","_id","email","username","login","user","stayLoggedIn","sessionObj","body","expiresAt","sessionStorage","setItem","JSON","stringify","postData","removeItem","register","confirmEmail","code","patchData","sendReset","checkResetPasswordCode","resetPassword","newPassword","emailTest","updateUser","createTemplate","template","getTemplates","getTemplatesFromAPI","data","getSessionData","worldID","Name","getWorlds","refresh","getPublicWorlds","publicWorlds","getWorldsForUser","userWorlds","templates","getWorldsForUserFromAPI","res","OwnerID","Public","getPublicWorldsFromAPI","getWorld","getAttributesForWorld","attributes","getTypesForWorld","types","getThingsForWorld","things","attributesByID","attributesByName","forEach","attribute","TypeIDs","t","Supers","SuperIDs","sID","concat","filter","t2","AttributesArr","Attributes","attr","attrID","undefined","push","index","length","trim","AttributeType","Options","DefinedType","ListType","defHash","Defaults","def","DefaultsHash","Types","tID","createWorld","world","deleteWorld","deleteData","generateCollabLink","addNewCollaborator","userID","emailCollaborator","deleteCollab","collabID","updateCollaboratorPermission","editPermission","checkCollabID","requestToCollaborate","declineCollabInvite","acceptCollabInvite","acceptCollabRequest","getAttributesForWorldFromAPI","getAttribute","Description","createAttribute","upsertAttributes","getTypesForWorldFromAPI","getType","typeID","createType","deleteType","getThingsForWorldFromAPI","getThing","thingID","createThing","thing","deleteThing","getComments","objectType","objectID","addComment","comment","updateComment","path","options","fetch","mode","credentials","headers","Accept","then","catch","method","putData","sessionName","noExpiry","json","Date","setHours","getHours","sessionStr","getItem","parse","Page","props","state","redirectTo","fromLogin","to","Component","HomePage","connect","app","dispatch","useStyles","makeStyles","root","vote","theVote","changeWaiting","votes","updatedComment","rootComment","replies","r","cleanReply","api","object","comments","prepComment","changeComments","err","reply","newReply","voteSum","i","allUsers","u","time","Object","values","reduce","total","CommentControl","classes","useState","value","changeValue","replying","changeReplying","Grid","container","spacing","direction","item","Card","className","CardContent","Typography","variant","color","toLocaleDateString","toLocaleTimeString","component","text","CardActions","disableSpacing","IconButton","aria-label","onClick","_","style","fontWeight","marginLeft","xs","map","key","marginTop","newComments","newWaiting","FormControl","fullWidth","InputLabel","htmlFor","OutlinedInput","id","autoComplete","multiline","onChange","e","target","onKeyPress","shiftKey","labelWidth","CommentsControl","waiting","changeUsers","loadUsers","changeLoadUsers","loadComments","changeLoadComments","setTimeout","Owner","Collaborators","c","disabled","Button","commentID","saveComment","commentsChange","GeneralDiscussionPage","menuRoutes","icon","Home","Forum","Menu","toggleFollow","follow","followingWorlds","indexOf","splice","handleUserInput","checked","setState","browse","Filter","worlds","prop","ListItem","width","activeClassName","button","Icon","ListItemText","primary","otherWorlds","w","toLowerCase","includes","List","Fab","size","Star","links","display","Tooltip","title","Search","Add","myWorlds","MobileMenu","selectedPage","worldIDs","StyledMenu","withStyles","paper","border","elevation","getContentAnchorEl","anchorOrigin","vertical","horizontal","transformOrigin","UserMenu","React","anchorEl","setAnchorEl","aria-controls","aria-haspopup","cursor","event","currentTarget","keepMounted","open","Boolean","onClose","MenuItem","onLogout","Bar","loadFromStorage","AppBar","position","Toolbar","selectedWorld","mobileMenuOpen","Box","sm","NavBar","menuOpen","page","src","logo","alt","logoText","brand","Divider","light","Sidebar","inputBlur","validation","validateField","fieldValidation","valid","fieldName","match","validateForm","respond","nameValid","emailValid","formValid","onSubmit","submitThroughAPI","errors","loginError","show","userLogin","onLogin","load","finishLoading","res2","loaded","Helmet","ProfilePage","attrs","Index","handleChange","panel","updateIndexExpandedPanel","indexExpandedPanel","majorless","Major","createButtons","maxWidth","Edit","PluralName","j","ThingIndex","TextBox","Value","displayName","onBlur","FormHelperText","TemplateModal","changeName","changeMessage","nameMessage","changeNameMessage","typeIDs","changeTypeIDs","changeValid","n","validate","newTypeIDs","FormControlLabel","control","Checkbox","addTypeToList","superType","attrType","removeTypeFromList","subTypes","subType","references","ReferenceIDs","label","templateName","onSave","saveTemplate","onCancel","TemplatesModal","selectedTemplate","changeSelectedTemplate","selectedTemplateIDs","changeSelectedTemplates","newSelectedTemplateIDs","typeKey","aKey","delete","selectedWorldID","modalOpen","getModalStyle","top","Math","round","window","innerHeight","left","innerWidth","transform","updatePublicWorldForCollab","respondToInvite","invite","updateTemplates","templateMode","importSelectedTemplates","templatesToImport","importDumbTypesRecursive","typePos","newTypes","typeMap","existingType","compareAndFixAttributes","upsertUs","nameChanges","existingAttribute","attrOptions","o","attrMap","addAttributesToDumbTypesRecursive","newType","attributesAdded","realID","templateIDs","importMode","getTypes","updateAttributes","getThings","params","People","Delete","AcceptingCollaborators","Modal","aria-labelledby","aria-describedby","WorldDetailsPage","a11yProps","addWorld","tempSelectedTemplateIDs","ArrowBack","keys","WorldEditPage","Control","componentDidMount","remember","handleClickShowPassword","showPassword","handleMouseDownPassword","preventDefault","password","confirmEmailValid","passwordValid","confirmPasswordValid","usernameValid","formMode","confirmPassword","loginClick","registerClick","passwordClick","cookies","Cookies","emailCookie","get","passCookie","endAdornment","InputAdornment","onMouseDown","edge","Link","LoginControl","accept","accepted","submitAccept","refreshWorld","onLoginAccept","decline","submitDecline","codeValid","CollaboratePage","TabPanel","children","p","selectedUser","collabs","inviteMessage","inviteEmail","collaborator","permission","collabLink","collabLinkCopied","collab","acceptCollab","copyCollabLink","generatedLink","select","document","execCommand","actuallyFinishLoading","newCollaborators","newCollabTab","collabTab","invites","requests","userMenuItems","Tabs","newValue","Tab","Select","labelId","ref","input","FileCopyOutlined","fontColor","direcion","Check","EditCollaboratorPage","redirectToNext","selectedType","inheritedAttributes","definedType","option","DefaultValue","DefaultListValues","defaultValue","defaultThing","sub","instances","TypeDetails","handleDefinedTypeChange","onNewType","handleOptionsChange","AttributeControl","attributeTypes","listTypes","selectedListType","selectedDefinedType","fromTypes","FromTypeIDs","handleTypeChange","chips","handleListTypeChange","onDelete","AttributeDefaultControl","attributeType","selectedTypeValue","listOptions","listOptionValues","onNewThing","placeholder","handleTextListChange","selectedValues","onSelect","selectedItem","addOption","onRemove","selectedList","removeOption","displayValue","addThingOfType","removeType","newAttribute","uuid","changeAttribute","changeDefault","blurAttribute","deleteAttribute","defaults","addNewType","addNewThing","defaultsMode","s","inheritedAttribute","AttributesControl","NewTypeModal","saveNewType","NewThingModal","newThingType","saveNewThing","resetForm","resetting","attrByName","attrArrValid","addMore","superIDs","typeAttributes","DefaultReferenceIDs","FromTypeID","supersChange","supers","addSuper","s2","duplicateAttributes","d","addSelectedAttribute","browseAttributesSelected","browseTypesSelected","addBrowsedType","removeSuper","removedItem","removeUs","checkMe","renderAttributes","typeModalOpen","putTypeOnAttribute","thingModalOpen","putThingOnAttribute","browseAttributes","additionalAttributes","selectedAttributeTypes","selectedAttributeName","found","desc","TypeEditPage","addAttributes","rows","descendingComparator","b","orderBy","ThingTableHead","order","onRequestSort","columnMap","TableHead","TableRow","headCell","TableCell","align","numeric","padding","disablePadding","sortDirection","TableSortLabel","active","property","visuallyHidden","useToolbarStyles","theme","paddingLeft","paddingRight","highlight","palette","secondary","main","backgroundColor","lighten","dark","flex","ThingTableToolbar","marginBottom","table","clip","height","margin","overflow","ThingTable","newRow","attrThing","allThings","ListValues","v","Type","setOrder","setOrderBy","selected","setSelected","setPage","rowsPerPage","setRowsPerPage","Paper","TableContainer","Table","numSelected","onSelectAllClick","newSelecteds","rowCount","TableBody","array","comparator","stabilizedThis","el","sort","stableSort","getComparator","slice","row","isItemSelected","hover","role","aria-checked","tabIndex","column","buttonClick","TablePagination","rowsPerPageOptions","count","onChangePage","newPage","onChangeRowsPerPage","parseInt","finishDelete","majorType","selectedThing","listValue","ThingDetails","FromTypes","infoModal","optionsChange","onInfo","modalSubmit","infoModalOpen","createThingFromType","newAttributes","existing","finishResettingForm","substring","handleInfoAttrNameChange","infoAttribute","inputBlur2","attr2","attrValid","validateAttrForm","infoAttributeName","typesChange","addType2","selectNewTypeForAttribute","newTypeForAttribute","saveInfoAttribute","submitAttributeThroughAPI","theType","newFromTypeIDs","browseAttributesFilter","typeStr","connectedTypes","otherTypes","fontSize","newThing","renderHeader","ThingEditPage","resetPasswordCode","ResetPasswordPage","confirmEmailCode","ConfirmEmailPage","loginOpen","exact","EditCollaboratorsPage","TypeDetailsPage","ThingDetailsPage","MainPage","AppLayout","updateDimensions","addEventListener","bind","removeEventListener","setWidth","setAPI","marginRight","App","location","hostname","initialState","articles","redirectToURL","loadIt","rootReducer","reducers","action","assign","worldArr","wasPublic","publicWorld","changedType","changedAt","now","changedThing","session","sessionReducer","reducer","combineReducers","store","createStore","refreshFromLocalStorage","refreshOnCheckAuth","redirectPath","driver","validateSession","sessionService","initSessionService","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.ef01919a.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,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\"","import {\r\n  SET_API,\r\n  ADD_ARTICLE,\r\n  LOGIN,\r\n  LOGOUT,\r\n  REDIRECT_TO,\r\n  SET_WORLDS,\r\n  SET_PUBLIC_WORLDS,\r\n  SET_TEMPLATES,\r\n  ADD_WORLD,\r\n  UPDATE_WORLD,\r\n  UPDATE_PUBLIC_WORLD_COLLAB,\r\n  SELECT_WORLD,\r\n  SET_ATTRIBUTES,\r\n  ADD_ATTRIBUTES,\r\n  UPDATE_ATTRIBUTES,\r\n  SET_TYPES,\r\n  ADD_TYPE,\r\n  SET_THINGS,\r\n  ADD_THING,\r\n  UPDATE_TYPE,\r\n  UPDATE_SELECTED_TYPE,\r\n  UPDATE_THING,\r\n  UPDATE_SELECTED_THING,\r\n  LOAD_FROM_STORAGE,\r\n  TOGGLE_MENU,\r\n  TOGGLE_LOGIN,\r\n  NOT_FROM_LOGIN,\r\n  SET_FOLLOWING_WORLDS,\r\n  SET_WIDTH,\r\n  UPDATE_INDEX_EXPANDED_PANEL\r\n} from \"../constants/actionTypes\";\r\n\r\nexport function updateIndexExpandedPanel(payload) {\r\n  return { type: UPDATE_INDEX_EXPANDED_PANEL, payload };\r\n}\r\nexport function setAPI(payload) {\r\n  return { type: SET_API, payload };\r\n}\r\nexport function addArticle(payload) {\r\n  return { type: ADD_ARTICLE, payload };\r\n}\r\nexport function userLogin(payload) {\r\n  return { type: LOGIN, payload };\r\n}\r\nexport function logout(payload) {\r\n  return { type: LOGOUT, payload };\r\n}\r\nexport function redirectTo(payload) {\r\n  return { type: REDIRECT_TO, payload };\r\n}\r\nexport function setWorlds(payload) {\r\n  return { type: SET_WORLDS, payload };\r\n}\r\nexport function setTemplates(payload) {\r\n  return { type: SET_TEMPLATES, payload };\r\n}\r\nexport function addWorld(payload) {\r\n  return { type: ADD_WORLD, payload };\r\n}\r\nexport function updateWorld(payload) {\r\n  return { type: UPDATE_WORLD, payload };\r\n}\r\nexport function updatePublicWorldForCollab(payload) {\r\n  return { type: UPDATE_PUBLIC_WORLD_COLLAB, payload };\r\n}\r\nexport function setPublicWorlds(payload) {\r\n  return { type: SET_PUBLIC_WORLDS, payload };\r\n}\r\nexport function selectWorld(payload) {\r\n  return { type: SELECT_WORLD, payload };\r\n}\r\nexport function setAttributes(payload) {\r\n  return { type: SET_ATTRIBUTES, payload };\r\n}\r\nexport function addAttributes(payload) {\r\n  return { type: ADD_ATTRIBUTES, payload };\r\n}\r\nexport function updateAttributes(payload) {\r\n  return { type: UPDATE_ATTRIBUTES, payload };\r\n}\r\nexport function setTypes(payload) {\r\n  return { type: SET_TYPES, payload };\r\n}\r\nexport function addType(payload) {\r\n  return { type: ADD_TYPE, payload };\r\n}\r\nexport function setThings(payload) {\r\n  return { type: SET_THINGS, payload };\r\n}\r\nexport function addThing(payload) {\r\n  return { type: ADD_THING, payload };\r\n}\r\nexport function updateType(payload) {\r\n  return { type: UPDATE_TYPE, payload };\r\n}\r\nexport function updateSelectedType(payload) {\r\n  return { type: UPDATE_SELECTED_TYPE, payload };\r\n}\r\nexport function updateThing(payload) {\r\n  return { type: UPDATE_THING, payload };\r\n}\r\nexport function updateSelectedThing(payload) {\r\n  return { type: UPDATE_SELECTED_THING, payload };\r\n}\r\nexport function loadFromStorage(payload) {\r\n  return { type: LOAD_FROM_STORAGE, payload };\r\n}\r\nexport function toggleMenu(payload) {\r\n  return { type: TOGGLE_MENU, payload };\r\n}\r\nexport function toggleLogin(payload) {\r\n  return { type: TOGGLE_LOGIN, payload };\r\n}\r\nexport function notFromLogin(payload) {\r\n  return { type: NOT_FROM_LOGIN, payload };\r\n}\r\nexport function setFollowingWorlds(payload) {\r\n  return { type: SET_FOLLOWING_WORLDS, payload };\r\n}\r\nexport function setWidth(payload) {\r\n  return { type: SET_WIDTH, payload };\r\n}\r\n","\r\nexport const UPDATE_INDEX_EXPANDED_PANEL = \"UPDATE_INDEX_EXPANDED_PANEL\";\r\nexport const SET_API = \"SET_API\";\r\nexport const ADD_ARTICLE = \"ADD_ARTICLE\";\r\nexport const LOGIN = \"LOGIN\";\r\nexport const LOGOUT = \"LOGOUT\";\r\nexport const REDIRECT_TO = \"REDIRECT_TO\";\r\nexport const SET_WORLDS = \"SET_WORLDS\";\r\nexport const SET_PUBLIC_WORLDS = \"SET_PUBLIC_WORLDS\";\r\nexport const SET_TEMPLATES = \"SET_TEMPLATES\";\r\nexport const ADD_WORLD = \"ADD_WORLD\";\r\nexport const UPDATE_WORLD = \"UPDATE_WORLD\";\r\nexport const UPDATE_PUBLIC_WORLD_COLLAB = \"UPDATE_PUBLIC_WORLD_COLLAB\";\r\nexport const SELECT_WORLD = \"SELECT_WORLD\";\r\nexport const SET_TYPES = \"SET_TYPES\";\r\nexport const ADD_TYPE = \"ADD_TYPE\";\r\nexport const SET_THINGS = \"SET_THINGS\";\r\nexport const ADD_THING = \"ADD_THING\";\r\nexport const UPDATE_TYPE = \"UPDATE_TYPE\";\r\n// export const UPDATE_ATTRIBUTES_ARR = \"UPDATE_ATTRIBUTES_ARR\";\r\nexport const SET_ATTRIBUTES = \"SET_ATTRIBUTES\";\r\nexport const ADD_ATTRIBUTES = \"ADD_ATTRIBUTES\";\r\nexport const UPDATE_ATTRIBUTES = \"UPDATE_ATTRIBUTES\";\r\nexport const UPDATE_SELECTED_TYPE = \"UPDATE_SELECTED_TYPE\";\r\nexport const UPDATE_THING = \"UPDATE_THING\";\r\nexport const UPDATE_SELECTED_THING = \"UPDATE_SELECTED_THING\";\r\nexport const LOAD_FROM_STORAGE = \"LOAD_FROM_STORAGE\";\r\nexport const TOGGLE_MENU = \"TOGGLE_MENU\";\r\nexport const TOGGLE_LOGIN = \"TOGGLE_LOGIN\";\r\nexport const NOT_FROM_LOGIN = \"NOT_FROM_LOGIN\";\r\nexport const SET_FOLLOWING_WORLDS = \"SET_FOLLOWING_WORLDS\";\r\nexport const SET_WIDTH = \"SET_WIDTH\";\r\n","\r\n// This is our special type of Error that represents\r\n// when a request got a 401 Unauthorized response\r\nfunction UnauthorizedError(message) {\r\n  this.name = \"UnauthorizedError\";\r\n  this.message = message;\r\n}\r\nUnauthorizedError.prototype = new Error();\r\n\r\nvar API = (function() {\r\n  var instance;\r\n\r\n  function createInstance() {\r\n    var api = new APIClass();\r\n    return api;\r\n  }\r\n\r\n  return {\r\n    getInstance: function() {\r\n      if (!instance) {\r\n        instance = createInstance();\r\n      }\r\n      return instance;\r\n    }\r\n  };\r\n})();\r\n\r\nclass APIClass {\r\n  constructor() {\r\n    this.real = true;\r\n  }\r\n\r\n  logErrorReason = reason => {\r\n    // log the error reason but keep the rejection\r\n    console.log(\"Response error reason:\", reason);\r\n    return Promise.reject(reason);\r\n  };\r\n\r\n  checkStatus = response => {\r\n    if (response.status >= 200 && response.status < 300) {\r\n      return response;\r\n    } else if (response.status === 401) {\r\n      var unauthorizedError = new UnauthorizedError(response.statusText);\r\n      unauthorizedError.response = response;\r\n      return Promise.reject(unauthorizedError);\r\n    } else {\r\n      var error = new Error(response.statusText);\r\n      error.response = response;\r\n      return Promise.reject(error);\r\n    }\r\n  };\r\n\r\n  getVersion = async () => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(\"/version\");\r\n      return this.processResponse(response);\r\n    } else {\r\n      return { version: \"0.0.1\" };\r\n    }\r\n  };\r\n\r\n  // User\r\n  getAllUsers = async () => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(\"/api/user/getAllUsers\");\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(\"/api/user/getAllUsers\");\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return [{\r\n        _id: \"-1\",\r\n        email: \"fake@fakemail.com\",\r\n        username: \"Liar Liar\"\r\n      }];\r\n    }\r\n  };\r\n\r\n  login = async (user, stayLoggedIn) => {\r\n    if (this.real) {\r\n      if (stayLoggedIn) {\r\n        const sessionObj = {\r\n          body: user,\r\n          expiresAt: \"never\"\r\n        };\r\n        sessionStorage.setItem(\"loginUser\", JSON.stringify(sessionObj));\r\n      }\r\n      const response = await this.postData(\"/api/user/login\", user);\r\n      return this.processResponse(response, null, \"user\", stayLoggedIn);\r\n    } else {\r\n      return {\r\n        _id: \"-1\",\r\n        email: \"fake@fakemail.com\",\r\n        username: \"Liar Liar\"\r\n      };\r\n    }\r\n  }\r\n\r\n  logout = async user => {\r\n    if (this.real) {\r\n      await this.postData(\"/api/user/logout\");\r\n      sessionStorage.removeItem(\"user\");\r\n    }\r\n  };\r\n\r\n  register = async user => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/user/register\", user);\r\n      return this.processResponse(response);\r\n    } else {\r\n      return -1;\r\n    }\r\n  };\r\n\r\n  confirmEmail = async (code) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/user/confirmEmail\", {code});\r\n      return this.processResponse(response);\r\n    } else {\r\n      return {\r\n        _id: \"-1\",\r\n        email: \"fake@fakemail.com\",\r\n        username: \"Liar Liar\"\r\n      };\r\n    }\r\n  };\r\n\r\n  sendReset = async user => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/user/sendReset\", user);\r\n      return this.processResponse(response);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  checkResetPasswordCode = async code => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/user/checkResetPasswordCode\", {code});\r\n      return this.processResponse(response);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n  \r\n  resetPassword = async (code, newPassword) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/user/resetPassword\", {code, newPassword});\r\n      return this.processResponse(response);\r\n    } else {\r\n      return {\r\n        _id: \"-1\",\r\n        email: \"fake@fakemail.com\",\r\n        username: \"Liar Liar\"\r\n      };\r\n    }\r\n  };\r\n\r\n  emailTest = async user => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/user/emailTest\", user);\r\n      return this.processResponse(response);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n  \r\n  updateUser = async user => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/user/update\", user);\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/user/update\", user);\r\n        return this.processResponse(response, null);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return {\r\n        _id: \"-1\",\r\n        email: \"fake@fakemail.com\",\r\n        username: \"Liar Liar\"\r\n      };\r\n    }\r\n  };\r\n\r\n  // Templates\r\n  createTemplate = async (template) => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/world/createTemplate\", { template: template });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.postData(\"/api/world/createTemplate\", { template: template });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return -1;\r\n    }\r\n  }\r\n\r\n  getTemplates = async (refresh = false) => {\r\n    if (refresh) {\r\n      return this.getTemplatesFromAPI();\r\n    }\r\n    else {\r\n      const data = this.getSessionData(\"templates\");\r\n      if (data !== null) {\r\n        return data;\r\n      }\r\n      else {\r\n        return this.getTemplatesFromAPI();\r\n      }\r\n    }\r\n  }\r\n  getTemplatesFromAPI = async () => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(\r\n        `/api/world/getTemplates/`\r\n      );\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(\r\n          `/api/world/getTemplates/`\r\n        );\r\n        return this.processResponse(response, null, `templates`);\r\n      }\r\n      return this.processResponse(response, retry, `templates`);\r\n    } else {\r\n      return [{ _id: -1, worldID: -1, Name: \"Alice\" }];\r\n    }\r\n  }\r\n\r\n  // World\r\n  getWorlds = async (refresh = false) => {\r\n    try {\r\n      const publicWorlds = await this.getPublicWorlds(refresh);\r\n      const userWorlds = await this.getWorldsForUser(refresh);\r\n      const templates = await this.getTemplates(refresh);\r\n\r\n      return {\r\n        publicWorlds,\r\n        userWorlds,\r\n        templates\r\n      };\r\n    }\r\n    catch (error) {\r\n      console.log(error);\r\n      return { error };\r\n    }\r\n  };\r\n\r\n  getWorldsForUser = async (refresh = false) => {\r\n    if (refresh) {\r\n      return this.getWorldsForUserFromAPI();\r\n    }\r\n    else {\r\n      const data = this.getSessionData(\"worlds\");\r\n      if (data !== null) {\r\n        return data;\r\n      }\r\n      else {\r\n        return this.getWorldsForUserFromAPI();\r\n      }\r\n    }\r\n  };\r\n  getWorldsForUserFromAPI = async () => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(`/api/world/getWorldsForUser`);\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(`/api/world/getWorldsForUser`);\r\n        return this.processResponse(response, null, \"worlds\");\r\n      }\r\n      const res = this.processResponse(response, retry, \"worlds\");\r\n      return res;\r\n    } else {\r\n      return [\r\n        { _id: -1, OwnerID: -1, Name: \"Alice in Wonderland\", Public: true }\r\n      ];\r\n    }\r\n  };\r\n\r\n  getPublicWorlds = async (refresh = false) => {\r\n    if (refresh) {\r\n      return this.getPublicWorldsFromAPI();\r\n    }\r\n    else {\r\n      const data = this.getSessionData(\"publicWorlds\");\r\n      if (data !== null) {\r\n        return data;\r\n      }\r\n      else {\r\n        return this.getPublicWorldsFromAPI();\r\n      }\r\n    }\r\n  };\r\n  getPublicWorldsFromAPI = async () => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(\"/api/world/getPublicWorlds\");\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(\"/api/world/getPublicWorlds\");\r\n        return this.processResponse(response, null, \"publicWorlds\");\r\n      }\r\n      return this.processResponse(response, retry, \"publicWorlds\");\r\n    } else {\r\n      return [\r\n        { _id: -1, OwnerID: -1, Name: \"Alice in Wonderland\", Public: true }\r\n      ];\r\n    }\r\n  };\r\n\r\n  getWorld = async (worldID, refresh = false) => {\r\n    try {\r\n      let attributes = await this.getAttributesForWorld(worldID, refresh);\r\n      attributes = attributes.attributes;\r\n      let types = await this.getTypesForWorld(worldID, refresh);\r\n      types = types.types;\r\n      let things = await this.getThingsForWorld(worldID, refresh);\r\n      things = things.things;\r\n\r\n      // Now connect them all as is appropriate.\r\n      const attributesByID = {};\r\n      const attributesByName = {};\r\n      attributes.forEach(attribute => {\r\n        attribute.TypeIDs = [];\r\n        attributesByID[attribute._id] = attribute;\r\n        attributesByName[attribute.Name] = attribute;\r\n      });\r\n      types.forEach(t=> {\r\n        t.Supers = [];\r\n        t.SuperIDs.forEach(sID=> {\r\n          t.Supers = t.Supers.concat(types.filter(t2=>t2._id === sID));\r\n        });\r\n        t.AttributesArr = [];\r\n        t.Attributes.forEach(a => {\r\n          const attr = attributesByID[a.attrID];\r\n          if (attr === undefined) {\r\n          }\r\n          else {\r\n            attr.TypeIDs.push(t._id);\r\n            t.AttributesArr.push({\r\n              index: t.AttributesArr.length,\r\n              Name: attr.Name.trim(),\r\n              AttributeType: attr.AttributeType,\r\n              Options: attr.Options,\r\n              DefinedType: attr.DefinedType,\r\n              ListType: attr.ListType,\r\n              attrID: a.attrID,\r\n              TypeIDs: attr.TypeIDs\r\n            });\r\n          }\r\n        });\r\n        const defHash = {};\r\n        if (t.Defaults !== undefined) {\r\n          t.Defaults.forEach(def => {\r\n            defHash[def.attrID] = def;\r\n          });\r\n        }\r\n        t.DefaultsHash = defHash;\r\n      });\r\n      things.forEach(t=> {\r\n        t.Types = [];\r\n        t.TypeIDs.forEach(tID=> {\r\n          t.Types = t.Types.concat(types.filter(t2=>t2._id === tID));\r\n        });\r\n      });\r\n      return {\r\n        attributes,\r\n        attributesByID,\r\n        attributesByName,\r\n        types,\r\n        things\r\n      };\r\n    }\r\n    catch (error) {\r\n      console.log(error);\r\n      return { error };\r\n    }\r\n  };\r\n\r\n  createWorld = async (world) => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/world/createWorld\", { world: world });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.postData(\"/api/world/createWorld\", { world: world });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return -1;\r\n    }\r\n  };\r\n\r\n  deleteWorld = async (worldID) => {\r\n    if (this.real) {\r\n      const response = await this.deleteData(\"/api/world/deleteWorld\", { worldID: worldID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.deleteData(\"/api/world/deleteWorld\", { worldID: worldID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  updateWorld = async (world) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/updateWorld\", { world: world });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/updateWorld\", { world: world });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  generateCollabLink = async (worldID) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/generateCollabLink\", { worldID: worldID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/generateCollabLink\", { worldID: worldID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  addNewCollaborator = async (worldID, userID, email) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/addNewCollaborator\", { worldID, userID, email });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/addNewCollaborator\", { worldID, userID, email });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  emailCollaborator = async (worldID, email) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/emailCollaborator\", { worldID, email });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/emailCollaborator\", { worldID, email });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  deleteCollab = async (worldID, collabID) => {\r\n    if (this.real) {\r\n      const response = await this.deleteData(\"/api/world/deleteCollab\", { worldID, collabID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.deleteData(\"/api/world/deleteCollab\", { worldID, collabID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  updateCollaboratorPermission = async (worldID, collabID, editPermission) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/updateCollaboratorPermission\", { worldID, collabID, editPermission });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/updateCollaboratorPermission\", { worldID, collabID, editPermission });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  checkCollabID = async (worldID, collabID) => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/world/checkCollabID\", {worldID, collabID});\r\n      return this.processResponse(response);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  requestToCollaborate = async (worldID) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/requestToCollaborate\", { worldID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/requestToCollaborate\", { worldID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  declineCollabInvite = async (worldID, collabID) => {\r\n    if (this.real) {\r\n      const response = await this.deleteData(\"/api/world/declineCollabInvite\", { worldID, collabID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.deleteData(\"/api/world/declineCollabInvite\", { worldID, collabID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  acceptCollabInvite = async (worldID, collabID) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/acceptCollabInvite\", { worldID, collabID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/acceptCollabInvite\", { worldID, collabID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  acceptCollabRequest = async (worldID, collabID) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/acceptCollabRequest\", { worldID, collabID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/acceptCollabRequest\", { worldID, collabID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  selectWorld = async (worldID) => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/world/selectWorld\", { worldID: worldID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.postData(\"/api/world/selectWorld\", { worldID: worldID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  // Attribute\r\n  getAttributesForWorld = async (worldID, refresh = false) => {\r\n    if (refresh) {\r\n      return this.getAttributesForWorldFromAPI(worldID);\r\n    }\r\n    else {\r\n      const data = this.getSessionData(`attributes_${worldID}`);\r\n      if (data !== null) {\r\n        return data;\r\n      }\r\n      else {\r\n        return this.getAttributesForWorldFromAPI(worldID);\r\n      }\r\n    }\r\n  };\r\n  getAttributesForWorldFromAPI = async (worldID) => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(\r\n        `/api/world/getAttributesForWorld/${worldID}`\r\n      );\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(\r\n          `/api/world/getAttributesForWorld/${worldID}`\r\n        );\r\n        return this.processResponse(response, null, `attributes_${worldID}`);\r\n      }\r\n      return this.processResponse(response, retry, `attributes_${worldID}`);\r\n    } else {\r\n      return [{ _id: -1, worldID: -1, Name: \"Character\" }];\r\n    }\r\n  };\r\n\r\n  getAttribute = async (worldID, attrID) => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(\r\n        `/api/world/getAttribute/${worldID}/${attrID}`\r\n      );\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(\r\n          `/api/world/getAttribute/${worldID}/${attrID}`\r\n        );\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return {\r\n        _id: -1,\r\n        worldID: -1,\r\n        Name: \"Character\",\r\n        Description: \"\",\r\n        // AttributesArr: {},\r\n        Attributes: {}\r\n      };\r\n    }\r\n  };\r\n\r\n  createAttribute = async (attribute) => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/world/createAttribute\", { attribute: attribute });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.postData(\"/api/world/createAttribute\", { attribute: attribute });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return -1;\r\n    }\r\n  };\r\n\r\n  // deleteAttribute = async (worldID, attrID) => {\r\n  //   if (this.real) {\r\n  //     const response = await this.deleteData(\"/api/world/deleteAttribute\", { worldID: worldID, attrID: attrID });\r\n  //     return this.processResponse(response);\r\n  //   } else {\r\n  //     return \"success\";\r\n  //   }\r\n  // };\r\n\r\n  // updateAttribute = async (attribute) => {\r\n  //   if (this.real) {\r\n  //     const response = await this.patchData(\"/api/world/updateAttribute\", { attribute: attribute });\r\n  //     return this.processResponse(response);\r\n  //   } else {\r\n  //     return \"success\";\r\n  //   }\r\n  // };\r\n\r\n  upsertAttributes = async (worldID, attributes) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/upsertAttributes\", { worldID, attributes: attributes });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/upsertAttributes\", { worldID, attributes: attributes });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n  // Type\r\n  getTypesForWorld = async (worldID, refresh = false) => {\r\n    if (refresh) {\r\n      return this.getTypesForWorldFromAPI(worldID);\r\n    }\r\n    else {\r\n      const data = this.getSessionData(`types_${worldID}`);\r\n      if (data !== null) {\r\n        return data;\r\n      }\r\n      else {\r\n        return this.getTypesForWorldFromAPI(worldID);\r\n      }\r\n    }\r\n  };\r\n  getTypesForWorldFromAPI = async (worldID) => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(\r\n        `/api/world/getTypesForWorld/${worldID}`\r\n      );\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(\r\n          `/api/world/getTypesForWorld/${worldID}`\r\n        );\r\n        return this.processResponse(response, null, `types_${worldID}`);\r\n      }\r\n      return this.processResponse(response, retry, `types_${worldID}`);\r\n    } else {\r\n      return [{ _id: -1, worldID: -1, Name: \"Character\" }];\r\n    }\r\n  };\r\n\r\n  getType = async (worldID, typeID) => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(\r\n        `/api/world/getType/${worldID}/${typeID}`\r\n      );\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(\r\n          `/api/world/getType/${worldID}/${typeID}`\r\n        );\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return {\r\n        _id: -1,\r\n        worldID: -1,\r\n        Name: \"Character\",\r\n        Description: \"\",\r\n        // AttributesArr: {},\r\n        Attributes: {}\r\n      };\r\n    }\r\n  };\r\n\r\n  createType = async (type) => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/world/createType\", { type: type });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.postData(\"/api/world/createType\", { type: type });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return -1;\r\n    }\r\n  };\r\n\r\n  deleteType = async (worldID, typeID) => {\r\n    if (this.real) {\r\n      const response = await this.deleteData(\"/api/world/deleteType\", { worldID: worldID, typeID: typeID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.deleteData(\"/api/world/deleteType\", { worldID: worldID, typeID: typeID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  updateType = async (type) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/updateType\", { type: type });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/updateType\", { type: type });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  // Thing\r\n  getThingsForWorld = async (worldID, refresh = false) => {\r\n    if (refresh) {\r\n      return this.getThingsForWorldFromAPI(worldID);\r\n    }\r\n    else {\r\n      const data = this.getSessionData(`things_${worldID}`);\r\n      if (data !== null) {\r\n        return data;\r\n      }\r\n      else {\r\n        return this.getThingsForWorldFromAPI(worldID);\r\n      }\r\n    }\r\n  };\r\n  getThingsForWorldFromAPI = async (worldID) => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(\r\n        `/api/world/getThingsForWorld/${worldID}`\r\n      );\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(\r\n          `/api/world/getThingsForWorld/${worldID}`\r\n        );\r\n        return this.processResponse(response, null, `things_${worldID}`);\r\n      }\r\n      return this.processResponse(response, retry, `things_${worldID}`);\r\n    } else {\r\n      return [{ _id: -1, worldID: -1, Name: \"Alice\" }];\r\n    }\r\n  };\r\n\r\n  getThing = async (worldID, thingID) => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(`/api/world/getThing/${worldID}/${thingID}`);\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.fetchData(`/api/world/getThing/${worldID}/${thingID}`);\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return {\r\n        _id: -1,\r\n        worldID: -1,\r\n        Types: [-1],\r\n        Name: \"Alice\",\r\n        Description: \"\"\r\n      };\r\n    }\r\n  };\r\n\r\n  createThing = async (thing) => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/world/createThing\", { thing: thing });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.postData(\"/api/world/createThing\", { thing: thing });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return -1;\r\n    }\r\n  };\r\n\r\n  deleteThing = async (worldID, thingID) => {\r\n    if (this.real) {\r\n      const response = await this.deleteData(\"/api/world/deleteThing\", { worldID: worldID, thingID: thingID });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.deleteData(\"/api/world/deleteThing\", { worldID: worldID, thingID: thingID });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  updateThing = async (thing) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/updateThing\", { thing: thing });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/updateThing\", { thing: thing });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return \"success\";\r\n    }\r\n  };\r\n\r\n  // Comments\r\n  getComments = async (worldID, objectType, objectID) => {\r\n    if (this.real) {\r\n      const response = await this.fetchData(`/api/world/getComments/${worldID}/${objectType}/${objectID}`);\r\n      return this.processResponse(response);\r\n    } else {\r\n      return {\r\n        _id: -1,\r\n        worldID: -1,\r\n        Types: [-1],\r\n        Name: \"Alice\",\r\n        Description: \"\"\r\n      };\r\n    }\r\n  }\r\n\r\n  addComment = async (comment) => {\r\n    if (this.real) {\r\n      const response = await this.postData(\"/api/world/addComment\", { comment });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.postData(\"/api/world/addComment\", { comment });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return -1;\r\n    }\r\n  }\r\n\r\n  updateComment = async (comment) => {\r\n    if (this.real) {\r\n      const response = await this.patchData(\"/api/world/updateComment\", { comment });\r\n      const retry = async () => {\r\n        await this.relogin();\r\n        const response = await this.patchData(\"/api/world/updateComment\", { comment });\r\n        return this.processResponse(response);\r\n      }\r\n      return this.processResponse(response, retry);\r\n    } else {\r\n      return -1;\r\n    }\r\n  }\r\n\r\n  // Core API Calls\r\n  fetchData = async (path, options = {}) => {\r\n    return await fetch(`${path}`, {\r\n      mode: \"cors\",\r\n      credentials: \"include\",\r\n      ...options,\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        ...options.headers\r\n      }\r\n    })\r\n      .then(this.checkStatus)\r\n      .catch(this.logErrorReason);\r\n  };\r\n\r\n  postData = async (path, data, options = {}) => {\r\n    return await fetch(`${path}`, {\r\n      mode: \"cors\",\r\n      credentials: \"include\",\r\n      ...options,\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        ...options.headers\r\n      },\r\n      method: \"POST\",\r\n      body: JSON.stringify(data)\r\n    })\r\n      .then(this.checkStatus)\r\n      .catch(this.logErrorReason);\r\n  };\r\n\r\n  putData = async (path, data, options = {}) => {\r\n    return await fetch(`${path}`, {\r\n      mode: \"cors\",\r\n      credentials: \"include\",\r\n      ...options,\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        ...options.headers\r\n      },\r\n      method: \"PUT\",\r\n      body: JSON.stringify(data)\r\n    })\r\n      .then(this.checkStatus)\r\n      .catch(this.logErrorReason);\r\n  };\r\n\r\n  patchData = async (path, data, options = {}) => {\r\n    return await fetch(`${path}`, {\r\n      mode: \"cors\",\r\n      credentials: \"include\",\r\n      ...options,\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        ...options.headers\r\n      },\r\n      method: \"PATCH\",\r\n      body: JSON.stringify(data)\r\n    })\r\n      .then(this.checkStatus)\r\n      .catch(this.logErrorReason);\r\n  };\r\n\r\n  deleteData = async (path, data, options = {}) => {\r\n    return await fetch(`${path}`, {\r\n      mode: \"cors\",\r\n      credentials: \"include\",\r\n      ...options,\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        ...options.headers\r\n      },\r\n      method: \"DELETE\",\r\n      body: JSON.stringify(data)\r\n    })\r\n      .then(this.checkStatus)\r\n      .catch(this.logErrorReason);\r\n  };\r\n\r\n  processResponse = async (response, retry = null, sessionName = null, noExpiry = false) => {\r\n    const body = await response.json();\r\n    if (response.status !== 200) { \r\n      throw Error(body.message);\r\n    }\r\n    else if (body.error !== undefined && retry !== null) {\r\n      return retry();\r\n    } \r\n    else {\r\n      if (sessionName !== null) {\r\n        let expiresAt = new Date();\r\n        if (noExpiry) \r\n          expiresAt = \"never\";\r\n        else \r\n          expiresAt.setHours(expiresAt.getHours() + 1);\r\n        const sessionObj = {\r\n          expiresAt,\r\n          body\r\n        };\r\n        sessionStorage.setItem(sessionName, JSON.stringify(sessionObj));\r\n      }\r\n      return body;\r\n    };\r\n  };\r\n\r\n  relogin = async () => {\r\n    try {\r\n      const user = this.getSessionData(\"loginUser\");\r\n      if (user !== null) {\r\n        const response = await this.postData(\"/api/user/login\", user);\r\n        this.processResponse(response, null, \"user\", true);\r\n      }\r\n    }\r\n    catch {}\r\n  }\r\n\r\n  getSessionData = (sessionName) => {\r\n    const sessionStr = sessionStorage.getItem(sessionName);\r\n    if (sessionStr !== null) {\r\n      const sessionObj = JSON.parse(sessionStr);\r\n      if (sessionObj.expiresAt !== undefined && \r\n        (sessionObj.expiresAt === \"never\" || sessionObj.expiresAt > new Date())) {\r\n        return sessionObj.body;\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n}\r\n\r\nexport default API;\r\n","import React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  notFromLogin\r\n} from \"../redux/actions/index\";\r\n// import MediaCard from \"../components/Displays/MediaCard\";\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    fromLogin: state.app.fromLogin\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    notFromLogin: () => dispatch(notFromLogin({}))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      version: \"0\",\r\n      redirectTo: null\r\n    };\r\n  }\r\n\r\n  componentDidMount() {}\r\n\r\n  render() {\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n    }\r\n    if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    } else {\r\n      return (\r\n        <div>\r\n          <h3>Author's Notebook</h3>\r\n\r\n          {/* <MediaCard title=\"ANB Basics Tutorial\" description=\"This video explains the basics of how to use the website and its tools.  It covers the basic concepts, creating a world, navigation, creating types, creating attributes, and creating things.\" /> */}\r\n\r\n          <p>\r\n            This is something that I've been wanting to build for a while. It's\r\n            purpose is to provide a place for keeping track of various aspects of\r\n            books that an author is writing. It is able to keep track of details\r\n            about characters, organizations, systems, and even storylines. I would\r\n            like to make it so it's publicly available, and that any authors\r\n            (aspiring and published) can use it to help them organize their\r\n            stories. I want to make it automate a number of things, but the\r\n            biggest part is to make it very dynamic and to allow for storage of\r\n            all different kinds of notes. In order to make it publicly available\r\n            however, it needs to at least be able to pay for itself. I'm not\r\n            talking about the time I spent/spend working on it, but the costs of\r\n            hosting the website, the db, and the url. Until I'm sure it's capable\r\n            of doing those things, I can't let everyone have access to it.\r\n          </p>\r\n          <p>\r\n            This is version 1 of instructions of how to use it. If I make it\r\n            available for anyone, I'll update it with some video instructions.\r\n          </p>\r\n          <p>\r\n            One thing you need to know is that this is a hobby project of mine.\r\n            I'm working on it by myself for now. I've got a real job, and I've got\r\n            a family, so this isn't my top priority, but that being said I do care\r\n            about this probject, and I do plan to get to all the things that are\r\n            on my to do list.\r\n          </p>\r\n          <p>\r\n            If you want to do more than just look at the things others have put on\r\n            (and which they're allowing you to see), then you'll have to register.\r\n            Making it use Facebook and/or Google authentication is on my to do\r\n            list. I know how to do that, but I just haven't gotten around to it.\r\n            So, for now, just register and login. It currently doesn't send any\r\n            emails, so if you forget your password or something, you'll have to\r\n            reach out to me, and I can straighten it out. Again, that kind of\r\n            thing is also on my to do list.\r\n          </p>\r\n          <p>\r\n            Once you're logged in then you're able to start keeping track of\r\n            things.\r\n          </p>\r\n          <p>\r\n            The first thing you create is currently called a World. This is a\r\n            holdover from when I was calling this my World Building App because I\r\n            was aiming it for Fantasy/Sci-Fi authors (like me), but I realized\r\n            that it could be used for anything really. If anyone has any\r\n            suggestions for something to call this instead of World, I'm open to\r\n            considering other options. Currently I'm considering changing it to\r\n            'Project', and I may do that before showing it to anyone other than\r\n            family and close friends. Anyway, a World is basically the root of\r\n            everything. Different Worlds aren't connected to each other. Each\r\n            World has a Name, and you can choose whether or not to make it Public.\r\n            If it's not Public then only the Owner (whoever created it) is able to\r\n            see it. If it is Public then anyone can see it, but only the Owner can\r\n            edit it. (Planned Future Features: When you create a new world you can\r\n            use a template which will include generic Types common to that type of\r\n            World, such as Character, Location, etc. I'm also planning to add the\r\n            ability for Owners to add Collaborators to their World. Collaborators\r\n            would be able to see the World, and the Owner would be able to control\r\n            their other permissions as well (create/edit type, delete type,\r\n            create/edit thing, and delete thing.). Only the Owner will have the\r\n            ability to Edit or Delete the World itself, but they will be able to\r\n            make someone else the Owner.)\r\n          </p>\r\n          <p>\r\n            Within a World you are able to define Types. Basically a Type is just\r\n            that. It's a Type of Thing that you want to keep track of. In each\r\n            Type you are able to define attributes which that Type of Thing share,\r\n            such as Characters having Age, Race, Gender, Height, Weight, Skin\r\n            Color, Eye Color, etc. Types can also be hierarchical through\r\n            inheritance. For example, in Harry Potter I would have a 'Character'\r\n            Type with all the attributes I listed above, but then I could have a\r\n            'Witch or Wizard' Type which has 'Character' as a Super Type. This\r\n            means that 'Witch or Wizard' already has all those same Attributes as\r\n            'Character', but you can add more Attributes like Wand, Known Spells,\r\n            etc. The way to set the Super Types for a type is with a control\r\n            called a Multi Select. It's basically a textbox, but as you type it\r\n            gives you suggestions. You click a suggestion and it adds a chip\r\n            showing it as selected. Clicking the x on the right of the chip\r\n            unselects it. When selecting a Type to be a Super Type it adds all the\r\n            Attributes of that Type to the Type you're creating or editing, but\r\n            they are greyed out and disabled for editing. The reason they're grey\r\n            and disabled is that they come from a Super Type, so their definition\r\n            is there. If a Super Type is removed then the Attributes remain, but\r\n            are no longer grey and disabled. They can then be edited. There are a\r\n            few more things to note however. First is that when adding a Super\r\n            Type which has Super Types, those Super Types will be added as well.\r\n            An example of this could be the 'Animagus' Type in Harry Potter.\r\n            'Animagus' has the Super Type 'Witch or Wizard', which has the Super\r\n            Type 'Character', so when defining 'Animagus' I could add 'Witch or\r\n            Wizard' as a Super Type, and that will automatically add 'Character'\r\n            as well. Removing a Super Type of other Super Types will remove all\r\n            Sub Types of the Super Type removed. An example of that would be\r\n            removing 'Character' from 'Animagus'. This would automatically remove\r\n            'Witch or Wizard' as well. It doesn't make sense to do that for\r\n            'Animagus', but it may be necessary for you if you want to rethink how\r\n            you're organizing things. The last thing to note about removing Super\r\n            Types is that so long as a single Super Type exists which has an\r\n            Attribute with that name, it will be greyed out and disabled. Another\r\n            note about Attributes is that their names have to be unique on the\r\n            Type (or Thing). It's generally a good idea to make sure that any\r\n            Attributes you define with the same name also have the same Attribute\r\n            type as well, otherwise you may run into Attribute name collisions.\r\n            One last thing about Types. I've added an option to Types called Major\r\n            Type. If it's checked then the Type is considered a Major Type and\r\n            will show up in places of the UI where a regular Type will not. This\r\n            makes finding, creating, and editing Things of that Type easier. I\r\n            would make 'Character' a Major Type, but 'Witch or Wizard' and\r\n            'Animagus' would be regular Types. (Planned Future Features: Template\r\n            Types like I have above for Template Worlds, but they're individual\r\n            Types. Also add Plural Name field which will be used in the UI for\r\n            places where we put the plural name of something. Currently it just\r\n            adds an 's' to the end of the Type name, and I want to continue to do\r\n            that if the Plural Name is left empty, but if it's not empty then\r\n            display the Plural Name instead.)\r\n          </p>\r\n          <p>\r\n            Types have Attributes (as mentioned above). Things (which I'll get\r\n            into more below) also have Attributes. The same Attributes really. In\r\n            the Harry Potter World the Attributes on the 'Character' Type would\r\n            then be given to every character you create afterward, but now instead\r\n            of naming the Attribute and saying what type of Attribute it is, you\r\n            get to specify a value for the Attribute.\r\n          </p>\r\n          <p>\r\n            An Attribute is anything you may wish to keep track of for anything.\r\n            These do not include Name or Description, because all Types and Things\r\n            always have Name and Description by default. Attributes are for\r\n            anything else you want to keep track of. It could be a relationship\r\n            like 'Friend', 'Family Member', 'Significant Other', 'Coworker', etc.\r\n            It could be skills and abilities, or possessions, or jobs, or home\r\n            address, or work or school schedule. Really anything you want to keep\r\n            track of which is part of something can be an Attribute. Currently\r\n            there are six types of Attributes that are supported: Text, Number,\r\n            True/False, Options, Type, and List. Text is just that. A Text\r\n            Attribute gives you a textbox where you can type anything you want to\r\n            keep track of. Number gives you a number box, which is like a textbox\r\n            but it only accepts numbers, and it has arrows on the right which can\r\n            be used to increment or decrement the number. True/False gives you a\r\n            checkbox. Options allows you to specify possible choices for the\r\n            Attribute, and then they show up in a drop down list (A quick example\r\n            of this could be 'Gender' having 'Male', 'Female', and others if you\r\n            wanted. They can have as many options as you want, and it can be used\r\n            for whatever Attribute you want.). Specifying the choices is done\r\n            using a control called a Chip Input. This looks like a regular\r\n            textbox, but whenever you hit enter the text in it is added as a chip.\r\n            Chips show the text, but have an x on their right which can be used to\r\n            remove them. It's basically like the Multiselect except without the\r\n            suggestions. The Chips are the choices that will be in the drop down\r\n            list which the user has when creating or editing a Thing with that\r\n            Attribute.\r\n          </p>\r\n          <p>The last two Attribute types are a little more complicated.</p>\r\n          <p>\r\n            When adding Attributes to a Type, the 'Type' Attribute type allows you\r\n            to then choose from the various Types you've defined for the World,\r\n            and then when you're creating or editing a Thing (such as the\r\n            'Character' 'Harry Potter') you would get all the Things of that Type\r\n            as choices in a drop down list. For example you could have a 'Best\r\n            Friend' Attribute which has the Attribute type of 'Type' and uses the\r\n            Defined Type of 'Character'. Then when editing Harry you would have a\r\n            drop down list which shows all the 'Characters' you've added to the\r\n            World as possible 'Best Friends'. You would of course then choose 'Ron\r\n            Weasley' (Sorry, Hermione, but you're a close second.).\r\n          </p>\r\n          <p>\r\n            The Attribute Type 'List' is still more complicated than 'Type'. It\r\n            allows you to decide which type of 'List' it's going to be. For now it\r\n            only supports 'Text', 'Options', and 'Type'. (I'm not planning to add\r\n            any others, but if it's requested I may consider it. A List of Text\r\n            could be anything really, so other types shouldn't be necessary.) If\r\n            an Attribute is defined as a List of Text then when creating or\r\n            editing a Thing the Attribute gives a Chip Input, which works the same\r\n            as it does for Options (described above). A List of Options allows you\r\n            to define the choices when creating or editing the Type, the same as\r\n            with a regular Options Attribute, and then when creating or editing a\r\n            Thing of that Type it gives a Multiselect which works the same as when\r\n            choosing Super Types (described above) with the Options defined\r\n            previously on the Type as the suggestions. A List of 'Type' allows you\r\n            to choose a Defined Type (like with the Attribute type 'Type'), but\r\n            when creating or editing a Thing it gives you a Multiselect instead of\r\n            a regular drop down list so you can select more than one. With all\r\n            'List' Attributes, the items in the list are displayed separated by\r\n            commas when looking at the details page rather than creating or\r\n            editing.\r\n          </p>\r\n          <p>\r\n            One last note about Attributes of type 'Type' or 'List' of 'Type'.\r\n            I've made it so that if you want to choose a Defined Type which you\r\n            haven't defined yet you can choose '+ Create New Type' and it opens a\r\n            quick little window (modal for those who care) which lets you define a\r\n            Type using just the name you want it to have. You'll have to edit that\r\n            Type later to give it any Super Types or Attributes it should have,\r\n            but you can create it there so you can continue defining the Type\r\n            you're already working on rather than having to leave and come back to\r\n            it. The same thing can be done when creating or editing a Thing with\r\n            an Attribute of type 'Type' or 'List' of 'Type', but for Things the\r\n            Type has already been chosen. Now you will be creating a Thing of that\r\n            Type. An example of this would be if you're editing the 'Character'\r\n            'Harry Potter', but when you get to 'Best Friend' you realize you\r\n            haven't added the 'Ron Weasley' 'Character' yet. You would choose '+\r\n            Create New Character', and then in the quick little window you would\r\n            type 'Ron Weasley'. He would get added as a blank character with just\r\n            his Name, but he would then be selected as Harry's 'Best Friend', and\r\n            you could finish defining Harry, and get to Ron later.\r\n          </p>\r\n          <p>\r\n            And one more thing about Attributes in general.  I added the ability to\r\n            set Default values for attributes on the Type.  Default Values will \r\n            automatically be set on any Things of that Type.  I made it as user \r\n            friendly as I could think to make it.\r\n          </p>\r\n          <p>\r\n            (Planned Future Features: Other Attribute types, including: Image,\r\n            Event, and External Link. If you have any suggestions of others, feel\r\n            free to recommend them.  Also need to put in validation to detect \r\n            Name and Default collisions.)\r\n          </p>\r\n          <p>\r\n            And that brings us to Things. If you've gotten to this point, then you\r\n            probably already understand what Things are, but I'll outline it\r\n            anyway. The generic term Thing is used to mean any actual thing you're\r\n            keeping track of. This would be your Characters, your Places, your\r\n            Items, Spells, whatever. When creating or editing a Thing you are able\r\n            to choose Types for the Thing (works the same as Super Types for\r\n            Types), and all the Attributes of those Types are added to the Thing,\r\n            but now you're able to give values for them. Again remember to avoid\r\n            Attribute Name collisions (If for some reason you've defined 2\r\n            unrelated Types with an Attribute that has the same name but different\r\n            Attribute types then you won't be able to have a Thing of both\r\n            Types.). If a Type is edited to remove an Attribute, Things which use\r\n            that Type and existed already will still have that Attribute. It will\r\n            just be an orphaned Attribute. Currently there's no way to remove\r\n            Attributes from Things. If a Type is edited to add Attributes then\r\n            Things which already existed will gain those Attributes as soon as\r\n            they're edited again. If a Type is edited and an Attribute is\r\n            changed... I'm not actually sure what would happen to Things that\r\n            already exist which have that Type. I'll have to test that. That's\r\n            really it for Things. They're the simple part. (Planned Future\r\n            Features: I'm planning to add the ability to add/remove/edit orphaned\r\n            Attributes for Things. When I do, I'll probably try to find a way to\r\n            make it so with adding/editing orphaned Attributes you'll be able to\r\n            add the Attribute to a selected Type already on the Thing.)\r\n          </p>\r\n          <p>I probably should have put Attributes below Things, but oh well.</p>\r\n          <p>Other Planned Future Features:</p>\r\n          <div>\r\n            <p>\r\n              Direct Messages: I'll add a simple messaging system to allow people\r\n              to communicate directly with one another.\r\n            </p>\r\n            <p>\r\n              Auto-links: For both comments and DMs I'll allow users to put links to\r\n              pages through a simple system similar to hashtags in Social Media.\r\n              I'm thinking I also want to add this capability to Descriptions on\r\n              Types and Things.\r\n            </p>\r\n            <p>\r\n              Following Public Worlds: Currently all Public Worlds are listed in\r\n              the menu, but I should make it so only those that the user follows\r\n              are shown there, and have a button to pull up the full list, and add\r\n              a button for people who neither own or collaborate on a Public World\r\n              to 'Follow' the World.\r\n            </p>\r\n            <p>\r\n              Home Page content: I'm planning to have actual Home Page content.\r\n              This will have a link to a video tutorial for new users (which I\r\n              have yet to make, and will need occasional updating after it's\r\n              made), as well as things like recent software changes. I also want\r\n              to make it so it can automatically have links to recently added or\r\n              edited Types or Things and recent comments which may be of\r\n              interest to the user.\r\n            </p>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst HomePage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default HomePage;\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\n\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport {\r\n  FormControl,\r\n  OutlinedInput,\r\n  InputLabel,\r\n  Grid,\r\n  // Button,\r\n  Typography,\r\n  Card, CardContent, CardActions,\r\n  IconButton, \r\n  // Tooltip\r\n} from \"@material-ui/core\";\r\nimport ArrowUpwardIcon from '@material-ui/icons/ArrowUpward';\r\nimport ArrowDownwardIcon from '@material-ui/icons/ArrowDownward';\r\nimport ReplyIcon from '@material-ui/icons/Reply';\r\n// import TextBox from \"./TextBox\";\r\n\r\nconst useStyles = makeStyles({\r\n  root: {\r\n    // maxWidth: 345,\r\n  },\r\n});\r\n\r\nconst vote = (comment, theVote, props) => {\r\n  if (props.user === null) {\r\n    return;\r\n  }\r\n  props.changeWaiting(true);\r\n  if (comment.votes[props.user._id] !== undefined && comment.votes[props.user._id] !== theVote) {\r\n    delete comment.votes[props.user._id];\r\n  } else {\r\n    comment.votes[props.user._id] = theVote;\r\n  }\r\n\r\n  const updatedComment = {...props.rootComment};\r\n  delete updatedComment.user;\r\n  // updatedComment.replies.forEach(r => {\r\n  //   cleanReply(r);\r\n  // });\r\n  updatedComment.replies = [];\r\n  props.rootComment.replies.forEach(r => {\r\n    updatedComment.replies.push(cleanReply(r));\r\n  });\r\n  // Calls API\r\n  props.api\r\n    .updateComment(updatedComment)\r\n    .then(res => {\r\n      if (res.error === undefined) {\r\n        props.api.getComments(props.world._id, props.objectType, props.object._id).then(res => {\r\n          res.comments.forEach(comment => {\r\n            prepComment(comment, props);\r\n          });\r\n          props.changeComments(res.comments);\r\n          props.changeWaiting(false);\r\n        });\r\n      } else {\r\n        console.log(res.error);\r\n      }\r\n      props.changeWaiting(false);\r\n    })\r\n    .catch(err => console.log(err));\r\n};\r\n\r\nconst reply = (text, props, changeReplying, changeValue) => {\r\n  if (props.user === null) {\r\n    return;\r\n  }\r\n  props.changeWaiting(true);\r\n\r\n  const rootComment = {...props.rootComment};\r\n  // Need to search for the right comment\r\n  // Actually in theory, adding it to props.comment should put it in the right place\r\n  const comment = props.comment;\r\n  // Then add the reply\r\n  comment.replies.push({\r\n    time: new Date(),\r\n    user: props.user,\r\n    userID: props.user._id,\r\n    text,\r\n    votes: {},\r\n    voteSum: 0,\r\n    replies: []\r\n  });\r\n  changeValue(\"\");\r\n  changeReplying(false);\r\n  props.changeWaiting(true);\r\n\r\n  const updatedComment = {...rootComment};\r\n  delete updatedComment.user;\r\n  updatedComment.replies = [];\r\n  rootComment.replies.forEach(r => {\r\n    updatedComment.replies.push(cleanReply(r));\r\n  });\r\n  // updatedComment.replies.forEach(r => {\r\n  //   cleanReply(r);\r\n  // });\r\n  \r\n  // Calls API\r\n  props.api\r\n    .updateComment(updatedComment)\r\n    .then(res => {\r\n      if (res.error === undefined) {\r\n        props.api.getComments(props.world._id, props.objectType, props.object._id).then(res => {\r\n          res.comments.forEach(comment => {\r\n            prepComment(comment, props);\r\n          });\r\n          props.changeComments(res.comments);\r\n          props.changeWaiting(false);\r\n        });\r\n      } else {\r\n        console.log(res.error);\r\n      }\r\n      props.changeWaiting(false);\r\n    })\r\n    .catch(err => console.log(err));\r\n};\r\n\r\nconst cleanReply = (reply) => {\r\n  const newReply = {...reply};\r\n  delete newReply.user;\r\n  delete newReply.voteSum;\r\n  newReply.replies = [];\r\n  for (let i = 0; i < reply.replies.length; i++) {\r\n    newReply.replies.push(cleanReply(reply.replies[i]));\r\n  }\r\n  return newReply;\r\n}\r\n\r\nconst prepComment = (comment, props) => {\r\n  comment.user = props.allUsers.filter(u => u._id === comment.userID)[0];\r\n  comment.time = new Date(comment.time);\r\n  comment.voteSum = Object.values(comment.votes).reduce((total, vote) => total + vote, 0);\r\n  comment.replies.forEach(r => {\r\n    prepComment(r, props);\r\n  });\r\n}\r\n\r\nexport default function CommentControl(props) {\r\n  const classes = useStyles();\r\n\r\n  const [value, changeValue] = useState(\"\");\r\n  // const [waiting, changeWaiting] = useState(false);\r\n  const [replying, changeReplying] = useState(false);\r\n  \r\n  return (\r\n    <Grid container spacing={0} direction=\"column\">\r\n      <Grid item>\r\n        <Card className={classes.root}>\r\n          <CardContent>\r\n            <Typography variant=\"body2\" color=\"textSecondary\">\r\n              {props.comment.user.username}: {props.comment.time.toLocaleDateString()} {props.comment.time.toLocaleTimeString()}\r\n            </Typography>\r\n            <Typography component=\"p\">\r\n              {props.comment.text}\r\n            </Typography>\r\n          </CardContent>\r\n          <CardActions disableSpacing>\r\n            { props.user === null || props.comment.votes[props.user._id] !== 1 ?\r\n              <IconButton \r\n                aria-label=\"upvote comment\"\r\n                onClick={_ => {\r\n                  vote(props.comment, 1, props);\r\n                }}>\r\n                <ArrowUpwardIcon />\r\n              </IconButton>\r\n            :\r\n              <IconButton \r\n                aria-label=\"upvote comment\"\r\n                color=\"primary\"\r\n                // style={{ color: \"green\" }}\r\n                onClick={_ => {\r\n                  // vote(comment, 1, props);\r\n                }}>\r\n                <ArrowUpwardIcon />\r\n              </IconButton>\r\n            }\r\n            <span style={{ fontWeight: \"bold\", color: props.user === null || props.comment.votes[props.user._id] === undefined ? \"black\" : props.comment.votes[props.user._id] === 1 ? \"blue\" : props.comment.votes[props.user._id] === -1 ? \"red\" : \"black\" }}>{props.comment.voteSum}</span>\r\n            { props.user === null || props.comment.votes[props.user._id] !== -1 ?\r\n              <IconButton \r\n                aria-label=\"downvote comment\"\r\n                onClick={_ => {\r\n                  vote(props.comment, -1, props);\r\n                }}>\r\n                <ArrowDownwardIcon />\r\n              </IconButton>\r\n            :\r\n              <IconButton \r\n                aria-label=\"downvote comment\"\r\n                color=\"secondary\"\r\n                onClick={_ => {\r\n                  // vote(comment, -1, props);\r\n                }}>\r\n                <ArrowDownwardIcon />\r\n              </IconButton>\r\n            }\r\n            <IconButton style={{ marginLeft: \"auto\" }}\r\n              onClick={_ => {\r\n                if (props.user !== null) {\r\n                  // Open a reply box under the card\r\n                  changeReplying(!replying);\r\n                }\r\n              }}\r\n              aria-label=\"reply\">\r\n              <ReplyIcon />\r\n            </IconButton>\r\n          </CardActions>\r\n        </Card>\r\n      </Grid>\r\n\r\n      { props.comment.replies.length > 0 &&\r\n        <Grid item container spacing={0} direction=\"row\">\r\n          <Grid item xs={2}>&nbsp;</Grid>\r\n          <Grid item xs={10} container spacing={0} direction=\"column\">\r\n            {props.comment.replies.map((reply, key) => {\r\n              return (\r\n                <Grid item key={key} style={{ marginTop: \"4px\" }}>\r\n                  <CommentControl \r\n                    comment={reply} \r\n                    user={props.user} \r\n                    world={props.world}\r\n                    object={props.object}\r\n                    objectType={props.objectType}\r\n                    api={props.api}\r\n                    rootComment={props.rootComment}\r\n                    allUsers={props.allUsers} \r\n                    changeComments={newComments => {\r\n                      props.changeComments(newComments);\r\n                    }} \r\n                    changeWaiting={newWaiting => {\r\n                      props.changeWaiting(newWaiting);\r\n                    }}\r\n                  />\r\n                </Grid>\r\n              );\r\n            })}\r\n          </Grid>\r\n        </Grid>\r\n      }\r\n      { replying &&\r\n        <Grid item>\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor={`text_field_reply`}>New Reply</InputLabel>\r\n            <OutlinedInput\r\n              id={`text_field_reply`}\r\n              name={`text_field_reply`}\r\n              type=\"text\"\r\n              autoComplete=\"Off\"\r\n              multiline\r\n              value={value}\r\n              onChange={e => {\r\n                changeValue(e.target.value);\r\n              }}\r\n              onKeyPress={e => {\r\n                if (e.key === 'Enter' && !e.shiftKey) {\r\n                  reply(value,  \r\n                    props, changeReplying, \r\n                    changeValue);\r\n                }\r\n              }}\r\n              labelWidth={80}\r\n              fullWidth\r\n            />\r\n          </FormControl>\r\n        </Grid>\r\n      }\r\n    </Grid>\r\n  );\r\n}\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\n\r\nimport {\r\n  FormControl,\r\n  OutlinedInput,\r\n  InputLabel,\r\n  Grid,\r\n  Button\r\n} from \"@material-ui/core\";\r\nimport CommentControl from \"./CommentControl\";\r\n\r\nconst saveComment = (text, props, changeWaiting, comments, changeComments, changeValue) => {\r\n  changeWaiting(true);\r\n  const comment = {\r\n    _id: null,\r\n    time: new Date(),\r\n    userID: props.user._id,\r\n    worldID: props.world._id,\r\n    objectType: props.objectType,\r\n    objectID: props.object._id,\r\n    text,\r\n    votes: {},\r\n    replies: []\r\n  };\r\n\r\n  // Calls API\r\n  props.api\r\n    .addComment(comment)\r\n    .then(res => {\r\n      if (res.error === undefined) {\r\n        comment._id = res.commentID;\r\n        comment.user = props.user;\r\n        comment.voteSum = 0;\r\n        const newComments = [...comments];\r\n        newComments.push(comment);\r\n        changeComments(newComments);\r\n        changeValue(\"\");\r\n      } else {\r\n        console.log(res.error);\r\n      }\r\n      changeWaiting(false);\r\n    })\r\n    .catch(err => console.log(err));\r\n};\r\n\r\nconst prepComment = (comment, allUsers) => {\r\n  comment.user = allUsers.filter(u => u._id === comment.userID)[0];\r\n  comment.time = new Date(comment.time);\r\n  comment.voteSum = Object.values(comment.votes).reduce((total, vote) => total + vote, 0);\r\n  comment.replies.forEach(r => {\r\n    prepComment(r, allUsers);\r\n  });\r\n}\r\n\r\nexport default function CommentsControl(props) {\r\n  const [value, changeValue] = useState(\"\");\r\n  const [waiting, changeWaiting] = useState(false);\r\n  const [comments, changeComments] = useState([]);\r\n  const [allUsers, changeUsers] = useState([]);\r\n  const [loadUsers, changeLoadUsers] = useState(true);\r\n  const [loadComments, changeLoadComments] = useState(false);\r\n  \r\n  console.log(props.user);\r\n\r\n  if (loadUsers) {\r\n    changeLoadUsers(false);\r\n    setTimeout(() => {\r\n      props.api.getAllUsers().then(res => {\r\n        changeUsers(res);\r\n        changeLoadComments(true);\r\n      });\r\n    }, 500);\r\n  } else if (loadComments) {\r\n    changeLoadComments(false);\r\n    setTimeout(() => {\r\n      props.api.getComments(props.world._id, props.objectType, props.object._id).then(res => {\r\n        res.comments.forEach(comment => {\r\n          prepComment(comment, allUsers);\r\n        });\r\n        changeComments(res.comments);\r\n      });\r\n    }, 500);\r\n  }\r\n\r\n  return (\r\n    <Grid container spacing={1} direction=\"column\">\r\n      { props.objectType !== \"General\" &&\r\n        <Grid item>\r\n          <b>Comments:</b>\r\n        </Grid>\r\n      }\r\n      { comments.map((comment, key) => {\r\n        return (\r\n          <Grid item key={key} container spacing={1} direction=\"column\">\r\n            <CommentControl \r\n              comment={comment} \r\n              rootComment={comment}\r\n              user={props.user} \r\n              world={props.world}\r\n              object={props.object}\r\n              objectType={props.objectType}\r\n              allUsers={allUsers} \r\n              api={props.api} \r\n              changeComments={newComments => {\r\n                changeComments(newComments);\r\n              }} \r\n              changeWaiting={changeWaiting}\r\n            />\r\n          </Grid>\r\n        );\r\n      })}\r\n      { props.objectType === \"General\" && comments.length === 0 ? \r\n        <Grid item>\r\n          No discussions yet\r\n        </Grid>\r\n      : comments.length === 0 &&\r\n        <Grid item>\r\n          No comments yet\r\n        </Grid>\r\n      }\r\n      <Grid item>\r\n        { (props.user !== null && (props.world.Owner === props.user._id || (props.world.Collaborators !== undefined && props.world.Collaborators.filter(c=> c.userID === props.user._id).length === 0))) ?\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor={`text_field_comments`}>New Comment</InputLabel>\r\n            <OutlinedInput\r\n              id={`text_field_comments`}\r\n              name={`text_field_comments`}\r\n              type=\"text\"\r\n              autoComplete=\"Off\"\r\n              multiline\r\n              value={value}\r\n              onChange={e => {\r\n                changeValue(e.target.value);\r\n              }}\r\n              labelWidth={110}\r\n              fullWidth\r\n            />\r\n          </FormControl>\r\n        : (props.user !== null && props.objectType === \"General\") ?\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor={`text_field_comments`}>New Discussion</InputLabel>\r\n            <OutlinedInput\r\n              id={`text_field_comments`}\r\n              name={`text_field_comments`}\r\n              type=\"text\"\r\n              autoComplete=\"Off\"\r\n              multiline\r\n              value={value}\r\n              onChange={e => {\r\n                changeValue(e.target.value);\r\n              }}\r\n              labelWidth={115}\r\n              fullWidth\r\n            />\r\n          </FormControl>\r\n        : (props.user === null && props.objectType === \"General\") ?\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor=\"fake_comments_label\">\r\n              You have to log in to start a discussion\r\n            </InputLabel>\r\n            <OutlinedInput\r\n              id=\"fake_comments_label\"\r\n              name=\"fake_comments_label\"\r\n              type=\"text\"\r\n              autoComplete=\"Off\"\r\n              disabled={true}\r\n              fullWidth\r\n            />\r\n          </FormControl>\r\n        :\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor=\"fake_comments_label\">\r\n              You have to log in to leave comments\r\n            </InputLabel>\r\n            <OutlinedInput\r\n              id=\"fake_comments_label\"\r\n              name=\"fake_comments_label\"\r\n              type=\"text\"\r\n              autoComplete=\"Off\"\r\n              disabled={true}\r\n              fullWidth\r\n            />\r\n          </FormControl>\r\n        }\r\n      </Grid>\r\n      <Grid item>\r\n        <Button\r\n          fullWidth\r\n          variant=\"contained\"\r\n          color=\"primary\"\r\n          disabled={waiting || value === \"\"}\r\n          onClick={_ => {\r\n            saveComment(value, props, changeWaiting, comments, changeComments, changeValue);\r\n          }}>\r\n          {waiting ? \"Please Wait\" : \"Submit\"}\r\n        </Button>\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n}\r\n","\r\nimport React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\n// import { Redirect } from \"react-router-dom\";\r\nimport {\r\n  // selectWorld, setTypes, setThings, setWorlds, \r\n  // setPublicWorlds, \r\n  // updatePublicWorldForCollab,\r\n  // setAttributes, \r\n  // setTemplates,\r\n  // updateAttributes,\r\n  notFromLogin,\r\n  toggleLogin\r\n} from \"../../redux/actions/index\";\r\nimport API from \"../../smartAPI\";\r\nimport { \r\n  Grid\r\n} from \"@material-ui/core\";\r\nimport CommentsControl \r\nfrom \"../../components/Inputs/CommentsControl\";\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    // selectedPage: state.app.selectedPage,\r\n    // selectedWorld: state.app.selectedWorld,\r\n    // selectedWorldID: state.app.selectedWorldID,\r\n    // worlds: state.app.worlds,\r\n    publicWorlds: state.app.publicWorlds,\r\n    // types: state.app.types,\r\n    // things: state.app.things,\r\n    user: state.app.user,\r\n    // attributesByID: state.app.attributesByID,\r\n    // attributesByName: state.app.attributesByName,\r\n    fromLogin: state.app.fromLogin,\r\n    templates: state.app.templates\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    // selectWorld: worldID => dispatch(selectWorld(worldID)),\r\n    // setTypes: types => dispatch(setTypes(types)),\r\n    // setThings: things => dispatch(setThings(things)),\r\n    // setWorlds: worlds => dispatch(setWorlds(worlds)),\r\n    // setTemplates: templates => dispatch(setTemplates(templates)),\r\n    // setPublicWorlds: worlds => dispatch(setPublicWorlds(worlds)),\r\n    // updatePublicWorldForCollab: world => dispatch(updatePublicWorldForCollab(world)),\r\n    // setAttributes: attributes => dispatch(setAttributes(attributes)),\r\n    // updateAttributes: attributes => dispatch(updateAttributes(attributes)),\r\n    notFromLogin: () => dispatch(notFromLogin({})),\r\n    toggleLogin: () => dispatch(toggleLogin({}))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n  componentDidMount() {\r\n  }\r\n  render() {\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n    }\r\n    console.log(this.props);\r\n    return (\r\n      <Grid item xs={12} container spacing={0} direction=\"column\">\r\n        <Grid item>\r\n          <h3>General Discussion Board</h3>\r\n        </Grid>\r\n        <Grid item>\r\n          This is a place where anyone can discuss anything related to \r\n          writing in general, or to look for collaborators, or something\r\n          to collaborate on.\r\n        </Grid>\r\n        <Grid item>\r\n          I plan to add filtering capabilities in the future.\r\n        </Grid>\r\n        <Grid item>\r\n          <CommentsControl \r\n            user={this.props.user} \r\n            object={{_id: \"General\"}}\r\n            objectType=\"General\"\r\n            world={{_id: \"General\"}}\r\n            api={this.api} \r\n            onChange={this.commentsChange}\r\n          /> \r\n        </Grid>\r\n      </Grid>\r\n    );\r\n  }\r\n}\r\nconst GeneralDiscussionPage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default GeneralDiscussionPage;\r\n","\r\nimport Home from \"@material-ui/icons/Home\";\r\nimport Forum from \"@material-ui/icons/Forum\";\r\nimport HomePage from \"../../views/Home\";\r\nimport GeneralDiscussionPage from \"../../views/Discussion/GeneralDiscussion\";\r\n\r\n\r\nconst menuRoutes = [\r\n  {\r\n    path: \"/\",\r\n    name: \"Home\",\r\n    icon: Home,\r\n    component: HomePage,\r\n  },\r\n  {\r\n    path: \"/discussion\",\r\n    name: \"Discussion\",\r\n    icon: Forum,\r\n    component: GeneralDiscussionPage,\r\n  }\r\n];\r\n\r\nexport default menuRoutes;\r\n","import React, { Component } from \"react\";\r\nimport \"../../App.css\";\r\nimport {\r\n  // Button,\r\n  Grid,\r\n  List,\r\n  ListItem,\r\n  ListItemText,\r\n  Icon,\r\n  FormControl,\r\n  InputLabel,\r\n  OutlinedInput,\r\n  Fab,\r\n  Tooltip\r\n} from \"@material-ui/core\";\r\nimport { Add, Star, Search } from \"@material-ui/icons\";\r\nimport { NavLink } from \"react-router-dom\";\r\nimport StarBorderIcon from \"@material-ui/icons/StarBorder\";\r\nimport { connect } from \"react-redux\";\r\nimport menuRoutes from \"./routes\";\r\nimport {\r\n  setWorlds,\r\n  setPublicWorlds,\r\n  setTemplates,\r\n  setFollowingWorlds,\r\n  toggleMenu,\r\n  logout,\r\n  // toggleLogin\r\n} from \"../../redux/actions/index\";\r\nimport API from \"../../smartAPI\";\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedPage: state.app.selectedPage,\r\n    worlds: state.app.worlds,\r\n    publicWorlds: state.app.publicWorlds,\r\n    user: state.app.user,\r\n    followingWorlds: state.app.followingWorlds,\r\n    width: state.app.width\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    setWorlds: worlds => dispatch(setWorlds(worlds)),\r\n    setPublicWorlds: worlds => dispatch(setPublicWorlds(worlds)),\r\n    setTemplates: templates => dispatch(setTemplates(templates)),\r\n    setFollowingWorlds: worldIDs => dispatch(setFollowingWorlds(worldIDs)),\r\n    toggleMenu: () => dispatch(toggleMenu({})),\r\n    // toggleLogin: () => dispatch(toggleLogin({}))\r\n    logout: () => dispatch(logout({}))\r\n  };\r\n}\r\nclass Menu extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      browse: false,\r\n      Filter: \"\"\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.api.getWorlds(true).then(res => {\r\n      this.props.setPublicWorlds(res.publicWorlds.worlds);\r\n      if (this.props.user !== null) {\r\n        if (res.publicWorlds === undefined) {\r\n          this.props.logout();\r\n        } else {\r\n          this.props.setWorlds(res.userWorlds.worlds);\r\n          this.props.setTemplates(res.templates.templates);\r\n        }\r\n      }\r\n    });\r\n    // this.api.getPublicWorlds().then(res => {\r\n    //   this.props.setPublicWorlds(res.worlds);\r\n    // });\r\n    // if (this.props.user !== null) {\r\n    //   this.api.getWorldsForUser().then(res => {\r\n    //     if (res.worlds !== undefined) {\r\n    //       this.props.setWorlds(res.worlds);\r\n    //     }\r\n    //     else {\r\n    //       // User's login is no longer valid.\r\n    //       this.props.logout();\r\n    //     }\r\n    //   });\r\n    // }\r\n  }\r\n\r\n  links() {\r\n    return (\r\n      <div>\r\n        {menuRoutes.map((prop, key) => (\r\n          <ListItem key={key} className=\"curvedButton\">\r\n            <NavLink\r\n              to={prop.path}\r\n              onClick={_ => {\r\n                this.props.toggleMenu();\r\n              }}\r\n              style={{\r\n                width: `${this.props.width}px`\r\n              }}\r\n              className=\"MyButton\"\r\n              activeClassName=\"active\"\r\n            >\r\n              <ListItem button>\r\n                {typeof prop.icon === \"string\" ? (\r\n                  <Icon className=\"marginLeft\">{prop.icon}</Icon>\r\n                ) : (\r\n                  <prop.icon className=\"marginLeft\" />\r\n                )}\r\n                &nbsp;\r\n                <ListItemText primary={prop.name} className=\"marginLeft\" />\r\n              </ListItem>\r\n            </NavLink>\r\n          </ListItem>\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  toggleFollow = (worldID, follow) => {\r\n    let followingWorlds = [...this.props.followingWorlds];\r\n    if (follow) {\r\n      followingWorlds.push(worldID);\r\n    } else {\r\n      const index = followingWorlds.indexOf(worldID);\r\n      followingWorlds.splice(index, 1);\r\n    }\r\n    if (this.props.user !== null) {\r\n      const user = { ...this.props.user };\r\n      user.followingWorlds = followingWorlds;\r\n      this.props.setFollowingWorlds(followingWorlds);\r\n      this.api.updateUser(user);\r\n    } else {\r\n      this.props.setFollowingWorlds(followingWorlds);\r\n    }\r\n  };\r\n\r\n  handleUserInput = e => {\r\n    const name = e.target.name;\r\n    const value =\r\n      e.target.type === \"checkbox\" ? e.target.checked : e.target.value;\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  publicWorlds() {\r\n    const followingWorlds = [];\r\n    const otherWorlds = [];\r\n    if (\r\n      this.props.publicWorlds !== undefined &&\r\n      this.props.publicWorlds !== null &&\r\n      this.props.publicWorlds.error === undefined\r\n    ) {\r\n      this.props.publicWorlds.forEach(w => {\r\n        if (this.state.browse) {\r\n          if (\r\n            this.state.Filter === \"\" ||\r\n            w.Name.toLowerCase().includes(this.state.Filter.toLowerCase())\r\n          ) {\r\n            if (this.props.followingWorlds.includes(w._id)) {\r\n              followingWorlds.push(w);\r\n            } else {\r\n              otherWorlds.push(w);\r\n            }\r\n          }\r\n        } else if (this.props.followingWorlds.includes(w._id)) {\r\n          followingWorlds.push(w);\r\n        }\r\n      });\r\n    }\r\n    if (this.state.browse) {\r\n      return (\r\n        <Grid container spacing={1} direction=\"column\">\r\n          <Grid item>\r\n            <FormControl variant=\"outlined\" fullWidth>\r\n              <InputLabel htmlFor=\"filter\">Filter</InputLabel>\r\n              <OutlinedInput\r\n                id=\"filter\"\r\n                name=\"Filter\"\r\n                type=\"text\"\r\n                autoComplete=\"Off\"\r\n                value={this.state.Filter}\r\n                onChange={this.handleUserInput}\r\n                labelWidth={43}\r\n                fullWidth\r\n              />\r\n            </FormControl>\r\n          </Grid>\r\n          <Grid item>\r\n            <List>\r\n              {followingWorlds.map((w, key) => (\r\n                <ListItem key={key} className=\"curvedButton\">\r\n                  <NavLink\r\n                    to={`/world/details/${w._id}`}\r\n                    onClick={_ => {\r\n                      this.props.toggleMenu();\r\n                    }}\r\n                    style={{\r\n                      width: `${this.props.width - 80}px`\r\n                    }}\r\n                    className=\"MySmallerButton\"\r\n                    activeClassName=\"active\"\r\n                  >\r\n                    <ListItem button>\r\n                      <ListItemText primary={w.Name} className=\"marginLeft\" />\r\n                    </ListItem>\r\n                  </NavLink>\r\n                  <Fab\r\n                    size=\"small\"\r\n                    color=\"primary\"\r\n                    onClick={e => {\r\n                      this.toggleFollow(w._id, false);\r\n                    }}\r\n                  >\r\n                    <Star />\r\n                  </Fab>\r\n                </ListItem>\r\n              ))}\r\n              {otherWorlds.map((w, key) => (\r\n                <ListItem key={key} className=\"curvedButton\">\r\n                  <NavLink\r\n                    to={`/world/details/${w._id}`}\r\n                    onClick={_ => {\r\n                      this.props.toggleMenu();\r\n                    }}\r\n                    style={{\r\n                      width: `${this.props.width - 80}px`\r\n                    }}\r\n                    className=\"MySmallerButton\"\r\n                    activeClassName=\"active\"\r\n                  >\r\n                    <ListItem button>\r\n                      <ListItemText primary={w.Name} className=\"marginLeft\" />\r\n                    </ListItem>\r\n                  </NavLink>\r\n                  <Fab\r\n                    size=\"small\"\r\n                    color=\"primary\"\r\n                    onClick={e => {\r\n                      this.toggleFollow(w._id, true);\r\n                    }}\r\n                  >\r\n                    <StarBorderIcon />\r\n                  </Fab>\r\n                </ListItem>\r\n              ))}\r\n            </List>\r\n          </Grid>\r\n        </Grid>\r\n      );\r\n    }\r\n    return followingWorlds.map((w, key) => (\r\n      <ListItem key={key} className=\"curvedButton\">\r\n        <NavLink\r\n          to={`/world/details/${w._id}`}\r\n          onClick={_ => {\r\n            this.props.toggleMenu();\r\n          }}\r\n          style={{\r\n            width: `${this.props.width}px`\r\n          }}\r\n          className=\"MyButton\"\r\n          activeClassName=\"active\"\r\n        >\r\n          <ListItem button>\r\n            <ListItemText primary={w.Name} className=\"marginLeft\" />\r\n          </ListItem>\r\n        </NavLink>\r\n      </ListItem>\r\n    ));\r\n  }\r\n\r\n  myWorlds() {\r\n    if (this.props.user === null || this.props.user === undefined) {\r\n      return \"\";\r\n    } else {\r\n      const worldLinks =\r\n        this.props.worlds === undefined\r\n          ? \"\"\r\n          : this.props.worlds.map((w, key) => (\r\n              <ListItem key={key} className=\"curvedButton\">\r\n                <NavLink\r\n                  to={`/world/details/${w._id}`}\r\n                  onClick={_ => {\r\n                    this.props.toggleMenu();\r\n                  }}\r\n                  style={{\r\n                    width: `${this.props.width}px`\r\n                  }}\r\n                  className=\"MyButton\"\r\n                  activeClassName=\"active\"\r\n                >\r\n                  <ListItem button>\r\n                    <ListItemText primary={w.Name} className=\"marginLeft\" />\r\n                  </ListItem>\r\n                </NavLink>\r\n              </ListItem>\r\n            ));\r\n      return worldLinks;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <List>\r\n        {this.links()}\r\n        <ListItem>\r\n          <ListItemText display=\"none\" primary={\"Public Worlds\"} />\r\n          <Tooltip title={`Browse Public Worlds`}>\r\n            <Fab\r\n              size=\"small\"\r\n              color=\"primary\"\r\n              onClick={e => {\r\n                this.setState({ browse: !this.state.browse });\r\n              }}\r\n            >\r\n              <Search />\r\n            </Fab>\r\n          </Tooltip>\r\n        </ListItem>\r\n        {this.publicWorlds()}\r\n        { this.props.user !== null &&\r\n          <ListItem>\r\n            <ListItemText primary={\"My Worlds\"} />\r\n          </ListItem>\r\n        }\r\n        { this.props.user !== null &&\r\n          <ListItem className=\"curvedButton\">\r\n            <NavLink \r\n            to={`/world/create`}\r\n            onClick={_ => {\r\n              this.props.toggleMenu();\r\n            }}\r\n            style={{\r\n              width: `${this.props.width}px`\r\n            }} \r\n            className=\"MyButton\" \r\n            activeClassName=\"active\">\r\n              <ListItem button>\r\n                <Add />\r\n                <ListItemText primary={\"Create New\"} />\r\n              </ListItem>\r\n            </NavLink>\r\n          </ListItem>\r\n        }\r\n        {this.myWorlds()}\r\n      </List>\r\n    );\r\n  }\r\n}\r\n\r\nconst MobileMenu = connect(mapStateToProps, mapDispatchToProps)(Menu);\r\nexport default MobileMenu;\r\n","import React from 'react';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport { NavLink } from \"react-router-dom\";\r\nimport {\r\n  Menu, MenuItem,\r\n  ListItem, ListItemText,\r\n  Icon, // ListItemIcon\r\n} from '@material-ui/core';\r\n// import {\r\n//   // InboxIcon,\r\n//   // DraftsIcon,\r\n//   // SendIcon\r\n// } from '@material-ui/icons';\r\n\r\nconst StyledMenu = withStyles({\r\n  paper: {\r\n    border: '1px solid #d3d4d5',\r\n  },\r\n})((props) => (\r\n  <Menu\r\n    elevation={0}\r\n    getContentAnchorEl={null}\r\n    anchorOrigin={{\r\n      vertical: 'bottom',\r\n      horizontal: 'center',\r\n    }}\r\n    transformOrigin={{\r\n      vertical: 'top',\r\n      horizontal: 'center',\r\n    }}\r\n    {...props}\r\n  />\r\n));\r\n\r\n// const StyledMenuItem = withStyles((theme) => ({\r\n//   root: {\r\n//     '&:focus': {\r\n//       backgroundColor: theme.palette.primary.main,\r\n//       '& .MuiListItemIcon-root, & .MuiListItemText-primary': {\r\n//         color: theme.palette.common.white,\r\n//       },\r\n//     },\r\n//   },\r\n// }))(MenuItem);\r\n\r\nexport default function UserMenu(props) {\r\n  const [anchorEl, setAnchorEl] = React.useState(null);\r\n\r\n  const handleClick = (event) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  return (\r\n    <span className=\"float-right blue whiteFont\">\r\n      <ListItem \r\n        aria-controls=\"user-menu\" aria-haspopup=\"true\"\r\n        style={{cursor: \"pointer\"}} \r\n        onClick={handleClick} \r\n        className=\"curvedButton float-right\">\r\n        <Icon>person</Icon>\r\n        <ListItemText primary={` ${props.username}`}/>\r\n      </ListItem>\r\n      <StyledMenu\r\n        id=\"customized-menu\"\r\n        anchorEl={anchorEl}\r\n        keepMounted\r\n        open={Boolean(anchorEl)}\r\n        onClose={_ => {setAnchorEl(null)}}\r\n      >\r\n        <MenuItem onClick={_ => {\r\n          // if (props.onProfile !== undefined)\r\n          //   props.onProfile();\r\n          setAnchorEl(null);\r\n        }}>\r\n          <NavLink\r\n            to=\"/User/Profile\"\r\n            // onClick={_ => {\r\n            //   this.props.toggleMenu();\r\n            // }}\r\n            style={{\r\n              color:\"black\"\r\n            }}\r\n            // className=\"MyButton\"\r\n            // activeClassName=\"active\"\r\n          >\r\n            <ListItemText primary=\"Profile\" />\r\n          </NavLink>\r\n        </MenuItem>\r\n        <MenuItem\r\n          style={{\r\n            color:\"black\"\r\n          }} \r\n          onClick={_ => {\r\n            if (props.onLogout !== undefined)\r\n              props.onLogout();\r\n            setAnchorEl(null);\r\n          }}>\r\n          <ListItemText primary=\"Logout\" />\r\n        </MenuItem>\r\n      </StyledMenu>\r\n    </span>\r\n  );\r\n}\r\n","import React, { Component } from \"react\";\r\nimport {\r\n  AppBar, Toolbar, ListItem, \r\n  ListItemText, Icon, IconButton, \r\n  // Button\r\n} from \"@material-ui/core\";\r\nimport MenuIcon from \"@material-ui/icons/Menu\";\r\n// import { NavLink } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  setWorlds,\r\n  loadFromStorage,\r\n  toggleMenu,\r\n  toggleLogin,\r\n  logout,\r\n  redirectTo\r\n} from \"../../redux/actions/index\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Box from \"@material-ui/core/Box\";\r\nimport API from \"../../smartAPI\";\r\nimport MobileMenu from \"./MobileMenu\";\r\nimport UserMenu from \"./UserMenu\";\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedPage: state.app.selectedPage,\r\n    user: state.app.user,\r\n    selectedWorld: state.app.selectedWorld,\r\n    mobileMenuOpen: !state.app.menuOpen // This defaults to closed instead of open\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    setWorlds: worlds => dispatch(setWorlds(worlds)),\r\n    loadFromStorage: () => dispatch(loadFromStorage({})),\r\n    toggleMenu: () => dispatch(toggleMenu({})),\r\n    toggleLogin: () => dispatch(toggleLogin({})),\r\n    logout: () => dispatch(logout({})),\r\n    redirectTo: page => dispatch(redirectTo(page))\r\n  };\r\n}\r\nclass Bar extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.loadFromStorage();\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <AppBar position=\"static\">\r\n        <Toolbar>\r\n          <Grid container spacing={0}>\r\n            <Grid item xs>\r\n              <IconButton\r\n                style={{ color: \"white\" }}\r\n                aria-label=\"Menu\"\r\n                onClick={_ => {\r\n                  this.props.toggleMenu();\r\n                }}\r\n              >\r\n                <MenuIcon />\r\n              </IconButton>\r\n            </Grid>\r\n            <Grid item xs>\r\n              <ListItem className=\"curvedButton\">\r\n                <ListItemText\r\n                  primary={\r\n                    this.props.selectedWorld === null\r\n                      ? \"Welcome!\"\r\n                      : this.props.selectedWorld.Name\r\n                  }\r\n                />\r\n              </ListItem>\r\n            </Grid>\r\n            <Grid item xs>\r\n              { this.props.user === null || this.props.user.username === undefined ? \r\n                <span style={{cursor: \"pointer\"}} \r\n                  onClick={_ => {\r\n                    this.props.toggleLogin();\r\n                  }}\r\n                  className=\"float-right blue whiteFont\">\r\n                  <ListItem className=\"curvedButton float-right\">\r\n                    <Icon>person</Icon>\r\n                    <ListItemText primary=\" Login/Register\"/>\r\n                  </ListItem>\r\n                </span>\r\n              : \r\n                <UserMenu \r\n                  username={this.props.user.username}\r\n                  onLogout={_ => {\r\n                    this.api.logout().then(_ => {\r\n                      this.props.logout();\r\n                    });\r\n                  }}\r\n                />\r\n              }\r\n            </Grid>\r\n          </Grid>\r\n        </Toolbar>\r\n        {this.props.mobileMenuOpen &&\r\n          <Box display={{ xs: 'inline', sm: 'none' }}>\r\n            <MobileMenu />\r\n          </Box>\r\n        }\r\n      </AppBar>\r\n    );\r\n  }\r\n}\r\n\r\nconst NavBar = connect(mapStateToProps, mapDispatchToProps)(Bar);\r\nexport default NavBar;\r\n","import React, { Component } from \"react\";\r\nimport \"../../App.css\";\r\n// import logo from \"../../logo.svg\";\r\nimport logo from \"../../assets/img/ANB.png\";\r\nimport {\r\n  // Button,\r\n  Grid,\r\n  List,\r\n  ListItem,\r\n  ListItemText,\r\n  Icon,\r\n  Divider,\r\n  FormControl,\r\n  InputLabel,\r\n  OutlinedInput,\r\n  Fab,\r\n  Tooltip\r\n} from \"@material-ui/core\";\r\nimport { Add, Star, Search } from \"@material-ui/icons\";\r\nimport StarBorderIcon from '@material-ui/icons/StarBorder';\r\nimport { NavLink } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport menuRoutes from \"./routes\";\r\nimport {\r\n  setWorlds,\r\n  setPublicWorlds,\r\n  setFollowingWorlds,\r\n  setTemplates,\r\n  logout\r\n} from \"../../redux/actions/index\";\r\nimport API from \"../../smartAPI\";\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedPage: state.app.selectedPage,\r\n    worlds: state.app.worlds,\r\n    publicWorlds: state.app.publicWorlds,\r\n    user: state.app.user,\r\n    followingWorlds: state.app.followingWorlds\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    setWorlds: worlds => dispatch(setWorlds(worlds)),\r\n    setPublicWorlds: worlds => dispatch(setPublicWorlds(worlds)),\r\n    setFollowingWorlds: worldIDs => dispatch(setFollowingWorlds(worldIDs)),\r\n    setTemplates: templates => dispatch(setTemplates(templates)),\r\n    logout: () => dispatch(logout({}))\r\n  };\r\n}\r\nclass Bar extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      browse: false,\r\n      Filter: \"\"\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.api.getWorlds(true).then(res => {\r\n      this.props.setPublicWorlds(res.publicWorlds.worlds);\r\n      this.props.setTemplates(res.templates.templates);\r\n      if (this.props.user !== null) {\r\n        if (res.userWorlds.worlds === undefined) {\r\n          this.props.logout();\r\n        } else {\r\n          this.props.setWorlds(res.userWorlds.worlds);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  links() {\r\n    return (\r\n      menuRoutes.map((prop, key) => \r\n        <ListItem key={key} className=\"curvedButton\">\r\n          <NavLink to={prop.path} className=\"MyButton\" activeClassName=\"active\">\r\n            <ListItem button>\r\n              {typeof prop.icon === \"string\" ? (\r\n                <Icon className=\"marginLeft\">{prop.icon}</Icon>\r\n              ) : (\r\n                <prop.icon className=\"marginLeft\" />\r\n              )}\r\n              &nbsp;\r\n              <ListItemText primary={prop.name} className=\"marginLeft\" />\r\n            </ListItem>\r\n          </NavLink>\r\n        </ListItem>\r\n      )\r\n    );\r\n  }\r\n\r\n  brand() {\r\n    return (\r\n      <NavLink to={`/`} className=\"BlackTextButton\" activeClassName=\"active\">\r\n        <ListItem>\r\n          <img src={logo} alt=\"logo\" className=\"App-logo\" />\r\n          <ListItemText primary={this.props.logoText} />\r\n        </ListItem>\r\n      </NavLink>\r\n    );\r\n  }\r\n\r\n  toggleFollow = (worldID, follow) => {\r\n    let followingWorlds = [...this.props.followingWorlds];\r\n    if (follow) {\r\n      followingWorlds.push(worldID);\r\n    } else {\r\n      const index = followingWorlds.indexOf(worldID);\r\n      followingWorlds.splice(index, 1);\r\n    }\r\n    if (this.props.user !== null) {\r\n      const user = { ...this.props.user };\r\n      user.followingWorlds = followingWorlds;\r\n      this.props.setFollowingWorlds(followingWorlds);\r\n      this.api.updateUser(user);\r\n    } else {\r\n      this.props.setFollowingWorlds(followingWorlds);\r\n    }\r\n  };\r\n\r\n  handleUserInput = e => {\r\n    const name = e.target.name;\r\n    const value =\r\n      e.target.type === \"checkbox\" ? e.target.checked : e.target.value;\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  publicWorlds() {\r\n    const followingWorlds = [];\r\n    const otherWorlds = [];\r\n    if (this.props.publicWorlds !== undefined &&\r\n      this.props.publicWorlds !== null &&\r\n      this.props.publicWorlds.error === undefined) {\r\n      this.props.publicWorlds.forEach(w => {\r\n        if (this.state.browse) {\r\n          if (this.state.Filter === \"\" || w.Name.toLowerCase().includes(this.state.Filter.toLowerCase())) {\r\n            if (this.props.followingWorlds.includes(w._id)) {\r\n              followingWorlds.push(w);\r\n            }\r\n            else {\r\n              otherWorlds.push(w);\r\n            }\r\n          }\r\n        } else if (this.props.followingWorlds.includes(w._id)) {\r\n          followingWorlds.push(w);\r\n        }\r\n      });\r\n    }\r\n    if (this.state.browse) {\r\n      return (\r\n        <Grid container spacing={1} direction=\"column\">\r\n          <Grid item>\r\n            <FormControl variant=\"outlined\" fullWidth>\r\n              <InputLabel htmlFor=\"filter\">Filter</InputLabel>\r\n              <OutlinedInput\r\n                id=\"filter\"\r\n                name=\"Filter\"\r\n                type=\"text\"\r\n                autoComplete=\"Off\"\r\n                value={this.state.Filter}\r\n                onChange={this.handleUserInput}\r\n                labelWidth={43}\r\n                fullWidth\r\n              />\r\n            </FormControl>\r\n          </Grid>\r\n          <Grid item>\r\n            <List>\r\n              {\r\n                followingWorlds.map((w, key) => \r\n                  <ListItem key={key} className=\"curvedButton\">\r\n                    <NavLink to={`/world/details/${w._id}`} className=\"MySmallerButton\" activeClassName=\"active\">\r\n                      <ListItem button>\r\n                        <ListItemText primary={w.Name} className=\"marginLeft\" />\r\n                      </ListItem>\r\n                    </NavLink>\r\n                    <Fab\r\n                      size=\"small\"\r\n                      color=\"primary\"\r\n                      onClick={e => {\r\n                        this.toggleFollow(w._id, false);\r\n                      }}\r\n                    >\r\n                      <Star />\r\n                    </Fab>\r\n                  </ListItem>\r\n                )\r\n              }\r\n              {\r\n                otherWorlds.map((w, key) => \r\n                  <ListItem key={key} className=\"curvedButton\">\r\n                    <NavLink to={`/world/details/${w._id}`} className=\"MySmallerButton\" activeClassName=\"active\">\r\n                      <ListItem button>\r\n                        <ListItemText primary={w.Name} className=\"marginLeft\" />\r\n                      </ListItem>\r\n                    </NavLink>\r\n                    <Fab\r\n                      size=\"small\"\r\n                      color=\"primary\"\r\n                      onClick={e => {\r\n                        this.toggleFollow(w._id, true);\r\n                      }}\r\n                    >\r\n                      <StarBorderIcon />\r\n                    </Fab>\r\n                  </ListItem>\r\n                )\r\n              }\r\n            </List>\r\n          </Grid>\r\n        </Grid>\r\n      );\r\n    }\r\n    return (\r\n      followingWorlds.map((w, key) => \r\n        <ListItem key={key} className=\"curvedButton\">\r\n          <NavLink to={`/world/details/${w._id}`} className=\"MyButton\" activeClassName=\"active\">\r\n            <ListItem button>\r\n              <ListItemText primary={w.Name} className=\"marginLeft\" />\r\n            </ListItem>\r\n          </NavLink>\r\n        </ListItem>\r\n      )\r\n    );\r\n  }\r\n\r\n  myWorlds() {\r\n    if (this.props.user === null || this.props.user === undefined) {\r\n      return \"\";\r\n    } else {\r\n      const worldLinks =\r\n        this.props.worlds === undefined\r\n          ? \"\"\r\n          : this.props.worlds.map((w, key) => \r\n              <ListItem key={key} className=\"curvedButton\">\r\n                <NavLink to={`/world/details/${w._id}`} className=\"MyButton\" activeClassName=\"active\">\r\n                  <ListItem button>\r\n                    <ListItemText primary={w.Name} className=\"marginLeft\" />\r\n                  </ListItem>\r\n                </NavLink>\r\n              </ListItem>\r\n            );\r\n      return (worldLinks);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <List>\r\n        {this.brand()}\r\n        <Divider light />\r\n        {this.links()}\r\n        <ListItem>\r\n          <ListItemText display=\"none\" primary={\"Public Worlds\"} />\r\n          <Tooltip title={`Browse Public Worlds`}>\r\n            <Fab\r\n              size=\"small\"\r\n              color=\"primary\"\r\n              onClick={e => {\r\n                this.setState({ browse: !this.state.browse });\r\n              }}\r\n            >\r\n              <Search />\r\n            </Fab>\r\n          </Tooltip>\r\n        </ListItem>\r\n        {this.publicWorlds()}\r\n        { this.props.user !== null &&\r\n          <ListItem>\r\n            <ListItemText primary={\"My Worlds\"} />\r\n          </ListItem>\r\n        }\r\n        { this.props.user !== null &&\r\n          <ListItem className=\"curvedButton\">\r\n            <NavLink to={`/world/create`} className=\"MyButton\" activeClassName=\"active\">\r\n              <ListItem button>\r\n                <Add />\r\n                <ListItemText primary={\"Create New\"} />\r\n              </ListItem>\r\n            </NavLink>\r\n          </ListItem>\r\n        }\r\n        {this.myWorlds()}\r\n      </List>\r\n    );\r\n  }\r\n}\r\n\r\nconst Sidebar = connect(mapStateToProps, mapDispatchToProps)(Bar);\r\nexport default Sidebar;\r\n","import React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\n// import uuid from 'react-uuid';\r\n// import { ArrowBack, Add, Search } from \"@material-ui/icons\";\r\nimport { \r\n  Grid, \r\n  //Button, \r\n  // Checkbox, FormControl, FormControlLabel,\r\n  // InputLabel, Tooltip, Fab,\r\n  // Select, MenuItem \r\n} from \"@material-ui/core\";\r\nimport { Helmet } from 'react-helmet';\r\n// import { Multiselect } from 'multiselect-react-dropdown';\r\nimport {\r\n  // updateSelectedType,\r\n  // addType,\r\n  // updateType,\r\n  // addAttributes,\r\n  setAttributes,\r\n  setTypes,\r\n  setThings,\r\n  notFromLogin\r\n} from \"../../redux/actions/index\";\r\nimport API from \"../../smartAPI\";\r\n// import TextBox from \"../../components/Inputs/TextBox\";\r\n\r\n/* \r\n  This component will take the main portion of the page and is used for\r\n  creating or editing a Type.  It will allow the use of Template Types\r\n  and Super Types to make the process faster.\r\n*/\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    types: state.app.types,\r\n    user: state.app.user,\r\n    fromLogin: state.app.fromLogin\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    setAttributes: attrs => dispatch(setAttributes(attrs)),\r\n    setTypes: types => dispatch(setTypes(types)),\r\n    setThings: things => dispatch(setThings(things)),\r\n    notFromLogin: () => dispatch(notFromLogin({}))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      username: \"\",\r\n      email: \"\",\r\n      fieldValidation: {\r\n        username: { valid: true, message: \"\" },\r\n        email: { valid: true, message: \"\" },\r\n      },\r\n      formValid: false,\r\n      message: \"\",\r\n      redirectTo: null,\r\n      waiting: false,\r\n      loaded: false\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  inputBlur = e => {\r\n    const name = e.target.name;\r\n    const validation = this.validateField(name);\r\n    const fieldValidation = this.state.fieldValidation;\r\n    if (\r\n      fieldValidation[name] !== undefined &&\r\n      fieldValidation[name].valid !== validation.valid\r\n    ) {\r\n      fieldValidation[name].valid = validation.valid;\r\n      fieldValidation[name].message = validation.message;\r\n      this.setState({ fieldValidation: fieldValidation });\r\n    }\r\n  }\r\n\r\n  validateField = fieldName => {\r\n    let value = null;\r\n    let valid = true;\r\n    let message = \"\";\r\n    switch (fieldName) {\r\n      case \"username\":\r\n        value = this.state.username;\r\n        // valid = value.match(/^[a-zA-Z0-9 ]*$/i) !== null;\r\n        // if (!valid)\r\n        //   message = \"Only Letters, Numbers, and Spaces allowed in Type Names\";\r\n        // else \r\n        if (value.length < 2) {\r\n          valid = false;\r\n          message = \"Username is too short\";\r\n        } else if (this.state.allUsers.filter(u=>u.username === value && u._id !== this.props.user._id).length !== 0) {\r\n          valid = false;\r\n          message = \"This Username is taken\";\r\n        }\r\n        break;\r\n      case \"email\":\r\n        value = this.state.email;\r\n        valid = value.match(/^([\\w.%+-]+)@([\\w-]+\\.)+([\\w]{2,})$/i) !== null;\r\n        message = valid ? \"\" : \"Email is invalid\";\r\n        if (valid && value !== this.props.user.email)\r\n          message = \"You will be sent a confirmation email at your new email upon submission.  Please use the link.\";\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    const response = { valid: valid, message: message };\r\n    return response;\r\n  }\r\n\r\n  validateForm = respond => {\r\n    const nameValid = this.validateField(\"username\");\r\n    const emailValid = this.validateField(\"email\");\r\n    const formValid = nameValid.valid && emailValid.valid;\r\n    const fieldValidation = this.state.fieldValidation;\r\n    fieldValidation.Name = nameValid;\r\n    this.setState(\r\n      {\r\n        formValid: formValid,\r\n        fieldValidation: fieldValidation\r\n      },\r\n      respond\r\n    );\r\n  }\r\n\r\n  onSubmit = () => {\r\n    function respond() {\r\n      if (this.state.formValid) {\r\n        this.setState({ waiting: true }, this.submitThroughAPI);\r\n      }\r\n    }\r\n\r\n    this.validateForm(respond);\r\n  }\r\n\r\n  submitThroughAPI = () => {\r\n    const user = {\r\n      _id: this.props.user._id,\r\n      username: this.state.username.trim(),\r\n      email: this.state.email.trim()\r\n    };\r\n\r\n    this.api.updateUser(user).then(res => {\r\n      // Should do all the same stuff that is done on login.\r\n      if (res.user === null) {\r\n        let errors = this.state.fieldValidation;\r\n        errors.loginError = { message: res.error, valid: false, show: true };\r\n        this.setState({ fieldValidation: errors, waiting: false });\r\n      }\r\n      else {\r\n        this.props.userLogin(res.user);\r\n        this.api.getWorldsForUser(res.user._id).then(res => {\r\n          this.props.setWorlds(res.worlds);\r\n          this.props.onLogin(res.user);\r\n          // this.setState({ redirectTo: \"/\" });\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  load = () => {\r\n    setTimeout(() => {\r\n      this.setState({\r\n        redirectTo: null,\r\n        message: \"Loading...\"\r\n      }, this.finishLoading);\r\n    }, 500);\r\n  }\r\n\r\n  finishLoading = () => {\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n    }\r\n    this.api.getAllUsers().then(res2 => {\r\n      this.setState({\r\n        allUsers: res2, \r\n        username: this.props.user.username, \r\n        email: this.props.user.email,\r\n        loaded: true,\r\n        message: \"\"\r\n      });\r\n    });\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.loaded)\r\n      this.load();\r\n    if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    } else if (this.props.user === null) {\r\n      return <span>Please log in to be able to access your profile.</span>;\r\n    } else {\r\n      return (\r\n        <Grid item xs={12} container spacing={1} direction=\"column\">\r\n          <Helmet>\r\n            <title>{ `Author's Notebook: User Profile` }</title>\r\n          </Helmet>\r\n          <Grid item>\r\n            <h2>User Profile</h2>\r\n          </Grid>\r\n          <Grid item>\r\n            Username: {this.props.user.username}\r\n            {/* { this.state.loaded && <span>{this.state.username}</span> \r\n              // <TextBox \r\n              //   Value={this.state.username} \r\n              //   fieldName=\"username\" \r\n              //   displayName=\"Username\" \r\n              //   message={this.state.fieldValidation.username.message}\r\n              //   onBlur={name => {\r\n              //     this.setState({ username: name }, this.validateForm);\r\n              //   }}\r\n              //   labelWidth={70}/>\r\n            } */}\r\n          </Grid>\r\n          <Grid item>\r\n            Email: {this.props.user.email}\r\n            {/* { this.state.loaded &&  \r\n              <TextBox \r\n                Value={this.state.email} \r\n                fieldName=\"email\" \r\n                displayName=\"Email\" \r\n                message={this.state.fieldValidation.email.message}\r\n                onBlur={email => {\r\n                  this.setState({ email }, this.validateForm);\r\n                }}\r\n                labelWidth={43}/>\r\n            } */}\r\n          </Grid>\r\n          <Grid item>I'll add more profile elements here as the website grows</Grid>\r\n          {/* <Grid item>\r\n            {Object.keys(this.state.fieldValidation).map((fieldName, i) => {\r\n              if (\r\n                this.state.fieldValidation[fieldName] !== undefined &&\r\n                this.state.fieldValidation[fieldName].message.length > 0\r\n              ) {\r\n                return (\r\n                  <p className=\"redFont\" key={i}>\r\n                    {this.state.fieldValidation[fieldName].message}\r\n                  </p>\r\n                );\r\n              } else {\r\n                return \"\";\r\n              }\r\n            })}\r\n          </Grid>\r\n          <Grid item>\r\n            <div className=\"float-right\">\r\n              <Button\r\n                variant=\"contained\" color=\"primary\"\r\n                style={{marginLeft: \"4px\"}}\r\n                className=\"w-200\"\r\n                disabled={this.state.waiting}\r\n                onClick={e => {this.onSubmit(false);}}\r\n                type=\"submit\"\r\n              >\r\n                {this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n              </Button>\r\n            </div>\r\n          </Grid>\r\n          <Grid item style={{color:\"red\"}}>{this.state.message}</Grid> */}\r\n        </Grid>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst ProfilePage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default ProfilePage;\r\n","import React, { Component } from 'react';\r\nimport { connect } from \"react-redux\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport {\r\n  Add, Edit\r\n} from \"@material-ui/icons\";\r\nimport {\r\n  Grid, List, ListItem, Button, Tooltip, Fab\r\n} from \"@material-ui/core\";\r\nimport KeyboardArrowDownIcon from '@material-ui/icons/KeyboardArrowDown';\r\nimport KeyboardArrowRightIcon from '@material-ui/icons/KeyboardArrowRight';\r\n// import Tooltip from '@material-ui/core/Tooltip';\r\n// import { Fab } from \"@material-ui/core\";\r\nimport {\r\n  updateIndexExpandedPanel\r\n} from \"../../redux/actions/index\";\r\n\r\n/* \r\n  This component will be used by the WorldDetails component.  It will\r\n  have a link at the top for creating new Things, and will list all\r\n  Things in the selected World, allowing navigation to their Details.  \r\n  The List will have pagination and filtering controls to make it \r\n  easier to manage.\r\n*/\r\nconst mapStateToProps = state => {\r\n  return { \r\n    things: state.app.things,\r\n    types: state.app.types,\r\n    selectedWorld: state.app.selectedWorld,\r\n    user: state.app.user,\r\n    indexExpandedPanel: state.app.indexExpandedPanel\r\n  };\r\n}\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    updateIndexExpandedPanel: panel => dispatch(updateIndexExpandedPanel(panel))\r\n  };\r\n}\r\nclass Index extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      redirectTo: null\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  handleChange = panel => {\r\n    this.props.updateIndexExpandedPanel(this.props.indexExpandedPanel === panel ? false : panel);\r\n  }\r\n\r\n  renderListForType(type) {\r\n    // TODO: Add a PluralName field to types so I can use it here.  It may end up being useful other places too.\r\n    const things = this.props.things.filter(thing => thing.TypeIDs.includes(type._id));\r\n    return (\r\n      <div className=\"Things\">\r\n        <List style={{ width: \"240px\" }}>\r\n          <ListItem>\r\n            <Button \r\n              fullWidth variant=\"contained\" color=\"primary\" \r\n              onClick={ _ => {this.setState({redirectTo:`/thing/create/type_id_${type._id}`})}}>\r\n              <Add/>{`Create New ${type.Name}`}\r\n            </Button>\r\n          </ListItem>\r\n          {\r\n            things.map((thing, i) => {\r\n              return (\r\n                <ListItem key={i}>\r\n                  <Button \r\n                    fullWidth variant=\"contained\" color=\"primary\" \r\n                    onClick={ _ => {this.setState({redirectTo:`/thing/details/${thing._id}`})}}>\r\n                    {thing.Name}\r\n                  </Button>\r\n                </ListItem>\r\n              );\r\n            })\r\n          }\r\n        </List>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    }\r\n    else {\r\n      const majorless = this.props.things.filter(thing => thing.Types.filter(t=>t.Major).length === 0);\r\n      const createButtons = this.props.selectedWorld !== null && \r\n        this.props.user !== null && \r\n        (this.props.selectedWorld.Owner === this.props.user._id || \r\n          this.props.selectedWorld.Collaborators.filter(c=>c.userID === this.props.user._id && c.type === \"collab\" && c.editPermission).length > 0);\r\n\r\n      return (\r\n        <div>\r\n          <Grid item container spacing={1} direction=\"column\">\r\n            <Grid item>\r\n              {this.props.indexExpandedPanel === \"TYPES\" ? \r\n                <Tooltip title={`Collapse Types`}>\r\n                  <Button \r\n                    onClick={_ => {this.handleChange(\"TYPES\")}}>\r\n                      <KeyboardArrowDownIcon/>\r\n                  </Button>\r\n                </Tooltip>\r\n              :\r\n                <Tooltip title={`Expand Types`}>\r\n                    <Button \r\n                      onClick={_ => {this.handleChange(\"TYPES\")}}>\r\n                      <KeyboardArrowRightIcon/>\r\n                    </Button>\r\n                  </Tooltip>\r\n              }\r\n              <span className={\"MuiTypography-root MuiListItemText-primary MuiTypography-body1\"}>{`Types (${this.props.types.length})`}</span>\r\n              { createButtons &&\r\n                <Tooltip title={`Create New Type`}>\r\n                  <Fab size=\"small\" color=\"primary\" style={{marginLeft: \"8px\"}}\r\n                    onClick={ _ => {this.setState({redirectTo:`/type/create`})}}>\r\n                    <Add/>\r\n                  </Fab>\r\n                </Tooltip> \r\n              }\r\n            </Grid>\r\n            { this.props.indexExpandedPanel === \"TYPES\" &&\r\n              <Grid item>\r\n                <List style={{ maxWidth: \"380px\" }}>\r\n                  {\r\n                    this.props.types.map((type, i) => {\r\n                      return (\r\n                        <ListItem key={i}>\r\n                          <Grid container spacing={1} direction=\"row\">\r\n                            <Grid item xs={8}>\r\n                              <Tooltip title={`Details for ${type.Name}`}>\r\n                                <Button \r\n                                  fullWidth variant=\"contained\" color=\"primary\" \r\n                                  onClick={ _ => {this.setState({redirectTo:`/type/details/${type._id}`})}}>\r\n                                  {type.Name}\r\n                                </Button>\r\n                              </Tooltip>\r\n                            </Grid>\r\n                            { createButtons &&\r\n                              <Grid item xs={2}>\r\n                                <Tooltip title={`Create New ${type.Name}`}>\r\n                                  <Fab size=\"small\" color=\"primary\" style={{marginLeft: \"8px\"}}\r\n                                    onClick={ _ => {this.setState({redirectTo:`/thing/create/type_id_${type._id}`})}}>\r\n                                    <Add/>\r\n                                  </Fab>\r\n                                </Tooltip>\r\n                              </Grid>\r\n                            }\r\n                            { createButtons &&\r\n                              <Grid item xs={2}>\r\n                                <Tooltip title={`Edit ${type.Name}`}>\r\n                                  <Fab size=\"small\" color=\"primary\" style={{marginLeft: \"8px\"}}\r\n                                    onClick={ _ => {this.setState({redirectTo:`/type/edit/${type._id}`})}}>\r\n                                    <Edit/>\r\n                                  </Fab>\r\n                                </Tooltip>\r\n                              </Grid>\r\n                            }\r\n                          </Grid>\r\n                        </ListItem>\r\n                      );\r\n                    })\r\n                  }\r\n                </List>\r\n              </Grid>\r\n            }\r\n            { this.props.types.filter(t=>t.Major).map((type, i) => {\r\n              const things = this.props.things.filter(thing => thing.TypeIDs.includes(type._id));\r\n              return (\r\n                <Grid key={i} item container spacing={1} direction=\"column\">\r\n                  <Grid item>\r\n                    {this.props.indexExpandedPanel === type._id ? \r\n                      <Tooltip title={`Collapse ${type.PluralName === undefined || type.PluralName === \"\" ? `${type.Name}s` : type.PluralName}`}>\r\n                        <Button \r\n                          onClick={_ => {this.handleChange(type._id)}}>\r\n                          <KeyboardArrowDownIcon/>\r\n                        </Button>\r\n                      </Tooltip>\r\n                      :\r\n                      <Tooltip title={`Expand ${type.PluralName === undefined || type.PluralName === \"\" ? `${type.Name}s` : type.PluralName}`}>\r\n                        <Button \r\n                          onClick={_ => {this.handleChange(type._id)}}>\r\n                          <KeyboardArrowRightIcon/>\r\n                        </Button>\r\n                      </Tooltip>\r\n                    }\r\n                    <Tooltip title={`Details for ${type.Name}`}>\r\n                      <Button variant=\"contained\" color=\"primary\" style={{ width: \"180px\" }}\r\n                        onClick={ _ => {this.setState({redirectTo:`/type/details/${type._id}`})}}>\r\n                        {type.PluralName === undefined || type.PluralName === \"\" ? `${type.Name}s` : type.PluralName} ({things.length})\r\n                      </Button>\r\n                    </Tooltip>\r\n                    { createButtons &&\r\n                      <span>\r\n                        <Tooltip title={`Create New ${type.Name}`}>\r\n                          <Fab size=\"small\" color=\"primary\" style={{marginLeft: \"8px\"}}\r\n                            onClick={ _ => {this.setState({redirectTo:`/thing/create/type_id_${type._id}`})}}>\r\n                            <Add/>\r\n                          </Fab>\r\n                        </Tooltip>\r\n                        <Tooltip title={`Edit ${type.Name}`}>\r\n                          <Fab size=\"small\" color=\"primary\" style={{marginLeft: \"8px\"}}\r\n                            onClick={ _ => {this.setState({redirectTo:`/type/edit/${type._id}`})}}>\r\n                            <Edit />\r\n                          </Fab>\r\n                        </Tooltip>\r\n                      </span>\r\n                    }\r\n                  </Grid>\r\n                  {this.props.indexExpandedPanel === type._id &&\r\n                    <Grid item>\r\n                      <List style={{ maxWidth: \"380px\" }}>\r\n                        {\r\n                          things.map((thing, j) => {\r\n                            return (\r\n                              <ListItem key={j}>\r\n                                <Grid container spacing={1} direction=\"row\">\r\n                                  <Grid item xs={10}>\r\n                                    <Tooltip title={`Details for ${thing.Name}`}>\r\n                                      <Button \r\n                                        fullWidth variant=\"contained\" color=\"primary\" \r\n                                        onClick={ _ => {this.setState({redirectTo:`/thing/details/${thing._id}`})}}>\r\n                                        {thing.Name}\r\n                                      </Button>\r\n                                    </Tooltip>\r\n                                  </Grid>\r\n                                  { createButtons &&\r\n                                    <Grid item xs={2}>\r\n                                      <Tooltip title={`Edit ${thing.Name}`}>\r\n                                        <Fab size=\"small\" color=\"primary\" style={{marginLeft: \"8px\"}}\r\n                                          onClick={ _ => {this.setState({redirectTo:`/thing/edit/${thing._id}`})}}>\r\n                                          <Edit/>\r\n                                        </Fab>\r\n                                      </Tooltip>\r\n                                    </Grid>\r\n                                  }\r\n                                </Grid>\r\n                              </ListItem>\r\n                            );\r\n                          })\r\n                        }\r\n                      </List>\r\n                    </Grid>\r\n                  }\r\n                </Grid>\r\n              );\r\n            })}\r\n            <Grid item>\r\n              {this.props.indexExpandedPanel === \"OTHER\" ? \r\n                <Tooltip title={`Collapse Other Things`}>\r\n                  <Button \r\n                    onClick={_ => {this.handleChange(\"OTHER\")}}>\r\n                    <KeyboardArrowDownIcon/>\r\n                  </Button>\r\n                </Tooltip>\r\n              :\r\n                <Tooltip title={`Expand Other Things`}>\r\n                  <Button \r\n                    onClick={_ => {this.handleChange(\"OTHER\")}}>\r\n                    <KeyboardArrowRightIcon/>\r\n                  </Button>\r\n                </Tooltip>\r\n              }\r\n              <span className={\"MuiTypography-root MuiListItemText-primary MuiTypography-body1\"}>{`Other Things (${majorless.length})`}</span>\r\n              { createButtons &&\r\n                <Tooltip title={`Create New Thing`}>\r\n                  <Fab size=\"small\" color=\"primary\" style={{marginLeft: \"8px\"}}\r\n                    onClick={ _ => {this.setState({redirectTo:`/thing/create`})}}>\r\n                    <Add/>\r\n                  </Fab>\r\n                </Tooltip>\r\n              }\r\n            </Grid>\r\n            {this.props.indexExpandedPanel === \"OTHER\" &&\r\n              <Grid item>\r\n                <List style={{ maxWidth: \"380px\" }}>\r\n                  {\r\n                    majorless.map((thing, j) => {\r\n                      return (\r\n                        <ListItem key={j}>\r\n                          <Grid container spacing={1} direction=\"row\">\r\n                            <Grid item xs={10}>\r\n                              <Tooltip title={`Details for ${thing.Name}`}>\r\n                                <Button \r\n                                  fullWidth variant=\"contained\" color=\"primary\" \r\n                                  onClick={ _ => {this.setState({redirectTo:`/thing/details/${thing._id}`})}}>\r\n                                  {thing.Name}\r\n                                </Button>\r\n                              </Tooltip>\r\n                            </Grid>\r\n                            { createButtons &&\r\n                              <Grid item xs={2}>\r\n                                <Tooltip title={`Edit ${thing.Name}`}>\r\n                                  <Fab size=\"small\" color=\"primary\" style={{marginLeft: \"8px\"}}\r\n                                    onClick={ _ => {this.setState({redirectTo:`/thing/edit/${thing._id}`})}}>\r\n                                    <Edit/>\r\n                                  </Fab>\r\n                                </Tooltip>\r\n                              </Grid>\r\n                            }\r\n                          </Grid>\r\n                        </ListItem>\r\n                      );\r\n                    })\r\n                  }\r\n                </List>\r\n              </Grid>\r\n            }\r\n          </Grid>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst ThingIndex = connect(mapStateToProps, mapDispatchToProps)(Index);\r\nexport default ThingIndex;\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\n\r\nimport {\r\n  FormControl,\r\n  OutlinedInput,\r\n  InputLabel,\r\n  FormHelperText\r\n} from \"@material-ui/core\";\r\n  \r\n\r\nexport default function TextBox(props) {\r\n  const [value, changeValue] = useState(props.Value === undefined || props.Value === null ? \"\" : props.Value);\r\n  const displayName = props.displayName === undefined ? props.fieldName : props.displayName;\r\n  \r\n  return (\r\n    <FormControl variant=\"outlined\" fullWidth>\r\n      <InputLabel htmlFor={`text_field_${props.fieldName}`}>{displayName}</InputLabel>\r\n      { props.multiline !== undefined && props.multiline ?\r\n        <OutlinedInput\r\n          id={`text_field_${props.fieldName}`}\r\n          name={`text_field_${props.fieldName}`}\r\n          type=\"text\"\r\n          autoComplete=\"Off\"\r\n          multiline\r\n          error={props.message !== undefined && props.message !== \"\"}\r\n          value={value}\r\n          onChange={e => {\r\n            changeValue(e.target.value);\r\n          }}\r\n          onBlur={e => {\r\n            props.onBlur(value.trim());\r\n          }}\r\n          labelWidth={props.labelWidth}\r\n          fullWidth\r\n        />\r\n      :\r\n        <OutlinedInput\r\n          id={`text_field_${props.fieldName}`}\r\n          name={`text_field_${props.fieldName}`}\r\n          type=\"text\"\r\n          autoComplete=\"Off\"\r\n          error={props.message !== undefined && props.message !== \"\"}\r\n          value={value}\r\n          onChange={e => {\r\n            changeValue(e.target.value);\r\n          }}\r\n          onBlur={e => {\r\n            props.onBlur(value.trim());\r\n          }}\r\n          labelWidth={props.labelWidth}\r\n          fullWidth\r\n        />\r\n      }\r\n      <FormHelperText>\r\n        {props.message}\r\n      </FormHelperText>\r\n    </FormControl>\r\n  );\r\n}\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\n\r\nimport {\r\n  Grid,\r\n  Button,\r\n  List, ListItem,\r\n  Checkbox, FormControlLabel\r\n} from \"@material-ui/core\";\r\nimport TextBox from \"../Inputs/TextBox\";\r\n\r\n\r\nconst validate = (value, props, changeMessage) => {\r\n  const valid = props.templates.filter((t) => t.Name === value).length === 0;\r\n  changeMessage(valid ? \"\" : \"This Template Name is already in use\");\r\n  return valid;\r\n};\r\n\r\nconst saveTemplate = (templateName, typeIDs, props, changeMessage, changeWaiting) => {\r\n  changeWaiting(true);\r\n  const template = {\r\n    _id: null,\r\n    Name: templateName.trim(),\r\n    typeIDs: typeIDs,\r\n    worldID: props.world._id\r\n  };\r\n\r\n  // Calls API\r\n  props.api\r\n    .createTemplate(template)\r\n    .then(res => {\r\n      if (res.error === undefined) {\r\n        changeMessage(\"Success\");\r\n        setTimeout(() => {\r\n          changeWaiting(false);\r\n          props.onSave();\r\n        }, 500);\r\n      } else {\r\n        changeMessage(res.error);\r\n        changeWaiting(false);\r\n      }\r\n    })\r\n    .catch(err => console.log(err));\r\n};\r\n\r\nconst addTypeToList = (type, types, attributesByID, typeIDs) => {\r\n  if (!typeIDs.includes(type._id)) {\r\n    typeIDs.push(type._id);\r\n    for (let i = 0; i < type.SuperIDs.length; i++) {\r\n      let superType = types.filter(t => t._id === type.SuperIDs[i]);\r\n      if (superType.length > 0){\r\n        superType = superType[0];\r\n        typeIDs = addTypeToList(superType, types, attributesByID, typeIDs);\r\n      }\r\n    }\r\n    for (let i = 0; i < type.Attributes.length; i++) {\r\n      let attr = attributesByID[type.Attributes[i].attrID];\r\n      if (attr.AttributeType === \"Type\" || (attr.AttributeType === \"List\" && attr.ListType === \"Type\")) {\r\n        let attrType = types.filter(t => t._id === attr.DefinedType);\r\n        if (attrType.length > 0) {\r\n          attrType = attrType[0];\r\n          typeIDs = addTypeToList(attrType, types, attributesByID, typeIDs);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return typeIDs;\r\n};\r\n\r\nconst removeTypeFromList = (type, types, attributesByID, typeIDs) => {\r\n  const index = typeIDs.indexOf(type._id);\r\n  if (index > -1) {\r\n    typeIDs.splice(index);\r\n    const subTypes = types.filter(t=>t.SuperIDs.includes(type._id));\r\n    for (let i = 0; i < subTypes.length; i++) {\r\n      let subType = subTypes[i];\r\n      if (subType.length > 0){\r\n        subType = subType[0];\r\n        typeIDs = removeTypeFromList(subType, types, attributesByID, typeIDs);\r\n      }\r\n    }\r\n    const references = types.filter(t=>t.ReferenceIDs !== undefined && t.ReferenceIDs.includes(type._id));\r\n    for (let i = 0; i < references.length; i++) {\r\n      let reference = references[i];\r\n      typeIDs = removeTypeFromList(reference, types, attributesByID, typeIDs);\r\n    }\r\n  }\r\n  return typeIDs;\r\n};\r\n\r\nexport default function TemplateModal(props) {\r\n  const valid = props.templates.filter((t) => t.Name === props.world.Name).length === 0;\r\n  const [name, changeName] = useState(props.world.Name);\r\n  const [message, changeMessage] = useState(\"\");\r\n  const [nameMessage, changeNameMessage] = useState(valid ? \"\" : \"This Template Name is already in use\");\r\n  const [waiting, changeWaiting] = useState(false);\r\n  const [typeIDs, changeTypeIDs] = useState([]);\r\n  const [nameValid, changeValid] = useState(valid);\r\n\r\n  return (\r\n    <Grid container spacing={1} direction=\"column\">\r\n      <Grid item>\r\n        Create a template for use in other worlds based on this one.\r\n        The template will be usable by any user.\r\n      </Grid>\r\n      <Grid item>\r\n        <TextBox \r\n          Value={name} \r\n          fieldName=\"Template Name\" \r\n          message={nameMessage}\r\n          onBlur={n => {\r\n            changeName(n);\r\n            changeValid(validate(n, props, changeNameMessage));\r\n          }}\r\n          labelWidth={110}/>\r\n      </Grid>\r\n      <Grid item style={{color: \"red\"}}>\r\n        {message}\r\n      </Grid>\r\n      <Grid item>\r\n        Choose which types you want to include in the template.  \r\n        Dependent Types will automatically be checked/unchecked as appropriate.\r\n        <List>\r\n          <ListItem>\r\n            <Button\r\n              variant=\"contained\"\r\n              color=\"primary\"\r\n              disabled={waiting || typeIDs.length === props.types.length}\r\n              onClick={_ => {\r\n                changeWaiting(true);\r\n                const newTypeIDs = [];\r\n                props.types.forEach(t => {\r\n                  newTypeIDs.push(t._id);\r\n                });\r\n                changeTypeIDs(newTypeIDs);\r\n                changeWaiting(false);\r\n              }}\r\n            >\r\n              {waiting ? \"Please Wait\" : \"Check All\"}\r\n            </Button>\r\n            <Button\r\n              style={{ marginLeft: \"4px\"}}\r\n              variant=\"contained\"\r\n              color=\"primary\"\r\n              disabled={waiting || typeIDs.length === 0}\r\n              onClick={_ => {\r\n                changeTypeIDs([]);\r\n              }}\r\n            >\r\n              {waiting ? \"Please Wait\" : \"Uncheck All\"}\r\n            </Button>\r\n          </ListItem>\r\n          { props.types.map((type, key) => {\r\n            return (\r\n              <ListItem key={key}>\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      checked={typeIDs.includes(type._id)}\r\n                      onChange={ e => {\r\n                        if (!waiting) {\r\n                          changeWaiting(true);\r\n                          let newTypeIDs = [...typeIDs];\r\n                          if (e.target.checked) {\r\n                            newTypeIDs = addTypeToList(type, props.types, props.attributesByID, newTypeIDs);\r\n                            changeTypeIDs(newTypeIDs);\r\n                          } else {\r\n                            newTypeIDs = removeTypeFromList(type, props.types, props.attributesByID, newTypeIDs);\r\n                            changeTypeIDs(newTypeIDs);\r\n                          }\r\n                          changeWaiting(false);\r\n                        }\r\n                      }}\r\n                      name={`include_type_${type._id}`}\r\n                      color=\"primary\"\r\n                    />\r\n                  }\r\n                  label={type.Name}\r\n                />\r\n              </ListItem>\r\n            );\r\n          })}\r\n        </List>\r\n      </Grid>\r\n      <Grid item container spacing={1} direction=\"row\">\r\n        <Grid item xs={6}>\r\n          <Button\r\n            fullWidth\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            disabled={waiting || !nameValid || typeIDs.length === 0}\r\n            onClick={_ => {\r\n              changeWaiting(true);\r\n              saveTemplate(name, typeIDs, props, changeMessage, changeWaiting);\r\n            }}\r\n          >\r\n            {waiting ? \"Please Wait\" : \"Submit\"}\r\n          </Button>\r\n        </Grid>\r\n        <Grid item xs={6}>\r\n          <Button\r\n            fullWidth\r\n            variant=\"contained\"\r\n            onClick={(e) => {\r\n              if (props.onCancel !== undefined && props.onCancel !== null)\r\n                props.onCancel();\r\n            }}\r\n          >\r\n            Cancel\r\n          </Button>\r\n        </Grid>\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n}\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\n\r\nimport {\r\n  Grid,\r\n  Button,\r\n  List, ListItem,\r\n  Checkbox, Tooltip\r\n} from \"@material-ui/core\";\r\n\r\n\r\nexport default function TemplatesModal(props) {\r\n  const [selectedTemplate, changeSelectedTemplate] = useState({});\r\n  const [selectedTemplateIDs, changeSelectedTemplates] = useState(props.selectedTemplateIDs === undefined ? [] : props.selectedTemplateIDs);\r\n\r\n  return (\r\n    <Grid container spacing={1} direction=\"column\">\r\n      <Grid item>\r\n        Click a template to view its contents.\r\n        Select the templates you want to import into your world.\r\n        Any which have types or attributes with the same names \r\n        (either with each other or with what you already have in your world), \r\n        we will try to merge them if possible.  \r\n        If it's not, then we will append the names of them with \r\n        the names of the templates they came from, and you can \r\n        resolve it yourself afterward.\r\n      </Grid>\r\n      <Grid item container spacing={1} direction=\"row\">\r\n        <Grid item xs={3}>\r\n          Templates:\r\n          <List>\r\n            { props.templates.map((template, key) => {\r\n              return (\r\n                <ListItem key={key}>\r\n                  <Checkbox\r\n                    checked={selectedTemplateIDs.includes(template._id)}\r\n                    onChange={ _ => {\r\n                      const newSelectedTemplateIDs = [...selectedTemplateIDs];\r\n                      newSelectedTemplateIDs.push(template._id);\r\n                      changeSelectedTemplates(newSelectedTemplateIDs);\r\n                    }}\r\n                    name={`include_template_${template._id}`}\r\n                    color=\"primary\"\r\n                  />\r\n                  <Tooltip title={`Details for ${template.Name}`}>\r\n                    <Button \r\n                      fullWidth variant=\"contained\" color=\"primary\" \r\n                      onClick={ _ => {\r\n                        changeSelectedTemplate(template);\r\n                      }}>\r\n                      {template.Name}\r\n                    </Button>\r\n                  </Tooltip>\r\n                </ListItem>\r\n              );\r\n            })}\r\n          </List>\r\n        </Grid>\r\n        { selectedTemplate._id !== undefined && \r\n          <Grid item xs={9} container spacing={1} direction=\"column\">\r\n            <Grid item>\r\n              {selectedTemplate.Name}\r\n            </Grid>\r\n            <Grid item>\r\n              Types:\r\n            </Grid>\r\n            { selectedTemplate.Types.map((type, typeKey) => {\r\n              return (\r\n                <Grid item key={typeKey} container spacing={1} direction=\"row\">\r\n                  <Grid item xs={12} sm={3}>\r\n                    {type.Name}\r\n                  </Grid>\r\n                  <Grid item xs={12} sm={9}>\r\n                    Attributes (\r\n                      { type.Attributes.map((a, aKey) => {\r\n                        return (\r\n                          <span key={aKey}>{aKey > 0 && <span>,&nbsp;</span>}{selectedTemplate.Attributes.filter(attr => attr.attrID === a.attrID)[0].Name}</span>\r\n                        );\r\n                      })}\r\n                    )\r\n                  </Grid>\r\n                </Grid>\r\n              );\r\n            })}\r\n          </Grid>\r\n        }\r\n      </Grid>\r\n      <Grid item container spacing={1} direction=\"row\">\r\n        <Grid item xs={6}>\r\n          <Button\r\n            fullWidth\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            disabled={selectedTemplateIDs.length === 0}\r\n            onClick={_ => {\r\n              props.onSubmit(selectedTemplateIDs);\r\n            }}\r\n          >\r\n            OK\r\n          </Button>\r\n        </Grid>\r\n        <Grid item xs={6}>\r\n          <Button\r\n            fullWidth\r\n            variant=\"contained\"\r\n            onClick={(e) => {\r\n              if (props.onCancel !== undefined && props.onCancel !== null)\r\n                props.onCancel();\r\n            }}\r\n          >\r\n            Cancel\r\n          </Button>\r\n        </Grid>\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport { \r\n  selectWorld, setTypes, setThings, setWorlds, \r\n  setPublicWorlds, updatePublicWorldForCollab,\r\n  setAttributes, \r\n  setTemplates,\r\n  updateAttributes,\r\n  notFromLogin,\r\n  toggleLogin\r\n} from \"../../redux/actions/index\";\r\nimport API from \"../../smartAPI\";\r\nimport Index from \"./Index\";\r\nimport { \r\n  Edit, Delete, People\r\n} from \"@material-ui/icons\";\r\nimport {\r\n  List, ListItem, \r\n  Grid, Button, \r\n  Modal, Tooltip,\r\n  Fab, Box\r\n} from '@material-ui/core';\r\nimport { Helmet } from 'react-helmet';\r\nimport TemplateModal from \"../../components/Modals/TemplateModal\";\r\nimport TemplatesModal from \"../../components/Modals/TemplatesModal\";\r\nimport CommentsControl from \"../../components/Inputs/CommentsControl\";\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedPage: state.app.selectedPage,\r\n    selectedWorld: state.app.selectedWorld,\r\n    selectedWorldID: state.app.selectedWorldID,\r\n    worlds: state.app.worlds,\r\n    publicWorlds: state.app.publicWorlds,\r\n    types: state.app.types,\r\n    things: state.app.things,\r\n    user: state.app.user,\r\n    attributesByID: state.app.attributesByID,\r\n    attributesByName: state.app.attributesByName,\r\n    fromLogin: state.app.fromLogin,\r\n    templates: state.app.templates\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    selectWorld: worldID => dispatch(selectWorld(worldID)),\r\n    setTypes: types => dispatch(setTypes(types)),\r\n    setThings: things => dispatch(setThings(things)),\r\n    setWorlds: worlds => dispatch(setWorlds(worlds)),\r\n    setTemplates: templates => dispatch(setTemplates(templates)),\r\n    setPublicWorlds: worlds => dispatch(setPublicWorlds(worlds)),\r\n    updatePublicWorldForCollab: world => dispatch(updatePublicWorldForCollab(world)),\r\n    setAttributes: attributes => dispatch(setAttributes(attributes)),\r\n    updateAttributes: attributes => dispatch(updateAttributes(attributes)),\r\n    notFromLogin: () => dispatch(notFromLogin({})),\r\n    toggleLogin: () => dispatch(toggleLogin({}))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      world: null,\r\n      modalOpen: false,\r\n      redirectTo: null,\r\n      templateMode: false,\r\n      importMode: false,\r\n      selectedTemplateIDs: []\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n  componentDidMount() {\r\n  }\r\n\r\n  getAttributes() {\r\n    this.api.getAttributesForWorld(this.props.selectedWorldID).then(res => {\r\n      if (res !== undefined && res.error === undefined) {\r\n        // We store the attributes in two hashes, by name and by id\r\n        this.props.setAttributes(res.attributes);\r\n        this.getTypes();\r\n      }\r\n    });\r\n  }\r\n\r\n  getTypes() {\r\n    this.api.getTypesForWorld(this.props.selectedWorldID).then(res => {\r\n      if (res !== undefined && res.error === undefined) {\r\n        // Add Supers to each type\r\n        const types = res.types;\r\n        const updateAttributes = [];\r\n        types.forEach(t=> {\r\n          t.Supers = [];\r\n          t.SuperIDs.forEach(sID=> {\r\n            t.Supers = t.Supers.concat(types.filter(t2=>t2._id === sID));\r\n          });\r\n          t.AttributesArr = [];\r\n          t.Attributes.forEach(a => {\r\n            const attr = this.props.attributesByID[a.attrID];\r\n            attr.TypeIDs.push(t._id);\r\n            updateAttributes.push(attr);\r\n            t.AttributesArr.push({\r\n              index: t.AttributesArr.length,\r\n              Name: attr.Name,\r\n              AttributeType: attr.AttributeType,\r\n              Options: attr.Options,\r\n              DefinedType: attr.DefinedType,\r\n              ListType: attr.ListType,\r\n              attrID: a.attrID,\r\n              TypeIDs: a.TypeIDs\r\n            });\r\n          });\r\n          const defHash = {};\r\n          if (t.Defaults !== undefined) {\r\n            t.Defaults.forEach(def => {\r\n              defHash[def.attrID] = def;\r\n            });\r\n          }\r\n          t.DefaultsHash = defHash;\r\n        });\r\n        this.props.updateAttributes(updateAttributes);\r\n        this.props.setTypes(types);\r\n        this.getThings();\r\n      }\r\n    });\r\n  }\r\n\r\n  getThings() {\r\n    this.api.getThingsForWorld(this.props.selectedWorldID).then(res => {\r\n      if (res !== undefined && res.error === undefined) {\r\n        const things = res.things;\r\n        things.forEach(t=> {\r\n          t.Types = [];\r\n          t.TypeIDs.forEach(tID=> {\r\n            t.Types = t.Types.concat(this.props.types.filter(t2=>t2._id === tID));\r\n          });\r\n        });\r\n        this.props.setThings(things);\r\n      }\r\n    });\r\n  }\r\n\r\n  delete = e => {\r\n    this.api.deleteWorld(this.props.selectedWorldID).then(res=>{\r\n      if (res.error === undefined) {\r\n        this.api.getWorlds(true).then(res2 => {\r\n          this.props.setPublicWorlds(res2.publicWorlds.worlds);\r\n          this.props.setWorlds(res2.userWorlds.worlds);\r\n          this.props.setTemplates(res2.templates.templates);\r\n\r\n          this.props.selectWorld(null);\r\n          this.setState({modalOpen: false, redirectTo: `/`});\r\n        });\r\n      }\r\n      else {\r\n        this.setState({ waiting: false, message: res.error });\r\n      }\r\n    });\r\n  }\r\n\r\n  getModalStyle = () => {\r\n    const top = Math.round(window.innerHeight / 2) - 50;\r\n    const left = Math.round(window.innerWidth / 2) - 200;\r\n  \r\n    return {\r\n      top: `${top}%`,\r\n      left: `${left}%`,\r\n      transform: `translate(${left}px, ${top}px)`,\r\n    };\r\n  }\r\n\r\n  load = (id) => {\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n    }\r\n    setTimeout(() => {\r\n      this.props.selectWorld(id);\r\n      this.api.getWorld(id).then(res => {\r\n        this.props.setAttributes(res.attributes);\r\n        this.props.setTypes(res.types);\r\n        this.props.setThings(res.things);\r\n      });\r\n    }, 500);\r\n  }\r\n\r\n  requestToCollaborate = () => {\r\n    this.api.requestToCollaborate(this.props.selectedWorldID).then(res => {\r\n      const world = this.props.selectedWorld;\r\n      world.Collaborators.push(res);\r\n      this.props.updatePublicWorldForCollab(world);\r\n    });\r\n  }\r\n\r\n  respondToInvite = () => {\r\n    const invite = this.props.selectedWorld.Collaborators.filter(c=> c.userID === this.props.user._id && c.type === \"invite\")[0];\r\n    this.setState({ redirectTo: `/world/collaborate/${this.props.selectedWorldID}/${invite.collabID}` });\r\n  }\r\n\r\n  updateTemplates = () => {\r\n    this.api.getTemplates().then(res => {\r\n      this.props.setTemplates(res.templates);\r\n      this.setState({ templateMode: false });\r\n    });\r\n  }\r\n\r\n  importSelectedTemplates = () => {\r\n    const templatesToImport = [...this.state.selectedTemplateIDs];\r\n    if (templatesToImport.length > 0) {\r\n      const template = {...this.props.templates.filter(t => t._id === templatesToImport[0])[0]};\r\n      this.importDumbTypesRecursive(0, template.Types, [], {}, template.Attributes, template.Name);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This checks to see if a type by that name exists.\r\n   * If so then it merges their descriptions and majorness,\r\n   * then it puts it in the map.\r\n   * If not then it inserts it with just name, description, \r\n   * and majorness, and puts it in the map.\r\n   * After all the dumb types are merged or inserted and mapped,\r\n   * and after all the attributes are merged, upserted, and mapped,\r\n   * then we go through all the types and merge in their attributes.\r\n   */\r\n  importDumbTypesRecursive = (typePos, types, newTypes, typeMap, attributes, templateName) => {\r\n    // function next() {\r\n      \r\n    // }\r\n    const type = {...types[typePos]};\r\n    const typeID = type.typeID;\r\n    // Check for an existing Type with the same name.\r\n    let existingType = this.props.types.filter(t => t.Name.trim().toLowerCase() === type.Name.trim().toLowerCase());\r\n    if (existingType.length > 0) {\r\n      existingType = existingType[0];\r\n      typeMap[typeID] = existingType._id;\r\n      newTypes.push(existingType);\r\n      if (existingType.Description === type.Description && (existingType.Major || !type.Major)) {\r\n        // Sans attributes, they match, so we can just move on.\r\n        // next();\r\n        typePos++;\r\n        if (types.length === typePos) {\r\n          // We're done with all the types.\r\n          // Now for the attributes.\r\n          this.compareAndFixAttributes(types, newTypes, typeMap, attributes, templateName);\r\n        } else {\r\n          this.importDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, templateName);\r\n        }\r\n      } else {\r\n        if (existingType.Description !== type.Description) {\r\n          existingType.Description += ` From Template (${templateName}) ${type.Description}`;\r\n        }\r\n        if (type.Major)\r\n          existingType.Major = true;\r\n        if (existingType.PluralName === undefined || existingType.PluralName === \"\")\r\n          existingType.PluralName = type.PluralName;\r\n        this.api.updateType(existingType).then(res => {\r\n          // next();\r\n          typePos++;\r\n          if (types.length === typePos) {\r\n            // We're done with all the types.\r\n            // Now for the attributes.\r\n            this.compareAndFixAttributes(types, newTypes, typeMap, attributes, templateName);\r\n          } else {\r\n            this.importDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, templateName);\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      // Remove the attributes\r\n      delete type.typeID;\r\n      type.Attributes = [];\r\n      type.worldID = this.props.selectedWorldID;\r\n      // insert it\r\n      this.api.createType(type).then(res => {\r\n        if (res.error === undefined) {\r\n          // map it\r\n          typeMap[typeID] = res.typeID;\r\n          type._id = res.typeID;\r\n          newTypes.push(type);\r\n          // next();\r\n          typePos++;\r\n          if (types.length === typePos) {\r\n            // We're done with all the types.\r\n            // Now for the attributes.\r\n            this.compareAndFixAttributes(types, newTypes, typeMap, attributes, templateName);\r\n          } else {\r\n            this.importDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, templateName);\r\n          }\r\n        } else {\r\n          console.log(res.error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * This goes through all the Attributes, \r\n   * and looks for existing Attributes with the same name.  \r\n   * If it finds one it checks to see if they're compatible \r\n   * (same type, etc).  \r\n   * If they're compatible then it merges them.  \r\n   * If not then the new one gets the template name appended to its name.\r\n   * Then they're upserted, and then all attributes are pulled, \r\n   * and it puts together a mapping of the ids to be used in the types.\r\n   */\r\n  compareAndFixAttributes = (types, newTypes, typeMap, attributes, templateName) => {\r\n    const upsertUs = [];\r\n    const nameChanges = {\r\n      // oldName: newName\r\n    };\r\n    attributes.forEach(a => {\r\n      const attribute = {...a};\r\n      delete attribute.attrID;\r\n      if (attribute.AttributeType === \"Type\" || (attribute.AttributeType === \"List\" && attribute.ListType === \"Type\")) {\r\n        // We need to fix DefinedType\r\n        attribute.DefinedType = typeMap[attribute.DefinedType];\r\n      }\r\n      const existingAttribute = this.props.attributesByName[attribute.Name];\r\n      if (existingAttribute !== undefined) {\r\n        // We've got a matching name.  Check if the types match.\r\n        if (attribute.AttributeType !== existingAttribute.AttributeType || (attribute.AttributeType === \"List\" && attribute.ListType !== existingAttribute.ListType)) {\r\n          // They don't, so we need to change the name.\r\n          attribute.Name += ` From Template (${templateName})`;\r\n          nameChanges[existingAttribute.Name] = attribute.Name;\r\n        } else {\r\n          // It matches, so we can merge them.\r\n          attribute._id = existingAttribute._id;\r\n          if (attribute.AttributeType === \"Options\" || (attribute.AttributeType === \"List\" && attribute.ListType === \"Options\")) {\r\n            // It's Options, so we need to merge the Options.\r\n            const attrOptions = attribute.Options;\r\n            attribute.Options = existingAttribute.Options;\r\n            attrOptions.forEach(o => {\r\n              if (!attribute.Options.includes(o))\r\n                attribute.Options.push(o);\r\n            });\r\n          }\r\n        }\r\n      }\r\n      attribute.worldID = this.props.selectedWorldID;\r\n      upsertUs.push(attribute);\r\n    });\r\n    // We've compared them, now we upsert.\r\n    this.api.upsertAttributes(this.props.selectedWorldID, upsertUs).then(res => {\r\n      // Now we need to build the map\r\n      const attrMap = {\r\n        // templateID: realID\r\n      };\r\n      attributes.forEach(a => {\r\n        if (nameChanges[a.Name] !== undefined) {\r\n          // The name changed so use the new name.\r\n          attrMap[a.attrID] = res.attributes[nameChanges[a.Name]];\r\n        } else {\r\n          attrMap[a.attrID] = res.attributes[a.Name];\r\n        }\r\n      });\r\n      // The map is built, so now we're done here, and we need to update the types with their attributes\r\n      this.addAttributesToDumbTypesRecursive(0, types, newTypes, typeMap, attributes, attrMap, templateName);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Goes through each type and adds its attributes onto its \r\n   * corresponding type in newTypes, updates, then sends it back \r\n   * to the beginning of the process.\r\n   * \r\n   */\r\n  addAttributesToDumbTypesRecursive = (typePos, types, newTypes, typeMap, attributes, attrMap, templateName) => {\r\n    const type = types[typePos];\r\n    const newType = newTypes[typePos];\r\n    if (type.Name !== newType.Name) {\r\n      console.log(\"Names don't match\");\r\n      // If this happens then I did something wrong.  Should never happen\r\n    }\r\n    else {\r\n      // function next() {\r\n        \r\n      // }\r\n      let attributesAdded = false;\r\n      if (newType.Attributes.length === 0) {\r\n        // It's not a merged type, so just add the attributes.\r\n        let index = 0;\r\n        type.Attributes.forEach(attr => {\r\n          const realID = attrMap[attr.attrID];\r\n          newType.Attributes.push({\r\n            attrID: realID, index\r\n          });\r\n          index++;\r\n          attributesAdded = true;\r\n        });\r\n      } else {\r\n        // It's a merged type, so we need to check each attribute to see if it's already on it.\r\n        let index = newType.Attributes.length;\r\n        type.Attributes.forEach(attr => {\r\n          const realID = attrMap[attr.attrID];\r\n          if (newType.Attributes.filter(a => a.attrID === realID).length === 0) {\r\n            newType.Attributes.push({\r\n              attrID: realID, index\r\n            });\r\n            index++;\r\n            attributesAdded = true;\r\n          }\r\n        });\r\n      }\r\n      if (attributesAdded) {\r\n        // Update the type\r\n        this.api.updateType(newType).then(res => {\r\n          if (res.error === undefined) {\r\n            // Done.  Move on.\r\n            // next();\r\n            typePos++;\r\n            if (types.length === typePos) {\r\n              // We're done with all the types.\r\n              // Now we see if there's another selected template.\r\n              this.api.getWorld(this.props.selectedWorldID, true).then(res => {\r\n                this.props.setAttributes(res.attributes);\r\n                this.props.setTypes(res.types);\r\n                this.props.setThings(res.things);\r\n\r\n                let templateIDs = [...this.state.selectedTemplateIDs];\r\n                templateIDs.splice(0);\r\n                this.setState({ selectedTemplateIDs: templateIDs });\r\n              });\r\n            } else {\r\n              this.addAttributesToDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, attrMap, templateName);\r\n            }\r\n          } else {\r\n            console.log(res.error);\r\n          }\r\n        });\r\n      } else {\r\n        // Nothing to update.  Move on.\r\n        // next();\r\n        typePos++;\r\n        if (types.length === typePos) {\r\n          // We're done with all the types.\r\n          // Now we see if there's another selected template.\r\n          this.api.getWorld(this.props.selectedWorldID, true).then(res => {\r\n            this.props.setAttributes(res.attributes);\r\n            this.props.setTypes(res.types);\r\n            this.props.setThings(res.things);\r\n\r\n            let templateIDs = [...this.state.selectedTemplateIDs];\r\n            templateIDs.splice(0);\r\n            this.setState({ selectedTemplateIDs: templateIDs });\r\n          });\r\n        } else {\r\n          this.addAttributesToDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, attrMap, templateName);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { id } = this.props.match.params;\r\n    if ((this.props.worlds.length > 0 || this.props.publicWorlds.length > 0) && (this.props.selectedWorldID === null || this.props.selectedWorldID !== id)) {\r\n      this.load(id);\r\n    }\r\n    if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    } else if (this.props.selectedWorld !== null && \r\n      !this.props.selectedWorld.Public && \r\n      this.props.user === null) {\r\n      setTimeout(() => {\r\n        this.props.toggleLogin();\r\n      }, 500);\r\n      return <span>Requires Login</span>;\r\n    } else if (this.props.selectedWorld !== null && \r\n      !this.props.selectedWorld.Public && \r\n      (this.props.selectedWorld.Owner !== this.props.user._id && \r\n        this.props.selectedWorld.Collaborators.filter(c=>c.userID === this.props.user._id && c.type === \"collab\").length === 0)) {\r\n      return <Redirect to=\"/\" />;\r\n    } else if (this.state.templateMode) {\r\n      return (\r\n        <TemplateModal \r\n          world={this.props.selectedWorld} \r\n          types={this.props.types}\r\n          attributesByID={this.props.attributesByID}\r\n          templates={this.props.templates} \r\n          onSave={_ => {\r\n            this.updateTemplates();\r\n          }}\r\n          onCancel={_ => {\r\n            this.setState({ templateMode: false });\r\n          }}\r\n          api={this.api} />\r\n      );\r\n    } else if (this.state.importMode) {\r\n      return (\r\n        <TemplatesModal \r\n          templates={this.props.templates} \r\n          onSubmit={selectedTemplateIDs => {\r\n            this.setState({ selectedTemplateIDs, importMode: false });\r\n            // console.log(selectedTemplateIDs);\r\n            // this.updateTemplates();\r\n          }}\r\n          onCancel={_ => {\r\n            this.setState({ importMode: false });\r\n          }} />\r\n      );\r\n    } else if (this.state.selectedTemplateIDs.length > 0) {\r\n      setTimeout(() => {\r\n        this.importSelectedTemplates();\r\n      }, 500);\r\n      return (\r\n        <span>Importing {this.props.templates.filter(t => t._id === this.state.selectedTemplateIDs[0] )[0].Name}.  Please Wait.</span>\r\n      );\r\n    } else {\r\n      return (\r\n        <Grid item xs={12} container spacing={0} direction=\"column\">\r\n          {this.props.selectedWorld !== null && \r\n            <Grid item container spacing={0} direction=\"row\">\r\n              <Helmet>\r\n                <title>{ `Author's Notebook: ${this.props.selectedWorld.Name}` }</title>\r\n              </Helmet>\r\n              <Grid item xs={12} sm={8} container spacing={0} direction=\"column\">\r\n                <Grid item>\r\n                  <h2>{this.props.selectedWorld.Name}</h2>\r\n                </Grid>\r\n                <Grid item>\r\n                  {this.props.selectedWorld.Description}\r\n                </Grid>\r\n                <Grid item>\r\n                  <Box display={{ xs: 'none', sm: 'block' }}>\r\n                    <Index />\r\n                  </Box>\r\n                </Grid>\r\n              </Grid>\r\n              { this.props.user !== null &&\r\n                <Grid item xs={12} sm={4}>\r\n                  { this.props.selectedWorld.Owner === this.props.user._id ?\r\n                    <List>\r\n                      <ListItem>\r\n                        <Grid container spacing={1} direction=\"row\">\r\n                          <Grid item xs={4} sm={12}>\r\n                            <Tooltip title={`Edit ${this.props.selectedWorld.Name}`}>\r\n                              <Fab size=\"small\" color=\"primary\"\r\n                                onClick={ _ => {this.setState({redirectTo:`/world/edit/${this.props.selectedWorldID}`})}}\r\n                              >\r\n                                <Edit />\r\n                              </Fab>\r\n                            </Tooltip>\r\n                          </Grid>\r\n                          <Grid item xs={4} sm={12}>\r\n                            <Tooltip title={`Edit Collaborators`}>\r\n                              <Fab size=\"small\" color=\"primary\"\r\n                                onClick={ _ => {this.setState({redirectTo:`/world/collaborators/${this.props.selectedWorldID}`})}}\r\n                              >\r\n                              <People />\r\n                              </Fab>\r\n                            </Tooltip>\r\n                          </Grid>\r\n                          <Grid item xs={4} sm={12}>\r\n                            <Tooltip title={`Delete ${this.props.selectedWorld.Name}`}>\r\n                              <Fab size=\"small\" color=\"primary\"\r\n                                onClick={e => {this.setState({modalOpen: true})}}\r\n                              >\r\n                                <Delete />\r\n                              </Fab>\r\n                            </Tooltip>\r\n                          </Grid>\r\n                        </Grid>\r\n                      </ListItem>\r\n                      <ListItem>\r\n                        <Button\r\n                          fullWidth\r\n                          variant=\"contained\"\r\n                          color=\"primary\"\r\n                          onClick={_ => {\r\n                            this.setState({ templateMode: true });\r\n                          }}\r\n                        >\r\n                          Create a Template\r\n                        </Button>\r\n                      </ListItem>\r\n                      <ListItem>\r\n                        <Button\r\n                          fullWidth\r\n                          variant=\"contained\"\r\n                          color=\"primary\"\r\n                          onClick={_ => {\r\n                            this.setState({ importMode: true });\r\n                          }}\r\n                        >\r\n                          Import Templates\r\n                        </Button>\r\n                      </ListItem>\r\n                    </List>\r\n                  : \r\n                    <List>\r\n                      { this.props.selectedWorld.Collaborators !== undefined && this.props.selectedWorld.Collaborators.filter(c=> c.userID === this.props.user._id).length === 0 ?\r\n                        <ListItem>\r\n                          { this.props.selectedWorld.AcceptingCollaborators && \r\n                            <Button\r\n                              variant=\"contained\"\r\n                              color=\"primary\"\r\n                              onClick={this.requestToCollaborate}\r\n                              type=\"button\"\r\n                            >\r\n                              Request to Collaborate\r\n                            </Button>\r\n                          }\r\n                        </ListItem>\r\n                      : this.props.selectedWorld.Collaborators.filter(c=> c.userID === this.props.user._id && c.type === \"request\").length > 0 ?\r\n                        <ListItem>\r\n                          Waiting on Collaboration Request\r\n                        </ListItem>\r\n                      : this.props.selectedWorld.Collaborators.filter(c=> c.userID === this.props.user._id && c.type === \"invite\").length > 0 &&\r\n                        <ListItem>\r\n                          <Button\r\n                            variant=\"contained\"\r\n                            color=\"primary\"\r\n                            onClick={this.respondToInvite}\r\n                            type=\"button\"\r\n                          >\r\n                            You've been invited to Collaborate\r\n                          </Button>\r\n                        </ListItem>\r\n                      }\r\n                    </List>\r\n                  }\r\n                </Grid>\r\n              }\r\n              <Grid item xs={12}>\r\n                <Box display={{ xs: 'block', sm: 'none' }}>\r\n                  <Index />\r\n                </Box>\r\n              </Grid>\r\n              <Grid item xs={12}>\r\n                <CommentsControl \r\n                  user={this.props.user} \r\n                  object={this.props.selectedWorld}\r\n                  objectType=\"World\"\r\n                  world={this.props.selectedWorld}\r\n                  api={this.api} \r\n                  onChange={this.commentsChange}\r\n                /> \r\n              </Grid>\r\n            </Grid>\r\n          }\r\n          <Modal\r\n              aria-labelledby=\"delete-thing-modal\"\r\n              aria-describedby=\"delete-thing-modal-description\"\r\n              open={this.state.modalOpen}\r\n              onClose={e => {this.setState({modalOpen: false})}}\r\n            >\r\n              <div style={this.getModalStyle()} className=\"paper\">\r\n                <Grid container spacing={1} direction=\"column\">\r\n                  <Grid item>\r\n                    Are you sure you want to delete {this.props.selectedWorld !== null ? this.props.selectedWorld.Name : \"\"}?\r\n                  </Grid>\r\n                  <Grid item>\r\n                    (All external references to it will be left alone and may not work correctly)\r\n                  </Grid>\r\n                  <Grid item container spacing={1} direction=\"row\">\r\n                    <Grid item xs={6}>\r\n                      <Button\r\n                        fullWidth\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={this.delete}\r\n                      >\r\n                        Yes\r\n                      </Button>\r\n                    </Grid>\r\n                    <Grid item xs={6}>\r\n                      <Button\r\n                        fullWidth\r\n                        variant=\"contained\"\r\n                        onClick={e => {this.setState({modalOpen: false})}}\r\n                      >\r\n                        Cancel\r\n                      </Button>\r\n                    </Grid>\r\n                  </Grid>\r\n                </Grid>\r\n              </div>\r\n            </Modal>\r\n        </Grid>\r\n      );\r\n    }\r\n  }\r\n}\r\nconst WorldDetailsPage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default WorldDetailsPage;\r\n","import React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  selectWorld,\r\n  addWorld,\r\n  updateWorld,\r\n  notFromLogin,\r\n  toggleLogin,\r\n  setAttributes,\r\n  setTypes,\r\n  setThings,\r\n  logout\r\n} from \"../../redux/actions/index\";\r\nimport { Button, Checkbox, FormControl, FormControlLabel,\r\n  OutlinedInput, InputLabel, FormHelperText, Grid, Tooltip, Fab\r\n} from \"@material-ui/core\";\r\nimport { ArrowBack } from \"@material-ui/icons\";\r\nimport { Helmet } from 'react-helmet';\r\nimport API from \"../../smartAPI\";\r\nimport TemplatesModal from \"../../components/Modals/TemplatesModal\";\r\n\r\n/* \r\n  This component will take the main portion of the page and is used for\r\n  creating or editing a World.  It will allow the use of Template Worlds\r\n  which come with preloaded Template Types.\r\n*/\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedPage: state.app.selectedPage,\r\n    selectedWorld: state.app.selectedWorld,\r\n    selectedWorldID: state.app.selectedWorldID,\r\n    worlds: state.app.worlds,\r\n    user: state.app.user,\r\n    fromLogin: state.app.fromLogin,\r\n    templates: state.app.templates,\r\n    types: state.app.types,\r\n    attributesByName: state.app.attributesByName\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    selectWorld: worldID => dispatch(selectWorld(worldID)),\r\n    addWorld: world => dispatch(addWorld(world)),\r\n    updateWorld: world => dispatch(updateWorld(world)),\r\n    notFromLogin: () => dispatch(notFromLogin({})),\r\n    toggleLogin: () => dispatch(toggleLogin({})),\r\n    setAttributes: attributes => dispatch(setAttributes(attributes)),\r\n    setTypes: types => dispatch(setTypes(types)),\r\n    setThings: things => dispatch(setThings(things)),\r\n    logout: () => dispatch(logout({}))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      // _id: null, // This gets used, but I'm intentionally making it undefined to start\r\n      Name: \"\",\r\n      Description: \"\",\r\n      Public: false,\r\n      AcceptingCollaborators: false,\r\n      fieldValidation: {\r\n        Name: { valid: true, message: \"\" }\r\n      },\r\n      formValid: false,\r\n      message: \"\",\r\n      redirectTo: null,\r\n      loaded: true,\r\n      importMode: false,\r\n      selectedTemplateIDs: [],\r\n      tempSelectedTemplateIDs: []\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  handleUserInput = e => {\r\n    const name = e.target.name;\r\n    const value =\r\n      e.target.type === \"checkbox\" ? e.target.checked : e.target.value;\r\n    this.setState({ [name]: value });\r\n  }\r\n\r\n  inputBlur = e => {\r\n    const name = e.target.name;\r\n    const validation = this.validateField(name);\r\n    const fieldValidation = this.state.fieldValidation;\r\n    if (\r\n      fieldValidation[name] !== undefined &&\r\n      fieldValidation[name].valid !== validation.valid\r\n    ) {\r\n      fieldValidation[name].valid = validation.valid;\r\n      fieldValidation[name].message = validation.message;\r\n      this.setState({ fieldValidation: fieldValidation });\r\n    }\r\n  }\r\n\r\n  a11yProps = (index) => {\r\n    return {\r\n      id: `simple-tab-${index}`,\r\n      'aria-controls': `simple-tabpanel-${index}`,\r\n    };\r\n  }\r\n\r\n  validateField = fieldName => {\r\n    let value = this.state[fieldName];\r\n    let valid = true;\r\n    let message = \"\";\r\n    switch (fieldName) {\r\n      case \"Name\":\r\n        valid = value.match(/^[a-zA-Z0-9 ]*$/i) !== null;\r\n        if (!valid)\r\n          message = \"Only Letters, Numbers, and Spaces allowed in World Names\";\r\n        else if (value.length < 4) {\r\n          valid = false;\r\n          message = \"World Name is too short\";\r\n        } else {\r\n          valid =\r\n            this.props.worlds.filter(\r\n              w => w.Name === value && w._id !== this.state._id\r\n            ).length === 0;\r\n          if (!valid) message = \"This World Name is already in use\";\r\n        }\r\n        break;\r\n      case \"inviteEmail\":\r\n        valid = value.match(/^([\\w.%+-]+)@([\\w-]+\\.)+([\\w]{2,})$/i) !== null;\r\n        message = valid ? \"\" : \"Email is invalid\";\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    const response = { valid: valid, message: message };\r\n    return response;\r\n  }\r\n\r\n  validateForm = respond => {\r\n    const nameValid = this.validateField(\"Name\");\r\n    const formValid = nameValid.valid;\r\n    const fieldValidation = this.state.fieldValidation;\r\n    fieldValidation.Name = nameValid;\r\n    this.setState(\r\n      {\r\n        formValid: formValid,\r\n        fieldValidation: fieldValidation\r\n      },\r\n      respond\r\n    );\r\n  }\r\n\r\n  onSubmit = () => {\r\n    function respond() {\r\n      if (this.state.formValid) {\r\n        this.setState({ waiting: true }, this.submitThroughAPI);\r\n      }\r\n    }\r\n\r\n    this.validateForm(respond);\r\n  }\r\n\r\n  submitThroughAPI = () => {\r\n    const world = {\r\n      _id: this.state._id,\r\n      Name: this.state.Name.trim(),\r\n      Description: this.state.Description.trim(),\r\n      Public: this.state.Public,\r\n      AcceptingCollaborators: this.state.AcceptingCollaborators,\r\n      Owner: this.props.user._id\r\n    };\r\n\r\n    if (world._id === null) {\r\n      this.api\r\n        .createWorld(world)\r\n        .then(res => {\r\n          if (res.error !== undefined) {\r\n            this.setState({ message: res.error }, () => {\r\n              this.props.logout();\r\n            });\r\n          }\r\n          else {\r\n            world._id = res.worldID;\r\n            this.props.addWorld(world);\r\n            this.props.selectWorld(world._id);\r\n            if (this.state.tempSelectedTemplateIDs === undefined) {\r\n              this.setState({\r\n                waiting: false,\r\n                redirectTo: `/world/details/${res.worldID}`\r\n              });\r\n            } else {\r\n              this.setState({\r\n                selectedTemplateIDs: this.state.tempSelectedTemplateIDs,\r\n                tempSelectedTemplateIDs: []\r\n              });\r\n            }\r\n          }\r\n        })\r\n        .catch(err => console.log(err));\r\n    } else {\r\n      this.api\r\n        .updateWorld(world)\r\n        .then(res => {\r\n          if (res.error !== undefined) {\r\n            this.setState({ message: res.error }, () => {\r\n              this.props.logout();\r\n            });\r\n          }\r\n          else {\r\n            this.props.updateWorld(world);\r\n            this.setState({\r\n              waiting: false,\r\n              redirectTo: `/world/details/${this.props.selectedWorldID}`\r\n            });\r\n          }\r\n        })\r\n        .catch(err => console.log(err));\r\n    }\r\n  }\r\n\r\n  load = (id) => {\r\n    setTimeout(() => {\r\n      this.setState({\r\n        _id: id,\r\n        redirectTo: null,\r\n        loaded: false\r\n      }, this.finishLoading);\r\n    }, 500);\r\n  }\r\n\r\n  finishLoading = () => {\r\n    if (this.state._id === null) {\r\n      this.setState({\r\n        Name: \"\",\r\n        Description: \"\",\r\n        AcceptingCollaborators: false,\r\n        Public: false,\r\n        loaded: true\r\n      });\r\n    }\r\n    else {\r\n      this.api.selectWorld(this.state._id).then(res => {\r\n        this.props.selectWorld(this.state._id);\r\n        this.api.getWorld(this.props.selectedWorldID).then(res => {\r\n          this.props.setAttributes(res.attributes);\r\n          this.props.setTypes(res.types);\r\n          this.props.setThings(res.things);\r\n\r\n          this.setState({\r\n            Name: this.props.selectedWorld.Name,\r\n            Description: this.props.selectedWorld.Description === undefined ? \"\" : this.props.selectedWorld.Description,\r\n            AcceptingCollaborators: this.props.selectedWorld.AcceptingCollaborators === undefined ? false : this.props.selectedWorld.AcceptingCollaborators,\r\n            Public: this.props.selectedWorld.Public,\r\n            loaded: true\r\n          });\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  importSelectedTemplates = () => {\r\n    const templatesToImport = [...this.state.selectedTemplateIDs];\r\n    if (templatesToImport.length > 0) {\r\n      const template = {...this.props.templates.filter(t => t._id === templatesToImport[0])[0]};\r\n      this.importDumbTypesRecursive(0, template.Types, [], {}, template.Attributes, template.Name);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This checks to see if a type by that name exists.\r\n   * If so then it merges their descriptions and majorness,\r\n   * then it puts it in the map.\r\n   * If not then it inserts it with just name, description, \r\n   * and majorness, and puts it in the map.\r\n   * After all the dumb types are merged or inserted and mapped,\r\n   * and after all the attributes are merged, upserted, and mapped,\r\n   * then we go through all the types and merge in their attributes.\r\n   */\r\n  importDumbTypesRecursive = (typePos, types, newTypes, typeMap, attributes, templateName) => {\r\n    // function next() {\r\n      \r\n    // }\r\n    const type = {...types[typePos]};\r\n    const typeID = type.typeID;\r\n    // Check for an existing Type with the same name.\r\n    let existingType = this.props.types.filter(t => t.Name.trim().toLowerCase() === type.Name.trim().toLowerCase());\r\n    if (existingType.length > 0) {\r\n      existingType = existingType[0];\r\n      typeMap[typeID] = existingType._id;\r\n      newTypes.push(existingType);\r\n      if (existingType.Description === type.Description && (existingType.Major || !type.Major)) {\r\n        // Sans attributes, they match, so we can just move on.\r\n        // next();\r\n        typePos++;\r\n        if (types.length === typePos) {\r\n          // We're done with all the types.\r\n          // Now for the attributes.\r\n          this.compareAndFixAttributes(types, newTypes, typeMap, attributes, templateName);\r\n        } else {\r\n          this.importDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, templateName);\r\n        }\r\n      } else {\r\n        if (existingType.Description !== type.Description) {\r\n          existingType.Description += ` From Template (${templateName}) ${type.Description}`;\r\n        }\r\n        if (type.Major)\r\n          existingType.Major = true;\r\n        if (existingType.PluralName === undefined || existingType.PluralName === \"\")\r\n          existingType.PluralName = type.PluralName;\r\n        this.api.updateType(existingType).then(res => {\r\n          // next();\r\n          typePos++;\r\n          if (types.length === typePos) {\r\n            // We're done with all the types.\r\n            // Now for the attributes.\r\n            this.compareAndFixAttributes(types, newTypes, typeMap, attributes, templateName);\r\n          } else {\r\n            this.importDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, templateName);\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      // Remove the attributes\r\n      delete type.typeID;\r\n      type.Attributes = [];\r\n      type.worldID = this.props.selectedWorldID;\r\n      // insert it\r\n      this.api.createType(type).then(res => {\r\n        if (res.error === undefined) {\r\n          // map it\r\n          typeMap[typeID] = res.typeID;\r\n          type._id = res.typeID;\r\n          newTypes.push(type);\r\n          // next();\r\n          typePos++;\r\n          if (types.length === typePos) {\r\n            // We're done with all the types.\r\n            // Now for the attributes.\r\n            this.compareAndFixAttributes(types, newTypes, typeMap, attributes, templateName);\r\n          } else {\r\n            this.importDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, templateName);\r\n          }\r\n        } else {\r\n          console.log(res.error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * This goes through all the Attributes, \r\n   * and looks for existing Attributes with the same name.  \r\n   * If it finds one it checks to see if they're compatible \r\n   * (same type, etc).  \r\n   * If they're compatible then it merges them.  \r\n   * If not then the new one gets the template name appended to its name.\r\n   * Then they're upserted, and then all attributes are pulled, \r\n   * and it puts together a mapping of the ids to be used in the types.\r\n   */\r\n  compareAndFixAttributes = (types, newTypes, typeMap, attributes, templateName) => {\r\n    const upsertUs = [];\r\n    const nameChanges = {\r\n      // oldName: newName\r\n    };\r\n    attributes.forEach(a => {\r\n      const attribute = {...a};\r\n      delete attribute.attrID;\r\n      if (attribute.AttributeType === \"Type\" || (attribute.AttributeType === \"List\" && attribute.ListType === \"Type\")) {\r\n        // We need to fix DefinedType\r\n        attribute.DefinedType = typeMap[attribute.DefinedType];\r\n      }\r\n      const existingAttribute = this.props.attributesByName[attribute.Name];\r\n      if (existingAttribute !== undefined) {\r\n        // We've got a matching name.  Check if the types match.\r\n        if (attribute.AttributeType !== existingAttribute.AttributeType || (attribute.AttributeType === \"List\" && attribute.ListType !== existingAttribute.ListType)) {\r\n          // They don't, so we need to change the name.\r\n          attribute.Name += ` From Template (${templateName})`;\r\n          nameChanges[existingAttribute.Name] = attribute.Name;\r\n        } else {\r\n          // It matches, so we can merge them.\r\n          attribute._id = existingAttribute._id;\r\n          if (attribute.AttributeType === \"Options\" || (attribute.AttributeType === \"List\" && attribute.ListType === \"Options\")) {\r\n            // It's Options, so we need to merge the Options.\r\n            const attrOptions = attribute.Options;\r\n            attribute.Options = existingAttribute.Options;\r\n            attrOptions.forEach(o => {\r\n              if (!attribute.Options.includes(o))\r\n                attribute.Options.push(o);\r\n            });\r\n          }\r\n        }\r\n      }\r\n      attribute.worldID = this.props.selectedWorldID;\r\n      upsertUs.push(attribute);\r\n    });\r\n    // We've compared them, now we upsert.\r\n    this.api.upsertAttributes(this.props.selectedWorldID, upsertUs).then(res => {\r\n      // Now we need to build the map\r\n      const attrMap = {\r\n        // templateID: realID\r\n      };\r\n      attributes.forEach(a => {\r\n        if (nameChanges[a.Name] !== undefined) {\r\n          // The name changed so use the new name.\r\n          attrMap[a.attrID] = res.attributes[nameChanges[a.Name]];\r\n        } else {\r\n          attrMap[a.attrID] = res.attributes[a.Name];\r\n        }\r\n      });\r\n      // The map is built, so now we're done here, and we need to update the types with their attributes\r\n      this.addAttributesToDumbTypesRecursive(0, types, newTypes, typeMap, attributes, attrMap, templateName);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Goes through each type and adds its attributes onto its \r\n   * corresponding type in newTypes, updates, then sends it back \r\n   * to the beginning of the process.\r\n   * \r\n   */\r\n  addAttributesToDumbTypesRecursive = (typePos, types, newTypes, typeMap, attributes, attrMap, templateName) => {\r\n    const type = types[typePos];\r\n    const newType = newTypes[typePos];\r\n    if (type.Name !== newType.Name) {\r\n      console.log(\"Names don't match\");\r\n      // If this happens then I did something wrong.  Should never happen\r\n    }\r\n    else {\r\n      // function next() {\r\n        \r\n      // }\r\n      let attributesAdded = false;\r\n      if (newType.Attributes.length === 0) {\r\n        // It's not a merged type, so just add the attributes.\r\n        let index = 0;\r\n        type.Attributes.forEach(attr => {\r\n          const realID = attrMap[attr.attrID];\r\n          newType.Attributes.push({\r\n            attrID: realID, index\r\n          });\r\n          index++;\r\n          attributesAdded = true;\r\n        });\r\n      } else {\r\n        // It's a merged type, so we need to check each attribute to see if it's already on it.\r\n        let index = newType.Attributes.length;\r\n        type.Attributes.forEach(attr => {\r\n          const realID = attrMap[attr.attrID];\r\n          if (newType.Attributes.filter(a => a.attrID === realID).length === 0) {\r\n            newType.Attributes.push({\r\n              attrID: realID, index\r\n            });\r\n            index++;\r\n            attributesAdded = true;\r\n          }\r\n        });\r\n      }\r\n      if (attributesAdded) {\r\n        // Update the type\r\n        this.api.updateType(newType).then(res => {\r\n          if (res.error === undefined) {\r\n            // Done.  Move on.\r\n            // next();\r\n            typePos++;\r\n            if (types.length === typePos) {\r\n              // We're done with all the types.\r\n              // Now we see if there's another selected template.\r\n              this.api.getWorld(this.props.selectedWorldID, true).then(res => {\r\n                this.props.setAttributes(res.attributes);\r\n                this.props.setTypes(res.types);\r\n                this.props.setThings(res.things);\r\n\r\n                let templateIDs = [...this.state.selectedTemplateIDs];\r\n                templateIDs.splice(0);\r\n                if (templateIDs.length === 0) {\r\n                  this.setState({\r\n                    waiting: false,\r\n                    redirectTo: `/world/details/${this.props.selectedWorldID}`,\r\n                    selectedTemplateIDs: templateIDs \r\n                  });\r\n                }\r\n                else {\r\n                  this.setState({ selectedTemplateIDs: templateIDs });\r\n                }\r\n              });\r\n            } else {\r\n              this.addAttributesToDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, attrMap, templateName);\r\n            }\r\n          } else {\r\n            console.log(res.error);\r\n          }\r\n        });\r\n      } else {\r\n        // Nothing to update.  Move on.\r\n        // next();\r\n        typePos++;\r\n        if (types.length === typePos) {\r\n          // We're done with all the types.\r\n          // Now we see if there's another selected template.\r\n          this.api.getWorld(this.props.selectedWorldID, true).then(res => {\r\n            this.props.setAttributes(res.attributes);\r\n            this.props.setTypes(res.types);\r\n            this.props.setThings(res.things);\r\n\r\n            let templateIDs = [...this.state.selectedTemplateIDs];\r\n            templateIDs.splice(0);\r\n            if (templateIDs.length === 0) {\r\n              this.setState({\r\n                waiting: false,\r\n                redirectTo: `/world/details/${this.props.selectedWorldID}`,\r\n                selectedTemplateIDs: templateIDs \r\n              });\r\n            }\r\n            else {\r\n              this.setState({ selectedTemplateIDs: templateIDs });\r\n            }\r\n          });\r\n        } else {\r\n          this.addAttributesToDumbTypesRecursive(typePos, types, newTypes, typeMap, attributes, attrMap, templateName);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n    }\r\n    let { id } = this.props.match.params;\r\n    if (id === undefined)\r\n      id = null;\r\n    if (this.state._id !== id) {\r\n      this.load(id);\r\n      return (<span>Loading...</span>);\r\n    } else if (!this.state.loaded) {\r\n      return (<span>Loading2...</span>);\r\n    } else if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    } else if (this.props.selectedWorld !== null && \r\n      this.props.user === null) {\r\n      setTimeout(() => {\r\n        this.props.toggleLogin();\r\n      }, 500);\r\n      return <span>Requires Login</span>;\r\n    } else if (this.state._id !== null && this.props.selectedWorld !== null && \r\n      (this.props.user === null || this.props.selectedWorld.Owner !== this.props.user._id)) {\r\n      return <Redirect to=\"/\" />;\r\n    } else if (this.state.importMode) {\r\n      return (\r\n        <TemplatesModal \r\n          templates={this.props.templates} \r\n          selectedTemplateIDs={this.state.tempSelectedTemplateIDs}\r\n          onSubmit={ tempSelectedTemplateIDs => {\r\n            this.setState({ tempSelectedTemplateIDs, importMode: false });\r\n          }}\r\n          onCancel={_ => {\r\n            this.setState({ importMode: false });\r\n          }} />\r\n      );\r\n    } else if (this.state.selectedTemplateIDs.length > 0) {\r\n      setTimeout(() => {\r\n        this.importSelectedTemplates();\r\n      }, 500);\r\n      return (\r\n        <span>Importing {this.props.templates.filter(t => t._id === this.state.selectedTemplateIDs[0] )[0].Name}.  Please Wait.</span>\r\n      );\r\n    } else {\r\n      return (\r\n        <Grid item xs={12} container spacing={1} direction=\"column\">\r\n          <Helmet>\r\n            <title>{ this.state._id === null ? `Author's Notebook: Create New World` : `Author's Notebook: Edit ${this.props.selectedWorld.Name}` }</title>\r\n          </Helmet>\r\n          <Grid item container spacing={1} direction=\"row\">\r\n            <Grid item xs={1}>\r\n              { this.props.selectedWorld !== null &&\r\n                <Tooltip title={`Back to ${this.props.selectedWorld.Name} Details`}>\r\n                  <Fab size=\"small\"\r\n                    color=\"primary\"\r\n                    onClick={ _ => {this.setState({redirectTo:`/world/details/${this.props.selectedWorldID}`})}}\r\n                  >\r\n                    <ArrowBack />\r\n                  </Fab>\r\n                </Tooltip>\r\n              }\r\n            </Grid>\r\n            <Grid item xs={11}>\r\n              <h2>\r\n                {this.state._id === null ? \"Create New World\" : \"Edit World\"}\r\n              </h2>\r\n            </Grid>\r\n          </Grid>\r\n          <Grid item>\r\n            <FormControl variant=\"outlined\" fullWidth>\r\n              <InputLabel htmlFor=\"name\">Name</InputLabel>\r\n              <OutlinedInput\r\n                id=\"name\"\r\n                name=\"Name\"\r\n                type=\"text\"\r\n                autoComplete=\"Off\"\r\n                error={!this.state.fieldValidation.Name.valid}\r\n                value={this.state.Name}\r\n                onChange={this.handleUserInput}\r\n                onBlur={this.inputBlur}\r\n                labelWidth={43}\r\n                fullWidth\r\n              />\r\n              <FormHelperText>\r\n                {this.state.fieldValidation.Name.message}\r\n              </FormHelperText>\r\n            </FormControl>\r\n          </Grid>\r\n          <Grid item>\r\n            <FormControl variant=\"outlined\" fullWidth>\r\n              <InputLabel htmlFor=\"description\">Description</InputLabel>\r\n              <OutlinedInput\r\n                id=\"description\"\r\n                name=\"Description\"\r\n                type=\"text\"\r\n                autoComplete=\"Off\"\r\n                multiline\r\n                value={this.state.Description}\r\n                onChange={this.handleUserInput}\r\n                onBlur={this.inputBlur}\r\n                labelWidth={80}\r\n                fullWidth\r\n              />\r\n            </FormControl>\r\n          </Grid>\r\n          <Grid item>\r\n            <FormControlLabel\r\n              control={\r\n                <Checkbox\r\n                  checked={this.state.Public}\r\n                  onChange={this.handleUserInput}\r\n                  name=\"Public\"\r\n                  color=\"primary\"\r\n                />\r\n              }\r\n              label=\"Public\"\r\n            />\r\n            { this.state.Public ?\r\n            <FormControlLabel\r\n              control={\r\n                <Checkbox\r\n                  checked={this.state.AcceptingCollaborators}\r\n                  onChange={this.handleUserInput}\r\n                  name=\"AcceptingCollaborators\"\r\n                  color=\"primary\"\r\n                />\r\n              }\r\n              label=\"Accepting Collaborator Requests\"\r\n            /> : \"\" }\r\n          </Grid>\r\n          <Grid item>{this.state.message}</Grid>\r\n          { this.state.tempSelectedTemplateIDs !== undefined && this.state.tempSelectedTemplateIDs.length > 0 &&\r\n            <Grid item>Templates will be imported on submit</Grid>\r\n          }\r\n          <Grid item container spacing={1} direction=\"row\">\r\n            <Grid item xs={12} sm={4}>\r\n              <Button\r\n                variant=\"contained\"\r\n                fullWidth\r\n                color=\"primary\"\r\n                disabled={this.state.waiting}\r\n                onClick={_ => {\r\n                  this.setState({ importMode: true });\r\n                }}\r\n                type=\"submit\"\r\n              >\r\n                Import Templates\r\n              </Button>\r\n            </Grid>\r\n            <Grid item xs={12} sm={4}>\r\n              <Button\r\n                variant=\"contained\"\r\n                fullWidth\r\n                color=\"primary\"\r\n                disabled={this.state.waiting}\r\n                onClick={this.onSubmit}\r\n                type=\"submit\"\r\n              >\r\n                {this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n              </Button>\r\n            </Grid>\r\n            <Grid item xs={12} sm={4}>\r\n              <Button\r\n                variant=\"contained\"\r\n                fullWidth\r\n                disabled={this.state.waiting}\r\n                onClick={_ => {\r\n                  this.setState({\r\n                    redirectTo: this.state._id === null ? `/` : `/world/details/${this.state._id}`\r\n                  });\r\n                }}\r\n                type=\"button\"\r\n              >\r\n                Cancel\r\n              </Button>\r\n            </Grid>\r\n          </Grid>\r\n          <Grid item>\r\n            {Object.keys(this.state.fieldValidation).map((fieldName, i) => {\r\n              if (\r\n                this.state.fieldValidation[fieldName] !== undefined &&\r\n                this.state.fieldValidation[fieldName].message.length > 0\r\n              ) {\r\n                return (\r\n                  <p className=\"redFont\" key={i}>\r\n                    {this.state.fieldValidation[fieldName].message}\r\n                  </p>\r\n                );\r\n              } else {\r\n                return \"\";\r\n              }\r\n            })}\r\n          </Grid>\r\n        </Grid>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst WorldEditPage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default WorldEditPage;","import React, { Component } from \"react\";\r\n// import { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport Checkbox from \"@material-ui/core/Checkbox\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport OutlinedInput from '@material-ui/core/OutlinedInput';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport InputAdornment from '@material-ui/core/InputAdornment';\r\nimport Visibility from '@material-ui/icons/Visibility';\r\nimport VisibilityOff from '@material-ui/icons/VisibilityOff';\r\nimport FormHelperText from '@material-ui/core/FormHelperText';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport { userLogin, setWorlds, setFollowingWorlds } from \"../../redux/actions/index\";\r\nimport Link from \"@material-ui/core/Link\";\r\nimport Cookies from \"universal-cookie\";\r\nimport API from '../../smartAPI';\r\n\r\n\r\nconst mapStateToProps = state => {\r\n  return { \r\n    // selectedPage: state.app.selectedPage, \r\n    user: state.app.user, \r\n    loginError: state.app.loginError,\r\n    followingWorlds: state.app.followingWorlds\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    userLogin: user => dispatch(userLogin(user)),\r\n    setWorlds: worlds => dispatch(setWorlds(worlds)),\r\n    setFollowingWorlds: worldIDs => dispatch(setFollowingWorlds(worldIDs))\r\n  };\r\n}\r\nclass Control extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const cookies = new Cookies();\r\n    const emailCookie = cookies.get('email');\r\n    const passCookie = cookies.get('password');\r\n    this.state = {\r\n      formMode: \"login\",\r\n      email: (emailCookie === undefined ? \"\" : emailCookie),\r\n      password: (passCookie === undefined ? \"\" : passCookie),\r\n      confirmEmail: \"\",\r\n      confirmPassword: \"\",\r\n      fieldValidation: { \r\n        email: { valid: true, message: \"\" }, \r\n        password: { valid: true, message: \"\" }, \r\n        confirmEmail: { valid: true, message: \"\" }, \r\n        confirmPassword: { valid: true, message: \"\" },\r\n        username: { valid: true, message: \"\" }\r\n      },\r\n      formValid: false,\r\n      remember: false,\r\n      message: \"\",\r\n      username: \"\",\r\n      // redirectTo: null,\r\n      allUsers: null\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount = () => {\r\n    if (this.state.email) {\r\n      this.validateField(\"email\");\r\n      this.validateField(\"password\");\r\n      this.setState({remember: true});\r\n    }\r\n  }\r\n\r\n  handleUserInput = e => {\r\n    const name = e.target.name;\r\n    const value = (e.target.type === \"checkbox\" ? e.target.checked : e.target.value);\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  inputBlur = e => {\r\n    const name = e.target.name;\r\n    const validation = this.validateField(name);\r\n    const fieldValidation = this.state.fieldValidation;\r\n    if (fieldValidation[name].valid !== validation.valid) {\r\n      fieldValidation[name].valid = validation.valid;\r\n      fieldValidation[name].message = validation.message;\r\n      this.setState({ fieldValidation: fieldValidation });\r\n    }\r\n  }\r\n\r\n  handleClickShowPassword = () => {\r\n    this.setState({ showPassword: !this.state.showPassword });\r\n  };\r\n\r\n  handleMouseDownPassword = event => {\r\n    event.preventDefault();\r\n  };\r\n\r\n  validateField = (fieldName) => {\r\n    let valid = true;\r\n    let message = \"\";\r\n    let value = this.state[fieldName];\r\n    switch (fieldName) {\r\n      case \"email\":\r\n        valid = value.match(/^([\\w.%+-]+)@([\\w-]+\\.)+([\\w]{2,})$/i) !== null;\r\n        message = valid ? \"\" : \"Email is invalid\";\r\n        break;\r\n      case \"password\":\r\n        valid = value.length >= 6;\r\n        message = valid ? \"\" : \"Password is too short\";\r\n        break;\r\n      case \"confirmEmail\":\r\n        valid = value === this.state.email;\r\n        message = valid ? \"\" : \"Confirm Email doesn't match Email\";\r\n        break;\r\n      case \"confirmPassword\":\r\n        valid = value === this.state.password;\r\n        message = valid ? \"\" : \"Confirm Password doesn't match Password\";\r\n        break;\r\n      case \"username\":\r\n        valid = value.length >= 2;\r\n        message = valid ? \"\" : \"Username is too short\";\r\n        if (valid && this.state.allUsers.filter(u=>u.username === value).length !== 0) {\r\n          valid = false;\r\n          message = \"This Username is taken\";\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    const response = { valid: valid, message: message };\r\n    return response;\r\n  };\r\n\r\n  validateForm = (respond) => {\r\n    const emailValid = this.validateField(\"email\");\r\n    let confirmEmailValid = { valid: true, message: \"\" };\r\n    let passwordValid = { valid: true, message: \"\" };\r\n    let confirmPasswordValid = { valid: true, message: \"\" };\r\n    let usernameValid = { valid: true, message: \"\" };\r\n    switch (this.state.formMode) {\r\n      case \"Login\":\r\n        passwordValid = this.validateField(\"password\");\r\n        break;\r\n      case \"Register\":\r\n        confirmEmailValid = this.validateField(\"confirmEmail\");\r\n        passwordValid = this.validateField(\"password\");\r\n        confirmPasswordValid = this.validateField(\"confirmPassword\");\r\n        usernameValid = this.validateField(\"username\");\r\n      break;\r\n      default:\r\n      break;\r\n    }\r\n    const formValid = \r\n      emailValid.valid && \r\n      passwordValid.valid && \r\n      confirmEmailValid.valid && \r\n      confirmPasswordValid.valid && \r\n      usernameValid.valid;\r\n    const fieldValidation = this.state.fieldValidation;\r\n    fieldValidation.email = emailValid;\r\n    fieldValidation.password = passwordValid;\r\n    fieldValidation.confirmEmail = confirmEmailValid;\r\n    fieldValidation.confirmPassword = confirmPasswordValid;\r\n    fieldValidation.username = usernameValid;\r\n    this.setState({ \r\n      formValid: formValid,\r\n      fieldValidation: fieldValidation\r\n    }, respond);\r\n  }\r\n\r\n  onSubmit = () => {\r\n    function respond() {\r\n      if (this.state.formValid) {\r\n        this.setState({ waiting: true },\r\n          this.submitThroughAPI);\r\n      }\r\n    }\r\n\r\n    this.validateForm(respond);\r\n  };\r\n\r\n  submitThroughAPI = () => {\r\n    const user = {\r\n      email: this.state.email.trim(),\r\n      password: this.state.password,\r\n      username: this.state.username.trim(),\r\n      followingWorlds: this.props.followingWorlds\r\n    };\r\n    if (this.state.formMode === \"login\") {\r\n      this.api.login(user, this.state.remember).then(res => {\r\n        if (res.user === null) {\r\n          let errors = this.state.fieldValidation;\r\n          errors.loginError = { message: res.error, valid: false, show: true };\r\n          this.setState({ fieldValidation: errors, waiting: false });\r\n        }\r\n        else {\r\n          this.props.userLogin(res.user);\r\n          this.api.getWorldsForUser(res.user._id).then(res => {\r\n            this.props.setWorlds(res.worlds);\r\n            this.props.onLogin(res.user);\r\n            // this.setState({ redirectTo: \"/\" });\r\n          });\r\n        }\r\n      })\r\n      .catch(err => console.log(err));\r\n    } else if (this.state.formMode === \"register\") {\r\n      this.api.register(user).then(res => {\r\n        if (res.error === undefined) {\r\n          this.setState({ \r\n            message: res.message, \r\n            formMode: \"login\", \r\n            fieldValidation: { \r\n              email: { valid: true, message: \"\" }, \r\n              password: { valid: true, message: \"\" }, \r\n              confirmEmail: { valid: true, message: \"\" }, \r\n              confirmPassword: { valid: true, message: \"\" },\r\n              username: { valid: true, message: \"\" }\r\n            },\r\n            waiting: false\r\n          });\r\n        }\r\n        else {\r\n          this.setState({ \r\n            message: res.error,\r\n            waiting: false\r\n          });\r\n        }\r\n      })\r\n      .catch(err => console.log(err));\r\n    } else if (this.state.formMode === \"password\") {\r\n      this.api.sendReset(user).then(res => {\r\n        this.setState({ message: res.message, \r\n          formMode: \"login\", \r\n          fieldValidation: { \r\n            email: { valid: true, message: \"\" }, \r\n            password: { valid: true, message: \"\" }, \r\n            confirmEmail: { valid: true, message: \"\" }, \r\n            confirmPassword: { valid: true, message: \"\" },\r\n            username: { valid: true, message: \"\" }\r\n          },\r\n          waiting: false \r\n        });\r\n      })\r\n      .catch(err => console.log(err));\r\n    }\r\n  }\r\n\r\n  loginClick = () => {\r\n    this.setState({ formMode: \"login\" });\r\n  };\r\n\r\n  registerClick = () => {\r\n    this.setState({ formMode: \"register\" });\r\n  };\r\n\r\n  passwordClick = () => {\r\n    this.setState({ formMode: \"password\" });\r\n  };\r\n\r\n  render() {\r\n    if (this.state.allUsers === null) {\r\n      this.api.getAllUsers().then(res => {\r\n        this.setState({allUsers: res});\r\n      });\r\n      return (<div></div>);\r\n    }\r\n    // else if (this.state.redirectTo !== null && \r\n    //   this.props.user !== null && \r\n    //   this.props.user !== undefined && \r\n    //   this.props.user.username !== undefined && \r\n    //   this.props.user.username !== \"\") {\r\n    //   return (<Redirect to={this.state.redirectTo} />);\r\n    // }\r\n    else {\r\n      if (this.state.formMode === \"login\") {\r\n        return (\r\n          <div>\r\n            <h2>Login</h2>\r\n            <div className=\"row\">\r\n              <div className=\"col-sm-12\">\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-12 margined\">\r\n                    <FormControl variant=\"outlined\"\r\n                        fullWidth>\r\n                      <InputLabel htmlFor=\"email\">Email</InputLabel>\r\n                      <OutlinedInput\r\n                        id=\"email\"\r\n                        name=\"email\"\r\n                        type=\"email\"\r\n                        error={ !this.state.fieldValidation.email.valid }\r\n                        value={this.state.email}\r\n                        onChange={this.handleUserInput}\r\n                        onBlur={this.inputBlur}\r\n                        labelWidth={40}\r\n                        fullWidth\r\n                      />\r\n                      <FormHelperText>{ this.state.fieldValidation.email.message }</FormHelperText>\r\n                    </FormControl>\r\n                  </div>\r\n                </div>\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-12 margined\">\r\n                    <FormControl variant=\"outlined\"\r\n                        fullWidth>\r\n                      <InputLabel htmlFor=\"outlined-adornment-password\">Password</InputLabel>\r\n                      <OutlinedInput\r\n                        id=\"outlined-adornment-password\"\r\n                        name=\"password\"\r\n                        type={this.state.showPassword ? 'text' : 'password'}\r\n                        value={this.state.password}\r\n                        error={ !this.state.fieldValidation.password.valid }\r\n                        onChange={this.handleUserInput}\r\n                        onBlur={this.inputBlur}\r\n                        endAdornment={\r\n                          <InputAdornment position=\"end\">\r\n                            <IconButton\r\n                              aria-label=\"toggle password visibility\"\r\n                              onClick={this.handleClickShowPassword}\r\n                              onMouseDown={this.handleMouseDownPassword}\r\n                              edge=\"end\"\r\n                            >\r\n                              {this.state.showPassword ? <Visibility /> : <VisibilityOff />}\r\n                            </IconButton>\r\n                          </InputAdornment>\r\n                        }\r\n                        labelWidth={70}\r\n                        fullWidth\r\n                      />\r\n                      <FormHelperText>{ this.state.fieldValidation.password.message }</FormHelperText>\r\n                    </FormControl>\r\n                  </div>\r\n                </div>\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-12 margined\">\r\n                    <FormControlLabel\r\n                      control={\r\n                        <Checkbox\r\n                          checked={this.state.remember}\r\n                          onChange={this.handleUserInput}\r\n                          name=\"remember\"\r\n                          color=\"primary\"\r\n                        />\r\n                      }\r\n                      label=\"Stay Signed In\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"row\">\r\n              <div className=\"col-sm-12\">\r\n                <div className=\"float-left\">\r\n                  <Link\r\n                    onClick={this.registerClick}\r\n                  >\r\n                    Register\r\n                  </Link>{\" \"}\r\n                  <Link\r\n                    onClick={this.passwordClick}\r\n                  >\r\n                    Forgot Password\r\n                  </Link>\r\n                </div>\r\n                <div className=\"float-right\">\r\n                  <Button className=\"w-200\" \r\n                    variant=\"contained\" color=\"primary\"\r\n                    disabled={this.state.waiting}\r\n                    onClick={this.onSubmit}\r\n                    type=\"submit\">{this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            {this.state.message}\r\n            {\r\n              Object.keys(this.state.fieldValidation).map((fieldName, i) => {\r\n                if (this.state.fieldValidation[fieldName] !== undefined && this.state.fieldValidation[fieldName].message.length > 0) {\r\n                  return (\r\n                    <p className=\"redFont\" key={i}>\r\n                      {this.state.fieldValidation[fieldName].message}\r\n                    </p>\r\n                  );\r\n                } else {\r\n                  return \"\";\r\n                }\r\n              })\r\n            }\r\n          </div>\r\n        );\r\n      } else if (this.state.formMode === \"register\") {\r\n        return (\r\n          <div>\r\n            <h2>Register</h2>\r\n            <div className=\"row\">\r\n              <div className=\"col-sm-12\">\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-6\">\r\n                    <div className=\"row\">\r\n                      <div className=\"col-sm-12 margined\">\r\n                        <FormControl variant=\"outlined\"\r\n                            fullWidth>\r\n                          <InputLabel htmlFor=\"username\">Username</InputLabel>\r\n                          <OutlinedInput\r\n                            id=\"username\"\r\n                            name=\"username\"\r\n                            type=\"text\"\r\n                            value={this.state.username}\r\n                            error={ !this.state.fieldValidation.username.valid }\r\n                            onChange={this.handleUserInput}\r\n                            onBlur={this.inputBlur}\r\n                            labelWidth={80}\r\n                            fullWidth\r\n                          />\r\n                          <FormHelperText>{ this.state.fieldValidation.username.message }</FormHelperText>\r\n                        </FormControl>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"col-sm-6\">\r\n                    <div className=\"row\">\r\n                      <div className=\"col-sm-12 margined\">\r\n                        <FormControl variant=\"outlined\"\r\n                            fullWidth>\r\n                          <InputLabel htmlFor=\"email\">Email</InputLabel>\r\n                          <OutlinedInput\r\n                            id=\"email\"\r\n                            name=\"email\"\r\n                            type=\"email\"\r\n                            value={this.state.email}\r\n                            error={ !this.state.fieldValidation.email.valid }\r\n                            onChange={this.handleUserInput}\r\n                            onBlur={this.inputBlur}\r\n                            labelWidth={40}\r\n                            fullWidth\r\n                          />\r\n                          <FormHelperText>{ this.state.fieldValidation.email.message }</FormHelperText>\r\n                        </FormControl>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"row\">\r\n                      <div className=\"col-sm-12 margined\">\r\n                        <FormControl variant=\"outlined\"\r\n                          fullWidth>\r\n                          <InputLabel htmlFor=\"confirmEmail\">Confirm Email</InputLabel>\r\n                          <OutlinedInput\r\n                            id=\"confirmEmail\"\r\n                            name=\"confirmEmail\"\r\n                            type=\"email\"\r\n                            error={ !this.state.fieldValidation.confirmEmail.valid }\r\n                            value={this.state.confirmEmail}\r\n                            onChange={this.handleUserInput}\r\n                            onBlur={this.inputBlur}\r\n                            labelWidth={100}\r\n                            fullWidth\r\n                          />\r\n                          <FormHelperText>{ this.state.fieldValidation.confirmEmail.message }</FormHelperText>\r\n                        </FormControl>\r\n                      </div>\r\n                    </div>\r\n                  </div> \r\n                </div>\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-12 margined\">\r\n                    <FormControl variant=\"outlined\"\r\n                        fullWidth>\r\n                      <InputLabel htmlFor=\"outlined-adornment-password\">Password</InputLabel>\r\n                      <OutlinedInput\r\n                        id=\"outlined-adornment-password\"\r\n                        name=\"password\"\r\n                        type={this.state.showPassword ? 'text' : 'password'}\r\n                        value={this.state.password}\r\n                        error={ !this.state.fieldValidation.password.valid }\r\n                        onChange={this.handleUserInput}\r\n                        onBlur={this.inputBlur}\r\n                        endAdornment={\r\n                          <InputAdornment position=\"end\">\r\n                            <IconButton\r\n                              aria-label=\"toggle password visibility\"\r\n                              onClick={this.handleClickShowPassword}\r\n                              onMouseDown={this.handleMouseDownPassword}\r\n                              edge=\"end\"\r\n                            >\r\n                              {this.state.showPassword ? <Visibility /> : <VisibilityOff />}\r\n                            </IconButton>\r\n                          </InputAdornment>\r\n                        }\r\n                        labelWidth={70}\r\n                        fullWidth\r\n                      />\r\n                      <FormHelperText>{ this.state.fieldValidation.password.message }</FormHelperText>\r\n                    </FormControl>\r\n                  </div>\r\n                </div>\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-12 margined\">\r\n                    <FormControl variant=\"outlined\"\r\n                        fullWidth>\r\n                      <InputLabel htmlFor=\"confirm-password\">Confirm Password</InputLabel>\r\n                      <OutlinedInput\r\n                        id=\"confirm-password\"\r\n                        name=\"confirmPassword\"\r\n                        type={this.state.showPassword ? 'text' : 'password'}\r\n                        value={this.state.confirmPassword}\r\n                        error={ !this.state.fieldValidation.confirmPassword.valid }\r\n                        onChange={this.handleUserInput}\r\n                        onBlur={this.inputBlur}\r\n                        endAdornment={\r\n                          <InputAdornment position=\"end\">\r\n                            <IconButton\r\n                              aria-label=\"toggle password visibility\"\r\n                              onClick={this.handleClickShowPassword}\r\n                              onMouseDown={this.handleMouseDownPassword}\r\n                              edge=\"end\"\r\n                            >\r\n                              {this.state.showPassword ? <Visibility /> : <VisibilityOff />}\r\n                            </IconButton>\r\n                          </InputAdornment>\r\n                        }\r\n                        labelWidth={130}\r\n                        fullWidth\r\n                      />\r\n                      <FormHelperText>{ this.state.fieldValidation.confirmPassword.message }</FormHelperText>\r\n                    </FormControl>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"row\">\r\n              <div className=\"col-sm-12\">\r\n                <div className=\"float-left\">\r\n                  <Link\r\n                    onClick={this.loginClick}\r\n                  >\r\n                    Login\r\n                  </Link>{\" \"}\r\n                  <Link\r\n                    onClick={this.passwordClick}\r\n                  >\r\n                    Forgot Password\r\n                  </Link>{\" \"}\r\n                </div>\r\n                <div className=\"float-right\">\r\n                  <Button className=\"w-200\" \r\n                    variant=\"contained\" color=\"primary\"\r\n                    disabled={this.state.waiting}\r\n                    onClick={this.onSubmit}\r\n                    type=\"submit\">{this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            {this.state.message}\r\n            {\r\n              Object.keys(this.state.fieldValidation).map((fieldName, i) => {\r\n                if (this.state.fieldValidation[fieldName] !== undefined && this.state.fieldValidation[fieldName].message.length > 0) {\r\n                  return (\r\n                    <p className=\"redFont\" key={i}>\r\n                      {this.state.fieldValidation[fieldName].message}\r\n                    </p>\r\n                  );\r\n                } else {\r\n                  return \"\";\r\n                }\r\n              })\r\n            }\r\n          </div>\r\n        );\r\n      } else if (this.state.formMode === \"password\") {\r\n        return (\r\n          <div>\r\n            <h2>Forgot Password?</h2>\r\n            <div className=\"row\">\r\n              <div className=\"col-sm-12\">\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-12 margined\">\r\n                    <FormControl variant=\"outlined\"\r\n                        fullWidth>\r\n                      <InputLabel htmlFor=\"email\">Email</InputLabel>\r\n                      <OutlinedInput\r\n                        id=\"email\"\r\n                        name=\"email\"\r\n                        type=\"email\"\r\n                        value={this.state.email}\r\n                        error={ !this.state.fieldValidation.email.valid }\r\n                        onChange={this.handleUserInput}\r\n                        onBlur={this.inputBlur}\r\n                        labelWidth={40}\r\n                        fullWidth\r\n                      />\r\n                      <FormHelperText>{ this.state.fieldValidation.email.message }</FormHelperText>\r\n                    </FormControl>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"row\">\r\n              <div className=\"col-sm-12\">\r\n                <div className=\"float-left\">\r\n                  <Link\r\n                    onClick={this.registerClick}\r\n                  >\r\n                    Register\r\n                  </Link>{\" \"}\r\n                  <Link\r\n                    onClick={this.loginClick}\r\n                  >\r\n                    Login\r\n                  </Link>\r\n                </div>\r\n                <div className=\"float-right\">\r\n                  <Button className=\"w-200\" \r\n                    variant=\"contained\" color=\"primary\"\r\n                    disabled={this.state.waiting}\r\n                    onClick={this.onSubmit}\r\n                    type=\"submit\">{this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            {this.state.message}\r\n            {\r\n              Object.keys(this.state.fieldValidation).map((fieldName, i) => {\r\n                if (this.state.fieldValidation[fieldName] !== undefined && this.state.fieldValidation[fieldName].message.length > 0) {\r\n                  return (\r\n                    <p className=\"redFont\" key={i}>\r\n                      {this.state.fieldValidation[fieldName].message}\r\n                    </p>\r\n                  );\r\n                } else {\r\n                  return \"\";\r\n                }\r\n              })\r\n            }\r\n          </div>\r\n        );\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst LoginControl = connect(mapStateToProps, mapDispatchToProps)(Control);\r\nexport default LoginControl;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  Button,\r\n  Grid\r\n} from \"@material-ui/core\";\r\nimport LoginControl from '../User/LoginControl';\r\nimport {\r\n  setWorlds,\r\n  setAttributes,\r\n  setTypes,\r\n  setThings\r\n} from \"../../redux/actions/index\";\r\nimport API from '../../smartAPI';\r\n\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    user: state.app.user\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    setWorlds: worlds => dispatch(setWorlds(worlds)),\r\n    setAttributes: attributes => dispatch(setAttributes(attributes)),\r\n    setTypes: types => dispatch(setTypes(types)),\r\n    setThings: things => dispatch(setThings(things))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      worldID: null,\r\n      collabID: null,\r\n      codeValid: false,\r\n      accepted: null,\r\n      message: \"Please wait.  Validating code.\",\r\n      world: null\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount = () => {\r\n  }\r\n\r\n  accept = () => {\r\n    if (this.props.user === null) {\r\n      this.setState({waiting: false, accepted: true});\r\n    }\r\n    else {\r\n      this.setState({waiting: true},\r\n        this.submitAccept\r\n      );\r\n    }\r\n  }\r\n\r\n  submitAccept = () => {\r\n    this.api.acceptCollabInvite(this.state.worldID, this.state.collabID).then(res => {\r\n      this.setState({waiting: false, accepted: true}, this.getWorlds);\r\n    });\r\n  }\r\n\r\n  getWorlds = () => {\r\n    this.api.getWorldsForUser().then(res => {\r\n      if (res.worlds !== undefined) this.props.setWorlds(res.worlds);\r\n      this.refreshWorld();\r\n    });\r\n  }\r\n\r\n  refreshWorld = () => {\r\n    this.api.getWorld(this.state.worldID, true).then(res => {\r\n      this.props.setAttributes(res.attributes);\r\n      this.props.setTypes(res.types);\r\n      this.props.setThings(res.things);\r\n    });\r\n  }\r\n\r\n  onLoginAccept = (user) => {\r\n    this.setState({waiting: true},\r\n      this.submitAccept\r\n    );\r\n  }\r\n\r\n  decline = () => {\r\n    this.setState({waiting: true},\r\n      this.submitDecline\r\n    );\r\n  }\r\n\r\n  submitDecline = () => {\r\n    this.api.declineCollabInvite(this.state.worldID, this.state.collabID).then(res => {\r\n      this.setState({waiting: false, accepted: false}, this.refreshWorld);\r\n    });\r\n  }\r\n\r\n  render() {\r\n    if (this.state.collabID === null) {\r\n      const { worldID, collabID } = this.props.match.params;\r\n      setTimeout(() => {\r\n        this.api.checkCollabID(worldID, collabID).then(res => {\r\n          if (res.error !== undefined) {\r\n            this.setState({collabID, worldID, codeValid: false, message: res.error});\r\n          }\r\n          else {\r\n            this.setState({collabID, worldID, world: res.world, codeValid: true, message: \"\"});\r\n          }\r\n        });\r\n      }, 500);\r\n      return (\r\n        <div>\r\n          <h2>{this.state.message}</h2>\r\n        </div>\r\n      );\r\n    }\r\n    else if (this.state.codeValid) {\r\n      if (this.state.accepted === null) {\r\n        return (\r\n          <Grid container spacing={1}>\r\n            <Grid item xs={12}>\r\n              <h2>You've been invited to collaborate on {this.state.world.Name}</h2>\r\n            </Grid>\r\n            <Grid item xs={12} container spacing={1}>\r\n              <Grid item xs={6}>\r\n                <Button className=\"w-200\" \r\n                  variant=\"contained\" color=\"primary\"\r\n                  disabled={this.state.waiting}\r\n                  onClick={this.accept}\r\n                  type=\"button\">\r\n                  Accept\r\n                </Button>\r\n              </Grid>\r\n              <Grid item xs={6}>\r\n                <Button className=\"w-200\" \r\n                  variant=\"contained\" color=\"primary\"\r\n                  disabled={this.state.waiting}\r\n                  onClick={this.decline}\r\n                  type=\"button\">\r\n                  Decline\r\n                </Button>\r\n              </Grid>\r\n            </Grid>\r\n          </Grid>\r\n        );\r\n      }\r\n      else if (this.state.accepted) {\r\n        if (this.props.user === null) {\r\n          return (\r\n            <Grid container spacing={1} direction=\"column\">\r\n              <Grid item>\r\n                <h2>Please log in (or register and then log in if you're new) so we can add you as a collaborator on {this.state.world.Name}.</h2>\r\n              </Grid>\r\n              <Grid item>\r\n                <LoginControl onLogin={this.onLoginAccept}/>\r\n              </Grid>\r\n            </Grid>\r\n          );\r\n        }\r\n        else {\r\n          return (\r\n            <Grid container spacing={1}>\r\n              <Grid item xs={12}>\r\n                <h2>Congratulations! You can now collaborate on {this.state.world.Name}</h2>\r\n              </Grid>\r\n            </Grid>\r\n          );\r\n        }\r\n      }\r\n      else {\r\n        return (\r\n          <Grid container spacing={1}>\r\n            <Grid item xs={12}>\r\n              Okay.  Well, we hope you enjoy working on other worlds.\r\n            </Grid>\r\n          </Grid>\r\n        );\r\n      }\r\n    }\r\n    else {\r\n      return (\r\n        <div>\r\n          <h2>{this.state.message}</h2>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst CollaboratePage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default CollaboratePage;\r\n","import React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  updateWorld, selectWorld,\r\n  notFromLogin,\r\n  toggleLogin,\r\n  logout,\r\n  setAttributes,\r\n  setTypes,\r\n  setThings\r\n} from \"../../redux/actions/index\";\r\nimport { Button, Checkbox, FormControl, FormControlLabel,\r\n  OutlinedInput, InputLabel, FormHelperText, Grid, \r\n  ListItem, ListItemText, \r\n  Tooltip, Fab, AppBar, Tabs, Tab, Box, \r\n  InputAdornment, IconButton,\r\n  Select, MenuItem\r\n} from \"@material-ui/core\";\r\nimport { Add, ArrowBack, FileCopyOutlined, Delete, Check } from \"@material-ui/icons\";\r\nimport { Helmet } from 'react-helmet';\r\nimport API from \"../../smartAPI\";\r\n\r\n/* \r\n  This component will take the main portion of the page and is used for\r\n  creating or editing a World.  It will allow the use of Template Worlds\r\n  which come with preloaded Template Types.\r\n*/\r\n\r\nfunction TabPanel(props) {\r\n  const { children, value, index } = props;\r\n\r\n  return (\r\n    <div>{value === index && <Box p={3}>{children}</Box>}</div>\r\n  );\r\n}\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedWorld: state.app.selectedWorld,\r\n    selectedWorldID: state.app.selectedWorldID,\r\n    worlds: state.app.worlds,\r\n    user: state.app.user,\r\n    fromLogin: state.app.fromLogin\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    updateWorld: world => dispatch(updateWorld(world)),\r\n    selectWorld: worldID => dispatch(selectWorld(worldID)),\r\n    notFromLogin: () => dispatch(notFromLogin({})),\r\n    toggleLogin: () => dispatch(toggleLogin({})),\r\n    logout: () => dispatch(logout({})),\r\n    setAttributes: attributes => dispatch(setAttributes(attributes)),\r\n    setTypes: types => dispatch(setTypes(types)),\r\n    setThings: things => dispatch(setThings(things))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      _id: null,\r\n      Collaborators: [],\r\n      allUsers: null,\r\n      fieldValidation: {\r\n        inviteEmail: { valid: true, message: \"\" }\r\n      },\r\n      message: \"\",\r\n      redirectTo: null,\r\n      newCollaborators: false,\r\n      newCollabTab: 0,\r\n      collabTab: 0,\r\n      collabLink: null,\r\n      collabLinkCopied: false,\r\n      selectedUser: \"\",\r\n      inviteEmail: \"\",\r\n      inviteMessage: \"\", \r\n      waiting: false\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  handleUserInput = e => {\r\n    const name = e.target.name;\r\n    const value =\r\n      e.target.type === \"checkbox\" ? e.target.checked : e.target.value;\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  inputBlur = e => {\r\n    const name = e.target.name;\r\n    const validation = this.validateField(name);\r\n    const fieldValidation = this.state.fieldValidation;\r\n    if (\r\n      fieldValidation[name] !== undefined &&\r\n      fieldValidation[name].valid !== validation.valid\r\n    ) {\r\n      fieldValidation[name].valid = validation.valid;\r\n      fieldValidation[name].message = validation.message;\r\n      this.setState({ fieldValidation: fieldValidation });\r\n    }\r\n  };\r\n\r\n  a11yProps = (index) => {\r\n    return {\r\n      id: `simple-tab-${index}`,\r\n      'aria-controls': `simple-tabpanel-${index}`,\r\n    };\r\n  }\r\n\r\n  validateField = fieldName => {\r\n    let value = this.state[fieldName];\r\n    let valid = true;\r\n    let message = \"\";\r\n    switch (fieldName) {\r\n      case \"inviteEmail\":\r\n        valid = value.match(/^([\\w.%+-]+)@([\\w-]+\\.)+([\\w]{2,})$/i) !== null;\r\n        message = valid ? \"\" : \"Email is invalid\";\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    const response = { valid: valid, message: message };\r\n    return response;\r\n  };\r\n\r\n  addNewCollaborator = () => {\r\n    function respond() {\r\n      this.api.addNewCollaborator(this.props.selectedWorldID, this.state.selectedUser._id, this.state.selectedUser.email).then(res => {\r\n        if (res.error === undefined) {\r\n          const collabs = [...this.state.Collaborators];\r\n          collabs.push(res);\r\n          const world = this.props.selectedWorld;\r\n          world.Collaborators = collabs;\r\n          this.props.updateWorld(world);\r\n          this.setState({\r\n            Collaborators: collabs, \r\n            inviteMessage: \"Invite Sent\",\r\n            selectedUser: \"\",\r\n            waiting: false\r\n          });\r\n        }\r\n        else {\r\n          this.setState({message: res.error, waiting: false}, () => {\r\n            this.props.logout();\r\n          });\r\n        }\r\n      });\r\n    }\r\n    this.setState({waiting: true}, respond);\r\n  }\r\n\r\n  emailCollaborator = () => {\r\n    const emailValid = this.validateField(\"inviteEmail\");\r\n    if (emailValid) {\r\n      function respond() {\r\n        this.api.emailCollaborator(this.props.selectedWorldID, this.state.inviteEmail).then(res => {\r\n          if (res.error === undefined) {\r\n            const collabs = [...this.state.Collaborators];\r\n            collabs.push(res);\r\n            const world = this.props.selectedWorld;\r\n            world.Collaborators = collabs;\r\n            this.props.updateWorld(world);\r\n            this.setState({\r\n              Collaborators: collabs, \r\n              inviteMessage: \"Email Sent\", \r\n              inviteEmail: \"\",\r\n              waiting: false\r\n            });\r\n          }\r\n          else {\r\n            this.setState({message: res.error, waiting: false}, () => {\r\n              this.props.logout();\r\n            });\r\n          }\r\n        });\r\n      }\r\n      this.setState({waiting: true}, respond);\r\n    }\r\n  }\r\n\r\n  updateCollaboratorPermission = (collaborator, permission) => {\r\n    collaborator.editPermission = permission;\r\n    function respond() {\r\n      this.api.updateCollaboratorPermission(this.props.selectedWorldID, collaborator.collabID, permission).then(res => {\r\n        if (res.error === undefined) {\r\n          const collabs = [...this.state.Collaborators];\r\n          const collab = collabs.filter(c=>c.collabID === collaborator.collabID)[0];\r\n          collab.editPermission = permission;\r\n          const world = this.props.selectedWorld;\r\n          world.Collaborators = collabs;\r\n          this.props.updateWorld(world);\r\n          this.setState({\r\n            Collaborators: collabs, waiting: false\r\n          });\r\n        }\r\n        else {\r\n          this.setState({message: res.error, waiting: false}, () => {\r\n            this.props.logout();\r\n          });\r\n        }\r\n      });\r\n    }\r\n    this.setState({waiting: true}, respond);\r\n  }\r\n\r\n  // Creates a collab invite on the world, but no user or email associated\r\n  generateCollabLink = () => {\r\n    function respond() {\r\n      this.api.generateCollabLink(this.props.selectedWorldID).then(res => {\r\n        if (res.error === undefined) {\r\n          const collabs = [...this.state.Collaborators];\r\n          collabs.push(res);\r\n          const world = this.props.selectedWorld;\r\n          world.Collaborators = collabs;\r\n          this.props.updateWorld(world);\r\n          this.setState({\r\n            collabLink: res.collabLink, \r\n            collabLinkCopied: false,\r\n            Collaborators: collabs, \r\n            waiting: false\r\n          });\r\n        }\r\n        else {\r\n          this.setState({message: res.error, waiting: false}, () => {\r\n            this.props.logout();\r\n          });\r\n        }\r\n      });\r\n    }\r\n    this.setState({waiting: true}, respond);\r\n  }\r\n\r\n  deleteCollab = (collab) => {\r\n    function respond() {\r\n      this.api.deleteCollab(this.props.selectedWorldID, collab.collabID).then(res => {\r\n        if (res.error === undefined) {\r\n          const collabs = this.state.Collaborators.filter(c=>c.collabID !== collab.collabID);\r\n          const world = this.props.selectedWorld;\r\n          world.Collaborators = collabs;\r\n          this.props.updateWorld(world);\r\n          this.setState({\r\n            collabLink: res.collabLink, \r\n            collabLinkCopied: false,\r\n            Collaborators: collabs, \r\n            waiting: false\r\n          });\r\n        }\r\n        else {\r\n          this.setState({message: res.error, waiting: false}, () => {\r\n            this.props.logout();\r\n          });\r\n        }\r\n      });\r\n    }\r\n    this.setState({waiting: true}, respond);\r\n  }\r\n\r\n  acceptCollab = (collab) => {\r\n    function respond() {\r\n      this.api.acceptCollabRequest(this.props.selectedWorldID, collab.collabID).then(res => {\r\n        if (res.error === undefined) {\r\n          const collabs = [...this.state.Collaborators];\r\n          const collab2 = collabs.filter(c => c.collabID === collab.collabID)[0];\r\n          collab2.type = \"collab\";\r\n          const world = this.props.selectedWorld;\r\n          world.Collaborators = collabs;\r\n          this.props.updateWorld(world);\r\n          this.setState({\r\n            Collaborators: collabs, \r\n            waiting: false\r\n          });\r\n        }\r\n        else {\r\n          this.setState({message: res.error, waiting: false}, () => {\r\n            this.props.logout();\r\n          });\r\n        }\r\n      });\r\n    }\r\n    this.setState({waiting: true}, respond);\r\n  }\r\n\r\n  // Copies the collaborator link to the user's clipboard\r\n  copyCollabLink = () => {\r\n    const el = this.generatedLink;\r\n    const textarea = el.children[0];\r\n    textarea.select();\r\n    document.execCommand(\"copy\");\r\n    this.setState({collabLinkCopied: true});\r\n  }\r\n\r\n  load = (id) => {\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n    }\r\n    \r\n    setTimeout(() => {\r\n      this.setState({\r\n        _id: id,\r\n        loaded: false\r\n      }, this.finishLoading);\r\n    }, 500);\r\n  }\r\n\r\n  finishLoading = () => {\r\n    this.api.selectWorld(this.state._id);\r\n    this.props.selectWorld(this.state._id);\r\n    this.api.getWorld(this.state._id).then(res => {\r\n      this.props.setAttributes(res.attributes);\r\n      this.props.setTypes(res.types);\r\n      this.props.setThings(res.things);\r\n      \r\n      this.api.getAllUsers().then(res => {\r\n        this.setState({allUsers: res, loaded: true}, \r\n          this.actuallyFinishLoading);\r\n      });\r\n    });\r\n  }\r\n\r\n  actuallyFinishLoading = () => {\r\n    let world = this.props.worlds.filter(w => w._id === this.state._id);\r\n    if (world.length > 0) {\r\n      world = world[0];\r\n      this.setState({\r\n        Name: world.Name,\r\n        Public: world.Public,\r\n        AcceptingCollaborators: world.AcceptingCollaborators === undefined || world.AcceptingCollaborators === null ? false : world.AcceptingCollaborators,\r\n        Collaborators: world.Collaborators === undefined ? [] : world.Collaborators\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n    }\r\n    let { id } = this.props.match.params;\r\n    if (id === undefined)\r\n      id = null;\r\n    if (this.state._id !== id) {\r\n      this.load(id);\r\n      return (<span>Loading...</span>);\r\n    } else if (!this.state.loaded) {\r\n      return (<span>Loading...</span>);\r\n    } else if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    } else if (this.props.selectedWorld !== null && \r\n      this.props.user === null) {\r\n      setTimeout(() => {\r\n        this.props.toggleLogin();\r\n      }, 500);\r\n      return <span>Requires Login</span>;\r\n    } else if (this.props.selectedWorld !== null && \r\n      this.props.selectedWorld.Owner !== this.props.user._id) {\r\n      return <Redirect to=\"/\" />;\r\n    } else {\r\n      const collabs = this.state.Collaborators.filter(c=>c.type===\"collab\");\r\n      const invites = this.state.Collaborators.filter(c=>c.type===\"invite\");\r\n      const requests = this.state.Collaborators.filter(c=>c.type===\"request\");\r\n      const selectUsers = this.state.allUsers.filter(u=>u._id !== this.props.selectedWorld.Owner && this.state.Collaborators.filter(c=>c.userID === u._id).length === 0);\r\n      const userMenuItems = selectUsers.map((u, i) => {\r\n        return (\r\n          <MenuItem key={i} value={u}>\r\n            {u.username}\r\n          </MenuItem>\r\n        );\r\n      });\r\n      return (\r\n        <Grid item xs={12} container spacing={1} direction=\"column\">\r\n          <Helmet>\r\n            <title>{ this.state._id === null ? `Author's Notebook: Create New World` : `Author's Notebook: Edit ${this.props.selectedWorld.Name} Collaborators` }</title>\r\n          </Helmet>\r\n          <Grid item container spacing={1} direction=\"row\">\r\n            <Grid item xs={1}>\r\n              <Tooltip title={`Back to ${this.props.selectedWorld.Name} Details`}>\r\n                <Fab size=\"small\"\r\n                  color=\"primary\"\r\n                  onClick={ _ => {this.setState({redirectTo:`/world/details/${this.props.selectedWorldID}`})}}\r\n                >\r\n                  <ArrowBack />\r\n                </Fab>\r\n              </Tooltip>\r\n            </Grid>\r\n            <Grid item xs={11}>\r\n              <h2>Edit Collaborators</h2>\r\n            </Grid>\r\n          </Grid>\r\n          <Grid item>\r\n            <ListItem style={{maxWidth: \"200px\"}}>\r\n              <ListItemText primary=\"Collaborators\" />\r\n              { this.state.newCollaborators ?\r\n                <Tooltip title={`Manage Existing Collaborators`}>\r\n                  <Fab\r\n                    size=\"small\"\r\n                    color=\"primary\"\r\n                    onClick={_ => {\r\n                      this.setState({ newCollaborators: false });\r\n                    }}\r\n                  >\r\n                    <ArrowBack />\r\n                  </Fab>\r\n                </Tooltip>  :\r\n                <Tooltip title={`Add New Collaborators`}>\r\n                  <Fab\r\n                    size=\"small\"\r\n                    color=\"primary\"\r\n                    onClick={_ => {\r\n                      this.setState({ newCollaborators: true });\r\n                    }}\r\n                  >\r\n                    <Add />\r\n                  </Fab>\r\n                </Tooltip> \r\n              }\r\n            </ListItem>\r\n          </Grid>\r\n          { this.state.newCollaborators ?\r\n            <Grid item container spacing={1} direction=\"column\">\r\n              <Grid item>\r\n                <AppBar position=\"static\">\r\n                  <Tabs value={this.state.newCollabTab} onChange={(_, newValue) => { this.setState({newCollabTab: newValue, inviteMessage: \"\"})}} aria-label=\"Add Collaborator Method\">\r\n                    <Tab label=\"Find Existing User\" {...this.a11yProps(0)} />\r\n                    <Tab label=\"Invite via Email\" {...this.a11yProps(1)} />\r\n                    <Tab label=\"Get an Invite Link\" {...this.a11yProps(2)} />\r\n                  </Tabs>\r\n                </AppBar>\r\n                <TabPanel value={this.state.newCollabTab} index={0}>\r\n                  <Grid container spacing={1} direction=\"column\">\r\n                    <Grid item>\r\n                      <FormControl variant=\"outlined\" fullWidth>\r\n                        <InputLabel htmlFor=\"user-select\" id=\"user-select-label\">\r\n                          Select a User\r\n                        </InputLabel>\r\n                        <Select\r\n                          labelId=\"user-select-label\"\r\n                          id=\"user-select\"\r\n                          value={this.state.selectedUser}\r\n                          onChange={e => {\r\n                            this.setState({selectedUser: e.target.value, inviteMessage: \"\" })\r\n                          }}\r\n                          labelWidth={90}\r\n                        >\r\n                          {userMenuItems}\r\n                        </Select>\r\n                      </FormControl>\r\n                    </Grid>\r\n                    <Grid item>\r\n                      <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        disabled={this.state.selectedUser === \"\" || this.state.waiting}\r\n                        onClick={this.addNewCollaborator}\r\n                      >\r\n                        Send Invite\r\n                      </Button> \r\n                      { this.state.inviteMessage }\r\n                    </Grid>\r\n                  </Grid>\r\n                </TabPanel>\r\n                <TabPanel value={this.state.newCollabTab} index={1}>\r\n                  <Grid container spacing={1} direction=\"column\">\r\n                    <Grid item>\r\n                      <FormControl variant=\"outlined\" fullWidth>\r\n                        <InputLabel htmlFor=\"inviteEmail\">Collaborator Email</InputLabel>\r\n                        <OutlinedInput\r\n                          id=\"inviteEmail\"\r\n                          name=\"inviteEmail\"\r\n                          type=\"email\"\r\n                          autoComplete=\"Off\"\r\n                          error={!this.state.fieldValidation.inviteEmail.valid}\r\n                          value={this.state.inviteEmail}\r\n                          onChange={this.handleUserInput}\r\n                          onBlur={this.inputBlur}\r\n                          labelWidth={140}\r\n                          fullWidth\r\n                        />\r\n                        <FormHelperText>\r\n                          {this.state.fieldValidation.inviteEmail.message}\r\n                        </FormHelperText>\r\n                      </FormControl>\r\n                    </Grid>\r\n                    <Grid item>\r\n                      <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        disabled={this.state.waiting}\r\n                        onClick={this.emailCollaborator}\r\n                      >\r\n                        Send Invite\r\n                      </Button> \r\n                      { this.state.inviteMessage }\r\n                    </Grid>\r\n                  </Grid>\r\n                </TabPanel>\r\n                <TabPanel value={this.state.newCollabTab} index={2}>\r\n                  <Grid container spacing={1} direction=\"column\">\r\n                    <Grid item>\r\n                      Generate a single use link to send someone yourself\r\n                    </Grid>\r\n                    <Grid item>\r\n                      <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        disabled={this.state.waiting}\r\n                        onClick={this.generateCollabLink}\r\n                      >\r\n                        Generate Link\r\n                      </Button> \r\n                    </Grid>\r\n                      { this.state.collabLink !== null && \r\n                        <Grid item>\r\n                          <OutlinedInput\r\n                            id=\"generatedLink\"\r\n                            name=\"generatedLink\"\r\n                            ref={(input) => this.generatedLink = input}\r\n                            type=\"text\"\r\n                            multiline={true}\r\n                            value={this.state.collabLink}\r\n                            // disabled={true}\r\n                            endAdornment={\r\n                              <InputAdornment position=\"end\">\r\n                                <IconButton\r\n                                  aria-label=\"copy to clipboard\"\r\n                                  onClick={this.copyCollabLink}\r\n                                  edge=\"end\"\r\n                                >\r\n                                  <FileCopyOutlined />\r\n                                </IconButton>\r\n                              </InputAdornment>\r\n                            }\r\n                            labelWidth={70}\r\n                            fullWidth\r\n                          />\r\n                          { this.state.collabLinkCopied && \r\n                            <span style={{fontColor: \"red\"}}>\r\n                              Link Copied to Clipboard\r\n                            </span>\r\n                          }\r\n                        </Grid>\r\n                      }\r\n                  </Grid>\r\n                  \r\n                </TabPanel>\r\n              </Grid>\r\n            </Grid> :\r\n            <Grid item container spacing={1} direction=\"column\">\r\n              <Grid item>\r\n                <AppBar position=\"static\">\r\n                  <Tabs value={this.state.collabTab} onChange={(_, newValue) => { this.setState({collabTab: newValue})}} aria-label=\"Collaborators\">\r\n                    <Tab label={`Collaborators (${collabs.length})`} {...this.a11yProps(0)} />\r\n                    <Tab label={`Invites (${invites.length})`} {...this.a11yProps(1)} />\r\n                    <Tab label={`Requests (${requests.length})`} {...this.a11yProps(2)} />\r\n                  </Tabs>\r\n                </AppBar>\r\n                <TabPanel value={this.state.collabTab} index={0}>\r\n                  <Grid container spacing={3} direction=\"column\">\r\n                    { collabs.map((c, key) => {\r\n                      return (\r\n                        <Grid item container spacing={1} direcion=\"row\" key={key}>\r\n                          <Grid item xs={12} sm={3}>\r\n                            {this.state.allUsers.filter(u=>u._id === c.userID)[0].username}\r\n                          </Grid>\r\n                          <Grid item xs={12} sm={6}>\r\n                            <FormControlLabel\r\n                              control={\r\n                                <Checkbox \r\n                                  checked={c.editPermission} \r\n                                  disabled={this.state.waiting}\r\n                                  onChange={e => {\r\n                                    this.updateCollaboratorPermission(c, e.target.checked);\r\n                                  }}\r\n                                  color=\"primary\" />\r\n                              }\r\n                              label=\"Full Permissions\"\r\n                            />\r\n                          </Grid>\r\n                          <Grid item xs={12} sm={3}>\r\n                            <Tooltip title={`Remove Collaborator`}>\r\n                              <Fab size=\"small\"\r\n                                color=\"primary\"\r\n                                disabled={this.state.waiting}\r\n                                onClick={e => {this.deleteCollab(c)}}\r\n                              >\r\n                                <Delete />\r\n                              </Fab>\r\n                            </Tooltip>\r\n                          </Grid>\r\n                        </Grid>\r\n                      );\r\n                    })}\r\n                  </Grid>\r\n                </TabPanel>\r\n                <TabPanel value={this.state.collabTab} index={1}>\r\n                  <Grid container spacing={3} direction=\"column\">\r\n                    { invites.map((c, key) => {\r\n                      let user = this.state.allUsers.filter(u=>u._id === c.userID);\r\n                      if (user.length === 0)\r\n                        user = null;\r\n                      else {\r\n                        user = user[0];\r\n                      }\r\n                      return (\r\n                        <Grid item container spacing={1} direction=\"row\" key={key}>\r\n                          <Grid item xs={12} sm={9} container spacing={1} direction=\"column\">\r\n                            { user !== null &&\r\n                              <Grid item>\r\n                                Username: {user.username}\r\n                              </Grid>\r\n                            }\r\n                            { c.email !== \"\" &&\r\n                              <Grid item>\r\n                                Email: {c.email}\r\n                              </Grid>\r\n                            }\r\n                            <Grid item>\r\n                              Invite Link: {c.collabLink}\r\n                            </Grid>\r\n                          </Grid>\r\n                          <Grid item xs={12} sm={3}>\r\n                            <Tooltip title={`Delete Invite`}>\r\n                              <Fab size=\"small\"\r\n                                color=\"primary\"\r\n                                disabled={this.state.waiting}\r\n                                onClick={e => {this.deleteCollab(c)}}\r\n                              >\r\n                                <Delete />\r\n                              </Fab>\r\n                            </Tooltip>\r\n                          </Grid>\r\n                        </Grid>  \r\n                      );\r\n                    })}\r\n                  </Grid>\r\n                </TabPanel>\r\n                <TabPanel value={this.state.collabTab} index={2}>\r\n                  <Grid container spacing={3} direction=\"column\">\r\n                    { requests.map((c, key) => {\r\n                      return (\r\n                        <Grid item container spacing={1} direcion=\"row\" key={key}>\r\n                          <Grid item xs={12} sm={6}>\r\n                            {this.state.allUsers.filter(u=>u._id === c.userID)[0].username}\r\n                          </Grid>\r\n                          <Grid item xs={12} sm={3}>\r\n                            <Tooltip title={`Accept Request`}>\r\n                              <Fab size=\"small\"\r\n                                color=\"primary\"\r\n                                disabled={this.state.waiting}\r\n                                onClick={_ => {this.acceptCollab(c)}}\r\n                              >\r\n                                <Check />\r\n                              </Fab>\r\n                            </Tooltip>\r\n                          </Grid>\r\n                          <Grid item xs={12} sm={3}>\r\n                            <Tooltip title={`Delete Request`}>\r\n                              <Fab size=\"small\"\r\n                                color=\"primary\"\r\n                                disabled={this.state.waiting}\r\n                                onClick={_ => {this.deleteCollab(c)}}\r\n                              >\r\n                                <Delete />\r\n                              </Fab>\r\n                            </Tooltip>\r\n                          </Grid>\r\n                        </Grid>\r\n                      );\r\n                    })}\r\n                  </Grid>\r\n                </TabPanel>\r\n              </Grid>\r\n            </Grid>\r\n          }\r\n          <Grid item>{this.state.message}</Grid>\r\n          <Grid item>\r\n            {Object.keys(this.state.fieldValidation).map((fieldName, i) => {\r\n              if (\r\n                this.state.fieldValidation[fieldName] !== undefined &&\r\n                this.state.fieldValidation[fieldName].message.length > 0\r\n              ) {\r\n                return (\r\n                  <p className=\"redFont\" key={i}>\r\n                    {this.state.fieldValidation[fieldName].message}\r\n                  </p>\r\n                );\r\n              } else {\r\n                return \"\";\r\n              }\r\n            })}\r\n          </Grid>\r\n        </Grid>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst EditCollaboratorPage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default EditCollaboratorPage;","import React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  updateSelectedType,\r\n  addType,\r\n  updateType,\r\n  setTypes,\r\n  setAttributes,\r\n  setThings,\r\n  notFromLogin,\r\n  toggleLogin,\r\n  logout,\r\n} from \"../../redux/actions/index\";\r\nimport { Edit, Delete, Add, ArrowBack } from \"@material-ui/icons\";\r\nimport {\r\n  Fab,\r\n  Modal,\r\n  Grid,\r\n  Button,\r\n  Tooltip,\r\n  List,\r\n  ListItem,\r\n  ListItemText,\r\n} from \"@material-ui/core\";\r\nimport { Helmet } from \"react-helmet\";\r\nimport API from \"../../smartAPI\";\r\nimport CommentsControl from \"../../components/Inputs/CommentsControl\";\r\n\r\n/* \r\n  This component will take the main portion of the page and is used for\r\n  creating or editing a Type.  It will allow the use of Super Types \r\n  to make the process faster.\r\n*/\r\n\r\nconst mapStateToProps = (state) => {\r\n  const type = state.app.selectedType;\r\n  const subTypes =\r\n    type === null\r\n      ? []\r\n      : state.app.types.filter((t) => t.SuperIDs.includes(type._id));\r\n  const things =\r\n    type === null\r\n      ? []\r\n      : state.app.things.filter((t) => t.TypeIDs.includes(type._id));\r\n  return {\r\n    selectedPage: state.app.selectedPage,\r\n    selectedType: type,\r\n    selectedWorld: state.app.selectedWorld,\r\n    selectedWorldID: state.app.selectedWorldID,\r\n    types: state.app.types,\r\n    subTypes: subTypes,\r\n    instances: things,\r\n    user: state.app.user,\r\n    things: state.app.things,\r\n    attributesByID: state.app.attributesByID,\r\n    attributesByName: state.app.attributesByName,\r\n    fromLogin: state.app.fromLogin,\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    updateSelectedType: (type) => dispatch(updateSelectedType(type)),\r\n    addType: (type) => dispatch(addType(type)),\r\n    updateType: (type) => dispatch(updateType(type)),\r\n    setTypes: (types) => dispatch(setTypes(types)),\r\n    setAttributes: (attributes) => dispatch(setAttributes(attributes)),\r\n    setThings: (things) => dispatch(setThings(things)),\r\n    notFromLogin: () => dispatch(notFromLogin({})),\r\n    toggleLogin: () => dispatch(toggleLogin({})),\r\n    logout: () => dispatch(logout({})),\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      _id: null,\r\n      fieldValidation: {\r\n        Name: { valid: true, message: \"\" },\r\n      },\r\n      formValid: false,\r\n      message: \"\",\r\n      redirectTo: null,\r\n      modalOpen: false,\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n    // load();\r\n  }\r\n\r\n  getModalStyle = () => {\r\n    const top = Math.round(window.innerHeight / 2) - 50;\r\n    const left = Math.round(window.innerWidth / 2) - 200;\r\n\r\n    return {\r\n      top: `${top}%`,\r\n      left: `${left}%`,\r\n      transform: `translate(${left}px, ${top}px)`,\r\n    };\r\n  };\r\n\r\n  delete = (e) => {\r\n    this.api\r\n      .deleteType(this.props.selectedWorldID, this.state._id)\r\n      .then((res) => {\r\n        if (res.error === undefined) {\r\n          this.api.getWorld(this.props.selectedWorldID, true).then((res2) => {\r\n            this.props.setAttributes(res2.attributes);\r\n            this.props.setTypes(res2.types);\r\n            this.props.setThings(res2.things);\r\n\r\n            this.setState({\r\n              redirectTo: `/world/details/${this.props.selectedWorldID}`,\r\n            });\r\n          });\r\n          // this.getWorld().then(res2 => {\r\n          //   this.setState({redirectTo: `/world/details/${this.props.selectedWorldID}`});\r\n          // });\r\n        } else {\r\n          this.setState({ waiting: false, message: res.error }, () => {\r\n            this.props.logout();\r\n          });\r\n        }\r\n      });\r\n  };\r\n\r\n  load = (id) => {\r\n    // const { id } = this.props.match.params;\r\n    setTimeout(() => {\r\n      this.setState(\r\n        {\r\n          _id: id,\r\n          redirectTo: null,\r\n        },\r\n        this.finishLoading\r\n      );\r\n    }, 500);\r\n  };\r\n\r\n  finishLoading = () => {\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n    }\r\n    const id = this.state._id;\r\n    if (id !== undefined) {\r\n      this.api.getWorld(this.props.selectedWorldID).then((res) => {\r\n        this.props.setAttributes(res.attributes);\r\n        this.props.setTypes(res.types);\r\n        this.props.setThings(res.things);\r\n\r\n        if (id !== null) {\r\n          let type = res.types.filter((t) => t._id === id);\r\n          if (type.length > 0) {\r\n            type = type[0];\r\n\r\n            this.props.updateSelectedType(type);\r\n          } else {\r\n            this.setState({ message: \"Invalid ID\", loaded: true });\r\n          }\r\n        } else {\r\n          this.props.updateSelectedType({\r\n            _id: null,\r\n            Name: \"\",\r\n            Description: \"\",\r\n            Supers: [],\r\n            SuperIDs: [],\r\n            AttributesArr: [],\r\n            Attributes: [],\r\n            Major: false,\r\n            DefaultsHash: {},\r\n          });\r\n        }\r\n      });\r\n      // this.getWorld().then(res => {\r\n      //   if (id !== null) {\r\n      //     let type = res.types.filter(t => t._id === id);\r\n      //     if (type.length > 0) {\r\n      //       type = type[0];\r\n\r\n      //       this.props.updateSelectedType(type);\r\n      //     }\r\n      //     else {\r\n      //       this.setState({ message: \"Invalid ID\", loaded: true });\r\n      //     }\r\n      //   } else {\r\n      //     this.props.updateSelectedType({\r\n      //       _id: null,\r\n      //       Name: \"\",\r\n      //       Description: \"\",\r\n      //       Supers: [],\r\n      //       SuperIDs: [],\r\n      //       AttributesArr: [],\r\n      //       Attributes: [],\r\n      //       Major: false,\r\n      //       DefaultsHash: {}\r\n      //     });\r\n      //   }\r\n      // })\r\n    } else {\r\n      this.props.updateSelectedType({\r\n        _id: null,\r\n        Name: \"\",\r\n        Description: \"\",\r\n        Supers: [],\r\n        AttributesArr: [],\r\n        Attributes: [],\r\n        Major: false,\r\n      });\r\n    }\r\n  };\r\n\r\n  redirectToNext = () => {\r\n    // Find the next type\r\n    let index = 0;\r\n    while (this.props.types[index]._id !== this.props.selectedType._id) index++;\r\n    index++;\r\n    if (index === this.props.types.length) index = 0;\r\n    this.setState({\r\n      redirectTo: `/type/details/${this.props.types[index]._id}`,\r\n    });\r\n  };\r\n\r\n  render() {\r\n    const { id } = this.props.match.params;\r\n    if (this.state._id !== id) {\r\n      this.load(id);\r\n    }\r\n    if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    } else if (\r\n      this.props.selectedWorld !== null &&\r\n      !this.props.selectedWorld.Public &&\r\n      this.props.user === null\r\n    ) {\r\n      setTimeout(() => {\r\n        this.props.toggleLogin();\r\n      }, 500);\r\n      return <span>Requires Login</span>;\r\n    } else if (\r\n      this.props.selectedWorld !== null &&\r\n      !this.props.selectedWorld.Public &&\r\n      this.props.selectedWorld.Owner !== this.props.user._id &&\r\n      this.props.selectedWorld.Collaborators.filter(\r\n        (c) => c.userID === this.props.user._id && c.type === \"collab\"\r\n      ).length === 0\r\n    ) {\r\n      return <Redirect to=\"/\" />;\r\n    } else if (\r\n      this.props.selectedType === undefined ||\r\n      this.props.selectedType === null\r\n    ) {\r\n      return <span>Loading</span>;\r\n    } else {\r\n      const references = this.props.types.filter(\r\n        (t) =>\r\n          t.ReferenceIDs !== undefined &&\r\n          t.ReferenceIDs.includes(this.state._id)\r\n      );\r\n      const inheritedAttributes = [];\r\n      this.props.selectedType.Supers.forEach((superType) => {\r\n        superType.AttributesArr.forEach((attribute) => {\r\n          if (\r\n            inheritedAttributes.filter((a) => a.attrID === attribute.attrID)\r\n              .length === 0\r\n          ) {\r\n            inheritedAttributes.push(attribute);\r\n          }\r\n        });\r\n      });\r\n      return (\r\n        <Grid item xs={12} container spacing={0} direction=\"column\">\r\n          {this.props.selectedWorld === null ? (\r\n            \"\"\r\n          ) : (\r\n            <div>\r\n              <Helmet>\r\n                <title>{`Author's Notebook: ${this.props.selectedWorld.Name}`}</title>\r\n              </Helmet>\r\n              <Grid item container spacing={0} direction=\"row\">\r\n                <Grid item xs={12} sm={8} container spacing={0} direction=\"column\">\r\n                  <Grid item container spacing={0} direction=\"row\">\r\n                    <Grid item xs={1}>\r\n                      <Tooltip\r\n                        title={`Back to ${this.props.selectedWorld.Name}`}\r\n                      >\r\n                        <Fab\r\n                          size=\"small\"\r\n                          color=\"primary\"\r\n                          onClick={(_) => {\r\n                            this.setState({\r\n                              redirectTo: `/world/details/${this.props.selectedWorldID}`,\r\n                            });\r\n                          }}\r\n                        >\r\n                          <ArrowBack />\r\n                        </Fab>\r\n                      </Tooltip>\r\n                    </Grid>\r\n                    <Grid item xs={11}>\r\n                      <h2>{this.props.selectedType.Name}</h2>\r\n                    </Grid>\r\n                  </Grid>\r\n                  <Grid item>\r\n                    <h3>{this.props.selectedType.Major ? \"Major Type\" : \"\"}</h3>\r\n                  </Grid>\r\n                  <Grid item>{this.props.selectedType.Description}</Grid>\r\n                </Grid>\r\n                <Grid item xs={12} sm={4}>\r\n                  <List>\r\n                    {this.props.user !== null &&\r\n                      this.props.selectedWorld !== null &&\r\n                      (this.props.selectedWorld.Owner === this.props.user._id ||\r\n                        this.props.selectedWorld.Collaborators.filter(\r\n                          (c) =>\r\n                            c.userID === this.props.user._id &&\r\n                            c.type === \"collab\" &&\r\n                            c.editPermission\r\n                        ).length > 0) && (\r\n                        <ListItem>\r\n                          <Grid container spacing={1} direction=\"row\">\r\n                            <Grid item xs={4} sm={12}>\r\n                              <Tooltip title={`Create New ${this.props.selectedType.Name}`}>\r\n                                <Fab\r\n                                  size=\"small\" color=\"primary\"\r\n                                  onClick={(_) => {\r\n                                    this.setState({\r\n                                      redirectTo: `/thing/create/type_id_${this.state._id}`,\r\n                                    });\r\n                                  }}>\r\n                                  <Add />\r\n                                </Fab>\r\n                              </Tooltip>\r\n                            </Grid>\r\n                            <Grid item xs={4} sm={12}>\r\n                              <Tooltip title={`Edit ${this.props.selectedType.Name}`}>\r\n                                <Fab\r\n                                  size=\"small\" color=\"primary\"\r\n                                  onClick={(_) => {\r\n                                    this.setState({\r\n                                      redirectTo: `/type/edit/${this.state._id}`,\r\n                                    });\r\n                                  }}>\r\n                                  <Edit />\r\n                                </Fab>\r\n                              </Tooltip>\r\n                            </Grid>\r\n                            <Grid item xs={4} sm={12}>\r\n                              <Tooltip title={`Delete ${this.props.selectedType.Name}`}>\r\n                                <Fab\r\n                                  size=\"small\" color=\"primary\"\r\n                                  onClick={(e) => {\r\n                                    this.setState({ modalOpen: true });\r\n                                  }}>\r\n                                  <Delete />\r\n                                </Fab>\r\n                              </Tooltip>\r\n                            </Grid>\r\n                          </Grid>\r\n                        </ListItem>\r\n                      )}\r\n                    <ListItem>\r\n                      <Button\r\n                        fullWidth\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={(_) => {\r\n                          this.redirectToNext();\r\n                        }}\r\n                      >\r\n                        <ListItemText primary=\"Next Type\" />\r\n                      </Button>\r\n                    </ListItem>\r\n                  </List>\r\n                </Grid>\r\n              </Grid>\r\n              <Grid item container spacing={0} direction=\"row\">\r\n                <Grid item xs={12} sm={8} container spacing={0} direction=\"column\">\r\n                  <Grid item>Attributes</Grid>\r\n                  <Grid item>\r\n                    <List>\r\n                      {this.props.selectedType !== null &&\r\n                        this.props.selectedType !== undefined &&\r\n                        inheritedAttributes.map((attribute, i) => {\r\n                          let definedType = this.props.types.filter(\r\n                            (t) => t._id === attribute.DefinedType\r\n                          );\r\n                          definedType =\r\n                            definedType.length === 0\r\n                              ? { Name: \"\" }\r\n                              : definedType[0];\r\n                          const def = this.props.selectedType.DefaultsHash[\r\n                            attribute.attrID\r\n                          ];\r\n                          return (\r\n                            <ListItem key={i}>\r\n                              <ListItemText>\r\n                                {attribute.Name}:&nbsp;\r\n                                {attribute.AttributeType === \"Options\" ? (\r\n                                  <span>\r\n                                    Options:\r\n                                    {attribute.Options.map((option, j) => {\r\n                                      return (\r\n                                        <span key={j}>\r\n                                          {j === 0 ? \" \" : \", \"}\r\n                                          {option}\r\n                                        </span>\r\n                                      );\r\n                                    })}\r\n                                    {def !== undefined &&\r\n                                      def.DefaultValue !== undefined &&\r\n                                      def.DefaultValue !== \"\" &&\r\n                                      ` (Default: ${def.DefaultValue})`}\r\n                                  </span>\r\n                                ) : attribute.AttributeType === \"Type\" ? (\r\n                                  <span>\r\n                                    <Button\r\n                                      variant=\"contained\"\r\n                                      color=\"primary\"\r\n                                      onClick={(_) => {\r\n                                        this.setState({\r\n                                          redirectTo: `/type/details/${attribute.DefinedType}`,\r\n                                        });\r\n                                      }}\r\n                                    >\r\n                                      <ListItemText\r\n                                        primary={definedType.Name}\r\n                                      />\r\n                                    </Button>\r\n                                    {def !== undefined &&\r\n                                      def.DefaultValue !== undefined &&\r\n                                      def.DefaultValue !== \"\" &&\r\n                                      this.props.things.filter(\r\n                                        (t) => def.DefaultValue === t._id\r\n                                      ).length > 0 &&\r\n                                      ` (Default: ${\r\n                                        this.props.things.filter(\r\n                                          (t) => t._id === def.DefaultValue\r\n                                        )[0].Name\r\n                                      })`}\r\n                                  </span>\r\n                                ) : attribute.AttributeType === \"List\" ? (\r\n                                  <span>\r\n                                    List:&nbsp;\r\n                                    {attribute.ListType === \"Options\" ? (\r\n                                      <span>\r\n                                        Options:\r\n                                        {attribute.Options.map(\r\n                                          (option, j) => {\r\n                                            return (\r\n                                              <span key={j}>\r\n                                                {j === 0 ? \" \" : \", \"}\r\n                                                {option}\r\n                                              </span>\r\n                                            );\r\n                                          }\r\n                                        )}\r\n                                        {def !== undefined &&\r\n                                          def.DefaultListValues !==\r\n                                            undefined &&\r\n                                          def.DefaultListValues.length >\r\n                                            0 && (\r\n                                            <span>\r\n                                              &nbsp;(Defaults:\r\n                                              {def.DefaultListValues.map(\r\n                                                (defaultValue, j) => {\r\n                                                  return (\r\n                                                    <span key={j}>\r\n                                                      {j === 0 ? \" \" : \", \"}\r\n                                                      {defaultValue}\r\n                                                    </span>\r\n                                                  );\r\n                                                }\r\n                                              )}\r\n                                              )\r\n                                            </span>\r\n                                          )}\r\n                                      </span>\r\n                                    ) : attribute.ListType === \"Type\" ? (\r\n                                      <span>\r\n                                        <Button\r\n                                          variant=\"contained\"\r\n                                          color=\"primary\"\r\n                                          onClick={(_) => {\r\n                                            this.setState({\r\n                                              redirectTo: `/type/details/${attribute.DefinedType}`,\r\n                                            });\r\n                                          }}\r\n                                        >\r\n                                          <ListItemText\r\n                                            primary={definedType.Name}\r\n                                          />\r\n                                        </Button>\r\n                                        {def !== undefined &&\r\n                                          def.DefaultListValues !==\r\n                                            undefined &&\r\n                                          def.DefaultListValues.length > 0 &&\r\n                                          this.props.things.filter((t) =>\r\n                                            def.DefaultListValues.includes(\r\n                                              t._id\r\n                                            )\r\n                                          ).length > 0 && (\r\n                                            <span>\r\n                                              &nbsp;(Defaults:\r\n                                              {def.DefaultListValues.map(\r\n                                                (defaultValue, j) => {\r\n                                                  let defaultThing = this.props.things.filter(\r\n                                                    (t) =>\r\n                                                      t._id === defaultValue\r\n                                                  );\r\n                                                  if (\r\n                                                    defaultThing.length === 0\r\n                                                  )\r\n                                                    return (\r\n                                                      <span key={j}></span>\r\n                                                    );\r\n                                                  else {\r\n                                                    defaultThing =\r\n                                                      defaultThing[0];\r\n                                                    return (\r\n                                                      <span key={j}>\r\n                                                        {j === 0 ? \" \" : \", \"}\r\n                                                        <Button\r\n                                                          variant=\"contained\"\r\n                                                          color=\"primary\"\r\n                                                          onClick={(_) => {\r\n                                                            this.setState({\r\n                                                              redirectTo: `/thing/details/${defaultValue}`,\r\n                                                            });\r\n                                                          }}\r\n                                                        >\r\n                                                          <ListItemText\r\n                                                            primary={\r\n                                                              defaultThing.Name\r\n                                                            }\r\n                                                          />\r\n                                                        </Button>\r\n                                                      </span>\r\n                                                    );\r\n                                                  }\r\n                                                }\r\n                                              )}\r\n                                              )\r\n                                            </span>\r\n                                          )}\r\n                                      </span>\r\n                                    ) : (\r\n                                      <span>\r\n                                        {attribute.ListType}\r\n                                        {def !== undefined &&\r\n                                          def.DefaultListValues !==\r\n                                            undefined &&\r\n                                          def.DefaultListValues.length >\r\n                                            0 && (\r\n                                            <span>\r\n                                              &nbsp;(Defaults:\r\n                                              {def.DefaultListValues.map(\r\n                                                (defaultValue, j) => {\r\n                                                  return (\r\n                                                    <span key={j}>\r\n                                                      {j === 0 ? \" \" : \", \"}\r\n                                                      {defaultValue}\r\n                                                    </span>\r\n                                                  );\r\n                                                }\r\n                                              )}\r\n                                              )\r\n                                            </span>\r\n                                          )}\r\n                                      </span>\r\n                                    )}\r\n                                  </span>\r\n                                ) : attribute.AttributeType ===\r\n                                  \"True/False\" ? (\r\n                                  <span>\r\n                                    {attribute.AttributeType}\r\n                                    {def !== undefined &&\r\n                                    def.DefaultValue !== undefined &&\r\n                                    def.DefaultValue !== \"\"\r\n                                      ? ` (Default: ${def.DefaultValue})`\r\n                                      : \" (Default: False)\"}\r\n                                  </span>\r\n                                ) : (\r\n                                  <span>\r\n                                    {attribute.AttributeType}\r\n                                    {def !== undefined &&\r\n                                      def.DefaultValue !== undefined &&\r\n                                      def.DefaultValue !== \"\" &&\r\n                                      ` (Default: ${def.DefaultValue})`}\r\n                                  </span>\r\n                                )}\r\n                              </ListItemText>\r\n                            </ListItem>\r\n                          );\r\n                        })}\r\n                      {this.props.selectedType !== null &&\r\n                        this.props.selectedType !== undefined &&\r\n                        this.props.selectedType.AttributesArr.map(\r\n                          (attribute, i) => {\r\n                            let definedType = this.props.types.filter(\r\n                              (t) => t._id === attribute.DefinedType\r\n                            );\r\n                            definedType =\r\n                              definedType.length === 0\r\n                                ? { Name: \"\" }\r\n                                : definedType[0];\r\n                            const def = this.props.selectedType.DefaultsHash[\r\n                              attribute.attrID\r\n                            ];\r\n                            return (\r\n                              <ListItem key={i}>\r\n                                <ListItemText>\r\n                                  {attribute.Name}:&nbsp;\r\n                                  {attribute.AttributeType === \"Options\" ? (\r\n                                    <span>\r\n                                      Options:\r\n                                      {attribute.Options.map((option, j) => {\r\n                                        return (\r\n                                          <span key={j}>\r\n                                            {j === 0 ? \" \" : \", \"}\r\n                                            {option}\r\n                                          </span>\r\n                                        );\r\n                                      })}\r\n                                      {def !== undefined &&\r\n                                        def.DefaultValue !== undefined &&\r\n                                        def.DefaultValue !== \"\" &&\r\n                                        ` (Default: ${def.DefaultValue})`}\r\n                                    </span>\r\n                                  ) : attribute.AttributeType === \"Type\" ? (\r\n                                    <span>\r\n                                      <Button\r\n                                        variant=\"contained\"\r\n                                        color=\"primary\"\r\n                                        onClick={(_) => {\r\n                                          this.setState({\r\n                                            redirectTo: `/type/details/${attribute.DefinedType}`,\r\n                                          });\r\n                                        }}\r\n                                      >\r\n                                        <ListItemText\r\n                                          primary={definedType.Name}\r\n                                        />\r\n                                      </Button>\r\n                                      {def !== undefined &&\r\n                                        def.DefaultValue !== undefined &&\r\n                                        def.DefaultValue !== \"\" &&\r\n                                        this.props.things.filter(\r\n                                          (t) => def.DefaultValue === t._id\r\n                                        ).length > 0 &&\r\n                                        ` (Default: ${\r\n                                          this.props.things.filter(\r\n                                            (t) => t._id === def.DefaultValue\r\n                                          )[0].Name\r\n                                        })`}\r\n                                    </span>\r\n                                  ) : attribute.AttributeType === \"List\" ? (\r\n                                    <span>\r\n                                      List:&nbsp;\r\n                                      {attribute.ListType === \"Options\" ? (\r\n                                        <span>\r\n                                          Options:\r\n                                          {attribute.Options.map(\r\n                                            (option, j) => {\r\n                                              return (\r\n                                                <span key={j}>\r\n                                                  {j === 0 ? \" \" : \", \"}\r\n                                                  {option}\r\n                                                </span>\r\n                                              );\r\n                                            }\r\n                                          )}\r\n                                          {def !== undefined &&\r\n                                            def.DefaultListValues !==\r\n                                              undefined &&\r\n                                            def.DefaultListValues.length >\r\n                                              0 && (\r\n                                              <span>\r\n                                                &nbsp;(Defaults:\r\n                                                {def.DefaultListValues.map(\r\n                                                  (defaultValue, j) => {\r\n                                                    return (\r\n                                                      <span key={j}>\r\n                                                        {j === 0 ? \" \" : \", \"}\r\n                                                        {defaultValue}\r\n                                                      </span>\r\n                                                    );\r\n                                                  }\r\n                                                )}\r\n                                                )\r\n                                              </span>\r\n                                            )}\r\n                                        </span>\r\n                                      ) : attribute.ListType === \"Type\" ? (\r\n                                        <span>\r\n                                          <Button\r\n                                            variant=\"contained\"\r\n                                            color=\"primary\"\r\n                                            onClick={(_) => {\r\n                                              this.setState({\r\n                                                redirectTo: `/type/details/${attribute.DefinedType}`,\r\n                                              });\r\n                                            }}\r\n                                          >\r\n                                            <ListItemText\r\n                                              primary={definedType.Name}\r\n                                            />\r\n                                          </Button>\r\n                                          {def !== undefined &&\r\n                                            def.DefaultListValues !==\r\n                                              undefined &&\r\n                                            def.DefaultListValues.length >\r\n                                              0 &&\r\n                                            this.props.things.filter((t) =>\r\n                                              def.DefaultListValues.includes(\r\n                                                t._id\r\n                                              )\r\n                                            ).length > 0 && (\r\n                                              <span>\r\n                                                &nbsp;(Defaults:\r\n                                                {def.DefaultListValues.map(\r\n                                                  (defaultValue, j) => {\r\n                                                    let defaultThing = this.props.things.filter(\r\n                                                      (t) =>\r\n                                                        t._id === defaultValue\r\n                                                    );\r\n                                                    if (\r\n                                                      defaultThing.length ===\r\n                                                      0\r\n                                                    )\r\n                                                      return (\r\n                                                        <span key={j}></span>\r\n                                                      );\r\n                                                    else {\r\n                                                      defaultThing =\r\n                                                        defaultThing[0];\r\n                                                      return (\r\n                                                        <span key={j}>\r\n                                                          {j === 0\r\n                                                            ? \" \"\r\n                                                            : \", \"}\r\n                                                          <Button\r\n                                                            variant=\"contained\"\r\n                                                            color=\"primary\"\r\n                                                            onClick={(_) => {\r\n                                                              this.setState({\r\n                                                                redirectTo: `/thing/details/${defaultValue}`,\r\n                                                              });\r\n                                                            }}\r\n                                                          >\r\n                                                            <ListItemText\r\n                                                              primary={\r\n                                                                defaultThing.Name\r\n                                                              }\r\n                                                            />\r\n                                                          </Button>\r\n                                                        </span>\r\n                                                      );\r\n                                                    }\r\n                                                  }\r\n                                                )}\r\n                                                )\r\n                                              </span>\r\n                                            )}\r\n                                        </span>\r\n                                      ) : (\r\n                                        <span>\r\n                                          {attribute.ListType}\r\n                                          {def !== undefined &&\r\n                                            def.DefaultListValues !==\r\n                                              undefined &&\r\n                                            def.DefaultListValues.length >\r\n                                              0 && (\r\n                                              <span>\r\n                                                &nbsp;(Defaults:\r\n                                                {def.DefaultListValues.map(\r\n                                                  (defaultValue, j) => {\r\n                                                    return (\r\n                                                      <span key={j}>\r\n                                                        {j === 0 ? \" \" : \", \"}\r\n                                                        {defaultValue}\r\n                                                      </span>\r\n                                                    );\r\n                                                  }\r\n                                                )}\r\n                                                )\r\n                                              </span>\r\n                                            )}\r\n                                        </span>\r\n                                      )}\r\n                                    </span>\r\n                                  ) : attribute.AttributeType ===\r\n                                    \"True/False\" ? (\r\n                                    <span>\r\n                                      {attribute.AttributeType}\r\n                                      {def !== undefined &&\r\n                                      def.DefaultValue !== undefined &&\r\n                                      def.DefaultValue !== \"\"\r\n                                        ? ` (Default: ${def.DefaultValue})`\r\n                                        : \" (Default: False)\"}\r\n                                    </span>\r\n                                  ) : (\r\n                                    <span>\r\n                                      {attribute.AttributeType}\r\n                                      {def !== undefined &&\r\n                                        def.DefaultValue !== undefined &&\r\n                                        def.DefaultValue !== \"\" &&\r\n                                        ` (Default: ${def.DefaultValue})`}\r\n                                    </span>\r\n                                  )}\r\n                                </ListItemText>\r\n                              </ListItem>\r\n                            );\r\n                          }\r\n                        )}\r\n                    </List>\r\n                  </Grid>\r\n                </Grid>\r\n                <Grid item xs={12} sm={4} container spacing={0} direction=\"column\">\r\n                  {this.props.selectedType.Supers.length > 0 && (\r\n                    <Grid item>\r\n                      <List>\r\n                        <ListItem>\r\n                          <ListItemText primary={\"Super Types\"} />\r\n                        </ListItem>\r\n                        {this.props.selectedType.Supers.map((superType, i) => {\r\n                          return (\r\n                            <ListItem key={i}>\r\n                              <Button\r\n                                fullWidth\r\n                                variant=\"contained\"\r\n                                color=\"primary\"\r\n                                onClick={(_) => {\r\n                                  this.setState({\r\n                                    redirectTo: `/type/details/${superType._id}`,\r\n                                  });\r\n                                }}\r\n                              >\r\n                                <ListItemText primary={superType.Name} />\r\n                              </Button>\r\n                            </ListItem>\r\n                          );\r\n                        })}\r\n                      </List>\r\n                    </Grid>\r\n                  )}\r\n                  {this.props.subTypes.length > 0 && (\r\n                    <Grid item>\r\n                      <List>\r\n                        <ListItem>\r\n                          <ListItemText primary={\"Sub Types\"} />\r\n                        </ListItem>\r\n                        {this.props.subTypes.map((sub, i) => {\r\n                          return (\r\n                            <ListItem key={i}>\r\n                              <Button\r\n                                fullWidth\r\n                                variant=\"contained\"\r\n                                color=\"primary\"\r\n                                onClick={(_) => {\r\n                                  this.setState({\r\n                                    redirectTo: `/type/details/${sub._id}`,\r\n                                  });\r\n                                }}\r\n                              >\r\n                                <ListItemText primary={sub.Name} />\r\n                              </Button>\r\n                            </ListItem>\r\n                          );\r\n                        })}\r\n                      </List>\r\n                    </Grid>\r\n                  )}\r\n                  {references.length > 0 && (\r\n                    <Grid item>\r\n                      <List>\r\n                        <ListItem>\r\n                          <ListItemText primary={\"Referenced in:\"} />\r\n                        </ListItem>\r\n                        {references.map((type, i) => {\r\n                          return (\r\n                            <ListItem key={i}>\r\n                              <Button\r\n                                fullWidth\r\n                                variant=\"contained\"\r\n                                color=\"primary\"\r\n                                onClick={(_) => {\r\n                                  this.setState({\r\n                                    redirectTo: `/type/details/${type._id}`,\r\n                                  });\r\n                                }}\r\n                              >\r\n                                <ListItemText primary={type.Name} />\r\n                              </Button>\r\n                            </ListItem>\r\n                          );\r\n                        })}\r\n                      </List>\r\n                    </Grid>\r\n                  )}\r\n                  {this.props.instances.length > 0 && (\r\n                    <Grid item>\r\n                      <List>\r\n                        <ListItem>\r\n                          <ListItemText primary={\"Instances\"} />\r\n                        </ListItem>\r\n                        {this.props.instances.map((thing, i) => {\r\n                          return (\r\n                            <ListItem key={i}>\r\n                              <Button\r\n                                fullWidth\r\n                                variant=\"contained\"\r\n                                color=\"primary\"\r\n                                onClick={(_) => {\r\n                                  this.setState({\r\n                                    redirectTo: `/thing/details/${thing._id}`,\r\n                                  });\r\n                                }}\r\n                              >\r\n                                <ListItemText primary={thing.Name} />\r\n                              </Button>\r\n                            </ListItem>\r\n                          );\r\n                        })}\r\n                      </List>\r\n                    </Grid>\r\n                  )}\r\n                </Grid>\r\n              </Grid>\r\n              <Grid item xs={12}>\r\n                <CommentsControl \r\n                  user={this.props.user} \r\n                  object={this.props.selectedType}\r\n                  objectType=\"Type\"\r\n                  world={this.props.selectedWorld}\r\n                  api={this.api} \r\n                  onChange={this.commentsChange}\r\n                /> \r\n              </Grid>\r\n              <Modal\r\n                aria-labelledby=\"delete-type-modal\"\r\n                aria-describedby=\"delete-type-modal-description\"\r\n                open={this.state.modalOpen}\r\n                onClose={(e) => {\r\n                  this.setState({ modalOpen: false });\r\n                }}\r\n              >\r\n                <div style={this.getModalStyle()} className=\"paper\">\r\n                  <Grid container spacing={1} direction=\"column\">\r\n                    <Grid item>\r\n                      Are you sure you want to delete{\" \"}\r\n                      {this.props.selectedType.Name}?\r\n                    </Grid>\r\n                    <Grid item>\r\n                      (All references to it will be left alone and may not work\r\n                      correctly)\r\n                    </Grid>\r\n                    <Grid item container spacing={1} direction=\"row\">\r\n                      <Grid item xs={6}>\r\n                        <Button\r\n                          fullWidth\r\n                          variant=\"contained\"\r\n                          color=\"primary\"\r\n                          onClick={this.delete}\r\n                        >\r\n                          Yes\r\n                        </Button>\r\n                      </Grid>\r\n                      <Grid item xs={6}>\r\n                        <Button\r\n                          fullWidth\r\n                          variant=\"contained\"\r\n                          onClick={(e) => {\r\n                            this.setState({ modalOpen: false });\r\n                          }}\r\n                        >\r\n                          Cancel\r\n                        </Button>\r\n                      </Grid>\r\n                    </Grid>\r\n                  </Grid>\r\n                </div>\r\n              </Modal>\r\n            </div>\r\n          )}\r\n        </Grid>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst TypeDetails = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default TypeDetails;\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\nimport FormControl from \"@material-ui/core/FormControl\";\r\nimport OutlinedInput from \"@material-ui/core/OutlinedInput\";\r\nimport InputLabel from \"@material-ui/core/InputLabel\";\r\nimport {Delete} from \"@material-ui/icons\";\r\nimport {Fab, Tooltip} from \"@material-ui/core\";\r\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport Select from '@material-ui/core/Select';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport ChipInput from \"material-ui-chip-input\";\r\n\r\nconst handleTypeChange = (e, props) => {\r\n  const attr = props.attribute;\r\n  attr[\"AttributeType\"] = e.target.value;\r\n  attr[\"ListType\"] = \"Text\";\r\n  props.onChange(attr);\r\n};\r\n\r\nconst handleDefinedTypeChange = (e, props) => {\r\n  const attr = props.attribute;\r\n  attr[\"DefinedType\"] = e.target.value;\r\n  if (e.target.value === \"new\") {\r\n    // function respond(newType) {\r\n    //   attr[\"DefinedType\"] = newType._id;\r\n    //   props.onChange(attr);\r\n    // }\r\n    // props.onNewType(respond);\r\n    props.onNewType(attr);\r\n  }\r\n  else \r\n    props.onChange(attr);\r\n};\r\n\r\nconst handleListTypeChange = (e, props) => {\r\n  const attr = props.attribute;\r\n  attr[\"ListType\"] = e.target.value;\r\n  props.onChange(attr);\r\n};\r\n\r\nconst handleOptionsChange = (e, props) => {\r\n  const attr = props.attribute;\r\n  attr.Options = e;\r\n  props.onChange(attr);\r\n};\r\n\r\nexport default function AttributeControl(props) {\r\n  const [name, changeName] = useState(props.attribute.Name);\r\n\r\n  const attributeTypes = [\r\n    \"Text\",\r\n    \"Number\",\r\n    \"True/False\",\r\n    \"Options\", \r\n    \"Type\", \r\n    \"List\"\r\n  ];\r\n  const listTypes = [\r\n    \"Text\",\r\n    \"Options\", \r\n    \"Type\"\r\n  ];\r\n\r\n  const selectedType =\r\n    props.attribute.AttributeType === undefined || props.attribute.AttributeType === null || props.attribute.AttributeType === \"\" ? attributeTypes[0] : props.attribute.AttributeType;\r\n\r\n  const selectedListType =\r\n    props.attribute.ListType === undefined || props.attribute.ListType === \"\" ? listTypes[0] : props.attribute.ListType;\r\n\r\n  const selectedDefinedType =\r\n    props.attribute.DefinedType === undefined || props.attribute.DefinedType === \"\" ? \"\" : props.attribute.DefinedType;\r\n\r\n  let fromTypes = props.attribute.FromTypeIDs === undefined ? [] : props.types.filter(t=> props.attribute.FromTypeIDs.includes(t._id));\r\n\r\n  return (\r\n    <Grid container spacing={1} direction=\"row\">\r\n      <Grid item sm={3} xs={12}>\r\n        <FormControl variant=\"outlined\" fullWidth>\r\n          <InputLabel htmlFor={`AttrName_${props.attribute.attrID}_${props.attribute.index}`}>Name</InputLabel>\r\n          <OutlinedInput\r\n            disabled={props.disabled}\r\n            id={`AttrName_${props.attribute.attrID}_${props.attribute.index}`}\r\n            name={`AttrName_${props.attribute.attrID}_${props.attribute.index}`}\r\n            type=\"text\"\r\n            error={props.error}\r\n            value={name}\r\n            autoComplete=\"off\"\r\n            onChange={e => {\r\n              changeName(e.target.value);\r\n            }}\r\n            onBlur={e => {\r\n              const attr = props.attribute;\r\n              attr.Name = name;\r\n              // const attr = {\r\n              //   index: props.attribute.index,\r\n              //   Name: name,\r\n              //   Type: props.attribute.AttributeType,\r\n              //   Options: props.attribute.Options,\r\n              //   ListType: props.attribute.ListType,\r\n              //   FromSupers: props.attribute.FromSupers,\r\n              //   DefinedType: props.attribute.DefinedType,\r\n              //   AttributeTypes: props.attribute.AttributeTypes,\r\n              //   DefaultValue: defaultValue,\r\n              //   DefaultListValues: defaultListValues\r\n              // };\r\n              props.onChange(attr);\r\n            }}\r\n            labelWidth={43}\r\n            fullWidth\r\n          />\r\n          <FormHelperText>{props.message}</FormHelperText>\r\n        </FormControl>\r\n      </Grid>\r\n      <Grid item sm={3} xs={12}>\r\n        <FormControl variant=\"outlined\" fullWidth>\r\n          <InputLabel htmlFor=\"attribute-type\" id=\"attribute-type-label\">\r\n            Attribute Type\r\n          </InputLabel>\r\n          <Select\r\n            labelId=\"attribute-type-label\"\r\n            id=\"attribute-type\"\r\n            disabled={props.disabled}\r\n            // disabled={props.attribute.FromSupers.length > 0} \r\n            value={selectedType}\r\n            onChange={e => {handleTypeChange(e, props)}}\r\n            fullWidth\r\n            labelWidth={100}\r\n          >\r\n            {attributeTypes.map((type, i) => {\r\n              return (<MenuItem key={i} value={type}>{type}</MenuItem>);\r\n            })}\r\n          </Select>\r\n        </FormControl>\r\n      </Grid>\r\n      <Grid item sm={3} xs={12}>\r\n        {selectedType === \"Options\" ? (\r\n          <ChipInput\r\n            variant=\"outlined\"\r\n            disabled={props.disabled}\r\n            // disabled={props.attribute.FromSupers.length > 0}\r\n            defaultValue={props.attribute.Options}\r\n            onChange={chips => handleOptionsChange(chips, props)}\r\n          />\r\n        ) : selectedType === \"Type\" ? (\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor=\"definedType\" id=\"definedType-label\">\r\n              Defined Type\r\n            </InputLabel>\r\n            <Select\r\n              labelId=\"definedType-label\"\r\n              id=\"definedType\"\r\n              disabled={props.disabled}\r\n              // disabled={props.attribute.FromSupers.length > 0} \r\n              value={selectedDefinedType}\r\n              onChange={e => {handleDefinedTypeChange(e, props)}}\r\n              fullWidth\r\n              labelWidth={100}\r\n            >\r\n              <MenuItem value=\"new\">+ Create New Type</MenuItem>\r\n              {props.types.map((type, i) => {\r\n                return (<MenuItem key={i} value={type._id}>{type.Name}</MenuItem>);\r\n              })}\r\n            </Select>\r\n          </FormControl>\r\n        ) : selectedType === \"List\" ? (\r\n          <Grid container spacing={1} direction=\"column\">\r\n            <Grid item>\r\n              <FormControl variant=\"outlined\" fullWidth>\r\n                <InputLabel htmlFor=\"list-type\" id=\"list-type-label\">\r\n                  List Type\r\n                </InputLabel>\r\n                <Select\r\n                  labelId=\"list-type-label\"\r\n                  id=\"list-type\"\r\n                  disabled={props.disabled}\r\n                  // disabled={props.attribute.FromSupers.length > 0} \r\n                  value={selectedListType}\r\n                  onChange={e => {handleListTypeChange(e, props)}}\r\n                  fullWidth\r\n                  labelWidth={70}\r\n                >\r\n                  {listTypes.map((type, i) => {\r\n                    return (<MenuItem key={i} value={type}>{type}</MenuItem>);\r\n                  })}\r\n                </Select>\r\n              </FormControl>\r\n            </Grid>\r\n            { props.attribute.ListType === \"Type\" ? \r\n              (\r\n                <Grid item>\r\n                  <FormControl variant=\"outlined\" fullWidth>\r\n                    <InputLabel htmlFor=\"definedType\" id=\"definedType-label\">\r\n                      Defined Type\r\n                    </InputLabel>\r\n                    <Select\r\n                      labelId=\"definedType-label\"\r\n                      id=\"definedType\"\r\n                      disabled={props.disabled}\r\n                      // disabled={props.attribute.FromSupers.length > 0} \r\n                      value={selectedDefinedType}\r\n                      onChange={e => {handleDefinedTypeChange(e, props)}}\r\n                      fullWidth\r\n                      labelWidth={100}\r\n                    >\r\n                      <MenuItem value=\"new\">+ Create New Type</MenuItem>\r\n                      {props.types.map((type, i) => {\r\n                        return (<MenuItem key={i} value={type._id}>{type.Name}</MenuItem>);\r\n                      })}\r\n                    </Select>\r\n                  </FormControl>\r\n                </Grid>\r\n              ) : props.attribute.ListType === \"Options\" ?\r\n              (\r\n                <Grid item>\r\n                  <ChipInput\r\n                    variant=\"outlined\"\r\n                    disabled={props.disabled}\r\n                    // disabled={props.attribute.FromSupers.length > 0}\r\n                    defaultValue={props.attribute.Options}\r\n                    onChange={chips => handleOptionsChange(chips, props)}\r\n                  />\r\n                </Grid>\r\n              ) : \"\"\r\n            }\r\n          </Grid>\r\n        ) : (\r\n          \"\"\r\n        )}\r\n      </Grid>\r\n      <Grid item xs={3}>\r\n        { fromTypes.length === 1 ? \r\n          `From Type: ${fromTypes[0].Name}`\r\n        : fromTypes.length > 1 ?\r\n          <span>\r\n            From Types: \r\n            { fromTypes.map((type, i) => {\r\n              return (<span key={i}>{i > 0 && \", \"}{type.Name}</span>)\r\n            })}\r\n          </span>\r\n        : \r\n          <Tooltip title={`Delete Attribute`}>\r\n            <Fab size=\"small\"\r\n              color=\"primary\"\r\n              // disabled={props.disabled}\r\n              // disabled={props.attribute.FromSupers.length > 0}\r\n              onClick={_ => props.onDelete(props.attribute)}\r\n            >\r\n              <Delete />\r\n            </Fab>\r\n          </Tooltip>\r\n        }\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n}\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\n\r\nimport {\r\n  Grid,\r\n  FormControl,\r\n  OutlinedInput,\r\n  InputLabel,\r\n  FormControlLabel,\r\n  FormHelperText,\r\n  Select,\r\n  MenuItem,\r\n  Checkbox\r\n} from \"@material-ui/core\";\r\n\r\nimport ChipInput from \"material-ui-chip-input\";\r\nimport { Multiselect } from \"multiselect-react-dropdown\";\r\n\r\nconst handleTextListChange = (e, props) => {\r\n  const def = props.def;\r\n  def.DefaultListValues = e;\r\n  props.onChange(def);\r\n};\r\nconst handleDefinedTypeChange = (e, props) => {\r\n  const attr = props.attribute;\r\n  if (e.target.value === \"new\") {\r\n    // function respond2(newThing) {\r\n    //   // attr[\"DefinedType\"] = newType._id;\r\n    //   // props.onChange(attr);\r\n    //   const def = props.def;\r\n    //   def.DefaultValue = newThing._id;\r\n    //   props.onChange(def);\r\n    //   respond(newThing._id);\r\n    // }\r\n    // const attr = props.attribute;\r\n    props.onNewThing(\r\n      // respond2,\r\n      attr,\r\n      // props.types.filter(t => t._id === props.attribute.DefinedType)[0]\r\n    );\r\n  } else {\r\n    attr[\"DefaultValue\"] = e.target.value;\r\n    props.onChange(attr);\r\n    // respond(e.target.value);\r\n  }\r\n};\r\nconst addOption = (selectedItem, props) => {\r\n  const def = props.def;\r\n  def.DefaultListValues.push(selectedItem.Name);\r\n  props.onChange(def);\r\n};\r\nconst removeOption = (selectedList, props) => {\r\n  const def = props.def;\r\n  def.DefaultListValues = [];\r\n  selectedList.forEach(o => {\r\n    def.DefaultListValues.push(o.Name);\r\n  });\r\n  props.onChange(def);\r\n};\r\nconst addThingOfType = (selectedItem, props) => {\r\n  if (selectedItem._id === \"new\") {\r\n    // function respond2(newThing) {\r\n    //   const def = props.def;\r\n    //   def.DefaultListValues.push(newThing._id);\r\n    //   props.onChange(def);\r\n    // }\r\n    // props.onNewThing(\r\n    //   respond2,\r\n      \r\n    // );\r\n    // function respond(newThing) {\r\n    //   const def = props.def;\r\n    //   def.DefaultListValues.push(newThing._id);\r\n    //   props.onChange(def);\r\n    // }\r\n    setTimeout(() => {\r\n      const attr = props.attribute;\r\n      // const thingType = props.types.filter(t => t._id === props.attribute.DefinedType)[0];\r\n      props.onNewThing(attr);// , thingType);\r\n    }, 500);\r\n  } else {\r\n    const def = props.def;\r\n    def.DefaultListValues.push(selectedItem._id);\r\n    props.onChange(def);\r\n  }\r\n};\r\nconst removeType = (selectedList, props) => {\r\n  const def = props.def;\r\n  def.DefaultListValues = [];\r\n  selectedList.forEach(o => {\r\n    def.DefaultListValues.push(o._id);\r\n  });\r\n  props.onChange(def);\r\n};\r\n\r\nexport default function AttributeDefaultControl(props) {\r\n  // I'm passing in attribute and def.\r\n  const [value, changeValue] = useState(props.def.DefaultValue);\r\n  const attributeType = props.attribute.AttributeType === \"\" ? \"Text\" : props.attribute.AttributeType;\r\n  \r\n  const selectedTypeValue = attributeType !== \"Type\" ? \"\" :\r\n    (props.def.DefaultValue === undefined || props.def.DefaultValue === \"\" ? \"\" : props.def.DefaultValue);\r\n  \r\n  const listOptions = [];\r\n  const listOptionValues = [];\r\n  if (attributeType === \"List\" && props.attribute.ListType === \"Options\") {\r\n    props.attribute.Options.forEach(o => {\r\n      listOptions.push({ Name: o });\r\n    });\r\n    props.def.DefaultListValues.forEach(o => {\r\n      listOptionValues.push({ Name: o });\r\n    });\r\n  } else if (attributeType === \"List\" && props.attribute.ListType === \"Type\") {\r\n    const definedType = props.types.filter(t => t._id === props.attribute.DefinedType)[0];\r\n    listOptions.push({ Name: `+ Create New ${definedType.Name}`, _id: \"new\" });\r\n    props.things\r\n      .filter(t => t.TypeIDs.includes(props.attribute.DefinedType))\r\n      .forEach(t => {\r\n        listOptions.push({ Name: t.Name, _id: t._id });\r\n      });\r\n    listOptions\r\n      .filter(t => props.def.DefaultListValues.includes(t._id))\r\n      .forEach(t => {\r\n        listOptionValues.push(t);\r\n      });\r\n  }\r\n\r\n  return (\r\n    <Grid container spacing={1} direction=\"row\">\r\n      <Grid item xs={12}>\r\n        {attributeType === \"Text\" ? (\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor={`attribute_name_${props.attribute.attrID}`}>{props.attribute.Name} Default Value</InputLabel>\r\n            <OutlinedInput\r\n              id={`attribute_name_${props.attribute.attrID}`}\r\n              name={`attribute_name_${props.attribute.attrID}`}\r\n              type=\"text\"\r\n              error={props.error}\r\n              value={value}\r\n              autoComplete=\"off\"\r\n              onChange={e => {\r\n                changeValue(e.target.value);\r\n              }}\r\n              onBlur={e => {\r\n                const def = props.def;\r\n                def.DefaultValue = value;\r\n                props.onChange(def);\r\n              }}\r\n              labelWidth={props.attribute.Name.length * 9 + 100}\r\n              fullWidth\r\n            />\r\n            <FormHelperText>{props.message}</FormHelperText>\r\n          </FormControl>\r\n        ) : attributeType === \"Number\" ? (\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor=\"numField\">{props.attribute.Name} Default Value</InputLabel>\r\n            <OutlinedInput\r\n              id=\"numField\"\r\n              name=\"numField\"\r\n              type=\"number\"\r\n              error={props.error}\r\n              value={value}\r\n              autoComplete=\"off\"\r\n              onChange={e => {\r\n                changeValue(e.target.value);\r\n              }}\r\n              onBlur={e => {\r\n                const def = props.def;\r\n                def.DefaultValue = value;\r\n                props.onChange(def);\r\n              }}\r\n              labelWidth={props.attribute.Name.length * 9 + 100}\r\n              fullWidth\r\n            />\r\n            <FormHelperText>{props.message}</FormHelperText>\r\n          </FormControl>\r\n        ) : attributeType === \"True/False\" ? (\r\n          <FormControlLabel\r\n            control={\r\n              <Checkbox checked={props.def.DefaultValue===\"True\"} onChange={e => {\r\n                const def = props.def;\r\n                def.DefaultValue = e.target.checked ? \"True\" : \"False\";\r\n                props.onChange(def);\r\n              }}\r\n              color=\"primary\" />\r\n            }\r\n            label={`${props.attribute.Name} Default True`}\r\n          />\r\n        ) : attributeType === \"Options\" ? (\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor=\"options-select\" id=\"options-select-label\">\r\n              {props.attribute.Name} Default Value\r\n            </InputLabel>\r\n            <Select\r\n              labelId=\"options-select-label\"\r\n              id=\"options-select\"\r\n              value={value}\r\n              onChange={e => {\r\n                changeValue(e.target.value);\r\n              }}\r\n              onBlur={e => {\r\n                const def = props.def;\r\n                def.DefaultValue = value;\r\n                props.onChange(def);\r\n              }}\r\n              fullWidth\r\n              labelWidth={props.attribute.Name.length * 9 + 100}\r\n            >\r\n              {props.attribute.Options.map((option, i) => {\r\n                return (\r\n                  <MenuItem key={i} value={option}>\r\n                    {option}\r\n                  </MenuItem>\r\n                );\r\n              })}\r\n            </Select>\r\n          </FormControl>\r\n        ) : attributeType === \"Type\" ? (\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor=\"type-select\" id=\"type-select-label\">\r\n              {props.attribute.Name} Default Value\r\n            </InputLabel>\r\n            <Select\r\n              labelId=\"type-select-label\"\r\n              id=\"type-select\"\r\n              value={selectedTypeValue}\r\n              onChange={e => {\r\n                handleDefinedTypeChange(e, props);\r\n              }}\r\n              // onBlur={e => {\r\n              //   const def = props.def;\r\n              //   def.DefaultValue = value;\r\n              //   props.onChange(def);\r\n              // }}\r\n              fullWidth\r\n              labelWidth={props.attribute.Name.length * 9 + 100}\r\n            >\r\n              <MenuItem value=\"new\">\r\n                + Create New{\" \"}\r\n                {props.types.filter(t => t._id === props.attribute.DefinedType)[0].Name}\r\n              </MenuItem>\r\n              {props.things\r\n                .filter(t => t.TypeIDs.includes(props.attribute.DefinedType))\r\n                .map((thing, i) => {\r\n                  return (\r\n                    <MenuItem key={i} value={thing._id}>\r\n                      {thing.Name}\r\n                    </MenuItem>\r\n                  );\r\n                })}\r\n            </Select>\r\n          </FormControl>\r\n        ) : attributeType === \"List\" ? (\r\n          <span>\r\n            {props.attribute.ListType === \"Text\" ? (\r\n              <ChipInput\r\n                placeholder={`${props.attribute.Name} Default Values`}\r\n                variant=\"outlined\"\r\n                defaultValue={props.def.DefaultListValues}\r\n                onChange={chips => handleTextListChange(chips, props)}\r\n              />\r\n            ) : props.attribute.ListType === \"Options\" ? (\r\n              <Multiselect\r\n                placeholder={`${props.attribute.Name} Default Values`}\r\n                options={listOptions}\r\n                selectedValues={listOptionValues}\r\n                onSelect={(_, selectedItem) => {\r\n                  addOption(selectedItem, props);\r\n                }}\r\n                onRemove={(selectedList, _) => {\r\n                  removeOption(selectedList, props);\r\n                }}\r\n                displayValue=\"Name\"\r\n              />\r\n            ) : props.attribute.ListType === \"Type\" ? (\r\n              <Multiselect\r\n                placeholder={`${props.attribute.Name} Default Values`}\r\n                options={listOptions}\r\n                selectedValues={listOptionValues}\r\n                onSelect={(_, selectedItem) => {\r\n                  addThingOfType(selectedItem, props);\r\n                }}\r\n                onRemove={(selectedList, _) => {\r\n                  removeType(selectedList, props);\r\n                }}\r\n                displayValue=\"Name\"\r\n              />\r\n            ) : (\r\n              \"\"\r\n            )}\r\n          </span>\r\n        ) : (\r\n          \"\"\r\n        )}\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport List from \"@material-ui/core/List\";\r\nimport ListItem from \"@material-ui/core/ListItem\";\r\nimport uuid from 'react-uuid';\r\nimport {\r\n  updateSelectedType,\r\n  addType,\r\n  addThing\r\n} from \"../../redux/actions/index\";\r\nimport AttributeControl from \"./AttributeControl\";\r\nimport AttributeDefaultControl from \"./AttributeDefaultControl\";\r\nimport API from \"../../smartAPI\";\r\n\r\n// It will let you add and remove attributes.\r\n// Each needs to have a unique name as part of validation.\r\n// Each also needs to have a valid type.\r\n// The type can be string, integer, double, enum, any Type\r\n// already defined for this world, or a list of any of the\r\n// other types.\r\n// In future versions I will add support for additional types:\r\n// Color, DateTime, Schedule.\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedType: state.app.selectedType,\r\n    // attributesArr: state.app.attributesArr,\r\n    types: state.app.types,\r\n    things: state.app.things,\r\n    selectedWorldID: state.app.selectedWorldID\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    updateSelectedType: type => dispatch(updateSelectedType(type)),\r\n    // updateAttributesArr: arr => dispatch(updateAttributesArr(arr)),\r\n    addType: type => dispatch(addType(type)),\r\n    addThing: thing => dispatch(addThing(thing))\r\n  };\r\n}\r\nclass Control extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      message: \"\",\r\n      waiting: false,\r\n      defaultsMode: false\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  newAttribute = () => {\r\n    const type = this.props.selectedType;\r\n    type.AttributesArr.push({\r\n      index: type.AttributesArr.length,\r\n      attrID: `null_${uuid()}`,\r\n      Name: \"\",\r\n      AttributeType: \"Text\",\r\n      Options: [],\r\n      DefinedType: \"\",\r\n      ListType: \"\"\r\n    });\r\n    this.props.updateSelectedType(type);\r\n  }\r\n\r\n  changeAttribute = value => {\r\n    const type = this.props.selectedType;\r\n    type.AttributesArr[value.index] = {\r\n      index: value.index,\r\n      attrID: value.attrID,\r\n      Name: value.Name,\r\n      AttributeType: value.AttributeType,\r\n      Options: value.Options,\r\n      DefinedType: value.DefinedType,\r\n      ListType: value.ListType,\r\n    };\r\n    this.props.updateSelectedType(type);\r\n  }\r\n\r\n  changeDefault = value => {\r\n    const type = this.props.selectedType;\r\n    type.DefaultsHash[value.attrID] = {\r\n      attrID: value.attrID,\r\n      DefaultValue: value.DefaultValue,\r\n      DefaultListValues: value.DefaultListValues,\r\n      FromTypeIDs: value.FromTypeIDs\r\n    };\r\n    this.props.updateSelectedType(type);\r\n  }\r\n\r\n  blurAttribute = e => {\r\n  }\r\n\r\n  deleteAttribute = value => {\r\n    const type = this.props.selectedType;\r\n    const attributes = [];\r\n    type.AttributesArr.forEach(t => {\r\n      if (t.index !== value.index) {\r\n        if (t.index > value.index)\r\n          t.index--;\r\n        attributes.push(t);\r\n      }\r\n    });\r\n    type.AttributesArr = [];\r\n    let defaults = {...type.DefaultsHash};\r\n    if (defaults[value.attrID] !== undefined) {\r\n      delete defaults[value.attrID];\r\n    }\r\n    type.DefaultsHash = {};\r\n    this.props.updateSelectedType(type);\r\n    setTimeout(() => {\r\n      type.AttributesArr = attributes;\r\n      type.DefaultsHash = defaults;\r\n      this.props.updateSelectedType(type);\r\n    }, 500);\r\n  }\r\n\r\n  addNewType = (attribute) => {\r\n    this.props.addNewType(attribute);\r\n  }\r\n\r\n  addNewThing = (attribute) => {\r\n    this.props.addNewThing(attribute);\r\n  }\r\n\r\n  render() {\r\n    // I should move this somewhere else so it's not happening on every render.\r\n    const inheritedAttributes = [];\r\n    this.props.selectedType.SuperIDs.forEach(s => {\r\n      let superType = this.props.types.filter(t => t._id === s);\r\n      if (superType.length > 0) {\r\n        superType = superType[0];\r\n        superType.AttributesArr.forEach(attribute => {\r\n          let inheritedAttribute = inheritedAttributes.filter(a=>a.attrID === attribute.attrID);\r\n          if (inheritedAttribute.length === 0) {\r\n            attribute.FromTypeIDs = [superType._id];\r\n            inheritedAttributes.push(attribute);\r\n          }\r\n          else {\r\n            inheritedAttribute = inheritedAttribute[0];\r\n            inheritedAttribute.FromTypeIDs.push(superType._id);\r\n          }\r\n        });\r\n      }\r\n    });\r\n    return (\r\n      <Grid item xs={12} container spacing={0} direction=\"column\">\r\n        <Grid item>\r\n          <List>\r\n            { this.props.selectedType !== null && this.props.selectedType !== undefined &&\r\n              inheritedAttributes.map((attribute, i) => {\r\n                let def = this.props.selectedType.DefaultsHash[attribute.attrID];\r\n                if (def === undefined)\r\n                  def = { attrID: attribute.attrID, DefaultValue: \"\", DefaultListValues: [] };\r\n                return (\r\n                  <ListItem key={i}>\r\n                    { this.props.defaultsMode ? \r\n                      <AttributeDefaultControl\r\n                        typeID={this.props.selectedType._id}\r\n                        attribute={attribute}\r\n                        def={def}\r\n                        onChange={this.changeDefault}\r\n                        // onBlur={this.blurAttribute}\r\n                        types={this.props.types}\r\n                        things={this.props.things}\r\n                        onNewThing={this.addNewThing}\r\n                      /> : \r\n                      <AttributeControl\r\n                        typeID={this.props.selectedType._id}\r\n                        disabled={true}\r\n                        attribute={attribute}\r\n                        // onChange={this.changeAttribute}\r\n                        // onDelete={this.deleteAttribute}\r\n                        // onBlur={this.blurAttribute}\r\n                        types={this.props.types}\r\n                        things={this.props.things}\r\n                        onNewType={this.addNewType}\r\n                      /> \r\n                    }\r\n                  </ListItem>\r\n                );\r\n              })\r\n            }\r\n            { this.props.selectedType !== null && this.props.selectedType !== undefined &&\r\n              this.props.selectedType.AttributesArr.map((attribute, i) => {\r\n                let def = this.props.selectedType.DefaultsHash[attribute.attrID];\r\n                if (def === undefined)\r\n                  def = { attrID: attribute.attrID, DefaultValue: \"\", DefaultListValues: [] };\r\n                \r\n                return (\r\n                  <ListItem key={i}>\r\n                    { this.props.defaultsMode ? \r\n                      <AttributeDefaultControl\r\n                        typeID={this.props.selectedType._id}\r\n                        attribute={attribute}\r\n                        def={def}\r\n                        onChange={this.changeDefault}\r\n                        onBlur={this.blurAttribute}\r\n                        types={this.props.types}\r\n                        things={this.props.things}\r\n                        onNewThing={this.addNewThing}\r\n                      /> : \r\n                      <AttributeControl\r\n                        typeID={this.props.selectedType._id}\r\n                        attribute={attribute}\r\n                        onChange={this.changeAttribute}\r\n                        onDelete={this.deleteAttribute}\r\n                        onBlur={this.blurAttribute}\r\n                        types={this.props.types}\r\n                        things={this.props.things}\r\n                        onNewType={this.addNewType}\r\n                      /> \r\n                    }\r\n                  </ListItem>\r\n                );\r\n              })\r\n            }\r\n          </List>\r\n        </Grid>\r\n      </Grid>\r\n    );\r\n  }\r\n}\r\n\r\nconst AttributesControl = connect(mapStateToProps, mapDispatchToProps)(Control);\r\nexport default AttributesControl;\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\n\r\nimport {\r\n  Grid,\r\n  FormControl,\r\n  OutlinedInput,\r\n  InputLabel,\r\n  FormHelperText,\r\n  // Modal,\r\n  Button,\r\n} from \"@material-ui/core\";\r\n\r\n// const getModalStyle = () => {\r\n//   const top = Math.round(window.innerHeight / 2) - 100;\r\n//   const left = Math.round(window.innerWidth / 2) - 200;\r\n\r\n//   return {\r\n//     top: `${top}%`,\r\n//     left: `${left}%`,\r\n//     transform: `translate(${left}px, ${top}px)`,\r\n//   };\r\n// };\r\n\r\nconst validate = (value, props, changeMessage) => {\r\n  const valid = props.types.filter((t) => t.Name === value).length === 0;\r\n  changeMessage(valid ? \"\" : \"This Type Name is already in use\");\r\n};\r\n\r\nconst saveNewType = (value, props, changeName, changeMessage, changeWaiting) => {\r\n  // if (props.onSave !== undefined && props.onSave !== null)\r\n  //   props.onSave();\r\n\r\n  const type = {\r\n    _id: null,\r\n    Name: value.trim(),\r\n    Description: \"\",\r\n    SuperIDs: [],\r\n    AttributesArr: [],\r\n    Attributes: [],\r\n    worldID: props.selectedWorldID,\r\n    Major: false,\r\n  };\r\n\r\n  // Calls API\r\n  props.api\r\n    .createType(type)\r\n    .then((res) => {\r\n      if (res.typeID !== undefined) {\r\n        type._id = res.typeID;\r\n        type.Supers = [];\r\n        // Adds to redux\r\n        if (props.addType) props.addType(type);\r\n        // Calls respond back to Attribute to set the type\r\n\r\n        changeWaiting(false);\r\n        if (props.onSave) {\r\n          // setTimeout(() => {\r\n          changeName(\"\");\r\n          props.onSave(type);\r\n          // }, 500);\r\n        }\r\n        // this.state.modalSubmit(type);\r\n        // this.setState({\r\n        //   waiting: false,\r\n        //   typeModalOpen: false\r\n        // });\r\n      } else if (res.error !== undefined) {\r\n        // this.setState({\r\n        //   waiting: false,\r\n        //   message: res.error\r\n        // });\r\n        changeWaiting(false);\r\n        changeMessage(res.error);\r\n        props.logout();\r\n      }\r\n    })\r\n    .catch((err) => console.log(err));\r\n};\r\n\r\nexport default function NewTypeModal(props) {\r\n  const [name, changeName] = useState(\"\");\r\n  const [message, changeMessage] = useState(\"\");\r\n  const [waiting, changeWaiting] = useState(false);\r\n\r\n  return (\r\n    <Grid container spacing={1} direction=\"column\">\r\n      <Grid item>Just give the new Type a name.</Grid>\r\n      <Grid item>(You can do the rest later.)</Grid>\r\n      <Grid item>\r\n        <FormControl variant=\"outlined\" fullWidth>\r\n          <InputLabel htmlFor=\"name\">Name</InputLabel>\r\n          <OutlinedInput\r\n            id=\"name\"\r\n            name=\"Name\"\r\n            type=\"text\"\r\n            autoComplete=\"Off\"\r\n            error={message !== \"\"}\r\n            value={name}\r\n            onChange={(e) => {\r\n              changeName(e.target.value);\r\n            }}\r\n            onBlur={(e) => {\r\n              validate(name, props, changeMessage);\r\n            }}\r\n            labelWidth={43}\r\n            fullWidth\r\n          />\r\n          <FormHelperText>{message}</FormHelperText>\r\n        </FormControl>\r\n      </Grid>\r\n      <Grid item container spacing={1} direction=\"row\">\r\n        <Grid item xs={6}>\r\n          <Button\r\n            fullWidth\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            disabled={waiting}\r\n            onClick={(e) => {\r\n              changeWaiting(true);\r\n              saveNewType(name, props, changeName, changeMessage, changeWaiting);\r\n            }}\r\n          >\r\n            {waiting ? \"Please Wait\" : \"Submit\"}\r\n          </Button>\r\n        </Grid>\r\n        <Grid item xs={6}>\r\n          <Button\r\n            fullWidth\r\n            variant=\"contained\"\r\n            onClick={(e) => {\r\n              if (props.onCancel !== undefined && props.onCancel !== null)\r\n                props.onCancel();\r\n            }}\r\n          >\r\n            Cancel\r\n          </Button>\r\n        </Grid>\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n}\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\n\r\nimport {\r\n  Grid,\r\n  FormControl,\r\n  OutlinedInput,\r\n  InputLabel,\r\n  FormHelperText,\r\n  Button,\r\n} from \"@material-ui/core\";\r\n\r\n\r\nconst validate = (value, props, changeMessage) => {\r\n  const valid = props.things.filter((t) => t.Name === value).length === 0;\r\n  changeMessage(valid ? \"\" : \"This Thing Name is already in use\");\r\n};\r\n\r\nconst saveNewThing = (value, props, changeName, changeMessage, changeWaiting) => {\r\n  \r\n  changeWaiting(true);\r\n  const thing = {\r\n    _id: null,\r\n    Name: value.trim(),\r\n    Description: \"\",\r\n    TypeIDs: props.newThingType === undefined ? [] : [props.newThingType._id],\r\n    Attributes: [],\r\n    worldID: props.selectedWorldID,\r\n    ReferenceIDs: []\r\n  };\r\n\r\n  // Calls API\r\n  props.api\r\n    .createThing(thing)\r\n    .then((res) => {\r\n      if (res.thingID !== undefined) {\r\n        thing._id = res.thingID;\r\n        thing.Types = props.newThingType === undefined ? [] : [props.newThingType];\r\n        thing.AttributesArr = [];\r\n        // Adds to props \r\n        props.addThing(thing);\r\n        // Calls respond back to Attribute to set the thing\r\n        changeName(\"\");\r\n        changeWaiting(false);\r\n        props.onSave(thing);\r\n\r\n        // this.state.modalSubmit(thing);\r\n        // this.setState({\r\n        //   waiting: false, \r\n        //   thingModalOpen: false,\r\n        //   Name: \"\"\r\n        // });\r\n      }\r\n      else if (res.error !== undefined) {\r\n        // this.setState({\r\n        //   waiting: false, \r\n        //   message: res.error \r\n        // });\r\n        changeMessage(res.error);\r\n        changeWaiting(false);\r\n        props.logout();\r\n      }\r\n    })\r\n    .catch(err => console.log(err));\r\n};\r\n\r\nexport default function NewThingModal(props) {\r\n  const [name, changeName] = useState(\"\");\r\n  const [message, changeMessage] = useState(\"\");\r\n  const [waiting, changeWaiting] = useState(false);\r\n\r\n  return (\r\n    <Grid container spacing={1} direction=\"column\">\r\n      <Grid item>Just give the new {props.newThingType.Name === undefined ? \"Thing\" : props.newThingType.Name} a name.</Grid>\r\n      <Grid item>(You can do the rest later.)</Grid>\r\n      <Grid item>\r\n        <FormControl variant=\"outlined\" fullWidth>\r\n          <InputLabel htmlFor=\"name\">Name</InputLabel>\r\n          <OutlinedInput\r\n            id=\"name\"\r\n            name=\"Name\"\r\n            type=\"text\"\r\n            autoComplete=\"Off\"\r\n            error={message !== \"\"}\r\n            value={name}\r\n            onChange={(e) => {\r\n              changeName(e.target.value);\r\n            }}\r\n            onBlur={(e) => {\r\n              validate(name, props, changeMessage);\r\n            }}\r\n            labelWidth={43}\r\n            fullWidth\r\n          />\r\n          <FormHelperText>{message}</FormHelperText>\r\n        </FormControl>\r\n      </Grid>\r\n      <Grid item container spacing={1} direction=\"row\">\r\n        <Grid item xs={6}>\r\n          <Button\r\n            fullWidth\r\n            variant=\"contained\"\r\n            color=\"primary\"\r\n            disabled={waiting}\r\n            onClick={(e) => {\r\n              changeWaiting(true);\r\n              saveNewThing(name, props, changeName, changeMessage, changeWaiting);\r\n            }}\r\n          >\r\n            {waiting ? \"Please Wait\" : \"Submit\"}\r\n          </Button>\r\n        </Grid>\r\n        <Grid item xs={6}>\r\n          <Button\r\n            fullWidth\r\n            variant=\"contained\"\r\n            onClick={(e) => {\r\n              if (props.onCancel !== undefined && props.onCancel !== null)\r\n                props.onCancel();\r\n            }}\r\n          >\r\n            Cancel\r\n          </Button>\r\n        </Grid>\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport uuid from 'react-uuid';\r\nimport { ArrowBack, Add, Search } from \"@material-ui/icons\";\r\nimport { \r\n  Grid, Button, Checkbox, FormControl, FormControlLabel,\r\n  InputLabel, Tooltip, Fab,\r\n  Select, MenuItem,\r\n  ListItem, ListItemText\r\n} from \"@material-ui/core\";\r\nimport { Helmet } from 'react-helmet';\r\nimport { Multiselect } from 'multiselect-react-dropdown';\r\nimport AttributesControl from \"./AttributesControl\";\r\n// import AttributeControl from \"./AttributeControl\";\r\n// import AttributeDefaultControl from \"./AttributeDefaultControl\";\r\nimport {\r\n  updateSelectedType,\r\n  addType,\r\n  updateType,\r\n  addAttributes,\r\n  setAttributes,\r\n  setTypes,\r\n  setThings,\r\n  notFromLogin,\r\n  addThing,\r\n  toggleLogin,\r\n  logout\r\n} from \"../../redux/actions/index\";\r\nimport API from \"../../smartAPI\";\r\nimport TextBox from \"../../components/Inputs/TextBox\";\r\nimport NewTypeModal from \"../../components/Modals/NewTypeModal\";\r\nimport NewThingModal from \"../../components/Modals/NewThingModal\";\r\n\r\n/* \r\n  This component will take the main portion of the page and is used for\r\n  creating or editing a Type.  It will allow the use of Template Types\r\n  and Super Types to make the process faster.\r\n*/\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedPage: state.app.selectedPage,\r\n    selectedType: state.app.selectedType,\r\n    selectedWorld: state.app.selectedWorld,\r\n    selectedWorldID: state.app.selectedWorldID,\r\n    types: state.app.types,\r\n    things: state.app.things,\r\n    user: state.app.user,\r\n    attributesByID: state.app.attributesByID,\r\n    attributesByName: state.app.attributesByName,\r\n    fromLogin: state.app.fromLogin\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    updateSelectedType: type => dispatch(updateSelectedType(type)),\r\n    addType: type => dispatch(addType(type)),\r\n    updateType: type => dispatch(updateType(type)),\r\n    addAttributes: attrs => dispatch(addAttributes(attrs)),\r\n    setAttributes: attrs => dispatch(setAttributes(attrs)),\r\n    setTypes: types => dispatch(setTypes(types)),\r\n    setThings: things => dispatch(setThings(things)),\r\n    notFromLogin: () => dispatch(notFromLogin({})),\r\n    addThing: thing => dispatch(addThing(thing)),\r\n    toggleLogin: () => dispatch(toggleLogin({})),\r\n    logout: () => dispatch(logout({}))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      _id: undefined,\r\n      // Name: \"\",\r\n      // Description: \"\",\r\n      // Supers: [],\r\n      // Attributes: [],\r\n      Major: false,\r\n      fieldValidation: {\r\n        Name: { valid: true, message: \"\" },\r\n        AttributesArr: { valid: true, message: \"\" },\r\n        Attributes: { valid: true, message: \"\" }\r\n      },\r\n      formValid: false,\r\n      message: \"\",\r\n      redirectTo: null,\r\n      waiting: false,\r\n      addMore: \"\",\r\n      resetting: false,\r\n      browseAttributes: false,\r\n      browseAttributesSelected: \"\",\r\n      browseTypesSelected: \"\",\r\n      newThingType: {}\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  resetForm = () => {\r\n    setTimeout(() => {\r\n      let { id } = this.props.match.params;\r\n      if (id !== undefined) {\r\n        this.setState({\r\n          resetting: false, \r\n          loaded: true,\r\n          redirectTo: `/type/create`\r\n        });\r\n      }\r\n      else {\r\n        this.setState({\r\n          resetting: false,\r\n          loaded: true\r\n        });\r\n      }\r\n    }, 500);\r\n  }\r\n\r\n  // handleUserInput = e => {\r\n  //   const name = e.target.name;\r\n  //   const value =\r\n  //     e.target.type === \"checkbox\" ? e.target.checked : e.target.value;\r\n  //   this.setState({ [name]: value });\r\n  // };\r\n\r\n  inputBlur = e => {\r\n    const name = e.target.name;\r\n    const validation = this.validateField(name);\r\n    const fieldValidation = this.state.fieldValidation;\r\n    if (\r\n      fieldValidation[name] !== undefined &&\r\n      fieldValidation[name].valid !== validation.valid\r\n    ) {\r\n      fieldValidation[name].valid = validation.valid;\r\n      fieldValidation[name].message = validation.message;\r\n      this.setState({ fieldValidation: fieldValidation });\r\n    }\r\n  }\r\n\r\n  validateField = fieldName => {\r\n    let value = null;\r\n    let valid = true;\r\n    let message = \"\";\r\n    switch (fieldName) {\r\n      case \"Name\":\r\n        value = this.props.selectedType[fieldName];\r\n        valid = value.match(/^[a-zA-Z0-9 ]*$/i) !== null;\r\n        if (!valid)\r\n          message = \"Only Letters, Numbers, and Spaces allowed in Type Names\";\r\n        else if (value.length < 2) {\r\n          valid = false;\r\n          message = \"Type Name is too short\";\r\n        } else {\r\n          valid =\r\n            this.props.types.filter(\r\n              t => t.Name === value && t._id !== this.state._id\r\n            ).length === 0;\r\n          if (!valid) message = \"This Type Name is already in use\";\r\n        }\r\n        break;\r\n      case \"AttributesArr\":\r\n        valid = true;\r\n        value = this.props.selectedType[fieldName];\r\n        message = \"\";\r\n        for (let i = 0; i < value.length; i++) {\r\n          const attrByName = this.props.attributesByName[value[i].Name];\r\n          if (attrByName !== undefined && \r\n            attrByName._id !== value[i].attrID) {\r\n            valid = false;\r\n            message = `An attribute with the name '${value[i].Name}' already exists`;\r\n            break;\r\n          }\r\n          else if ((value[i].AttributeType === \"Type\" || (value[i].AttributeType === \"List\" && value[i].ListType === \"Type\")) && (value[i].DefinedType === undefined || value[i].DefinedType === null || value[i].DefinedType === \"\")) {\r\n            valid = false;\r\n            message = `A Defined Type must be selected for ${value[i].Name}.`;\r\n            break;\r\n          }\r\n          else if ((value[i].AttributeType === \"Options\" || (value[i].AttributeType === \"List\" && value[i].ListType === \"Options\")) && (value[i].Options === undefined || value[i].Options === null || value[i].Options.length === 0)) {\r\n            valid = false;\r\n            message = `At least one Option must be set for ${value[i].Name}.`;\r\n            break;\r\n          }\r\n        } \r\n        break;\r\n      case \"Attributes\":\r\n        valid = true;\r\n        value = this.props.selectedType[fieldName];\r\n        message = \"\";\r\n        for (let i = 0; i < value.length; i++) {\r\n          const attrByName = this.props.attributesByName[value[i].Name];\r\n          if (attrByName !== undefined && \r\n            attrByName._id !== value[i].attrID) {\r\n            valid = false;\r\n            message = `An attribute with this name already exists`;\r\n            break;\r\n          }\r\n          else if ((value[i].AttributeType === \"Type\" || (value[i].AttributeType === \"List\" && value[i].ListType === \"Type\")) && (value[i].DefinedType === undefined || value[i].DefinedType === null || value[i].DefinedType === \"\")) {\r\n            valid = false;\r\n            message = `A Defined Type must be selected for ${value[i].Name}.`;\r\n            break;\r\n          }\r\n          else if ((value[i].AttributeType === \"Options\" || (value[i].AttributeType === \"List\" && value[i].ListType === \"Options\")) && (value[i].Options === undefined || value[i].Options === null || value[i].Options.length === 0)) {\r\n            valid = false;\r\n            message = `At least one Option must be set for ${value[i].Name}.`;\r\n            break;\r\n          }\r\n        } \r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    const response = { valid: valid, message: message };\r\n    return response;\r\n  }\r\n\r\n  validateForm = respond => {\r\n    const nameValid = this.validateField(\"Name\");\r\n    const attrArrValid = this.validateField(\"AttributesArr\");\r\n    // const attrValid = this.validateField(\"Attributes\");\r\n    const formValid = nameValid.valid && attrArrValid.valid;\r\n    const fieldValidation = this.state.fieldValidation;\r\n    fieldValidation.Name = nameValid;\r\n    fieldValidation.AttributesArr = attrArrValid;\r\n    // fieldValidation.Attributes = attrValid;\r\n    this.setState(\r\n      {\r\n        formValid: formValid,\r\n        fieldValidation: fieldValidation\r\n      },\r\n      respond\r\n    );\r\n  }\r\n\r\n  onSubmit = (addMore) => {\r\n    function respond() {\r\n      if (this.state.formValid) {\r\n        this.setState({ waiting: true, addMore: addMore }, this.submitThroughAPI);\r\n      }\r\n    }\r\n\r\n    this.validateForm(respond);\r\n  }\r\n\r\n  submitThroughAPI = () => {\r\n    const superIDs = this.props.selectedType.Supers.map(s => {\r\n      return s._id;\r\n    });\r\n\r\n    const attributes = this.props.selectedType.AttributesArr.map(a => {\r\n      return {\r\n        _id: a.attrID,\r\n        Name: a.Name.trim(),\r\n        AttributeType: a.AttributeType,\r\n        Options: a.Options,\r\n        DefinedType: a.DefinedType,\r\n        ListType: a.ListType\r\n      };\r\n    });\r\n    \r\n    this.api.upsertAttributes(this.props.selectedWorldID, attributes).then(res => {\r\n      const typeAttributes = [];\r\n      this.props.selectedType.AttributesArr.forEach(a => {\r\n        const id = a.attrID.includes(\"null\") ? res.attributes[a.Name] : a.attrID;\r\n        typeAttributes.push({\r\n          attrID: id,\r\n          index: a.index,\r\n          // Name: a.Name,\r\n          // AttributeType: a.AttributeType,\r\n          // Options: a.Options,\r\n          // DefinedType: a.DefinedType,\r\n          // ListType: a.ListType\r\n        });\r\n      });\r\n\r\n      const type = {\r\n        _id: this.state._id,\r\n        Name: this.props.selectedType.Name.trim(),\r\n        PluralName: this.props.selectedType.PluralName === undefined ? \"\" : this.props.selectedType.PluralName.trim(),\r\n        Description: this.props.selectedType.Description,\r\n        SuperIDs: superIDs,\r\n        // AttributesArr: this.props.selectedType.AttributesArr,\r\n        Attributes: typeAttributes,\r\n        Defaults: [],\r\n        worldID: this.props.selectedWorld._id,\r\n        Major: this.props.selectedType.Major,\r\n        ReferenceIDs: [],\r\n        DefaultReferenceIDs: []\r\n      };\r\n      // this.props.selectedType.AttributesArr.filter(a=>a.AttributeType === \"Type\" || (a.AttributeType === \"List\" && a.ListType === \"Type\")).forEach(a=>{\r\n      //   if (!type.ReferenceIDs.includes(a.DefinedType)) {\r\n      //     type.ReferenceIDs.push(a.DefinedType);\r\n      //   }\r\n      // });\r\n      this.props.selectedType.AttributesArr.filter(a=>a.AttributeType === \"Type\" || (a.AttributeType === \"List\" && a.ListType === \"Type\")).forEach(a=>{\r\n        if (!type.ReferenceIDs.includes(a.DefinedType)) {\r\n          type.ReferenceIDs.push(a.DefinedType);\r\n        }\r\n      });\r\n      this.props.selectedType.Supers.forEach(s=> {\r\n        s.AttributesArr.filter(a=>a.AttributeType === \"Type\" || (a.AttributeType === \"List\" && a.ListType === \"Type\")).forEach(a=>{\r\n          if (!type.ReferenceIDs.includes(a.DefinedType)) {\r\n            type.ReferenceIDs.push(a.DefinedType);\r\n          }\r\n        });\r\n      });\r\n      Object.keys(this.props.selectedType.DefaultsHash).forEach(attrID => {\r\n        // There's the situation which can happen here where a default thing gets deleted (not removed as default).\r\n        // I really should filter it out, but it's not hurting anything for now, so I'm going to leave it.\r\n        const def = this.props.selectedType.DefaultsHash[attrID];\r\n        type.Defaults.push({\r\n          attrID, \r\n          FromTypeID: def.FromTypeID, \r\n          DefaultValue: def.DefaultValue, \r\n          DefaultListValues: def.DefaultListValues \r\n        });\r\n      });\r\n  \r\n      if (type._id === null) {\r\n        this.api\r\n          .createType(type)\r\n          .then(res => {\r\n            if (res.typeID !== undefined) {\r\n              this.api.getWorld(this.props.selectedWorldID, true).then(res2 => {\r\n                this.props.setAttributes(res2.attributes);\r\n                this.props.setTypes(res2.types);\r\n                this.props.setThings(res2.things);\r\n\r\n                if (this.state.addMore === \"add\") {\r\n                  this.props.updateSelectedType({\r\n                    _id: null,\r\n                    Name: \"\",\r\n                    PluralName: \"\",\r\n                    Description: \"\",\r\n                    Supers: [],\r\n                    SuperIDs: [],\r\n                    AttributesArr: [],\r\n                    Attributes: [],\r\n                    Major: false,\r\n                    DefaultsHash: {}\r\n                  });\r\n                  this.setState({\r\n                    _id: null,\r\n                    // Name: \"\",\r\n                    // Description: \"\",\r\n                    // Supers: [],\r\n                    // Attributes: [],\r\n                    // Major: false,\r\n                    fieldValidation: {\r\n                      Name: { valid: true, message: \"\" },\r\n                      AttributesArr: { valid: true, message: \"\" },\r\n                      Attributes: { valid: true, message: \"\" }\r\n                    },\r\n                    formValid: false,\r\n                    message: \"\",\r\n                    redirectTo: null,\r\n                    waiting: false,\r\n                    addMore: false,\r\n                    resetting: true,\r\n                    loaded: false\r\n                  }, this.resetForm);\r\n                } else if (this.state.addMore === \"next\") {\r\n                  this.redirectToNext();\r\n                } else {\r\n                  this.setState({\r\n                    waiting: false,\r\n                    redirectTo: `/world/details/${this.props.selectedWorld._id}`\r\n                  });\r\n                }\r\n              });\r\n            }\r\n            else if (res.error !== undefined) {\r\n              this.setState({\r\n                waiting: false, \r\n                message: res.error \r\n              }, () => {\r\n                this.props.logout();\r\n              });\r\n            }\r\n          })\r\n          .catch(err => console.log(err));\r\n      } else {\r\n        this.api\r\n          .updateType(type)\r\n          .then(res => {\r\n            if (res.error === undefined) {\r\n              this.api.getWorld(this.props.selectedWorldID, true).then(res2 => {\r\n                this.props.setAttributes(res2.attributes);\r\n                this.props.setTypes(res2.types);\r\n                this.props.setThings(res2.things);\r\n\r\n                if (this.state.addMore === \"add\") {\r\n                  this.props.updateSelectedType({\r\n                    _id: null,\r\n                    Name: \"\",\r\n                    PluralName: \"\",\r\n                    Description: \"\",\r\n                    Supers: [],\r\n                    SuperIDs: [],\r\n                    AttributesArr: [],\r\n                    Attributes: [],\r\n                    Major: false,\r\n                    DefaultsHash: {}\r\n                  });\r\n                  this.setState({\r\n                    _id: null,\r\n                    // Name: \"\",\r\n                    // Description: \"\",\r\n                    // Supers: [],\r\n                    // Attributes: [],\r\n                    // Major: false,\r\n                    fieldValidation: {\r\n                      Name: { valid: true, message: \"\" },\r\n                      AttributesArr: { valid: true, message: \"\" },\r\n                      Attributes: { valid: true, message: \"\" }\r\n                    },\r\n                    formValid: false,\r\n                    message: \"\",\r\n                    redirectTo: null,\r\n                    waiting: false,\r\n                    addMore: false,\r\n                    resetting: true,\r\n                    loaded: false\r\n                  }, this.resetForm);\r\n                } else if (this.state.addMore === \"next\") {\r\n                  this.redirectToNext();\r\n                } else {\r\n                  this.setState({\r\n                    waiting: false,\r\n                    redirectTo: `/world/details/${this.props.selectedWorld._id}`\r\n                  });\r\n                }\r\n              });\r\n            }\r\n            else {\r\n              this.setState({\r\n                waiting: false, \r\n                message: res.error \r\n              }, () => {\r\n                this.props.logout();\r\n              });\r\n            }\r\n          })\r\n          .catch(err => console.log(err));\r\n      }\r\n    });\r\n  }\r\n\r\n  supersChange = (e, value) => {\r\n    let supers = [];\r\n    for (let i = 0; i < value.length; i++) {\r\n      const t = value[i];\r\n      supers.push(t);\r\n      supers = supers.concat(t.Supers);\r\n    }\r\n    const type = this.props.selectedType;\r\n    type.Supers = supers;\r\n    this.props.updateSelectedType(type);\r\n    // this.setState({ Supers: supers });\r\n  }\r\n\r\n  addSuper = (selectedList, selectedItem) => {\r\n    const type = this.props.selectedType;\r\n    type.SuperIDs.push(selectedItem._id);\r\n    selectedItem.Supers.forEach(s => {\r\n      if (selectedList.filter(s2 => s2._id === s._id).length === 0) {\r\n        selectedList.push(s);\r\n        type.SuperIDs.push(s._id);\r\n      }\r\n    });\r\n    // We need to go through all the attributes on type, \r\n    // and make sure that none of them are also on a super type\r\n    let duplicateAttributes = [];\r\n    selectedList.forEach(t => {\r\n      duplicateAttributes = duplicateAttributes.concat(type.AttributesArr.filter(a => a.TypeIDs.includes(t._id)));\r\n    });\r\n    type.AttributesArr = type.AttributesArr.filter(a => duplicateAttributes.filter(d => d.attrID === a.attrID).length === 0);\r\n    \r\n    type.Supers = selectedList;\r\n    this.props.updateSelectedType(type);\r\n    // this.setState({ Supers: selectedList });\r\n  }\r\n\r\n  newAttribute = () => {\r\n    const type = this.props.selectedType;\r\n    type.AttributesArr.push({\r\n      index: type.AttributesArr.length,\r\n      attrID: `null_${uuid()}`,\r\n      Name: \"\",\r\n      AttributeType: \"Text\",\r\n      Options: [],\r\n      DefinedType: \"\",\r\n      ListType: \"\",\r\n      TypeIDs: []\r\n    });\r\n    this.props.updateSelectedType(type);\r\n  }\r\n\r\n  addSelectedAttribute = () => {\r\n    const attr = this.props.attributesByID[this.state.browseAttributesSelected];\r\n    \r\n    const type = this.props.selectedType;\r\n    type.AttributesArr.push({\r\n      index: type.AttributesArr.length,\r\n      attrID: attr._id,\r\n      Name: attr.Name,\r\n      AttributeType: attr.AttributeType,\r\n      Options: attr.Options,\r\n      DefinedType: attr.DefinedType,\r\n      ListType: attr.ListType,\r\n      TypeIDs: attr.TypeIDs\r\n    });\r\n    this.props.updateSelectedType(type);\r\n    this.setState({ \r\n      browseAttributesSelected: \"\",\r\n      browseTypesSelected: \"\" \r\n    });\r\n  }\r\n\r\n  addBrowsedType = (typeID) => {\r\n    const type = this.props.selectedType;\r\n    let attrType = this.props.types.filter(t => t._id === typeID)[0];\r\n    \r\n    type.SuperIDs.push(attrType._id);\r\n    const selectedList = type.Supers;\r\n    selectedList.push(attrType);\r\n\r\n    attrType.Supers.forEach(s => {\r\n      if (selectedList.filter(s2 => s2._id === s._id).length === 0) {\r\n        selectedList.push(s);\r\n        type.SuperIDs.push(s._id);\r\n      }\r\n    });\r\n    // We need to go through all the attributes on type, \r\n    // and make sure that none of them are also on a super type\r\n    let duplicateAttributes = [];\r\n    selectedList.forEach(t => {\r\n      duplicateAttributes = duplicateAttributes.concat(type.AttributesArr.filter(a => a.TypeIDs.includes(t._id)));\r\n    });\r\n    type.AttributesArr = type.AttributesArr.filter(a => duplicateAttributes.filter(d => d.attrID === a.attrID).length === 0);\r\n    \r\n    type.Supers = [];\r\n    this.props.updateSelectedType(type);\r\n    // this.setState({ Supers: [] });\r\n    setTimeout(() => {\r\n      type.Supers = selectedList;\r\n      this.props.updateSelectedType(type);\r\n      this.setState({ \r\n        browseAttributesSelected: \"\", \r\n        browseTypesSelected: \"\", \r\n        // Supers: selectedList \r\n      });\r\n    }, 500);\r\n  }\r\n  \r\n  removeSuper = (selectedList, removedItem) => {\r\n    let supers = [];\r\n    let superIDs = [];\r\n    let removeUs = [removedItem._id];\r\n    const type = this.props.selectedType;\r\n    for (let i = 0; i < type.Supers.length; i++) {\r\n      const checkMe = this.props.types.filter(\r\n        t => t._id === type.Supers[i]._id\r\n      )[0];\r\n      if (checkMe._id === removedItem._id || checkMe.SuperIDs.includes(removedItem._id))\r\n        removeUs.push(checkMe._id);\r\n      else {\r\n        supers.push(checkMe);\r\n        superIDs.push(checkMe._id);\r\n      }\r\n    }\r\n    type.Supers = []; // supers;\r\n    type.SuperIDs = []; // superIDs;\r\n    this.props.updateSelectedType(type);\r\n    this.setState({ \r\n      // Supers: supers, \r\n      loaded: false \r\n    });\r\n    setTimeout(() => {\r\n      type.Supers = supers;\r\n      type.SuperIDs =  superIDs;\r\n      this.props.updateSelectedType(type);\r\n      this.setState({ loaded: true });\r\n    }, 500);\r\n  }\r\n\r\n  redirectToNext = () => {\r\n    // Find the next type\r\n    let index = 0;\r\n    if (this.props.selectedType === undefined || this.props.selectedType._id !== null) {\r\n      while (this.props.types[index]._id !== this.props.selectedType._id)\r\n        index++;\r\n      index++;\r\n    }\r\n    if (index === this.props.types.length)\r\n      index = 0;\r\n    this.setState({ \r\n      waiting: false, \r\n      redirectTo: `/type/edit/${this.props.types[index]._id}` \r\n    });\r\n  }\r\n\r\n  load = (id) => {\r\n    setTimeout(() => {\r\n      this.setState({\r\n        _id: id,\r\n        redirectTo: null,\r\n        loaded: false,\r\n        message: \"Loading...\"\r\n      }, this.finishLoading);\r\n    }, 500);\r\n  }\r\n\r\n  finishLoading = () => {\r\n    const id = this.state._id;\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n      this.setState({\r\n        _id: id,\r\n        loaded: true,\r\n        message: \"\"\r\n      });\r\n    }\r\n    else {\r\n      this.api.getWorld(this.props.selectedWorldID).then(res => {\r\n        this.props.setAttributes(res.attributes);\r\n        this.props.setTypes(res.types);\r\n        this.props.setThings(res.things);\r\n        if (id !== null) {\r\n          let type = res.types.filter(t => t._id === id);\r\n          if (type.length > 0) {\r\n            type = type[0];\r\n\r\n            const supers = this.props.types.filter(t =>\r\n              type.SuperIDs.includes(t._id)\r\n            );\r\n            type.Supers = supers;\r\n            this.props.updateSelectedType(type);\r\n            this.setState({\r\n              // Name: type.Name,\r\n              // Description: type.Description,\r\n              _id: id,\r\n              // Supers: supers,\r\n              // Major: type.Major,\r\n              loaded: true,\r\n              message: \"\"\r\n            });\r\n          }\r\n          else {\r\n            this.api.getWorld(this.props.selectedWorldID, true).then(res2 => {\r\n              this.props.setAttributes(res2.attributes);\r\n              this.props.setTypes(res2.types);\r\n              this.props.setThings(res2.things);\r\n              if (id !== null) {\r\n                let type = res2.types.filter(t => t._id === id);\r\n                if (type.length > 0) {\r\n                  type = type[0];\r\n      \r\n                  const supers = this.props.types.filter(t =>\r\n                    type.SuperIDs.includes(t._id)\r\n                  );\r\n                  type.Supers = supers;\r\n                  this.props.updateSelectedType(type);\r\n                  this.setState({\r\n                    // Name: type.Name,\r\n                    // Description: type.Description,\r\n                    _id: id,\r\n                    // Supers: supers,\r\n                    // Major: type.Major,\r\n                    loaded: true,\r\n                    message: \"\"\r\n                  });\r\n                }\r\n                else {\r\n                  // I had it get here with an ID from Cosmere, when I was supposed to be looking at a Type from Ozzie.\r\n                  // Need to figure out how it got the wrong ID.\r\n                  this.setState({ \r\n                    message: `Invalid ID: ${id}`, \r\n                    loaded: true \r\n                  });\r\n                }\r\n              } else {\r\n                this.props.updateSelectedType({\r\n                  _id: null,\r\n                  Name: \"\",\r\n                  PluralName: \"\",\r\n                  Description: \"\",\r\n                  Supers: [],\r\n                  SuperIDs: [],\r\n                  AttributesArr: [],\r\n                  Attributes: [],\r\n                  Major: false,\r\n                  DefaultsHash: {}\r\n                });\r\n                this.setState({ \r\n                  message: \"\", \r\n                  loaded: true \r\n                });\r\n              }\r\n            });\r\n          }\r\n        } else {\r\n          this.props.updateSelectedType({\r\n            _id: null,\r\n            Name: \"\",\r\n            PluralName: \"\",\r\n            Description: \"\",\r\n            Supers: [],\r\n            SuperIDs: [],\r\n            AttributesArr: [],\r\n            Attributes: [],\r\n            Major: false,\r\n            DefaultsHash: {}\r\n          });\r\n          this.setState({ \r\n            message: \"\",\r\n            loaded: true \r\n          });\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  changeDefault = value => {\r\n    const type = this.props.selectedType;\r\n    type.DefaultsHash[value.attrID] = {\r\n      attrID: value.attrID,\r\n      DefaultValue: value.DefaultValue,\r\n      DefaultListValues: value.DefaultListValues,\r\n      FromTypeIDs: value.FromTypeIDs\r\n    };\r\n    this.props.updateSelectedType(type);\r\n  }\r\n\r\n  newAttribute = () => {\r\n    const type = this.props.selectedType;\r\n    type.AttributesArr.push({\r\n      index: type.AttributesArr.length,\r\n      attrID: `null_${uuid()}`,\r\n      Name: \"\",\r\n      AttributeType: \"Text\",\r\n      Options: [],\r\n      DefinedType: \"\",\r\n      ListType: \"\"\r\n    });\r\n    this.props.updateSelectedType(type);\r\n  }\r\n\r\n  changeAttribute = value => {\r\n    const type = this.props.selectedType;\r\n    type.AttributesArr[value.index] = {\r\n      index: value.index,\r\n      attrID: value.attrID,\r\n      Name: value.Name,\r\n      AttributeType: value.AttributeType,\r\n      Options: value.Options,\r\n      DefinedType: value.DefinedType,\r\n      ListType: value.ListType,\r\n    };\r\n    this.props.updateSelectedType(type);\r\n  }\r\n\r\n  deleteAttribute = value => {\r\n    const type = this.props.selectedType;\r\n    const attributes = [];\r\n    type.AttributesArr.forEach(t => {\r\n      if (t.index !== value.index) {\r\n        if (t.index > value.index)\r\n          t.index--;\r\n        attributes.push(t);\r\n      }\r\n    });\r\n    type.AttributesArr = [];\r\n    let defaults = {...type.DefaultsHash};\r\n    if (defaults[value.attrID] !== undefined) {\r\n      delete defaults[value.attrID];\r\n    }\r\n    type.DefaultsHash = {};\r\n    this.props.updateSelectedType(type);\r\n    setTimeout(() => {\r\n      type.AttributesArr = attributes;\r\n      type.DefaultsHash = defaults;\r\n      this.props.updateSelectedType(type);\r\n    }, 500);\r\n  }\r\n\r\n  renderAttributes = () => {\r\n    return (\r\n      <AttributesControl \r\n        defaultsMode={this.state.defaultsMode} \r\n        addNewType={attribute => {\r\n          this.setState({ \r\n            typeModalOpen: true,\r\n            putTypeOnAttribute: attribute\r\n          });\r\n        }}\r\n        addNewThing={attribute => {\r\n          this.setState({ \r\n            thingModalOpen: true,\r\n            newThingType: this.props.types.filter(t => t._id === attribute.DefinedType)[0],\r\n            putThingOnAttribute: attribute\r\n          });\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  render() {\r\n    let { id } = this.props.match.params;\r\n    if (id === undefined)\r\n      id = null;\r\n    if (this.state._id !== id) {\r\n      this.load(id);\r\n      return (<span>Loading...</span>);\r\n    }\r\n    else if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    } else if (this.props.selectedWorld !== null && \r\n      !this.props.selectedWorld.Public && \r\n      this.props.user === null) {\r\n      setTimeout(() => {\r\n        this.props.toggleLogin();\r\n      }, 500);\r\n      return <span>Requires Login</span>;\r\n    } else if (this.props.selectedWorld !== null && \r\n      !this.props.selectedWorld.Public && \r\n      (this.props.selectedWorld.Owner !== this.props.user._id && \r\n          this.props.selectedWorld.Collaborators.filter(c=>c.userID === this.props.user._id && c.type === \"collab\" && c.editPermission).length === 0)) {\r\n      return <Redirect to=\"/\" />;\r\n    } else if (this.props.selectedType === null || this.props.selectedType._id !== id) {\r\n      return <span>{this.state.message}</span>;\r\n    } else if (this.state.typeModalOpen) {\r\n      return (\r\n        <NewTypeModal \r\n          types={this.props.types}\r\n          selectedWorldID={this.props.selectedWorldID}\r\n          onCancel={_ => {\r\n            this.setState({\r\n              typeModalOpen: false\r\n            });\r\n          }}\r\n          addType={type => {\r\n            this.props.addType(type);\r\n          }}\r\n          onSave={newType => {\r\n            const type = this.props.selectedType;\r\n            const attr = type.AttributesArr.filter(a => a.attrID === this.state.putTypeOnAttribute.attrID)[0];\r\n            attr.DefinedType = newType._id;\r\n            this.props.updateSelectedType(type);\r\n            this.setState({\r\n              typeModalOpen: false\r\n            });\r\n          }}\r\n          api={this.api}\r\n          logout={() => {\r\n            this.props.logout();\r\n          }}\r\n        />\r\n      );\r\n    } else if (this.state.thingModalOpen) {\r\n      return (\r\n        <NewThingModal \r\n          things={this.props.things}\r\n          newThingType={this.state.newThingType}\r\n          selectedWorldID={this.props.selectedWorldID}\r\n          onCancel={_ => {\r\n            this.setState({\r\n              thingModalOpen: false\r\n            });\r\n          }}\r\n          addThing={thing => {\r\n            this.props.addThing(thing);\r\n          }}\r\n          onSave={thing => {\r\n            this.setState({\r\n              thingModalOpen: false\r\n            }, _ => {\r\n              // Need to put it on putThingOnAttribute\r\n              const type = this.props.selectedType;\r\n              const attr = type.AttributesArr.filter(a => a.attrID === this.state.putThingOnAttribute.attrID)[0];\r\n              let def = this.props.selectedType.DefaultsHash[attr.attrID];\r\n              if (def === undefined)\r\n                def = { attrID: attr.attrID, DefaultValue: \"\", DefaultListValues: [] };\r\n              if (attr.AttributeType === \"Type\") {\r\n                def.DefaultValue = thing._id;\r\n              }\r\n              else {\r\n                // The only way it can be here is if it's List and ListType is Type\r\n                def.DefaultListValues.push(thing._id);\r\n              }\r\n              this.props.updateSelectedType(type);\r\n            });\r\n          }}\r\n          api={this.api}\r\n          logout={() => {\r\n            this.props.logout();\r\n          }}\r\n        />\r\n      );\r\n    } else {\r\n      const types =\r\n        this.props.types === undefined || this.state._id === null\r\n          ? this.props.types\r\n          : this.props.types.filter(type => type._id !== this.state._id);\r\n      let additionalAttributes = [];\r\n      let selectedAttributeTypes = [];\r\n      let selectedAttributeName = \"\";\r\n      if (this.state.browseAttributes) {\r\n        Object.keys(this.props.attributesByID).forEach(id => {\r\n          const attr = this.props.attributesByID[id];\r\n          if (!attr.TypeIDs.includes(this.props.selectedType._id) && \r\n            this.props.selectedType.AttributesArr.filter(a => a.attrID === attr._id).length === 0) { // This second condition will make newly added attributes not show up.\r\n            let found = false;\r\n            for (let i = 0; i < this.props.selectedType.Supers.length; i++) {\r\n              if (attr.TypeIDs.includes(this.props.selectedType.Supers[i]._id)) {\r\n                found = true;\r\n                break;\r\n              }\r\n            }\r\n            if (!found) {\r\n              additionalAttributes.push({\r\n                _id: attr._id,\r\n                Name: attr.Name\r\n              });\r\n            }\r\n          }\r\n        });\r\n\r\n        if (this.state.browseAttributesSelected !== \"\") {\r\n          selectedAttributeName = this.props.attributesByID[this.state.browseAttributesSelected].Name;\r\n          selectedAttributeTypes = this.props.types.filter(t => this.props.attributesByID[this.state.browseAttributesSelected].TypeIDs.includes(t._id));\r\n        }\r\n      }\r\n      return (\r\n        <Grid item xs={12} container spacing={1} direction=\"column\">\r\n          { this.props.selectedWorld === null ? \"\" :\r\n            <Grid item container spacing={1} direction=\"column\">\r\n              <Helmet>\r\n                <title>{ `Author's Notebook: ${this.props.selectedWorld.Name}` }</title>\r\n              </Helmet>\r\n              <Grid item container spacing={1} direction=\"row\">\r\n                <Grid item xs={1}>\r\n                  <Tooltip title={`Back to ${this.props.selectedWorld.Name}`}>\r\n                    <Fab size=\"small\"\r\n                      color=\"primary\"\r\n                      onClick={ _ => {this.setState({redirectTo:`/world/details/${this.props.selectedWorldID}`})}}\r\n                    >\r\n                      <ArrowBack />\r\n                    </Fab>\r\n                  </Tooltip>\r\n                </Grid>\r\n                <Grid item xs={7} sm={9}>\r\n                  <h2>{this.state._id === null ? \"Create New Type\" : \"Edit Type\"}</h2>\r\n                </Grid>\r\n                { this.props.types.length > 1 &&\r\n                  <Grid item xs={4} sm={2}>\r\n                    <ListItem>\r\n                      <Button\r\n                        fullWidth\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={_ => {\r\n                          this.redirectToNext();\r\n                        }}\r\n                      >\r\n                        <ListItemText primary=\"Next Type\"/>\r\n                      </Button>\r\n                    </ListItem>\r\n                  </Grid>\r\n                }\r\n              </Grid>\r\n              <Grid item>\r\n                { this.state.loaded &&  \r\n                  <TextBox \r\n                    Value={this.props.selectedType.Name} \r\n                    fieldName=\"Name\" \r\n                    message={this.state.fieldValidation.Name.message}\r\n                    onBlur={name => {\r\n                      const type = this.props.selectedType;\r\n                      type.Name = name;\r\n                      this.props.updateSelectedType(type);\r\n                      this.validateForm();\r\n                      // this.setState({ Name: name }, \r\n                      //   this.validateForm);\r\n                    }}\r\n                    labelWidth={43}/>\r\n                }\r\n              </Grid>\r\n              <Grid item>\r\n                { this.state.loaded &&  \r\n                  <TextBox \r\n                    Value={this.props.selectedType.PluralName} \r\n                    fieldName=\"PluralName\" \r\n                    displayName=\"Plural Name\" \r\n                    onBlur={name => {\r\n                      const type = this.props.selectedType;\r\n                      type.PluralName = name;\r\n                      this.props.updateSelectedType(type);\r\n                      this.validateForm();\r\n                      // this.setState({ Name: name }, \r\n                      //   this.validateForm);\r\n                    }}\r\n                    labelWidth={85}/>\r\n                }\r\n              </Grid>\r\n              <Grid item>\r\n                { this.state.loaded &&  \r\n                  <TextBox \r\n                    Value={this.props.selectedType.Description} \r\n                    fieldName=\"Description\" \r\n                    multiline={true}\r\n                    onBlur={desc => {\r\n                      const type = this.props.selectedType;\r\n                      type.Description = desc;\r\n                      this.props.updateSelectedType(type);\r\n                    }}\r\n                    labelWidth={82}/>\r\n                }\r\n              </Grid>\r\n              <Grid item>\r\n                <FormControlLabel\r\n                  control={\r\n                    <Checkbox\r\n                      checked={this.props.selectedType.Major}\r\n                      onChange={ e => {\r\n                        const value = e.target.checked;\r\n                        const type = this.props.selectedType;\r\n                        type.Major = value;\r\n                        this.props.updateSelectedType(type);\r\n                        // this.setState({ [name]: value });\r\n                        // this.handleUserInput(e);\r\n                      }}\r\n                      name=\"Major\"\r\n                      color=\"primary\"\r\n                    />\r\n                  }\r\n                  label=\"Major Type\"\r\n                />\r\n              </Grid>\r\n              { !this.state.resetting &&\r\n                <Grid item>\r\n                  <Multiselect\r\n                    placeholder=\"Super Types\"\r\n                    options={types}\r\n                    selectedValues={this.props.selectedType.Supers}\r\n                    onSelect={this.addSuper}\r\n                    onRemove={this.removeSuper}\r\n                    displayValue=\"Name\"\r\n                  />\r\n                </Grid>\r\n              }\r\n              <Grid item container spacing={0} direction=\"row\">\r\n                <Grid item xs={6}>\r\n                  <span>Attributes&nbsp;\r\n                    <Tooltip \r\n                      title={`Add New Attribute`}>\r\n                      <span>\r\n                        <Fab size=\"small\"\r\n                          color=\"primary\"\r\n                          disabled={this.state.defaultsMode}\r\n                          onClick={ _ => { this.newAttribute()}}\r\n                        >\r\n                          <Add />\r\n                        </Fab>\r\n                      </span>\r\n                    </Tooltip>\r\n                    <Tooltip \r\n                      title={`Browse Additional Attributes`}>\r\n                      <span>\r\n                        <Fab\r\n                          size=\"small\"\r\n                          color=\"primary\" \r\n                          disabled={this.state.defaultsMode}\r\n                          onClick={e => {\r\n                            this.setState({ browseAttributes: !this.state.browseAttributes });\r\n                          }}\r\n                        >\r\n                          <Search />\r\n                        </Fab>\r\n                      </span>\r\n                    </Tooltip>\r\n                  </span>\r\n                </Grid>\r\n                <Grid item xs={6}>\r\n                  <Button variant=\"contained\" color=\"primary\" onClick={e => { this.setState({defaultsMode: !this.state.defaultsMode}) }}>\r\n                    { this.state.defaultsMode ? \"Set Attribute Types\" : \"Set Defaults\"}\r\n                  </Button>\r\n                </Grid>\r\n              </Grid>\r\n              { this.state.browseAttributes && \r\n                <Grid item container spacing={1} direction=\"row\">\r\n                  <Grid item xs={12} sm={6}>\r\n                    <FormControl variant=\"outlined\" fullWidth>\r\n                      <InputLabel htmlFor=\"browseForAttributes\" id=\"browseForAttributes-label\">\r\n                        Browse Attributes\r\n                      </InputLabel>\r\n                      <Select\r\n                        labelId=\"browseForAttributes-label\"\r\n                        id=\"browseForAttributes\"\r\n                        value={this.state.browseAttributesSelected}\r\n                        onChange={e => {\r\n                          this.setState({ browseAttributesSelected: e.target.value });\r\n                        }}\r\n                        fullWidth\r\n                        labelWidth={130}\r\n                      >\r\n                        {\r\n                          additionalAttributes.map((attr, i) => {\r\n                            return (\r\n                              <MenuItem key={i} value={attr._id}>\r\n                                {attr.Name}\r\n                              </MenuItem>\r\n                            );\r\n                          })\r\n                        }\r\n                      </Select>\r\n                    </FormControl>\r\n                  </Grid>\r\n                  <Grid item xs={12} sm={6}>\r\n                    <Button\r\n                      variant=\"contained\" color=\"primary\"\r\n                      disabled={ this.state.browseAttributesSelected === \"\" }\r\n                      onClick={e => {this.addSelectedAttribute();}}\r\n                      type=\"submit\"\r\n                    >\r\n                      Add Attribute\r\n                    </Button>\r\n                  </Grid>\r\n                  { selectedAttributeTypes.length === 1 ?\r\n                    <Grid style={{color: \"red\"}} item xs={12} container spacing={1} direction=\"row\">\r\n                      <Grid item xs={12}>\r\n                        This Attribute is also found on the Type '{selectedAttributeTypes[0].Name}'.  You may want to add '{selectedAttributeTypes[0].Name}' as a Super Type instead of adding the Attribute.\r\n                      </Grid>                      \r\n                      <Grid item xs={12} sm={6}>\r\n                        <Button\r\n                          variant=\"contained\" color=\"primary\"\r\n                          onClick={e => {this.addBrowsedType(selectedAttributeTypes[0]._id);}}\r\n                          type=\"submit\"\r\n                        >\r\n                          Add {selectedAttributeTypes[0].Name}\r\n                        </Button>\r\n                      </Grid>\r\n                    </Grid>\r\n                  : selectedAttributeTypes.length > 1 &&\r\n                    <Grid style={{color: \"red\"}} item xs={12} container spacing={1} direction=\"row\">\r\n                      <Grid item xs={12}>\r\n                        This Attribute is also found on other Types.  You may want to add one as a Super Type instead of adding the Attribute.\r\n                      </Grid>                      \r\n                      <Grid item xs={12} sm={6}>\r\n                        <FormControl variant=\"outlined\" fullWidth>\r\n                          <InputLabel htmlFor=\"browseTypesWithAttribute\" id=\"browseTypesWithAttribute-label\">\r\n                            Browse Types with {selectedAttributeName}\r\n                          </InputLabel>\r\n                          <Select\r\n                            labelId=\"browseTypesWithAttribute-label\"\r\n                            id=\"browseTypesWithAttribute\"\r\n                            value={this.state.browseTypesSelected}\r\n                            onChange={e => {\r\n                              this.setState({ browseTypesSelected: e.target.value });\r\n                            }}\r\n                            fullWidth\r\n                            labelWidth={140 + selectedAttributeName.length * 9}\r\n                          >\r\n                            { selectedAttributeTypes.map((type, i) => {\r\n                              return (\r\n                                <MenuItem key={i} value={type._id}>\r\n                                  {type.Name}\r\n                                </MenuItem>\r\n                              );\r\n                            })}\r\n                          </Select>\r\n                        </FormControl>\r\n                      </Grid>\r\n                      <Grid item xs={12} sm={6}>\r\n                        <Button\r\n                          variant=\"contained\" color=\"primary\"\r\n                          disabled={ this.state.browseTypesSelected === \"\" }\r\n                          onClick={e => {this.addBrowsedType(this.state.browseTypesSelected);}}\r\n                          type=\"submit\"\r\n                        >\r\n                          Add Type\r\n                        </Button>\r\n                      </Grid>\r\n                    </Grid>\r\n                  }\r\n                </Grid>\r\n              }\r\n              <Grid item>\r\n                { this.state.loaded &&\r\n                  this.renderAttributes()\r\n                }\r\n              </Grid>\r\n              <Grid item>\r\n                {Object.keys(this.state.fieldValidation).map((fieldName, i) => {\r\n                  if (\r\n                    this.state.fieldValidation[fieldName] !== undefined &&\r\n                    this.state.fieldValidation[fieldName].message.length > 0\r\n                  ) {\r\n                    return (\r\n                      <p className=\"redFont\" key={i}>\r\n                        {this.state.fieldValidation[fieldName].message}\r\n                      </p>\r\n                    );\r\n                  } else {\r\n                    return \"\";\r\n                  }\r\n                })}\r\n              </Grid>\r\n              <Grid item>\r\n                <div className=\"float-right\">\r\n                  { this.props.types.length > 0 &&\r\n                    <Button\r\n                      variant=\"contained\" color=\"primary\"\r\n                      disabled={this.state.waiting}\r\n                      onClick={e => {this.onSubmit(\"next\")}}\r\n                      type=\"submit\"\r\n                    >\r\n                      {this.state.waiting ? \"Please Wait\" : \"Submit and Edit Next\"}\r\n                    </Button>\r\n                  }\r\n                  <Button\r\n                    variant=\"contained\" color=\"primary\"\r\n                    style={{marginLeft: \"4px\"}}\r\n                    disabled={this.state.waiting}\r\n                    onClick={e => {this.onSubmit(\"add\")}}\r\n                    type=\"submit\"\r\n                  >\r\n                    {this.state.waiting ? \"Please Wait\" : \"Submit and Create Another\"}\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"contained\" color=\"primary\"\r\n                    style={{marginLeft: \"4px\"}}\r\n                    className=\"w-200\"\r\n                    disabled={this.state.waiting}\r\n                    onClick={e => {this.onSubmit(\"\")}}\r\n                    type=\"submit\"\r\n                  >\r\n                    {this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"contained\"\r\n                    style={{marginLeft: \"4px\"}}\r\n                    disabled={this.state.waiting}\r\n                    onClick={_ => {\r\n                      if (this.props.selectedType._id === null) {\r\n                        this.setState({\r\n                          redirectTo: `/world/details/${this.props.selectedWorldID}`\r\n                        });\r\n                      }\r\n                      else {\r\n                        this.setState({\r\n                          redirectTo: `/type/details/${this.props.selectedType._id}`\r\n                        });\r\n                      }\r\n                    }}\r\n                    type=\"button\"\r\n                  >\r\n                    Cancel\r\n                  </Button>\r\n                </div>\r\n              </Grid>\r\n              <Grid item style={{color:\"red\"}}>{this.state.message}</Grid>\r\n            </Grid>\r\n          }\r\n        </Grid>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst TypeEditPage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default TypeEditPage;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n// import clsx from 'clsx';\r\nimport { lighten, makeStyles } from '@material-ui/core/styles';\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableContainer from '@material-ui/core/TableContainer';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TablePagination from '@material-ui/core/TablePagination';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport TableSortLabel from '@material-ui/core/TableSortLabel';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Box from '@material-ui/core/Box';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport { \r\n  Button, ListItemText\r\n} from \"@material-ui/core\";\r\n\r\nlet rows = [];\r\n\r\nfunction descendingComparator(a, b, orderBy) {\r\n  if (b[orderBy] < a[orderBy]) {\r\n    return -1;\r\n  }\r\n  if (b[orderBy] > a[orderBy]) {\r\n    return 1;\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction getComparator(order, orderBy) {\r\n  return order === 'desc'\r\n    ? (a, b) => descendingComparator(a, b, orderBy)\r\n    : (a, b) => -descendingComparator(a, b, orderBy);\r\n}\r\n\r\nfunction stableSort(array, comparator) {\r\n  const stabilizedThis = array.map((el, index) => [el, index]);\r\n  stabilizedThis.sort((a, b) => {\r\n    const order = comparator(a[0], b[0]);\r\n    if (order !== 0) return order;\r\n    return a[1] - b[1];\r\n  });\r\n  return stabilizedThis.map((el) => el[0]);\r\n}\r\n\r\nfunction ThingTableHead(props) {\r\n  const { classes, order, orderBy, onRequestSort, columnMap } = props;\r\n  const createSortHandler = (property) => (event) => {\r\n    onRequestSort(event, property);\r\n  };\r\n\r\n  return (\r\n    <TableHead>\r\n      <TableRow>\r\n        {columnMap.map((headCell) => (\r\n          <TableCell\r\n            key={headCell.id}\r\n            align={headCell.numeric ? 'right' : 'left'}\r\n            padding={headCell.disablePadding ? 'none' : 'default'}\r\n            sortDirection={orderBy === headCell.id ? order : false}\r\n          >\r\n            <TableSortLabel\r\n              active={orderBy === headCell.id}\r\n              direction={orderBy === headCell.id ? order : 'asc'}\r\n              onClick={createSortHandler(headCell.id)}\r\n            >\r\n              {headCell.label}\r\n              {orderBy === headCell.id ? (\r\n                <span className={classes.visuallyHidden}>\r\n                  {order === 'desc' ? 'sorted descending' : 'sorted ascending'}\r\n                </span>\r\n              ) : null}\r\n            </TableSortLabel>\r\n          </TableCell>\r\n        ))}\r\n      </TableRow>\r\n    </TableHead>\r\n  );\r\n}\r\n\r\nThingTableHead.propTypes = {\r\n  classes: PropTypes.object.isRequired,\r\n  numSelected: PropTypes.number.isRequired,\r\n  onRequestSort: PropTypes.func.isRequired,\r\n  onSelectAllClick: PropTypes.func.isRequired,\r\n  order: PropTypes.oneOf(['asc', 'desc']).isRequired,\r\n  orderBy: PropTypes.string.isRequired,\r\n  rowCount: PropTypes.number.isRequired,\r\n  columnMap: PropTypes.array.isRequired\r\n};\r\n\r\nconst useToolbarStyles = makeStyles((theme) => ({\r\n  root: {\r\n    paddingLeft: theme.spacing(2),\r\n    paddingRight: theme.spacing(1),\r\n  },\r\n  highlight:\r\n    theme.palette.type === 'light'\r\n      ? {\r\n          color: theme.palette.secondary.main,\r\n          backgroundColor: lighten(theme.palette.secondary.light, 0.85),\r\n        }\r\n      : {\r\n          color: theme.palette.text.primary,\r\n          backgroundColor: theme.palette.secondary.dark,\r\n        },\r\n  title: {\r\n    flex: '1 1 100%',\r\n  },\r\n}));\r\n\r\nconst ThingTableToolbar = (props) => {\r\n  const classes = useToolbarStyles();\r\n  const { label } = props;\r\n\r\n  return (\r\n    <Toolbar>\r\n      <Typography className={classes.title} variant=\"h6\" id=\"tableTitle\" component=\"div\">\r\n        {label}\r\n      </Typography>\r\n    </Toolbar>\r\n  );\r\n};\r\n\r\nThingTableToolbar.propTypes = {\r\n  // numSelected: PropTypes.number.isRequired,\r\n  label: PropTypes.string.isRequired\r\n};\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    width: '100%',\r\n  },\r\n  paper: {\r\n    width: '100%',\r\n    marginBottom: theme.spacing(2),\r\n  },\r\n  table: {\r\n    // minWidth: 750,\r\n  },\r\n  visuallyHidden: {\r\n    border: 0,\r\n    clip: 'rect(0 0 0 0)',\r\n    height: 1,\r\n    margin: -1,\r\n    overflow: 'hidden',\r\n    padding: 0,\r\n    position: 'absolute',\r\n    top: 20,\r\n    width: 1,\r\n  },\r\n}));\r\n\r\nexport default function ThingTable(props) {\r\n  const columnMap = [\r\n    { \r\n      id: 'Name', \r\n      numeric: false, \r\n      disablePadding: true, \r\n      label: 'Name' \r\n    },\r\n    { \r\n      id: 'Description', \r\n      numeric: false, \r\n      disablePadding: true, \r\n      label: 'Description' \r\n    }\r\n  ];\r\n  rows = [];\r\n  props.things.forEach(thing => {\r\n    const newRow = {\r\n      _id: thing._id,\r\n      Name: thing.Name,\r\n      Description: thing.Description\r\n    };\r\n    thing.Attributes.forEach(attr => {\r\n      const attribute = props.attributesByID[attr.attrID];\r\n      if (attribute.AttributeType === \"Type\") {\r\n        let attrThing = props.allThings.filter(t => t._id === attr.Value);\r\n        if (attrThing.length > 0) {\r\n          attrThing = attrThing[0];\r\n          newRow[attr.attrID] = attrThing.Name;\r\n        }\r\n      } else if (attribute.AttributeType === \"List\") {\r\n        newRow[attr.attrID] = \"\";\r\n        if (attribute.ListType === \"Type\") {\r\n          attr.ListValues.forEach(v => {\r\n            let attrThing = props.allThings.filter(t => t._id === v);\r\n            if (attrThing.length > 0) {\r\n              attrThing = attrThing[0];\r\n              newRow[attr.attrID] += (newRow[attr.attrID].length > 0 ? \", \" : \"\") + attrThing.Name;\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          attr.ListValues.forEach(v => {\r\n            newRow[attr.attrID] += (newRow[attr.attrID].length > 0 ? \", \" : \"\") + v;\r\n          });\r\n        }\r\n      } else {\r\n        newRow[attr.attrID] = attr.Value;\r\n      }\r\n      if (columnMap.filter(c => c.id === attr.attrID).length === 0) {\r\n        columnMap.push({\r\n          id: attribute._id, \r\n          numeric: attribute.Type === \"Number\", \r\n          disablePadding: true, \r\n          label: attribute.Name\r\n        });\r\n      }\r\n    });\r\n    rows.push(newRow);\r\n  });\r\n\r\n  const classes = useStyles();\r\n  const [order, setOrder] = React.useState('asc');\r\n  const [orderBy, setOrderBy] = React.useState('Name');\r\n  const [selected, setSelected] = React.useState([]);\r\n  const [page, setPage] = React.useState(0);\r\n  // const [dense, setDense] = React.useState(false);\r\n  const dense = true;\r\n  const [rowsPerPage, setRowsPerPage] = React.useState(5);\r\n\r\n  const handleRequestSort = (event, property) => {\r\n    const isAsc = orderBy === property && order === 'asc';\r\n    setOrder(isAsc ? 'desc' : 'asc');\r\n    setOrderBy(property);\r\n  };\r\n\r\n  const handleSelectAllClick = (event) => {\r\n    if (event.target.checked) {\r\n      const newSelecteds = rows.map((n) => n.name);\r\n      setSelected(newSelecteds);\r\n      return;\r\n    }\r\n    setSelected([]);\r\n  };\r\n\r\n  // const handleClick = (event, name) => {\r\n  //   const selectedIndex = selected.indexOf(name);\r\n  //   let newSelected = [];\r\n\r\n  //   if (selectedIndex === -1) {\r\n  //     newSelected = newSelected.concat(selected, name);\r\n  //   } else if (selectedIndex === 0) {\r\n  //     newSelected = newSelected.concat(selected.slice(1));\r\n  //   } else if (selectedIndex === selected.length - 1) {\r\n  //     newSelected = newSelected.concat(selected.slice(0, -1));\r\n  //   } else if (selectedIndex > 0) {\r\n  //     newSelected = newSelected.concat(\r\n  //       selected.slice(0, selectedIndex),\r\n  //       selected.slice(selectedIndex + 1),\r\n  //     );\r\n  //   }\r\n\r\n  //   setSelected(newSelected);\r\n  // };\r\n\r\n  const handleChangePage = (event, newPage) => {\r\n    setPage(newPage);\r\n  };\r\n\r\n  const handleChangeRowsPerPage = (event) => {\r\n    setRowsPerPage(parseInt(event.target.value, 10));\r\n    setPage(0);\r\n  };\r\n\r\n  // const handleChangeDense = (event) => {\r\n  //   setDense(event.target.checked);\r\n  // };\r\n\r\n  const isSelected = (name) => selected.indexOf(name) !== -1;\r\n\r\n  // const emptyRows = rowsPerPage - Math.min(rowsPerPage, rows.length - page * rowsPerPage);\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <Box display={{ xs: 'none', sm: 'block' }}>\r\n        <Paper className={classes.paper}>\r\n          <ThingTableToolbar label={props.label} />\r\n          <TableContainer>\r\n            <Table\r\n              className={classes.table}\r\n              aria-labelledby=\"tableTitle\"\r\n              size={dense ? 'small' : 'medium'}\r\n              aria-label=\"enhanced table\"\r\n            >\r\n              <ThingTableHead\r\n                classes={classes}\r\n                numSelected={selected.length}\r\n                order={order}\r\n                orderBy={orderBy}\r\n                onSelectAllClick={handleSelectAllClick}\r\n                onRequestSort={handleRequestSort}\r\n                rowCount={rows.length}\r\n                columnMap={columnMap}\r\n              />\r\n              <TableBody>\r\n                {stableSort(rows, getComparator(order, orderBy))\r\n                  .slice(page * rowsPerPage, page * rowsPerPage + rowsPerPage)\r\n                  .map((row, index) => {\r\n                    const isItemSelected = isSelected(row.name);\r\n                    \r\n                    return (\r\n                      <TableRow\r\n                        hover\r\n                        role=\"checkbox\"\r\n                        aria-checked={isItemSelected}\r\n                        tabIndex={-1}\r\n                        key={index}\r\n                        selected={isItemSelected}\r\n                      >\r\n                        {columnMap.map((column, key) => {\r\n                          return (\r\n                            <TableCell key={key}>\r\n                              {column.id === \"Name\" ?\r\n                                <Button\r\n                                  variant=\"contained\"\r\n                                  color=\"primary\"\r\n                                  onClick={ _ => { props.buttonClick(row._id)}}\r\n                                >\r\n                                  <ListItemText primary={row.Name}/>\r\n                                </Button>\r\n                              :\r\n                                <span>{row[column.id]}</span>\r\n                              }\r\n                            </TableCell>\r\n                          );\r\n                        })}\r\n                      </TableRow>\r\n                    );\r\n                  })}\r\n              </TableBody>\r\n            </Table>\r\n          </TableContainer>\r\n          { rows.length > 5 &&\r\n            <TablePagination\r\n              rowsPerPageOptions={[5, 10, 25]}\r\n              component=\"div\"\r\n              count={rows.length}\r\n              rowsPerPage={rowsPerPage}\r\n              page={page}\r\n              onChangePage={handleChangePage}\r\n              onChangeRowsPerPage={handleChangeRowsPerPage}\r\n            />\r\n          }\r\n        </Paper>\r\n      </Box>\r\n      <Box display={{ xs: 'block', sm: 'none' }}>\r\n        { props.label }: \r\n        { props.things.map((thing, i) => {\r\n          return (\r\n            <Button key={i} style={{ marginLeft: \"4px\" }}\r\n              variant=\"contained\" color=\"primary\"\r\n              onClick={ _ => { props.buttonClick(thing._id)}}>\r\n              <ListItemText primary={thing.Name}/>\r\n            </Button>\r\n          );\r\n        })}\r\n      </Box>\r\n    </div>\r\n  );\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport { ArrowBack, Edit, Delete } from \"@material-ui/icons\";\r\nimport { \r\n  Fab, Tooltip, Modal, Grid, Button, \r\n  List, ListItem, ListItemText, Box\r\n} from \"@material-ui/core\";\r\nimport { Helmet } from 'react-helmet';\r\nimport {\r\n  updateSelectedThing,\r\n  addThing,\r\n  updateThing,\r\n  setAttributes,\r\n  setTypes,\r\n  setThings,\r\n  notFromLogin,\r\n  toggleLogin,\r\n  logout\r\n} from \"../../redux/actions/index\";\r\nimport API from \"../../smartAPI\";\r\nimport ThingTable from \"../../components/Displays/ThingTable\";\r\nimport CommentsControl from \"../../components/Inputs/CommentsControl\";\r\n\r\nconst mapStateToProps = state => {\r\n  const thing = state.app.selectedThing;\r\n  return {\r\n    selectedPage: state.app.selectedPage,\r\n    selectedThing: thing,\r\n    selectedWorld: state.app.selectedWorld,\r\n    selectedWorldID: state.app.selectedWorldID,\r\n    types: state.app.types,\r\n    things: state.app.things,\r\n    user: state.app.user,\r\n    attributesByID: state.app.attributesByID,\r\n    fromLogin: state.app.fromLogin\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    updateSelectedThing: thing => dispatch(updateSelectedThing(thing)),\r\n    addThing: thing => dispatch(addThing(thing)),\r\n    updateThing: thing => dispatch(updateThing(thing)),\r\n    setAttributes: attrs => dispatch(setAttributes(attrs)),\r\n    setTypes: types => dispatch(setTypes(types)),\r\n    setThings: things => dispatch(setThings(things)),\r\n    notFromLogin: () => dispatch(notFromLogin({})),\r\n    toggleLogin: () => dispatch(toggleLogin({})),\r\n    logout: () => dispatch(logout({}))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      _id: null,\r\n      Name: \"\",\r\n      Description: \"\",\r\n      Types: [],\r\n      AttributesArr: [],\r\n      fieldValidation: {\r\n        Name: { valid: true, message: \"\" },\r\n        AttributesArr: { valid: true, message: \"\" }\r\n      },\r\n      formValid: false,\r\n      message: \"\",\r\n      redirectTo: null,\r\n      modalOpen: false,\r\n      majorType: null\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  getModalStyle = () => {\r\n    const top = Math.round(window.innerHeight / 2) - 50;\r\n    const left = Math.round(window.innerWidth / 2) - 200;\r\n  \r\n    return {\r\n      top: `${top}%`,\r\n      left: `${left}%`,\r\n      transform: `translate(${left}px, ${top}px)`,\r\n    };\r\n  }\r\n\r\n  delete = e => {\r\n    this.setState({ waiting: true }, this.finishDelete);\r\n  }\r\n\r\n  finishDelete = e => {\r\n    this.api.deleteThing(this.props.selectedWorldID, this.state._id).then(res=>{\r\n      if (res.error === undefined) {\r\n        this.api.getWorld(this.props.selectedWorldID, true).then(res2 => {\r\n          this.props.setAttributes(res2.attributes);\r\n          this.props.setTypes(res2.types);\r\n          this.props.setThings(res2.things);\r\n\r\n          this.setState({ waiting: false, redirectTo: `/world/details/${this.props.selectedWorldID}`});\r\n        });\r\n      }\r\n      else {\r\n        this.setState({ waiting: false, message: res.error }, () => {\r\n          this.props.logout();\r\n        });\r\n      }\r\n      // const things = this.props.things.filter(t=>t._id!==this.state._id);\r\n      // this.props.setThings(things);\r\n      // this.setState({redirectTo: `/world/details/${this.props.selectedWorldID}`})\r\n    });\r\n  }\r\n\r\n  redirectToNext = () => {\r\n    // Find the next thing\r\n    const things = this.state.majorType === null ? this.props.things : this.props.things.filter(t => t.TypeIDs.includes(this.state.majorType._id));\r\n    let index = 0;\r\n    while (things[index]._id !== this.props.selectedThing._id)\r\n      index++;\r\n    index++;\r\n    if (index === things.length)\r\n      index = 0;\r\n    this.setState({ \r\n      waiting: false, \r\n      redirectTo: `/thing/details/${things[index]._id}` \r\n    });\r\n  }\r\n\r\n  load = (id) => {\r\n    setTimeout(() => {\r\n      this.setState({\r\n        _id: id,\r\n        redirectTo: null\r\n      }, this.finishLoading);\r\n    }, 500);\r\n  }\r\n\r\n  finishLoading = () => {\r\n    if (this.props.fromLogin) {\r\n      this.props.notFromLogin();\r\n    }\r\n    const id = this.state._id;\r\n    this.api.getWorld(this.props.selectedWorldID).then(res => {\r\n      this.props.setAttributes(res.attributes);\r\n      this.props.setTypes(res.types);\r\n      this.props.setThings(res.things);\r\n      \r\n      if (id !== undefined) {\r\n        let thing = res.things.filter(t => t._id === id);\r\n        if (thing.length === 0) {\r\n          this.setState({ message: \"Invalid Thing ID\" });\r\n        }\r\n        else {\r\n          thing = thing[0];\r\n          thing.AttributesArr = [];\r\n          thing.Attributes.forEach(a => {\r\n            const attr = this.props.attributesByID[a.attrID];\r\n            thing.AttributesArr.push({\r\n              index: thing.AttributesArr.length,\r\n              Name: attr.Name,\r\n              AttributeType: attr.AttributeType,\r\n              Options: attr.Options,\r\n              DefinedType: attr.DefinedType,\r\n              ListType: attr.ListType,\r\n              attrID: a.attrID,\r\n              Value: a.Value,\r\n              ListValues: a.ListValues,\r\n              TypeIDs: attr.TypeIDs\r\n            });\r\n          });\r\n          if (this.state.majorType === null) {\r\n            let majorType = thing.Types.filter(t=>t.Major);\r\n            if (majorType.length > 0) {\r\n              majorType = majorType[0];\r\n              \r\n              this.setState({\r\n                Name: thing.Name,\r\n                Description: thing.Description,\r\n                _id: id,\r\n                Types: thing.Types,\r\n                majorType\r\n              });\r\n            }\r\n            else {\r\n              this.setState({\r\n                Name: thing.Name,\r\n                Description: thing.Description,\r\n                _id: id,\r\n                Types: thing.Types\r\n              });\r\n            }\r\n          }\r\n          else {\r\n            this.setState({\r\n              Name: thing.Name,\r\n              Description: thing.Description,\r\n              _id: id,\r\n              Types: thing.Types\r\n            });\r\n          }\r\n        }\r\n        this.props.updateSelectedThing(thing);\r\n      } else {\r\n        this.props.updateSelectedThing({\r\n          _id: null,\r\n          Name: \"\",\r\n          Description: \"\",\r\n          Types: [],\r\n          Attributes: [],\r\n          AttributesArr: []\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { id } = this.props.match.params;\r\n    if (this.state._id !== id) {\r\n      this.load(id);\r\n    }\r\n    if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    } else if (this.props.selectedWorld !== null && \r\n      !this.props.selectedWorld.Public && \r\n      this.props.user === null) {\r\n      setTimeout(() => {\r\n        this.props.toggleLogin();\r\n      }, 500);\r\n      return <span>Requires Login</span>;\r\n    } else if (this.props.selectedWorld !== null && \r\n      !this.props.selectedWorld.Public && \r\n      (this.props.selectedWorld.Owner !== this.props.user._id && \r\n        this.props.selectedWorld.Collaborators.filter(c=>c.userID === this.props.user._id && c.type === \"collab\").length === 0)) {\r\n      return <Redirect to=\"/\" />;\r\n    } else {\r\n      const references = this.props.things.filter(t=>t.ReferenceIDs !== undefined && t.ReferenceIDs.includes(this.state._id));\r\n      return (\r\n        <Grid item xs={12} container spacing={0} direction=\"column\">\r\n          { this.props.selectedWorld === null ? \"\" :\r\n            <div>\r\n              <Helmet>\r\n                <title>{ `Author's Notebook: ${this.props.selectedWorld.Name}` }</title>\r\n              </Helmet>\r\n              <Grid item container spacing={0} direction=\"row\">\r\n                <Grid item xs={12} sm={8} container spacing={0} direction=\"column\">\r\n                  <Grid item container spacing={0} direction=\"row\">\r\n                    <Grid item xs={1}>\r\n                      <Tooltip title={`Back to ${this.props.selectedWorld.Name}`}>\r\n                        <Fab size=\"small\"\r\n                          color=\"primary\"\r\n                          onClick={ _ => {this.setState({redirectTo:`/world/details/${this.props.selectedWorldID}`})}}\r\n                        >\r\n                          <ArrowBack />\r\n                        </Fab>\r\n                      </Tooltip>\r\n                    </Grid>\r\n                    <Grid item xs={11}>\r\n                      <h2>{this.state.Name}</h2>\r\n                    </Grid>\r\n                  </Grid>\r\n                  <Grid item>{this.state.Description}</Grid>\r\n                </Grid>\r\n                <Grid item xs={12} sm={4}>\r\n                  <List>\r\n                    { (this.props.user !== null && \r\n                      this.props.selectedWorld !== null && \r\n                      (this.props.selectedWorld.Owner === this.props.user._id || \r\n                        this.props.selectedWorld.Collaborators.filter(c=>c.userID === this.props.user._id && c.type === \"collab\" && c.editPermission).length > 0)) &&\r\n                      <ListItem>\r\n                        <Box display={{ xs: 'block', sm: 'none' }} width={1}>\r\n                          <Grid container spacing={1} direction=\"row\">\r\n                            <Grid item xs={3}>\r\n                              &nbsp;\r\n                            </Grid>\r\n                            <Grid item xs={4}>\r\n                              <Tooltip title={`Edit ${this.state.Name}`}>\r\n                                <Fab size=\"small\"\r\n                                  color=\"primary\"\r\n                                  onClick={ _ => {this.setState({redirectTo:`/thing/edit/${this.state._id}`})}}\r\n                                >\r\n                                  <Edit />\r\n                                </Fab>\r\n                              </Tooltip>\r\n                            </Grid>\r\n                            <Grid item xs={5}>\r\n                              <Tooltip title={`Delete ${this.state.Name}`}>\r\n                                <Fab size=\"small\"\r\n                                  color=\"primary\"\r\n                                  onClick={e => {this.setState({modalOpen: true})}}\r\n                                >\r\n                                  <Delete />\r\n                                </Fab>\r\n                              </Tooltip>\r\n                            </Grid>\r\n                          </Grid>\r\n                        </Box>\r\n                        <Box display={{ xs: 'none', sm: 'block' }}>\r\n                          <Grid container spacing={1} direction=\"column\">\r\n                            <Grid item>\r\n                              <Tooltip title={`Edit ${this.state.Name}`}>\r\n                                <Fab size=\"small\"\r\n                                  color=\"primary\"\r\n                                  onClick={ _ => {this.setState({redirectTo:`/thing/edit/${this.state._id}`})}}\r\n                                >\r\n                                  <Edit />\r\n                                </Fab>\r\n                              </Tooltip>\r\n                            </Grid>\r\n                            <Grid item>\r\n                              <Tooltip title={`Delete ${this.state.Name}`}>\r\n                                <Fab size=\"small\"\r\n                                  color=\"primary\"\r\n                                  onClick={e => {this.setState({modalOpen: true})}}\r\n                                >\r\n                                  <Delete />\r\n                                </Fab>\r\n                              </Tooltip>\r\n                            </Grid>\r\n                          </Grid>\r\n                        </Box>\r\n                      </ListItem>\r\n                    }\r\n                    <ListItem>\r\n                      { this.state.majorType === null ?\r\n                        <Button\r\n                          fullWidth\r\n                          variant=\"contained\"\r\n                          color=\"primary\"\r\n                          onClick={_ => {\r\n                            this.redirectToNext();\r\n                          }}\r\n                        >\r\n                          <ListItemText primary=\"Next\" />\r\n                        </Button>\r\n                      :\r\n                        <Button\r\n                          fullWidth\r\n                          variant=\"contained\"\r\n                          color=\"primary\"\r\n                          onClick={_ => {\r\n                            this.redirectToNext();\r\n                          }}\r\n                        >\r\n                          <ListItemText primary={`Next ${this.state.majorType.Name}`}/>\r\n                        </Button>\r\n                      }\r\n                    </ListItem>\r\n                  </List> \r\n                </Grid>\r\n              </Grid>\r\n              <Grid item container spacing={0} direction=\"row\">\r\n                <Grid item xs={12} sm={8}>\r\n                  Attributes\r\n                  <List>\r\n                    { this.props.selectedThing !== null && this.props.selectedThing !== undefined &&\r\n                      this.props.selectedThing.AttributesArr.map(\r\n                        (attribute, i) => {\r\n                          return (\r\n                            <ListItem key={i}>\r\n                              { attribute.AttributeType === \"Type\" && attribute.Value !== \"\" ?\r\n                                <ThingTable \r\n                                  attributesByID={this.props.attributesByID} \r\n                                  label={attribute.Name} \r\n                                  things={this.props.things.filter(t=>t._id === attribute.Value)} \r\n                                  allThings={this.props.things}\r\n                                />\r\n                              : attribute.AttributeType === \"List\" && attribute.ListType === \"Type\" ?\r\n                                <ThingTable \r\n                                  attributesByID={this.props.attributesByID} \r\n                                  label={attribute.Name} \r\n                                  things={this.props.things.filter(t=>attribute.ListValues.includes(t._id))} \r\n                                  allThings={this.props.things}\r\n                                  buttonClick={thingID => {\r\n                                    this.setState({redirectTo:`/thing/details/${thingID}`});\r\n                                  }}\r\n                                />\r\n                              : attribute.AttributeType === \"List\" ?\r\n                                attribute.ListValues.map(\r\n                                  (listValue, i) => {\r\n                                    return(\r\n                                      <span key={i}>\r\n                                        { \r\n                                          i > 0 ? `, ${listValue}` : `${listValue}`\r\n                                        }\r\n                                      </span>\r\n                                    );\r\n                                  })\r\n                              : \r\n                                <span>{attribute.Name}:&nbsp;{attribute.Value}</span>\r\n                              }\r\n                            </ListItem>\r\n                          );\r\n                        }\r\n                      )\r\n                    }\r\n                  </List>\r\n                </Grid>\r\n                <Grid item xs={12} sm={4} container spacing={0} direction=\"column\">\r\n                  { this.state.Types.length > 0 && \r\n                    <Grid item>\r\n                      <List>\r\n                        <ListItem>\r\n                          <ListItemText primary={\"Types\"} />\r\n                        </ListItem>\r\n                        {this.state.Types.map((type, i) => {\r\n                          return (\r\n                            <ListItem key={i}>\r\n                              <Button fullWidth\r\n                                variant=\"contained\"\r\n                                color=\"primary\"\r\n                                onClick={ _ => {this.setState({redirectTo:`/type/details/${type._id}`})}}\r\n                              >\r\n                                <ListItemText primary={type.Name} />\r\n                              </Button>\r\n                            </ListItem>\r\n                          );\r\n                        })}\r\n                      </List>\r\n                    </Grid>\r\n                  }\r\n                  { references.length > 0 &&\r\n                    <Grid item>\r\n                      <List>\r\n                        <ListItem>\r\n                          <ListItemText primary={\"Referenced in:\"} />\r\n                        </ListItem>\r\n                        {references.map((thing, i) => {\r\n                          return (\r\n                            <ListItem key={i}>\r\n                              <Button fullWidth\r\n                                variant=\"contained\"\r\n                                color=\"primary\"\r\n                                onClick={ _ => {this.setState({redirectTo:`/thing/details/${thing._id}`})}}\r\n                              >\r\n                                <ListItemText primary={thing.Name} />\r\n                              </Button>\r\n                            </ListItem>\r\n                          );\r\n                        })}\r\n                      </List>\r\n                    </Grid>\r\n                  }\r\n                </Grid>\r\n              </Grid>\r\n              { this.props.selectedThing !== null &&\r\n                <Grid item xs={12}>\r\n                  <CommentsControl \r\n                    user={this.props.user} \r\n                    object={this.props.selectedThing}\r\n                    objectType=\"Thing\"\r\n                    world={this.props.selectedWorld}\r\n                    api={this.api} \r\n                    onChange={this.commentsChange}\r\n                  /> \r\n                </Grid>\r\n              }\r\n              <Modal\r\n                aria-labelledby=\"delete-thing-modal\"\r\n                aria-describedby=\"delete-thing-modal-description\"\r\n                open={this.state.modalOpen}\r\n                onClose={e => {this.setState({modalOpen: false})}}\r\n              >\r\n                <div style={this.getModalStyle()} className=\"paper\">\r\n                  <Grid container spacing={1} direction=\"column\">\r\n                    <Grid item>\r\n                      Are you sure you want to delete {this.state.Name}?\r\n                    </Grid>\r\n                    <Grid item>\r\n                      (All references to it will be left alone and may not work correctly)\r\n                    </Grid>\r\n                    <Grid item container spacing={1} direction=\"row\">\r\n                      <Grid item xs={6}>\r\n                        <Button\r\n                          fullWidth\r\n                          variant=\"contained\"\r\n                          color=\"primary\"\r\n                          onClick={this.delete}\r\n                        >\r\n                          Yes\r\n                        </Button>\r\n                      </Grid>\r\n                      <Grid item xs={6}>\r\n                        <Button\r\n                          fullWidth\r\n                          variant=\"contained\"\r\n                          onClick={e => {this.setState({modalOpen: false})}}\r\n                        >\r\n                          Cancel\r\n                        </Button>\r\n                      </Grid>\r\n                    </Grid>\r\n                  </Grid>\r\n                </div>\r\n              </Modal>\r\n            </div>\r\n          }\r\n        </Grid>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst ThingDetails = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default ThingDetails;\r\n","/* eslint-disable no-use-before-define */\r\nimport React, { useState } from \"react\";\r\n\r\nimport {\r\n  Grid,\r\n  FormControl,\r\n  OutlinedInput,\r\n  InputLabel,\r\n  FormControlLabel,\r\n  FormHelperText,\r\n  Select,\r\n  MenuItem,\r\n  Checkbox\r\n} from \"@material-ui/core\";\r\nimport InfoIcon from '@material-ui/icons/Info';\r\n\r\nimport ChipInput from \"material-ui-chip-input\";\r\nimport { Multiselect } from \"multiselect-react-dropdown\";\r\n\r\nconst handleTextListChange = (e, props) => {\r\n  const attr = props.attribute;\r\n  attr.ListValues = e;\r\n  props.onChange(attr);\r\n};\r\nconst handleDefinedTypeChange = (e, props, respond) => {\r\n  // const attr = props.attribute;\r\n  // attr[\"DefinedType\"] = e.target.value;\r\n  if (e.target.value === \"new\") {\r\n    // function respond2(newThing) {\r\n    //   // attr[\"DefinedType\"] = newType._id;\r\n    //   // props.onChange(attr);\r\n    //   respond(newThing._id);\r\n    // }\r\n    // props.onNewThing(\r\n    //   // respond2,\r\n    //   props.types.filter(t => t._id === props.attribute.DefinedType)[0]\r\n    // );\r\n    const attr = props.attribute;\r\n    props.onNewThing(attr);\r\n  } else {\r\n    // props.onChange(attr);\r\n    respond(e.target.value);\r\n  }\r\n};\r\nconst addOption = (selectedItem, props) => {\r\n  const attr = props.attribute;\r\n  attr.ListValues.push(selectedItem.Name);\r\n  props.onChange(attr);\r\n};\r\nconst removeOption = (selectedList, props) => {\r\n  const attr = props.attribute;\r\n  attr.ListValues = [];\r\n  selectedList.forEach(o => {\r\n    attr.ListValues.push(o.Name);\r\n  });\r\n  props.onChange(attr);\r\n};\r\nconst addType = (selectedItem, props) => {\r\n  if (selectedItem._id === \"new\") {\r\n    // function respond2(newThing) {\r\n    //   const attr = props.attribute;\r\n    //   attr.ListValues.push(newThing._id);\r\n    //   props.onChange(attr);\r\n    // }\r\n    \r\n    setTimeout(() => {\r\n      const attr = props.attribute;\r\n      props.onNewThing(attr);\r\n    }, 500);\r\n    // props.onNewThing(\r\n    //   // respond2,\r\n    //   // props.types.filter(t => t._id === props.attribute.DefinedType)[0]\r\n    //   props.attribute\r\n    // );\r\n  } else {\r\n    const attr = props.attribute;\r\n    attr.ListValues.push(selectedItem._id);\r\n    props.onChange(attr);\r\n  }\r\n};\r\nconst removeType = (selectedList, props) => {\r\n  const attr = props.attribute;\r\n  attr.ListValues = [];\r\n  selectedList.forEach(o => {\r\n    attr.ListValues.push(o._id);\r\n  });\r\n  props.onChange(attr);\r\n};\r\n\r\nexport default function AttributeControl(props) {\r\n  const [value, changeValue] = useState(props.attribute.Value);\r\n  const attributeType = props.attribute.AttributeType === \"\" ? \"Text\" : props.attribute.AttributeType;\r\n\r\n  const listOptions = [];\r\n  const listOptionValues = [];\r\n  if (attributeType === \"List\" && props.attribute.ListType === \"Options\") {\r\n    props.attribute.Options.forEach(o => {\r\n      listOptions.push({ Name: o });\r\n    });\r\n    props.attribute.ListValues.forEach(o => {\r\n      listOptionValues.push({ Name: o });\r\n    });\r\n  } else if (attributeType === \"List\" && props.attribute.ListType === \"Type\") {\r\n    const definedType = props.types.filter(t => t._id === props.attribute.DefinedType)[0];\r\n    if (definedType !== undefined) {\r\n      listOptions.push({ Name: `+ Create New ${definedType.Name}`, _id: \"new\" });\r\n      props.things\r\n        .filter(t => t.TypeIDs.includes(props.attribute.DefinedType))\r\n        .forEach(t => {\r\n          listOptions.push({ Name: t.Name, _id: t._id });\r\n        });\r\n      listOptions\r\n        .filter(t => props.attribute.ListValues.includes(t._id))\r\n        .forEach(t => {\r\n          listOptionValues.push(t);\r\n        });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Grid item container spacing={1} direction=\"row\">\r\n      <Grid item xs={11}>\r\n        {attributeType === \"Text\" ? (\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor={`attribute_name_${props.attribute.attrID}`}>{props.attribute.Name}</InputLabel>\r\n            <OutlinedInput\r\n              id={`attribute_name_${props.attribute.attrID}`}\r\n              name={`attribute_name_${props.attribute.attrID}`}\r\n              type=\"text\"\r\n              error={props.error}\r\n              value={value}\r\n              autoComplete=\"off\"\r\n              onChange={e => {\r\n                changeValue(e.target.value);\r\n              }}\r\n              onBlur={e => {\r\n                const attr = {\r\n                  index: props.attribute.index,\r\n                  attrID: props.attribute.attrID,\r\n                  Name: props.attribute.Name,\r\n                  AttributeType: props.attribute.AttributeType,\r\n                  Options: props.attribute.Options,\r\n                  DefinedType: props.attribute.DefinedType,\r\n                  ListType: props.attribute.ListType,\r\n                  FromTypes: props.attribute.FromTypes,\r\n                  Value: value,\r\n                  ListValues: props.attribute.ListValues\r\n                };\r\n                props.onChange(attr);\r\n              }}\r\n              labelWidth={props.attribute.Name.length * 9}\r\n              fullWidth\r\n            />\r\n            <FormHelperText>{props.message}</FormHelperText>\r\n          </FormControl>\r\n        ) : attributeType === \"Number\" ? (\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor=\"numField\">{props.attribute.Name}</InputLabel>\r\n            <OutlinedInput\r\n              id=\"numField\"\r\n              name=\"numField\"\r\n              type=\"number\"\r\n              error={props.error}\r\n              value={value}\r\n              autoComplete=\"off\"\r\n              onChange={e => {\r\n                changeValue(e.target.value);\r\n              }}\r\n              onBlur={e => {\r\n                const attr = {\r\n                  index: props.attribute.index,\r\n                  attrID: props.attribute.attrID,\r\n                  Name: props.attribute.Name,\r\n                  AttributeType: props.attribute.AttributeType,\r\n                  Options: props.attribute.Options,\r\n                  DefinedType: props.attribute.DefinedType,\r\n                  ListType: props.attribute.ListType,\r\n                  FromTypes: props.attribute.FromTypes,\r\n                  Value: value,\r\n                  ListValues: props.attribute.ListValues\r\n                };\r\n                props.onChange(attr);\r\n              }}\r\n              labelWidth={props.attribute.Name.length * 9}\r\n              fullWidth\r\n            />\r\n            <FormHelperText>{props.message}</FormHelperText>\r\n          </FormControl>\r\n        ) : attributeType === \"True/False\" ? (\r\n          <FormControlLabel\r\n            control={\r\n              <Checkbox checked={props.attribute.Value===\"True\"} onChange={e => {\r\n                const attr = props.attribute;\r\n                attr.Value = e.target.checked ? \"True\" : \"False\";\r\n                props.onChange(attr);\r\n              }}\r\n              color=\"primary\" />\r\n            }\r\n            label={props.attribute.Name}\r\n          />\r\n        ) : attributeType === \"Options\" ? (\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor=\"options-select\" id=\"options-select-label\">\r\n              {props.attribute.Name}\r\n            </InputLabel>\r\n            <Select\r\n              labelId=\"options-select-label\"\r\n              id=\"options-select\"\r\n              value={value}\r\n              onChange={e => {\r\n                changeValue(e.target.value);\r\n              }}\r\n              onBlur={e => {\r\n                const attr = {\r\n                  index: props.attribute.index,\r\n                  attrID: props.attribute.attrID,\r\n                  Name: props.attribute.Name,\r\n                  AttributeType: props.attribute.AttributeType,\r\n                  Options: props.attribute.Options,\r\n                  DefinedType: props.attribute.DefinedType,\r\n                  ListType: props.attribute.ListType,\r\n                  FromTypes: props.attribute.FromTypes,\r\n                  Value: value,\r\n                  ListValues: props.attribute.ListValues\r\n                };\r\n                props.onChange(attr);\r\n              }}\r\n              fullWidth\r\n              labelWidth={props.attribute.Name.length * 9}\r\n            >\r\n              {props.attribute.Options.map((option, i) => {\r\n                return (\r\n                  <MenuItem key={i} value={option}>\r\n                    {option}\r\n                  </MenuItem>\r\n                );\r\n              })}\r\n            </Select>\r\n          </FormControl>\r\n        ) : attributeType === \"Type\" ? (\r\n          <FormControl variant=\"outlined\" fullWidth>\r\n            <InputLabel htmlFor=\"type-select\" id=\"type-select-label\">\r\n              {props.attribute.Name}\r\n            </InputLabel>\r\n            <Select\r\n              labelId=\"type-select-label\"\r\n              id=\"type-select\"\r\n              value={value}\r\n              onChange={e => {\r\n                handleDefinedTypeChange(e, props, changeValue);\r\n              }}\r\n              onBlur={e => {\r\n                const attr = {\r\n                  index: props.attribute.index,\r\n                  attrID: props.attribute.attrID,\r\n                  Name: props.attribute.Name,\r\n                  AttributeType: props.attribute.AttributeType,\r\n                  Options: props.attribute.Options,\r\n                  DefinedType: props.attribute.DefinedType,\r\n                  ListType: props.attribute.ListType,\r\n                  FromTypes: props.attribute.FromTypes,\r\n                  Value: value,\r\n                  ListValues: props.attribute.ListValues\r\n                };\r\n                props.onChange(attr);\r\n              }}\r\n              fullWidth\r\n              labelWidth={props.attribute.Name.length * 9}\r\n            >\r\n              <MenuItem value=\"new\">\r\n                + Create New{\" \"}\r\n                {props.types.filter(t => t._id === props.attribute.DefinedType)[0].Name}\r\n              </MenuItem>\r\n              {props.things\r\n                .filter(t => t.TypeIDs.includes(props.attribute.DefinedType))\r\n                .map((thing, i) => {\r\n                  return (\r\n                    <MenuItem key={i} value={thing._id}>\r\n                      {thing.Name}\r\n                    </MenuItem>\r\n                  );\r\n                })}\r\n            </Select>\r\n          </FormControl>\r\n        ) : attributeType === \"List\" ? (\r\n          <span>\r\n            {props.attribute.ListType === \"Text\" ? (\r\n              <ChipInput\r\n                placeholder={props.attribute.Name}\r\n                variant=\"outlined\"\r\n                defaultValue={props.attribute.ListValues}\r\n                onChange={chips => handleTextListChange(chips, props)}\r\n              />\r\n            ) : props.attribute.ListType === \"Options\" ? (\r\n              <Multiselect\r\n                placeholder={props.attribute.Name}\r\n                options={listOptions}\r\n                selectedValues={listOptionValues}\r\n                onSelect={(_, selectedItem) => {\r\n                  addOption(selectedItem, props);\r\n                }}\r\n                onRemove={(selectedList, _) => {\r\n                  removeOption(selectedList, props);\r\n                }}\r\n                displayValue=\"Name\"\r\n              />\r\n            ) : props.attribute.ListType === \"Type\" ? (\r\n              <Multiselect\r\n                placeholder={props.attribute.Name}\r\n                options={listOptions}\r\n                selectedValues={listOptionValues}\r\n                onSelect={(_, selectedItem) => {\r\n                  addType(selectedItem, props);\r\n                }}\r\n                onRemove={(selectedList, _) => {\r\n                  removeType(selectedList, props);\r\n                }}\r\n                displayValue=\"Name\"\r\n              />\r\n            ) : (\r\n              \"\"\r\n            )}\r\n          </span>\r\n        ) : (\r\n          \"\"\r\n        )}\r\n      </Grid>\r\n      <Grid item xs={1}>\r\n        <InfoIcon\r\n          style={{ cursor: \"pointer\" }}\r\n          onClick={ _ => {\r\n            props.infoModal(props.attribute);\r\n          }} \r\n        />\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n}\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { \r\n  Grid, Modal, FormControl, InputLabel, \r\n  OutlinedInput, FormHelperText, Button,\r\n  // List,\r\n  // ListItem,\r\n} from \"@material-ui/core\";\r\nimport { \r\n  updateSelectedThing, addThing, logout\r\n} from \"../../redux/actions/index\";\r\nimport AttributeControl from \"./AttributeControl\";\r\nimport API from \"../../smartAPI\";\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedThing: state.app.selectedThing,\r\n    things: state.app.things,\r\n    types: state.app.types,\r\n    selectedWorldID: state.app.selectedWorldID\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    updateSelectedThing: thing => dispatch(updateSelectedThing(thing)),\r\n    addThing: thing => dispatch(addThing(thing)),\r\n    logout: () => dispatch(logout({}))\r\n  };\r\n}\r\nclass Control extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      modalOpen: false,\r\n      infoModalOpen: false,\r\n      // infoAttribute: null,\r\n      Name: \"\",\r\n      fieldValidation: {\r\n        Name: { valid: true, message: \"\" }\r\n      },\r\n      formValid: false,\r\n      message: \"\",\r\n      waiting: false,\r\n      newThingType: null\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  newAttribute = () => {\r\n    const thing = this.props.selectedThing;\r\n    thing.AttributesArr.push({\r\n      index: thing.AttributesArr.length,\r\n      _id: null,\r\n      Name: \"\",\r\n      AttributeType: \"Text\",\r\n      Options: [],\r\n      DefinedType: \"\",\r\n      ListType: \"Text\",\r\n      FromTypes: [],\r\n      Value: \"\",\r\n      ListValues: [],\r\n      FromTypeIDs: [],\r\n      TypeIDs: []\r\n    });\r\n    this.props.updateSelectedThing(thing);\r\n  };\r\n\r\n  changeAttribute = value => {\r\n    const thing = this.props.selectedThing;\r\n    const attribute = thing.AttributesArr.filter(a=>a.attrID === value.attrID)[0];\r\n    attribute.Value = value.Value;\r\n    attribute.ListValues = value.ListValues;\r\n    this.props.updateSelectedThing(thing);\r\n  };\r\n\r\n  blurAttribute = e => {\r\n  };\r\n\r\n  deleteAttribute = value => {\r\n    const thing = this.props.selectedThing;\r\n    thing.AttributesArr.splice(value.index);\r\n    this.props.updateSelectedThing(thing);\r\n  };\r\n\r\n  optionsChange = (e, props) => {\r\n  }\r\n\r\n  // addNewThing = (respond, type) => {\r\n  //   // Opens a Modal where they enter a name.\r\n  //   this.setState({modalOpen: true, modalSubmit: respond, newThingType: type});\r\n  // }\r\n\r\n  addNewThing = (attribute) => {\r\n    this.props.addNewThing(attribute);\r\n  }\r\n\r\n  infoModal = (attribute) => {\r\n    this.props.onInfo(attribute);\r\n  }\r\n  \r\n  getModalStyle = () => {\r\n    const top = Math.round(window.innerHeight / 2) - 100;\r\n    const left = Math.round(window.innerWidth / 2) - 200;\r\n  \r\n    return {\r\n      top: `${top}%`,\r\n      left: `${left}%`,\r\n      transform: `translate(${left}px, ${top}px)`,\r\n    };\r\n  }\r\n\r\n  handleUserInput = e => {\r\n    const name = e.target.name;\r\n    const value =\r\n      e.target.type === \"checkbox\" ? e.target.checked : e.target.value;\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  inputBlur = e => {\r\n    const name = e.target.name;\r\n    const validation = this.validateField(name);\r\n    const fieldValidation = this.state.fieldValidation;\r\n    if (\r\n      fieldValidation[name] !== undefined &&\r\n      fieldValidation[name].valid !== validation.valid\r\n    ) {\r\n      fieldValidation[name].valid = validation.valid;\r\n      fieldValidation[name].message = validation.message;\r\n      this.setState({ fieldValidation: fieldValidation });\r\n    }\r\n  };\r\n\r\n  validateField = fieldName => {\r\n    let value = null;\r\n    let valid = true;\r\n    let message = \"\";\r\n    switch (fieldName) {\r\n      case \"Name\":\r\n        value = this.state[fieldName];\r\n        valid = value.match(/^[a-zA-Z0-9 ]*$/i) !== null;\r\n        if (!valid)\r\n          message = \"Only Letters, Numbers, and Spaces allowed in Thing Names\";\r\n        else if (value.length < 2) {\r\n          valid = false;\r\n          message = \"Thing Name is too short\";\r\n        } else {\r\n          valid =\r\n            this.props.things.filter(\r\n              t => t.Name === value && t._id !== this.state._id\r\n            ).length === 0;\r\n          if (!valid) message = \"This Thing Name is already in use\";\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    const response = { valid: valid, message: message };\r\n    return response;\r\n  };\r\n\r\n  validateForm = respond => {\r\n    const nameValid = this.validateField(\"Name\");\r\n    const formValid = nameValid.valid;\r\n    const fieldValidation = this.state.fieldValidation;\r\n    fieldValidation.Name = nameValid;\r\n    this.setState(\r\n      {\r\n        formValid: formValid,\r\n        fieldValidation: fieldValidation\r\n      },\r\n      respond\r\n    );\r\n  };\r\n\r\n  saveNewThing = () => {\r\n    function respond() {\r\n      if (this.state.formValid) {\r\n        this.setState({ waiting: true }, this.submitThroughAPI);\r\n      }\r\n    }\r\n\r\n    this.validateForm(respond);\r\n  };\r\n\r\n  submitThroughAPI = () => {\r\n    const types = this.props.types.filter(t=> t._id === this.state.newThingType._id || this.state.newThingType.SuperIDs.includes(t._id));\r\n    const typeIDs = types.map(s => {\r\n      return s._id;\r\n    });\r\n    const thing = {\r\n      _id: this.state._id,\r\n      Name: this.state.Name.trim(),\r\n      Description: \"\",\r\n      TypeIDs: typeIDs,\r\n      Attributes: [],\r\n      worldID: this.props.selectedWorldID\r\n    };\r\n\r\n    // Calls API\r\n    this.api\r\n      .createThing(thing)\r\n      .then(res => {\r\n        if (res.thingID !== undefined) {\r\n          thing._id = res.thingID;\r\n          thing.Types = types;\r\n          thing.AttributesArr = [];\r\n          // Adds to props \r\n          this.props.addThing(thing);\r\n          // Calls respond back to Attribute to set the thing\r\n          this.state.modalSubmit(thing);\r\n          this.setState({\r\n            waiting: false, \r\n            modalOpen: false\r\n          });\r\n        }\r\n        else if (res.error !== undefined) {\r\n          this.setState({\r\n            waiting: false, \r\n            message: res.error \r\n          }, () => {\r\n            this.props.logout();\r\n          });\r\n        }\r\n      })\r\n      .catch(err => console.log(err));\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <Grid item xs={12} container spacing={1} direction=\"column\">\r\n        {this.props.selectedThing !== null && this.props.selectedThing !== undefined &&\r\n          this.props.selectedThing.AttributesArr.map((attribute, i) => {\r\n            return (\r\n              <AttributeControl\r\n                key={i}\r\n                thingID={this.props.selectedThing._id}\r\n                attribute={attribute}\r\n                onChange={this.changeAttribute}\r\n                onDelete={this.deleteAttribute}\r\n                onBlur={this.blurAttribute}\r\n                things={this.props.things}\r\n                types={this.props.types}\r\n                onNewThing={this.addNewThing}\r\n                infoModal={this.infoModal}\r\n              />\r\n            );\r\n          })\r\n        }\r\n        <Modal\r\n          aria-labelledby=\"new-thing-modal\"\r\n          aria-describedby=\"new-thing-modal-description\"\r\n          open={this.state.modalOpen}\r\n          onClose={e => {this.setState({modalOpen: false})}}\r\n        >\r\n          <div style={this.getModalStyle()} className=\"paper\">\r\n            <Grid container spacing={1} direction=\"column\">\r\n              <Grid item>\r\n                Just give the new {this.state.newThingType === null ? \"\" : this.state.newThingType.Name} a name.\r\n              </Grid>\r\n              <Grid item>\r\n                (You can do the rest later.)\r\n              </Grid>\r\n              <Grid item>\r\n                <FormControl variant=\"outlined\" fullWidth>\r\n                  <InputLabel htmlFor=\"name\">Name</InputLabel>\r\n                  <OutlinedInput\r\n                    id=\"name\"\r\n                    name=\"Name\"\r\n                    type=\"text\"\r\n                    autoComplete=\"Off\"\r\n                    error={!this.state.fieldValidation.Name.valid}\r\n                    value={this.state.Name}\r\n                    onChange={this.handleUserInput}\r\n                    onBlur={this.inputBlur}\r\n                    labelWidth={43}\r\n                    fullWidth\r\n                  />\r\n                  <FormHelperText>\r\n                    {this.state.fieldValidation.Name.message}\r\n                  </FormHelperText>\r\n                </FormControl>\r\n              </Grid>\r\n              <Grid item container spacing={1} direction=\"row\">\r\n                <Grid item xs={6}>\r\n                  <Button\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    color=\"primary\"\r\n                    disabled={this.state.waiting}\r\n                    onClick={this.saveNewThing}\r\n                  >\r\n                    {this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n                  </Button>\r\n                </Grid>\r\n                <Grid item xs={6}>\r\n                  <Button\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    onClick={e => {this.setState({modalOpen: false})}}\r\n                  >\r\n                    Cancel\r\n                  </Button>\r\n                </Grid>\r\n              </Grid>\r\n            </Grid>\r\n          </div>\r\n        </Modal>\r\n      </Grid>\r\n    );\r\n  }\r\n}\r\n\r\nconst AttributesControl = connect(mapStateToProps, mapDispatchToProps)(Control);\r\nexport default AttributesControl;\r\n","import React, { Component } from \"react\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  updateSelectedThing,\r\n  addThing,\r\n  updateThing,\r\n  updateType,\r\n  addType,\r\n  setAttributes,\r\n  setTypes,\r\n  setThings,\r\n  notFromLogin,\r\n  toggleLogin,\r\n  logout\r\n} from \"../../redux/actions/index\";\r\nimport { \r\n  Button, FormControl, \r\n  OutlinedInput, InputLabel, \r\n  FormHelperText, Grid, \r\n  Fab, Tooltip,\r\n  List, ListItem, ListItemText,\r\n  Select, MenuItem,\r\n  // Modal\r\n} from \"@material-ui/core\";\r\nimport ChipInput from \"material-ui-chip-input\";\r\nimport { ArrowBack, Add, Search } from \"@material-ui/icons\";\r\nimport AttributesControl from \"./AttributesControl\";\r\nimport { Multiselect } from 'multiselect-react-dropdown';\r\nimport { Helmet } from 'react-helmet';\r\nimport API from \"../../smartAPI\";\r\nimport NewTypeModal from \"../../components/Modals/NewTypeModal\";\r\nimport NewThingModal from \"../../components/Modals/NewThingModal\";\r\nimport TextBox from \"../../components/Inputs/TextBox\";\r\n\r\n/* \r\n  This component will take the main portion of the page and is used for\r\n  creating or editing a Thing.  It will allow the use of Types to make\r\n  it faster.\r\n*/\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    selectedPage: state.app.selectedPage,\r\n    selectedThing: state.app.selectedThing,\r\n    selectedWorld: state.app.selectedWorld,\r\n    selectedWorldID: state.app.selectedWorldID,\r\n    things: state.app.things,\r\n    types: state.app.types,\r\n    user: state.app.user,\r\n    attributesByID: state.app.attributesByID,\r\n    attributesByName: state.app.attributesByName,\r\n    fromLogin: state.app.fromLogin\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    updateSelectedThing: thing => dispatch(updateSelectedThing(thing)),\r\n    addThing: thing => dispatch(addThing(thing)),\r\n    updateThing: thing => dispatch(updateThing(thing)),\r\n    updateType: type => dispatch(updateType(type)),\r\n    addType: type => dispatch(addType(type)),\r\n    setAttributes: attributes => dispatch(setAttributes(attributes)),\r\n    setTypes: types => dispatch(setTypes(types)),\r\n    setThings: things => dispatch(setThings(things)),\r\n    notFromLogin: () => dispatch(notFromLogin({})),\r\n    toggleLogin: () => dispatch(toggleLogin({})),\r\n    logout: () => dispatch(logout({}))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      _id: undefined,\r\n      // Name: \"\",\r\n      // Description: \"\",\r\n      // Types: [],\r\n      // AttributesArr: [],\r\n      // Attributes: [],\r\n      fieldValidation: {\r\n        Name: { valid: true, message: \"\" },\r\n        // AttributesArr: { valid: true, message: \"\" },\r\n        Attributes: { valid: true, message: \"\" },\r\n        infoAttributeName: { valid: true, message: \"\" }\r\n      },\r\n      formValid: false,\r\n      message: \"\",\r\n      redirectTo: null,\r\n      waiting: false,\r\n      addMore: \"\",\r\n      resetting: false,\r\n      loaded: true,\r\n      errors: [],\r\n      infoAttribute: null,\r\n      typeModalOpen: false,\r\n      newTypeForAttribute: \"\",\r\n      browseAttributes: false,\r\n      browseAttributesFilter: \"\",\r\n      browseAttributesSelected: \"\",\r\n      thingModalOpen: false,\r\n      newThingType: null,\r\n      putThingOnAttribute: null,\r\n      majorType: null\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  createThingFromType = type => {\r\n    let types = [];\r\n    types.push(type);\r\n    type.Supers.forEach(s=>{\r\n      if (types.filter(t=>t._id === s._id).length === 0) {\r\n        let superType = this.props.types.filter(t=>t._id === s._id);\r\n        if (superType.length > 0)\r\n          types.push(superType[0]);\r\n      }\r\n    });\r\n    const thing = {\r\n      _id: null,\r\n      Name: \"\",\r\n      Description: \"\",\r\n      Types: [],\r\n      Attributes: []\r\n    };\r\n    let newAttributes = [];\r\n    types.forEach(type=> {\r\n      for (let i = 0; i < type.Attributes.length; i++) {\r\n        const attribute = {...type.Attributes[i]};\r\n        let existing = thing.Attributes.filter(a=>a.attrID === attribute.attrID);\r\n        if (existing.length === 0) {\r\n          attribute.FromTypeIDs = [type._id];\r\n          attribute.index = type.Attributes.length + newAttributes.length;\r\n          newAttributes.push(attribute);\r\n        }\r\n        else {\r\n          existing = existing[0];\r\n          if (existing.FromTypeIDs === undefined || existing.FromTypeIDs === null)\r\n            existing.FromTypeIDs = [];\r\n          existing.FromTypeIDs.push(type._id);\r\n        }\r\n      }\r\n    });\r\n    types.forEach(type=> {\r\n      newAttributes.forEach(attribute => {\r\n        if (type.DefaultsHash[attribute.attrID] === undefined || type.DefaultsHash[attribute.attrID].DefaultValue === undefined) {\r\n          attribute.Value = \"\";\r\n          attribute.ListValues = [];\r\n        }\r\n        else {\r\n          attribute.Value = type.DefaultsHash[attribute.attrID].DefaultValue;\r\n          attribute.ListValues = type.DefaultsHash[attribute.attrID].DefaultListValues;\r\n        }\r\n      })\r\n    });\r\n    let attributes = [...thing.Attributes, ...newAttributes];\r\n    thing.Attributes = attributes;\r\n    thing.AttributesArr = [];\r\n    thing.Attributes.forEach(a => {\r\n      const attr = this.props.attributesByID[a.attrID];\r\n      thing.AttributesArr.push({\r\n        index: thing.AttributesArr.length,\r\n        Name: attr.Name,\r\n        AttributeType: attr.AttributeType,\r\n        Options: attr.Options,\r\n        DefinedType: attr.DefinedType,\r\n        ListType: attr.ListType,\r\n        attrID: a.attrID,\r\n        Value: a.Value,\r\n        ListValues: a.ListValues,\r\n        FromTypeIDs: a.FromTypeIDs,\r\n        TypeIDs: attr.TypeIDs\r\n      });\r\n    });\r\n    thing.Types = types;\r\n    this.props.updateSelectedThing(thing);\r\n    this.setState({ \r\n      _id: null, \r\n      // Types: types, \r\n      loaded: true,\r\n      majorType: type\r\n    }); //, errors });\r\n  };\r\n\r\n  resetForm = () => {\r\n    setTimeout(() => {\r\n      let { id } = this.props.match.params;\r\n      if (id !== undefined && !id.includes(\"type_id_\")) {\r\n        this.setState({\r\n          resetting: false, \r\n          redirectTo: `/thing/create`\r\n        });\r\n      }\r\n      else {\r\n        this.setState({\r\n          resetting: false\r\n        }, this.finishResettingForm);\r\n      }\r\n    }, 500);\r\n  };\r\n\r\n  finishResettingForm = () => {\r\n    const { id } = this.props.match.params;\r\n    if (id !== undefined && id.includes(\"type_id_\")) {\r\n      // We're creating it from a type rather than from blank\r\n      const typeID = id.substring(8);\r\n      let type = this.props.types.filter(t=> t._id === typeID);\r\n      if (type.length > 0) {\r\n        type = type[0];\r\n        this.createThingFromType(type);\r\n      }\r\n      else {\r\n        this.setState({ message: \"Invalid Type\" });\r\n      }\r\n    }\r\n  }\r\n\r\n  // handleUserInput = e => {\r\n  //   const name = e.target.name;\r\n  //   const value =\r\n  //     e.target.type === \"checkbox\" ? e.target.checked : e.target.value;\r\n  //   this.setState({ [name]: value });\r\n  // };\r\n\r\n  handleInfoAttrNameChange = e => {\r\n    const infoAttribute = this.state.infoAttribute;\r\n    infoAttribute.Name = e.target.value;\r\n    this.setState({ infoAttribute });\r\n  };\r\n\r\n  inputBlur = e => {\r\n    const name = e.target.name;\r\n    const validation = this.validateField(name);\r\n    const fieldValidation = this.state.fieldValidation;\r\n    if (\r\n      fieldValidation[name] !== undefined &&\r\n      (fieldValidation[name].valid !== validation.valid ||\r\n        fieldValidation[name].message !== validation.message)\r\n    ) {\r\n      fieldValidation[name].valid = validation.valid;\r\n      fieldValidation[name].message = validation.message;\r\n      this.setState({ fieldValidation: fieldValidation });\r\n    }\r\n  };\r\n\r\n  inputBlur2 = e => {\r\n    const name = \"infoAttributeName\";\r\n    const validation = this.validateField(name);\r\n    const fieldValidation = this.state.fieldValidation;\r\n    if (\r\n      fieldValidation[name] !== undefined &&\r\n      (fieldValidation[name].valid !== validation.valid ||\r\n        fieldValidation[name].message !== validation.message)\r\n    ) {\r\n      fieldValidation[name].valid = validation.valid;\r\n      fieldValidation[name].message = validation.message;\r\n      this.setState({ fieldValidation: fieldValidation });\r\n    }\r\n  };\r\n\r\n  addSelectedAttribute = () => {\r\n    const thing = this.props.selectedThing;\r\n    const attr = this.props.attributesByID[this.state.browseAttributesSelected];\r\n    const attributes = thing.Attributes;\r\n    const AttributesArr = thing.AttributesArr;\r\n    attributes.push({\r\n      attrID: this.state.browseAttributesSelected,\r\n      Value: \"\",\r\n      ListValues: [],\r\n      index: attributes.length,\r\n      FromTypeIDs: []\r\n    });\r\n    AttributesArr.push({\r\n      attrID: this.state.browseAttributesSelected,\r\n      index: AttributesArr.length,\r\n      Value: \"\",\r\n      ListValues: [],\r\n      Name: attr.Name,\r\n      AttributeType: attr.AttributeType,\r\n      Options: attr.Options,\r\n      DefinedType: attr.DefinedType,\r\n      ListType: attr.ListType,\r\n      FromTypeIDs: [],\r\n      TypeIDs: attr.TypeIDs\r\n    });\r\n    thing.Attributes = [];\r\n    thing.AttributesArr = [];\r\n    this.props.updateSelectedThing(thing);\r\n    setTimeout(() => {\r\n      thing.Attributes = attributes;\r\n      thing.AttributesArr = AttributesArr;\r\n      this.props.updateSelectedThing(thing);\r\n      this.setState({ browseAttributesSelected: \"\" });\r\n    }, 500);\r\n  }\r\n\r\n  validateField = fieldName => {\r\n    let value = null;\r\n    let valid = true;\r\n    let message = \"\";\r\n    switch (fieldName) {\r\n      case \"Name\":\r\n        value = this.props.selectedThing[fieldName].trim();\r\n        valid = value.match(/^[a-zA-Z0-9 ]*$/i) !== null;\r\n        if (!valid)\r\n          message = \"Only Letters, Numbers, and Spaces allowed in Thing Names\";\r\n        else if (value.length < 2) {\r\n          valid = false;\r\n          message = \"Thing Name is too short\";\r\n        } else {\r\n          valid =\r\n            this.props.things.filter(\r\n              t => t.Name === value && t._id !== this.state._id\r\n            ).length === 0;\r\n          if (!valid) message = \"This Thing Name is already in use\";\r\n        }\r\n        break;\r\n      case \"infoAttributeName\":\r\n        value = this.state.infoAttribute.Name.trim();\r\n        valid = value.match(/^[a-zA-Z0-9 ]*$/i) !== null;\r\n        if (!valid)\r\n          message = \"Only Letters, Numbers, and Spaces allowed in Attribute Names\";\r\n        else if (value.length < 2) {\r\n          valid = false;\r\n          message = \"Attribute Name is too short\";\r\n        } else {\r\n          const attrByName = this.props.attributesByName[value];\r\n          valid = attrByName === undefined || attrByName._id === this.state.infoAttribute.attrID;\r\n          if (!valid) message = \"There is another Attribute with this name.\";\r\n        }\r\n        break;\r\n      case \"AttributesArr\":\r\n        valid = true;\r\n        value = this.props.selectedThing[fieldName];\r\n        value.forEach(a => {\r\n          if (valid && value.filter(attr2 => attr2.Name === a.Name).length > 1) {\r\n            valid = false;\r\n          }\r\n        });\r\n        message = valid ? \"\" : \"Attribute Names must be unique\";\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    const response = { valid: valid, message: message };\r\n    return response;\r\n  };\r\n\r\n  validateForm = respond => {\r\n    const nameValid = this.validateField(\"Name\");\r\n    const attrValid = this.validateField(\"AttributesArr\");\r\n    const formValid = nameValid.valid && attrValid.valid;\r\n    const fieldValidation = this.state.fieldValidation;\r\n    fieldValidation.Name = nameValid;\r\n    fieldValidation.Attributes = attrValid;\r\n    this.setState(\r\n      {\r\n        formValid: formValid,\r\n        fieldValidation: fieldValidation\r\n      },\r\n      respond\r\n    );\r\n  };\r\n\r\n  validateAttrForm = respond => {\r\n    const nameValid = this.validateField(\"infoAttributeName\");\r\n    const fieldValidation = this.state.fieldValidation;\r\n    fieldValidation.infoAttributeName = nameValid;\r\n    this.setState(\r\n      {\r\n        fieldValidation: fieldValidation\r\n      },\r\n      respond\r\n    );\r\n  };\r\n\r\n  onSubmit = (addMore) => {\r\n    function respond() {\r\n      if (this.state.formValid) {\r\n        this.setState({ \r\n          waiting: true, \r\n          addMore: addMore \r\n        }, \r\n        this.submitThroughAPI);\r\n      }\r\n    }\r\n\r\n    this.validateForm(respond);\r\n  };\r\n\r\n  submitThroughAPI = () => {\r\n    const typeIDs = this.props.selectedThing.Types.map(s => {\r\n      return s._id;\r\n    });\r\n    const thing = {\r\n      _id: this.state._id,\r\n      Name: this.props.selectedThing.Name.trim(),\r\n      Description: this.props.selectedThing.Description.trim(),\r\n      TypeIDs: typeIDs,\r\n      // AttributesArr: this.props.selectedThing.AttributesArr,\r\n      Attributes: [],\r\n      worldID: this.props.selectedWorld._id,\r\n      ReferenceIDs: []\r\n    };\r\n    this.props.selectedThing.AttributesArr.forEach(a => {\r\n      thing.Attributes.push({\r\n        attrID: a.attrID,\r\n        index: a.index,\r\n        Value: a.Value.trim(),\r\n        ListValues: a.ListValues\r\n      });\r\n      if (a.AttributeType === \"Type\") {\r\n        if (!thing.ReferenceIDs.includes(a.Value)) {\r\n          thing.ReferenceIDs.push(a.Value);\r\n        }\r\n      }\r\n      if (a.AttributeType === \"List\" && a.ListType === \"Type\") {\r\n        a.ListValues.forEach(v=> {\r\n          if (!thing.ReferenceIDs.includes(v)) {\r\n            thing.ReferenceIDs.push(v);\r\n          }\r\n        });\r\n      }\r\n    });\r\n    if (thing._id === null) {\r\n      this.api\r\n        .createThing(thing)\r\n        .then(res => {\r\n          if (res.error === undefined){\r\n            // thing._id = res.thingID;\r\n            // thing.Types = this.state.Types;\r\n            // thing.AttributesArr = this.props.selectedThing.AttributesArr;\r\n            // this.props.addThing(thing);\r\n            this.api.getWorld(this.props.selectedWorldID, true).then(res2 => {\r\n              this.props.setAttributes(res2.attributes);\r\n              this.props.setTypes(res2.types);\r\n              this.props.setThings(res2.things);\r\n\r\n              if (this.state.addMore === \"add\") {\r\n                this.props.updateSelectedThing({\r\n                  _id: null,\r\n                  Name: \"\",\r\n                  Description: \"\",\r\n                  Types: [],\r\n                  Attributes: [],\r\n                  AttributesArr: []\r\n                });\r\n                this.setState({\r\n                  _id: null,\r\n                  // Name: \"\",\r\n                  // Description: \"\",\r\n                  // Types: [],\r\n                  // Attributes: [],\r\n                  fieldValidation: {\r\n                    Name: { valid: true, message: \"\" },\r\n                    Attributes: { valid: true, message: \"\" }\r\n                  },\r\n                  formValid: false,\r\n                  message: \"\",\r\n                  waiting: false,\r\n                  resetting: true\r\n                }, this.resetForm);\r\n              } else if (this.state.addMore === \"next\") {\r\n                this.redirectToNext();\r\n              } else {\r\n                this.setState({\r\n                  waiting: false,\r\n                  redirectTo: `/world/details/${this.props.selectedWorld._id}`\r\n                });\r\n              }\r\n            });\r\n          }\r\n          else {\r\n            this.setState({message: res.error}, () => {\r\n              this.props.logout();\r\n            });\r\n          }\r\n        })\r\n        .catch(err => console.log(err));\r\n    } else {\r\n      this.api\r\n        .updateThing(thing)\r\n        .then(res => {\r\n          if (res.error === undefined) {\r\n            this.api.getWorld(this.props.selectedWorldID, true).then(res2 => {\r\n              this.props.setAttributes(res2.attributes);\r\n              this.props.setTypes(res2.types);\r\n              this.props.setThings(res2.things);\r\n              \r\n              if (this.state.addMore === \"add\") {\r\n                this.props.updateSelectedThing({\r\n                  _id: null,\r\n                  Name: \"\",\r\n                  Description: \"\",\r\n                  Types: [],\r\n                  Attributes: [],\r\n                  AttributesArr: []\r\n                });\r\n                this.setState({\r\n                  // Name: \"\",\r\n                  // Description: \"\",\r\n                  // Types: [],\r\n                  // Attributes: [],\r\n                  fieldValidation: {\r\n                    Name: { valid: true, message: \"\" },\r\n                    Attributes: { valid: true, message: \"\" }\r\n                  },\r\n                  formValid: false,\r\n                  message: \"\",\r\n                  waiting: false,\r\n                  addMore: false,\r\n                  resetting: true\r\n                }, this.resetForm);\r\n              } else if (this.state.addMore === \"next\") {\r\n                this.redirectToNext();\r\n              } else {\r\n                this.setState({\r\n                  waiting: false,\r\n                  redirectTo: `/world/details/${this.props.selectedWorld._id}`\r\n                });\r\n              }\r\n            });\r\n          }\r\n          else {\r\n            this.setState({message: res.error}, () => {\r\n              this.props.logout();\r\n            });\r\n          }\r\n        })\r\n        .catch(err => console.log(err));\r\n    }\r\n  };\r\n\r\n  typesChange = (e, value) => {\r\n    let types = [];\r\n    for (let i = 0; i < value.length; i++) {\r\n      const t = value[i];\r\n      types.push(t);\r\n      types = types.concat(t.Types);\r\n    }\r\n    const thing = this.props.selectedThing;\r\n    thing.Types = types;\r\n    this.props.updateSelectedThing(thing);\r\n    // this.setState({ Types: types });\r\n  };\r\n\r\n  addType = (selectedList, selectedItem) => {\r\n    const thing = this.props.selectedThing;\r\n    const newTypes = {};\r\n    newTypes[selectedItem._id] = selectedItem;\r\n    selectedItem.Supers.forEach(s=>{\r\n      if (selectedList.filter(t=>t._id === s._id).length === 0) {\r\n        let superType = this.props.types.filter(t=>t._id === s._id);\r\n        if (superType.length > 0 && selectedList.filter(t=>t._id === superType[0]._id).length === 0){\r\n          selectedList.push(superType[0]);\r\n          newTypes[superType[0]._id] = superType[0];\r\n        }\r\n      }\r\n      if (this.props.selectedThing.Types.filter(t=>t._id === s._id).length === 0){\r\n        newTypes[s._id] = s;\r\n      }\r\n    });\r\n    let newAttributes = [];\r\n    Object.keys(newTypes).forEach(typeID => {\r\n      const type = newTypes[typeID];\r\n      type.Attributes.forEach(a => {\r\n        const attribute = {...a};\r\n        let existing = thing.Attributes.filter(a=>a.attrID === attribute.attrID);\r\n        if (existing.length === 0) {\r\n          attribute.FromTypeIDs = [type._id];\r\n          attribute.index = type.Attributes.length + newAttributes.length;\r\n          // attribute.attrID = \r\n          newAttributes.push(attribute);\r\n        }\r\n        else {\r\n          existing = existing[0];\r\n          if (existing.FromTypeIDs === undefined || existing.FromTypeIDs === null)\r\n            existing.FromTypeIDs = [];\r\n          existing.FromTypeIDs.push(type._id);\r\n        }\r\n      });\r\n    });\r\n    Object.keys(newTypes).forEach(typeID => {\r\n      const type = newTypes[typeID];\r\n      newAttributes.forEach(attribute => {\r\n        if (type.DefaultsHash === undefined || type.DefaultsHash[attribute.attrID] === undefined || type.DefaultsHash[attribute.attrID].DefaultValue === undefined) {\r\n          attribute.Value = \"\";\r\n          attribute.ListValues = [];\r\n        }\r\n        else {\r\n          if (attribute.Value === undefined) {\r\n            attribute.Value = \"\";\r\n            attribute.ListValues = [];\r\n          }\r\n          if (attribute.Value === \"\") {\r\n            attribute.Value = type.DefaultsHash[attribute.attrID].DefaultValue;\r\n          }\r\n          type.DefaultsHash[attribute.attrID].DefaultListValues.forEach(listValue => {\r\n            if (!attribute.ListValues.includes(listValue))\r\n              attribute.ListValues.push(listValue);\r\n          });\r\n        }\r\n      })\r\n    });\r\n    let attributes = [...thing.Attributes, ...newAttributes];\r\n    // this.setState({ Types: selectedList });\r\n    thing.Types = selectedList;\r\n    thing.Attributes = attributes;\r\n    thing.AttributesArr = [];\r\n    const AttributesArr = [];\r\n    thing.Attributes.forEach(a => {\r\n      const attr = this.props.attributesByID[a.attrID];\r\n      AttributesArr.push({\r\n        index: thing.AttributesArr.length,\r\n        Name: attr.Name,\r\n        AttributeType: attr.AttributeType,\r\n        Options: attr.Options,\r\n        DefinedType: attr.DefinedType,\r\n        ListType: attr.ListType,\r\n        attrID: a.attrID,\r\n        Value: a.Value,\r\n        ListValues: a.ListValues,\r\n        FromTypeIDs: a.FromTypeIDs,\r\n        TypeIDs: attr.TypeIDs\r\n      });\r\n    });\r\n    this.props.updateSelectedThing(thing);\r\n    setTimeout(() => {\r\n      thing.Attributes = attributes;\r\n      thing.AttributesArr = AttributesArr;\r\n      this.props.updateSelectedThing(thing);\r\n    }, 500);\r\n  }\r\n\r\n  addType2 = (type) => {\r\n    const types = this.props.selectedThing.Types;\r\n    types.push(type);\r\n    // this.addType(types, type);\r\n\r\n    const newTypes = [type];\r\n    const thing = this.props.selectedThing;\r\n    type.Supers.forEach(s=>{\r\n      if (types.filter(t=>t._id === s._id).length === 0) {\r\n        let superType = this.props.types.filter(t=>t._id === s._id);\r\n        if (superType.length > 0 && types.filter(t=>t._id === superType[0]._id).length === 0){\r\n          types.push(superType[0]);\r\n          newTypes.push(superType[0]);\r\n        }\r\n      }\r\n      if (this.props.selectedThing.Types.filter(t=>t._id === s._id).length === 0){\r\n        newTypes.push(s);\r\n      }\r\n    });\r\n    let newAttributes = [];\r\n    newTypes.forEach(type => {\r\n      type.Attributes.forEach(a => {\r\n        const attribute = {...a};\r\n        let existing = thing.Attributes.filter(a=>a.attrID === attribute.attrID);\r\n        if (existing.length === 0) {\r\n          attribute.FromTypeIDs = [type._id];\r\n          attribute.index = type.Attributes.length + newAttributes.length;\r\n          // attribute.attrID = \r\n          newAttributes.push(attribute);\r\n        }\r\n        else {\r\n          existing = existing[0];\r\n          if (existing.FromTypeIDs === undefined || existing.FromTypeIDs === null)\r\n            existing.FromTypeIDs = [];\r\n          existing.FromTypeIDs.push(type._id);\r\n        }\r\n      });\r\n    });\r\n    newTypes.forEach(type=> {\r\n      newAttributes.forEach(attribute => {\r\n        if (type.DefaultsHash === undefined || type.DefaultsHash[attribute.attrID] === undefined || type.DefaultsHash[attribute.attrID].DefaultValue === undefined) {\r\n          attribute.Value = \"\";\r\n          attribute.ListValues = [];\r\n        }\r\n        else {\r\n          attribute.Value = type.DefaultsHash[attribute.attrID].DefaultValue;\r\n          attribute.ListValues = type.DefaultsHash[attribute.attrID].DefaultListValues;\r\n        }\r\n      })\r\n    });\r\n    let attributes = [...thing.Attributes, ...newAttributes];\r\n    this.setState({ \r\n      // Types: types, \r\n      resetting: true \r\n    });\r\n    thing.Types = types;\r\n    thing.Attributes = attributes;\r\n    thing.AttributesArr = [];\r\n    const AttributesArr = [];\r\n    thing.Attributes.forEach(a => {\r\n      const attr = this.props.attributesByID[a.attrID];\r\n      AttributesArr.push({\r\n        index: thing.AttributesArr.length,\r\n        Name: attr.Name,\r\n        AttributeType: attr.AttributeType,\r\n        Options: attr.Options,\r\n        DefinedType: attr.DefinedType,\r\n        ListType: attr.ListType,\r\n        attrID: a.attrID,\r\n        Value: a.Value,\r\n        ListValues: a.ListValues,\r\n        FromTypeIDs: a.FromTypeIDs,\r\n        TypeIDs: attr.TypeIDs\r\n      });\r\n    });\r\n    this.props.updateSelectedThing(thing);\r\n    setTimeout(() => {\r\n      thing.Attributes = attributes;\r\n      thing.AttributesArr = AttributesArr;\r\n      this.props.updateSelectedThing(thing);\r\n      this.setState({ resetting: false, infoAttribute: null });\r\n    }, 500);\r\n  }\r\n\r\n  selectNewTypeForAttribute = (e) => {\r\n    if (e.target.value === \"new\") {\r\n      function respond(newType) {\r\n        // attr[\"DefinedType\"] = newType._id;\r\n        this.setState({ newTypeForAttribute: newType._id });\r\n      }\r\n      this.setState({ typeModalOpen: true, modalSubmit: respond});\r\n    }\r\n    else \r\n      this.setState({ newTypeForAttribute: e.target.value });\r\n  }\r\n\r\n  saveInfoAttribute = () => {\r\n    function respond() {\r\n      if (this.state.fieldValidation.infoAttributeName.valid) {\r\n        this.setState({ \r\n          waiting: true\r\n        }, \r\n        this.submitAttributeThroughAPI);\r\n      }\r\n    }\r\n\r\n    this.validateAttrForm(respond);\r\n  }\r\n\r\n  submitAttributeThroughAPI = () => {\r\n    // Need to upsert the attribute, and then move forward\r\n\r\n    const attributes = [{\r\n      _id: this.state.infoAttribute.attrID,\r\n      Name: this.state.infoAttribute.Name.trim(),\r\n      AttributeType: this.state.infoAttribute.AttributeType,\r\n      Options: this.state.infoAttribute.Options,\r\n      DefinedType: this.state.infoAttribute.DefinedType,\r\n      ListType: this.state.infoAttribute.ListType\r\n    }];\r\n    \r\n    this.api.upsertAttributes(this.props.selectedWorldID, attributes).then(res => {\r\n      if (res.error === undefined) {\r\n        // res.attributes is a hash with the name as key and id as value\r\n        this.api.getWorld(this.props.selectedWorldID, true).then(res2 => {\r\n          this.props.setAttributes(res2.attributes);\r\n          this.props.setTypes(res2.types);\r\n          this.props.setThings(res2.things);\r\n          \r\n          const attribute = this.state.infoAttribute;\r\n          if (this.state.newTypeForAttribute !== \"\") {\r\n            attribute.TypeIDs.push(this.state.newTypeForAttribute);\r\n            attribute.FromTypeIDs.push(this.state.newTypeForAttribute);\r\n          }\r\n          const thing = this.props.selectedThing;\r\n          if (attribute.attrID === null) {\r\n            attribute.attrID = res.attributes[attribute.Name];\r\n            // Add it to the Thing's attributes\r\n            const attr2 = {\r\n              attrID: attribute.attrID,\r\n              index: thing.Attributes.length,\r\n              Value: \"\",\r\n              ListValues: []\r\n            };\r\n            thing.Attributes.push(attr2);\r\n            thing.AttributesArr.push({\r\n              attrID: attribute.attrID,\r\n              index: attr2.index,\r\n              Value: \"\",\r\n              ListValues: [],\r\n              Name: attribute.Name,\r\n              AttributeType: attribute.AttributeType,\r\n              Options: attribute.Options,\r\n              DefinedType: attribute.DefinedType,\r\n              ListType: attribute.ListType,\r\n              FromTypeIDs: attribute.FromTypeIDs,\r\n              TypeIDs: attribute.TypeIDs\r\n            });\r\n          }\r\n          else {\r\n            // Update the attribute on the Thing\r\n            const attr2 = thing.AttributesArr.filter(a => a.attrID === attribute.attrID)[0];\r\n            attr2.Name = attribute.Name;\r\n            attr2.AttributeType = attribute.AttributeType;\r\n            attr2.Options = attribute.Options;\r\n            attr2.DefinedType = attribute.DefinedType;\r\n            attr2.ListType = attribute.ListType;\r\n            attr2.FromTypeIDs = attribute.FromTypeIDs;\r\n            attr2.TypeIDs = attribute.TypeIDs;\r\n          }\r\n          if (attribute.FromTypeIDs.length === 0) {\r\n            this.props.updateSelectedThing(thing);\r\n            this.setState({infoAttribute: null, waiting: false});\r\n          }\r\n          else {\r\n            // Need to add it to the type\r\n            const theType = this.props.types.filter(t => t._id === attribute.FromTypeIDs[0])[0];\r\n            const type = {\r\n              _id: theType._id,\r\n              Name: theType.Name,\r\n              Description: theType.Description,\r\n              SuperIDs: theType.SuperIDs,\r\n              // AttributesArr: this.props.selectedType.AttributesArr,\r\n              Attributes: theType.Attributes,\r\n              Defaults: theType.Defaults,\r\n              worldID: this.props.selectedWorld._id,\r\n              Major: theType.Major,\r\n              ReferenceIDs: theType.ReferenceIDs,\r\n              DefaultReferenceIDs: theType.DefaultReferenceIDs\r\n            };\r\n            type.Attributes.push({\r\n              attrID: attribute.attrID,\r\n              index: type.Attributes.length,\r\n              // Name: a.Name,\r\n              // AttributeType: a.AttributeType,\r\n              // Options: a.Options,\r\n              // DefinedType: a.DefinedType,\r\n              // ListType: a.ListType\r\n            });\r\n            this.api\r\n              .updateType(type)\r\n              .then(res => {\r\n                if (res.error === undefined) {\r\n                  type.Supers = [];\r\n                  type.SuperIDs.forEach(sID=> {\r\n                    type.Supers = type.Supers.concat(this.props.types.filter(t2=>t2._id === sID));\r\n                  });\r\n                  type.AttributesArr = [];\r\n                  type.Attributes.forEach(a => {\r\n                    const attr = this.props.attributesByID[a.attrID];\r\n                    type.AttributesArr.push({\r\n                      index: type.AttributesArr.length,\r\n                      Name: attr.Name,\r\n                      AttributeType: attr.AttributeType,\r\n                      Options: attr.Options,\r\n                      DefinedType: attr.DefinedType,\r\n                      ListType: attr.ListType,\r\n                      attrID: a.attrID\r\n                    });\r\n                  });\r\n                  const defHash = {};\r\n                  if (type.Defaults !== undefined) {\r\n                    type.Defaults.forEach(def => {\r\n                      defHash[def.attrID] = def;\r\n                    });\r\n                  }\r\n                  type.DefaultsHash = defHash;\r\n                  this.props.updateType(type);\r\n\r\n                  function respond() {\r\n                    this.addType2(type);\r\n                  }\r\n                  \r\n                  this.setState({\r\n                    infoAttribute: null, waiting: false\r\n                  }, respond);\r\n                }\r\n                else {\r\n                  this.setState({\r\n                    waiting: false, \r\n                    message: res.error \r\n                  }, () => {\r\n                    this.props.logout();\r\n                  });\r\n                }\r\n              })\r\n              .catch(err => console.log(err));\r\n          }\r\n        });\r\n      }\r\n      else {\r\n        this.setState({ message: res.error, waiting: false }, () => {\r\n          this.props.logout();\r\n        });\r\n      }\r\n    });\r\n  }\r\n  \r\n  removeType = (selectedList, removedItem) => {\r\n    // TODO: Add a confirmation before doing this\r\n    // to let them know it will also remove sub-types.\r\n    let types = [];\r\n    let removeUs = [];\r\n    this.props.selectedThing.Types.forEach(checkMe => {\r\n      if (checkMe._id === removedItem._id || checkMe.SuperIDs.includes(removedItem._id))\r\n        removeUs.push(checkMe._id);\r\n      else types.push(checkMe);\r\n    });\r\n    const thing = this.props.selectedThing;\r\n    let attributes = [...thing.Attributes];\r\n    attributes.forEach(attribute => {\r\n      const newFromTypeIDs = [];\r\n      attribute.FromTypeIDs.forEach(typeID => {\r\n        if (!removeUs.includes(typeID))\r\n          newFromTypeIDs.push(typeID);\r\n      });\r\n      attribute.FromTypeIDs = newFromTypeIDs;\r\n    });\r\n    // this.setState({ Types: types });\r\n    thing.Types = types;\r\n    thing.Attributes = attributes;\r\n    thing.AttributesArr = [];\r\n    thing.Attributes.forEach(a => {\r\n      const attr = this.props.attributesByID[a.attrID];\r\n      thing.AttributesArr.push({\r\n        index: thing.AttributesArr.length,\r\n        Name: attr.Name,\r\n        AttributeType: attr.AttributeType,\r\n        Options: attr.Options,\r\n        DefinedType: attr.DefinedType,\r\n        ListType: attr.ListType,\r\n        attrID: a.attrID,\r\n        Value: a.Value,\r\n        ListValues: a.ListValues,\r\n        FromTypeIDs: a.FromTypeIDs,\r\n        TypeIDs: attr.TypeIDs\r\n      });\r\n    });\r\n    this.props.updateSelectedThing(thing);\r\n  }\r\n\r\n  redirectToNext = () => {\r\n    // Find the next thing\r\n    const things = this.state.majorType === null ? this.props.things : this.props.things.filter(t => t.TypeIDs.includes(this.state.majorType._id));\r\n    let index = 0;\r\n    if (this.props.selectedThing === undefined || this.props.selectedThing._id !== null) {\r\n      while (things[index]._id !== this.props.selectedThing._id)\r\n        index++;\r\n      index++;\r\n    }\r\n    if (index === things.length)\r\n      index = 0;\r\n    this.setState({ \r\n      waiting: false, \r\n      redirectTo: `/thing/edit/${things[index]._id}` \r\n    });\r\n  }\r\n\r\n  renderHeader() {\r\n    let typeStr = \"Thing\";\r\n    this.props.selectedThing.Types.forEach(t=>{\r\n      if (t.Major) { \r\n        if (typeStr === \"Thing\") {\r\n          typeStr = t.Name;\r\n        }\r\n        else {\r\n          typeStr += \"/\" + t.Name;\r\n        }\r\n      }\r\n    });\r\n    return <h2>{this.state._id === null ? `Create New ${typeStr}` : `Edit ${typeStr}`}</h2>;\r\n  }\r\n\r\n  load = (id) => {\r\n    setTimeout(() => {\r\n      this.setState({\r\n        _id: id,\r\n        redirectTo: null,\r\n        loaded: false\r\n      }, this.finishLoading);\r\n    }, 500);\r\n  }\r\n\r\n  finishLoading = () => {\r\n    this.api.getWorld(this.props.selectedWorldID).then(res => {\r\n      this.props.setAttributes(res.attributes);\r\n      this.props.setTypes(res.types);\r\n      this.props.setThings(res.things);\r\n      \r\n      if (this.props.fromLogin) {\r\n        this.props.notFromLogin();\r\n        this.setState({\r\n          // _id: id,\r\n          loaded: true,\r\n          message: \"\"\r\n        });\r\n      }\r\n      else {\r\n        if (this.state._id !== null) {\r\n          // We're editing an existing Thing\r\n          let thing = res.things.filter(t => t._id === this.state._id);\r\n          if (thing.length === 0) {\r\n            this.setState({ message: \"Invalid ID\" });\r\n          }\r\n          else {\r\n            thing = thing[0];\r\n            // const things = this.props.things.filter(\r\n            //   t => t._id !== thing._id\r\n            // );\r\n            let Types = [];\r\n            thing.TypeIDs.forEach(tID=> {\r\n              Types = Types.concat(this.props.types.filter(t2=>t2._id === tID));\r\n            });\r\n            let newAttributes = [];\r\n            Types.forEach(type=> {\r\n              for (let i = 0; i < type.Attributes.length; i++) {\r\n                const attribute = {...type.Attributes[i]};\r\n                let existing = thing.Attributes.filter(a=>a.attrID === attribute.attrID);\r\n                if (existing.length === 0) {\r\n                  attribute.FromTypeIDs = [type._id];\r\n                  attribute.index = thing.Attributes.length + newAttributes.length;\r\n                  newAttributes.push(attribute);\r\n                }\r\n                else {\r\n                  existing = existing[0];\r\n                  if (existing.FromTypeIDs === undefined || existing.FromTypeIDs === null)\r\n                    existing.FromTypeIDs = [];\r\n                  existing.FromTypeIDs.push(type._id);\r\n                }\r\n              }\r\n            });\r\n            Types.forEach(type=> {\r\n              newAttributes.forEach(attribute => {\r\n                if (type.DefaultsHash[attribute.attrID] === undefined || type.DefaultsHash[attribute.attrID].DefaultValue === undefined) {\r\n                  attribute.Value = \"\";\r\n                  attribute.ListValues = [];\r\n                }\r\n                else {\r\n                  attribute.Value = type.DefaultsHash[attribute.attrID].DefaultValue;\r\n                  attribute.ListValues = type.DefaultsHash[attribute.attrID].DefaultListValues;\r\n                }\r\n              })\r\n            });\r\n            let attributes = [...thing.Attributes, ...newAttributes];\r\n            thing.Attributes = attributes;\r\n            thing.AttributesArr = [];\r\n            thing.Attributes.forEach(a => {\r\n              const attr = this.props.attributesByID[a.attrID];\r\n              thing.AttributesArr.push({\r\n                index: thing.AttributesArr.length,\r\n                Name: attr.Name,\r\n                AttributeType: attr.AttributeType,\r\n                Options: attr.Options,\r\n                DefinedType: attr.DefinedType,\r\n                ListType: attr.ListType,\r\n                attrID: a.attrID,\r\n                Value: a.Value,\r\n                ListValues: a.ListValues,\r\n                FromTypeIDs: a.FromTypeIDs,\r\n                TypeIDs: attr.TypeIDs\r\n              });\r\n            });\r\n            thing.Types = Types;\r\n            this.props.updateSelectedThing(thing);\r\n            if (this.state.majorType === null) {\r\n              let majorType = thing.Types.filter(t=>t.Major);\r\n              if (majorType.length > 0) {\r\n                majorType = majorType[0];\r\n                \r\n                this.setState({\r\n                  loaded: true,\r\n                  majorType\r\n                });\r\n              }\r\n              else {\r\n                this.setState({\r\n                  loaded: true\r\n                });\r\n              }\r\n            }\r\n            else {\r\n              this.setState({\r\n                loaded: true\r\n              });\r\n            }\r\n          }\r\n        } else {\r\n          let { id } = this.props.match.params;\r\n          if (id !== undefined && id.includes(\"type_id_\")) {\r\n            // We're creating it from a type rather than from blank\r\n            const typeID = id.substring(8);\r\n            let type = this.props.types.filter(t=> t._id === typeID);\r\n            if (type.length > 0) {\r\n              type = type[0];\r\n              this.createThingFromType(type);\r\n            }\r\n            else {\r\n              this.setState({ message: \"Invalid Type\", loaded: true });\r\n            }\r\n          }\r\n          else {\r\n            // We're creating a new thing from blank.\r\n            this.props.updateSelectedThing({\r\n              _id: null,\r\n              Name: \"\",\r\n              Description: \"\",\r\n              Types: [],\r\n              Attributes: [],\r\n              AttributesArr: []\r\n            });\r\n            this.setState({ loaded: true });\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  render() {\r\n    let { id } = this.props.match.params;\r\n    if (id === undefined || id.includes(\"type_id_\"))\r\n      id = null;\r\n    if (this.state._id !== id) {\r\n      this.load(id);\r\n      return (<span>Loading...</span>);\r\n    } else if (this.state.redirectTo !== null) {\r\n      return <Redirect to={this.state.redirectTo} />;\r\n    } else if (this.props.selectedWorld !== null && \r\n      !this.props.selectedWorld.Public && \r\n      this.props.user === null) {\r\n      setTimeout(() => {\r\n        this.props.toggleLogin();\r\n      }, 500);\r\n      return <span>Requires Login</span>;\r\n    } else if (this.props.selectedWorld !== null && \r\n      !this.props.selectedWorld.Public && \r\n      (this.props.selectedWorld.Owner !== this.props.user._id && \r\n          this.props.selectedWorld.Collaborators.filter(c=>c.userID === this.props.user._id && c.type === \"collab\" && c.editPermission).length === 0)) {\r\n      return <Redirect to=\"/\" />;\r\n    } else if (this.props.selectedThing === null || this.props.selectedThing._id !== id) {\r\n      return <span>Loading...</span>;\r\n    } else if (this.state.typeModalOpen) {\r\n      return (\r\n        <NewTypeModal \r\n          types={this.props.types}\r\n          selectedWorldID={this.props.selectedWorldID}\r\n          onCancel={_ => {\r\n            this.setState({typeModalOpen: false});\r\n          }}\r\n          addType={type => {\r\n            this.props.addType(type);\r\n          }}\r\n          onSave={type => {\r\n            this.setState({typeModalOpen: false, newTypeForAttribute: type._id});\r\n          }}\r\n          api={this.api}\r\n          logout={() => {\r\n            this.props.logout();\r\n          }}\r\n        />\r\n      );\r\n    } else if (this.state.infoAttribute !== null) {\r\n      const connectedTypes = this.props.types.filter(t=> this.state.infoAttribute.FromTypeIDs.includes(t._id));\r\n      const otherTypes = this.props.types.filter(t=> !this.state.infoAttribute.FromTypeIDs.includes(t._id) && this.state.infoAttribute.TypeIDs.includes(t._id));\r\n      if (connectedTypes.length === 0) {\r\n        if (otherTypes.length === 0) {\r\n          const attributeTypes = [\r\n            \"Text\",\r\n            \"Number\",\r\n            \"True/False\",\r\n            \"Options\", \r\n            \"Type\", \r\n            \"List\"\r\n          ];\r\n          const listTypes = [\r\n            \"Text\",\r\n            \"Options\", \r\n            \"Type\"\r\n          ];\r\n          // This attribute isn't on any types, so we need to give the ability to add it to a type, as well as to edit it.\r\n          return (\r\n            <Grid item xs={12} container spacing={1} direction=\"column\">\r\n              <Grid item>\r\n                <List>\r\n                  <ListItem style={{fontSize:\"30px\"}}>Attribute Info</ListItem>\r\n                  <ListItem>\r\n                    <FormControl variant=\"outlined\" fullWidth>\r\n                      <InputLabel htmlFor=\"infoAttributeName\">Name</InputLabel>\r\n                      <OutlinedInput\r\n                        id=\"infoAttributeName\"\r\n                        name=\"infoAttributeName\"\r\n                        type=\"text\"\r\n                        autoComplete=\"Off\"\r\n                        error={!this.state.fieldValidation.infoAttributeName.valid}\r\n                        value={this.state.infoAttribute.Name}\r\n                        onChange={this.handleInfoAttrNameChange}\r\n                        onBlur={this.inputBlur2}\r\n                        labelWidth={43}\r\n                        fullWidth\r\n                      />\r\n                      <FormHelperText>\r\n                        {this.state.fieldValidation.infoAttributeName.message}\r\n                      </FormHelperText>\r\n                    </FormControl>\r\n                  </ListItem>\r\n                  <ListItem>\r\n                    <FormControl variant=\"outlined\" fullWidth>\r\n                      <InputLabel htmlFor=\"attribute-type\" id=\"attribute-type-label\">\r\n                        Attribute Type\r\n                      </InputLabel>\r\n                      <Select\r\n                        labelId=\"attribute-type-label\"\r\n                        id=\"attribute-type\"\r\n                        disabled={this.state.waiting}\r\n                        // disabled={props.attribute.FromSupers.length > 0} \r\n                        value={this.state.infoAttribute.AttributeType}\r\n                        onChange={e => {\r\n                          const attr = this.state.infoAttribute;\r\n                          attr[\"AttributeType\"] = e.target.value;\r\n                          this.setState({ infoAttribute: attr });\r\n                        }}\r\n                        fullWidth\r\n                        labelWidth={100}\r\n                      >\r\n                        {attributeTypes.map((type, i) => {\r\n                          return (<MenuItem key={i} value={type}>{type}</MenuItem>);\r\n                        })}\r\n                      </Select>\r\n                    </FormControl>\r\n                  </ListItem>\r\n                  { this.state.infoAttribute.AttributeType === \"List\" && \r\n                    <ListItem>\r\n                      <FormControl variant=\"outlined\" fullWidth>\r\n                        <InputLabel htmlFor=\"list-type\" id=\"list-type-label\">\r\n                          List Type\r\n                        </InputLabel>\r\n                        <Select\r\n                          labelId=\"list-type-label\"\r\n                          id=\"list-type\"\r\n                          disabled={this.state.waiting}\r\n                          // disabled={props.attribute.FromSupers.length > 0} \r\n                          value={this.state.infoAttribute.ListType}\r\n                          onChange={e => {\r\n                            const attr = this.state.infoAttribute;\r\n                            attr[\"ListType\"] = e.target.value;\r\n                            this.setState({ infoAttribute: attr });\r\n                          }}\r\n                          fullWidth\r\n                          labelWidth={70}\r\n                        >\r\n                          {listTypes.map((type, i) => {\r\n                            return (<MenuItem key={i} value={type}>{type}</MenuItem>);\r\n                          })}\r\n                        </Select>\r\n                      </FormControl>\r\n                    </ListItem> \r\n                  }\r\n                  { (this.state.infoAttribute.AttributeType === \"Type\" || (this.state.infoAttribute.AttributeType === \"List\" && this.state.infoAttribute.ListType === \"Type\")) && \r\n                    <ListItem>\r\n                      <FormControl variant=\"outlined\" fullWidth>\r\n                        <InputLabel htmlFor=\"definedType\" id=\"definedType-label\">\r\n                          Defined Type\r\n                        </InputLabel>\r\n                        <Select\r\n                          labelId=\"definedType-label\"\r\n                          id=\"definedType\"\r\n                          disabled={this.state.waiting}\r\n                          // disabled={props.attribute.FromSupers.length > 0} \r\n                          value={this.state.infoAttribute.DefinedType}\r\n                          onChange={e => {\r\n                            const attr = this.state.infoAttribute;\r\n                            attr[\"DefinedType\"] = e.target.value;\r\n                            if (e.target.value === \"new\") {\r\n                              function respond(newType) {\r\n                                attr[\"DefinedType\"] = newType._id;\r\n                                this.setState({ typeModalOpen: false, infoAttribute: attr });\r\n                              }\r\n                              this.setState({ typeModalOpen: true, modalSubmit: respond});\r\n                            }\r\n                            else \r\n                              this.setState({ infoAttribute: attr });\r\n                          }}\r\n                          fullWidth\r\n                          labelWidth={100}\r\n                        >\r\n                          <MenuItem value=\"new\">+ Create New Type</MenuItem>\r\n                          {this.props.types.map((type, i) => {\r\n                            return (<MenuItem key={i} value={type._id}>{type.Name}</MenuItem>);\r\n                          })}\r\n                        </Select>\r\n                      </FormControl>\r\n                    </ListItem> \r\n                  }\r\n                  { (this.state.infoAttribute.AttributeType === \"Options\" || (this.state.infoAttribute.AttributeType === \"List\" && this.state.infoAttribute.ListType === \"Options\")) && \r\n                    <ListItem>\r\n                      <ChipInput\r\n                        variant=\"outlined\"\r\n                        disabled={this.state.waiting}\r\n                        // disabled={props.attribute.FromSupers.length > 0}\r\n                        defaultValue={this.state.infoAttribute.Options}\r\n                        onChange={chips => {\r\n                          const attr = this.state.infoAttribute;\r\n                          attr[\"Options\"] = chips;\r\n                          this.setState({ infoAttribute: attr });\r\n                        }}\r\n                      />\r\n                    </ListItem>\r\n                  }\r\n                  <ListItem>\r\n                    Select a Type to add this attribute to, and to add to {this.props.selectedThing.Name}\r\n                  </ListItem>\r\n                  <ListItem>\r\n                    <FormControl variant=\"outlined\" fullWidth>\r\n                      <InputLabel htmlFor=\"newTypeForAttribute\" id=\"newTypeForAttribute-label\">\r\n                        Type For Attribute\r\n                      </InputLabel>\r\n                      <Select\r\n                        labelId=\"newTypeForAttribute-label\"\r\n                        id=\"newTypeForAttribute\"\r\n                        value={this.state.newTypeForAttribute}\r\n                        onChange={e => {this.selectNewTypeForAttribute(e)}}\r\n                        fullWidth\r\n                        labelWidth={125}\r\n                      >\r\n                        <MenuItem value=\"new\">+ Create New Type</MenuItem>\r\n                        {this.props.types.map((type, i) => {\r\n                          return (<MenuItem key={i} value={type._id}>{type.Name}</MenuItem>);\r\n                        })}\r\n                      </Select>\r\n                    </FormControl>\r\n                  </ListItem>\r\n                </List>\r\n              </Grid>\r\n              <Grid item>{this.state.message}</Grid>\r\n              <Grid item container spacing={1} direction=\"row\">\r\n                <Grid item xs={6}>\r\n                  <Button\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    color=\"primary\"\r\n                    disabled={this.state.waiting}\r\n                    onClick={this.saveInfoAttribute}\r\n                  >\r\n                    {this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n                  </Button>\r\n                </Grid>\r\n                <Grid item xs={6}>\r\n                  <Button\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    onClick={_ => {this.setState({infoAttribute: null})}}\r\n                  >\r\n                    Cancel\r\n                  </Button>\r\n                </Grid>\r\n              </Grid>\r\n            </Grid>\r\n          );\r\n        }\r\n        else {\r\n          return (\r\n            <Grid item xs={12} container spacing={1} direction=\"column\">\r\n              <Grid item>\r\n                <List>\r\n                  <ListItem style={{fontSize:\"30px\"}}>Attribute Info</ListItem>\r\n                  <ListItem>Name: {this.state.infoAttribute.Name}</ListItem>\r\n                  <ListItem>Type: {this.state.infoAttribute.AttributeType}</ListItem>\r\n                  { this.state.infoAttribute.AttributeType === \"List\" && \r\n                    <ListItem>List Type: {this.state.infoAttribute.ListType}</ListItem> \r\n                  }\r\n                  { (this.state.infoAttribute.AttributeType === \"Type\" || (this.state.infoAttribute.AttributeType === \"List\" && this.state.infoAttribute.ListType === \"Type\")) && \r\n                    <ListItem>\r\n                      Defined Type: \r\n                      <Button\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={ _ => {this.setState({redirectTo:`/type/details/${this.state.infoAttribute.DefinedType}`})}}\r\n                      >\r\n                        {this.props.types.filter(t=>t._id === this.state.infoAttribute.DefinedType)[0].Name}\r\n                      </Button>\r\n                    </ListItem> \r\n                  }\r\n                  { (this.state.infoAttribute.AttributeType === \"Options\" || (this.state.infoAttribute.AttributeType === \"List\" && this.state.infoAttribute.ListType === \"Options\")) && \r\n                    <ListItem>\r\n                      Options: \r\n                      {this.state.infoAttribute.Options.map((option, j) => {\r\n                        return (\r\n                          <span key={j}>\r\n                            {j === 0 ? \" \" : \", \"}\r\n                            {option}\r\n                          </span>\r\n                        );\r\n                      })}\r\n                    </ListItem>\r\n                  }\r\n                  <ListItem>\r\n                    { otherTypes.length === 1 ? \"Type associated with this attribute:\" : \"Types associated with this attribute:\" }\r\n                    <List>\r\n                      { otherTypes.map((type, j) => {\r\n                        return (\r\n                          <span key={j}>\r\n                            <Button\r\n                              variant=\"contained\"\r\n                              color=\"primary\"\r\n                              onClick={ _ => {this.setState({redirectTo:`/type/details/${type._id}`})}}\r\n                            >\r\n                              {type.Name}\r\n                            </Button>\r\n\r\n                            <Button\r\n                              variant=\"contained\"\r\n                              color=\"primary\"\r\n                              onClick={ _ => {this.addType2(type)}}\r\n                            >\r\n                              Add {type.Name} to {this.props.selectedThing.Name}\r\n                            </Button>\r\n                          </span>\r\n                        );\r\n                      })}\r\n                    </List>\r\n                  </ListItem>\r\n                </List>\r\n              </Grid>\r\n              <Grid item container spacing={1} direction=\"row\">\r\n                <Grid item xs={6}>\r\n                  {/* <Button\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    color=\"primary\"\r\n                    disabled={this.state.waiting}\r\n                    onClick={this.saveNewThing}\r\n                  >\r\n                    {this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n                  </Button> */}\r\n                </Grid>\r\n                <Grid item xs={6}>\r\n                  <Button\r\n                    fullWidth\r\n                    variant=\"contained\"\r\n                    onClick={e => {this.setState({infoAttribute: null})}}\r\n                  >\r\n                    Cancel\r\n                  </Button>\r\n                </Grid>\r\n              </Grid>\r\n            </Grid>\r\n          );\r\n        }\r\n      }\r\n      else {\r\n        return (\r\n          <Grid item xs={12} container spacing={1} direction=\"column\">\r\n            <Grid item>\r\n              <List>\r\n                <ListItem style={{fontSize:\"30px\"}}>Attribute Info</ListItem>\r\n                <ListItem>Name: {this.state.infoAttribute.Name}</ListItem>\r\n                <ListItem>Type: {this.state.infoAttribute.AttributeType}</ListItem>\r\n                { this.state.infoAttribute.AttributeType === \"List\" && \r\n                  <ListItem>List Type: {this.state.infoAttribute.ListType}</ListItem> \r\n                }\r\n                { (this.state.infoAttribute.AttributeType === \"Type\" || (this.state.infoAttribute.AttributeType === \"List\" && this.state.infoAttribute.ListType === \"Type\")) && \r\n                  <ListItem>\r\n                    Defined Type: \r\n                    <Button\r\n                      variant=\"contained\"\r\n                      color=\"primary\"\r\n                      onClick={ _ => {this.setState({redirectTo:`/type/details/${this.state.infoAttribute.DefinedType}`})}}\r\n                    >\r\n                      {this.props.types.filter(t=>t._id === this.state.infoAttribute.DefinedType)[0].Name}\r\n                    </Button>\r\n                  </ListItem> \r\n                }\r\n                { (this.state.infoAttribute.AttributeType === \"Options\" || (this.state.infoAttribute.AttributeType === \"List\" && this.state.infoAttribute.ListType === \"Options\")) && \r\n                  <ListItem>\r\n                    Options: \r\n                    {this.state.infoAttribute.Options.map((option, j) => {\r\n                      return (\r\n                        <span key={j}>\r\n                          {j === 0 ? \" \" : \", \"}\r\n                          {option}\r\n                        </span>\r\n                      );\r\n                    })}\r\n                  </ListItem>\r\n                }\r\n                { connectedTypes.length > 0 &&\r\n                  <ListItem>\r\n                    { connectedTypes.length === 1 ? \"From Type:\" : \"From Types:\" }\r\n                    {\r\n                      connectedTypes.map((type, j) => {\r\n                        return (\r\n                          <span key={j}>\r\n                            {j === 0 ? \" \" : \", \"}\r\n                            <Button\r\n                              variant=\"contained\"\r\n                              color=\"primary\"\r\n                              onClick={ _ => {this.setState({redirectTo:`/type/details/${type._id}`})}}\r\n                            >\r\n                              {type.Name}\r\n                            </Button>\r\n                          </span>\r\n                        );\r\n                      })\r\n                    }\r\n                  </ListItem>\r\n                }\r\n                { otherTypes.length > 0 &&\r\n                  <ListItem>\r\n                    { otherTypes.length === 1 ? \"Other Associated Type:\" : \"Other Associated Types:\" }\r\n                    { otherTypes.map((type, j) => {\r\n                      return (\r\n                        <span key={j}>\r\n                          {j === 0 ? \" \" : \", \"}\r\n                          <Button\r\n                            variant=\"contained\"\r\n                            color=\"primary\"\r\n                            onClick={ _ => {this.setState({redirectTo:`/type/details/${type._id}`})}}\r\n                          >\r\n                            {type.Name}\r\n                          </Button>\r\n                        </span>\r\n                      );\r\n                    })}\r\n                  </ListItem>\r\n                }\r\n              </List>\r\n            </Grid>\r\n            <Grid item>\r\n              <Button\r\n                variant=\"contained\"\r\n                onClick={e => {this.setState({infoAttribute: null})}}\r\n              >\r\n                Cancel\r\n              </Button>\r\n            </Grid>\r\n          </Grid>\r\n        );\r\n      }\r\n    } else if (this.state.thingModalOpen) {\r\n      return (\r\n        <NewThingModal \r\n          things={this.props.things}\r\n          newThingType={this.state.newThingType}\r\n          selectedWorldID={this.props.selectedWorldID}\r\n          onCancel={_ => {\r\n            this.setState({\r\n              thingModalOpen: false\r\n            });\r\n          }}\r\n          addThing={thing => {\r\n            this.props.addThing(thing);\r\n          }}\r\n          onSave={newThing => {\r\n            this.setState({\r\n              thingModalOpen: false\r\n            }, _ => {\r\n              // Need to put it on putThingOnAttribute\r\n              const thing = this.props.selectedThing;\r\n              const attr = thing.AttributesArr.filter(a => a.attrID === this.state.putThingOnAttribute.attrID)[0];\r\n              if (attr.AttributeType === \"Type\") {\r\n                attr.Value = newThing._id;\r\n              }\r\n              else {\r\n                // The only way it can be here is if it's List and ListType is Type\r\n                attr.ListValues.push(newThing._id);\r\n              }\r\n              this.props.updateSelectedThing(thing);\r\n            });\r\n          }}\r\n          api={this.api}\r\n          logout={() => {\r\n            this.props.logout();\r\n          }}\r\n        />\r\n      );\r\n    } else {\r\n      let additionalAttributes = [];\r\n      if (this.state.browseAttributes) {\r\n        Object.keys(this.props.attributesByID).forEach(id => {\r\n          if (this.props.selectedThing.Attributes.filter(a => a.attrID === id).length === 0){\r\n            additionalAttributes.push(this.props.attributesByID[id]);\r\n          }\r\n        });\r\n      }\r\n      return (\r\n        <Grid item xs={12} container spacing={1} direction=\"column\">\r\n          { this.props.selectedWorld !== null &&\r\n            <Grid item container spacing={1} direction=\"column\">\r\n              <Helmet>\r\n                <title>{ `Author's Notebook: ${this.props.selectedWorld.Name}` }</title>\r\n              </Helmet>\r\n              <Grid item container spacing={1} direction=\"row\">\r\n                <Grid item xs={1}>\r\n                  <Tooltip title={`Back to ${this.props.selectedWorld.Name}`}>\r\n                    <Fab size=\"small\"\r\n                      color=\"primary\"\r\n                      onClick={ _ => {this.setState({redirectTo:`/world/details/${this.props.selectedWorldID}`})}}\r\n                    >\r\n                      <ArrowBack />\r\n                    </Fab>\r\n                  </Tooltip>\r\n                </Grid>\r\n                <Grid item xs={7} sm={9}>\r\n                  {this.renderHeader()}\r\n                </Grid>\r\n                <Grid item xs={4} sm={2}>\r\n                  <ListItem>\r\n                    { this.state.majorType === null && this.props.things.length > 1 ?\r\n                      <Button\r\n                        fullWidth\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={_ => {\r\n                          this.redirectToNext();\r\n                        }}\r\n                      >\r\n                        <ListItemText primary=\"Next\" />\r\n                      </Button>\r\n                    : this.state.majorType !== null && this.props.things.filter(t => t.TypeIDs.includes(this.state.majorType._id)).length > 1 &&\r\n                      <Button\r\n                        fullWidth\r\n                        variant=\"contained\"\r\n                        color=\"primary\"\r\n                        onClick={_ => {\r\n                          this.redirectToNext();\r\n                        }}\r\n                      >\r\n                        <ListItemText primary={`Next ${this.state.majorType.Name}`}/>\r\n                      </Button>\r\n                    }\r\n                  </ListItem>\r\n                </Grid>\r\n              </Grid>\r\n              <Grid item>\r\n                { this.state.loaded &&  \r\n                  <TextBox \r\n                    Value={this.props.selectedThing.Name} \r\n                    fieldName=\"Name\" \r\n                    message={this.state.fieldValidation.Name.message}\r\n                    onBlur={name => {\r\n                      const thing = this.props.selectedThing;\r\n                      thing.Name = name;\r\n                      this.props.updateSelectedThing(thing);\r\n                      this.validateForm();\r\n                      // this.setState({ Name: name }, this.validateForm);\r\n                    }}\r\n                    labelWidth={43}/>\r\n                }\r\n              </Grid>\r\n              <Grid item>\r\n                { this.state.loaded &&  \r\n                  <TextBox \r\n                    Value={this.props.selectedThing.Description} \r\n                    fieldName=\"Description\" \r\n                    multiline={true}\r\n                    onBlur={desc => {\r\n                      const thing = this.props.selectedThing;\r\n                      thing.Description = desc;\r\n                      this.props.updateSelectedThing(thing);\r\n                      // this.setState({ Description: desc });\r\n                    }}\r\n                    labelWidth={82}/>\r\n                }\r\n              </Grid>\r\n              <Grid item>\r\n                { !this.state.resetting &&\r\n                  <Multiselect\r\n                    placeholder=\"Types\"\r\n                    options={this.props.types}\r\n                    selectedValues={this.props.selectedThing.Types}\r\n                    onSelect={this.addType}\r\n                    onRemove={this.removeType}\r\n                    displayValue=\"Name\"\r\n                  />\r\n                }\r\n              </Grid>\r\n              <Grid item container spacing={1} direction=\"column\">\r\n                <Grid item>\r\n                  <span>Attributes&nbsp;\r\n                    <Tooltip title={`Add New Attribute`}>\r\n                      <Fab size=\"small\"\r\n                        color=\"primary\"\r\n                        onClick={ _ => {\r\n                          this.setState({ infoAttribute: {\r\n                            index: this.props.selectedThing.AttributesArr.length,\r\n                            Name: \"\",\r\n                            AttributeType: \"Text\",\r\n                            Options: [],\r\n                            DefinedType: \"\",\r\n                            ListType: \"\",\r\n                            attrID: null,\r\n                            Value: \"\",\r\n                            ListValues: [],\r\n                            FromTypeIDs: [],\r\n                            TypeIDs: []\r\n                          }});\r\n                        }}\r\n                      >\r\n                        <Add />\r\n                      </Fab>\r\n                    </Tooltip>\r\n                    <Tooltip title={`Browse Additional Attributes`}>\r\n                      <Fab\r\n                        size=\"small\"\r\n                        color=\"primary\"\r\n                        onClick={e => {\r\n                          this.setState({ browseAttributes: !this.state.browseAttributes });\r\n                        }}\r\n                      >\r\n                        <Search />\r\n                      </Fab>\r\n                    </Tooltip>\r\n                  </span>\r\n                </Grid>\r\n                { this.state.browseAttributes && \r\n                  <Grid item container spacing={1} direction=\"row\">\r\n                    <Grid item xs={12} sm={6}>\r\n                      <FormControl variant=\"outlined\" fullWidth>\r\n                        <InputLabel htmlFor=\"browseForAttributes\" id=\"browseForAttributes-label\">\r\n                          Browse Additional Attributes\r\n                        </InputLabel>\r\n                        <Select\r\n                          labelId=\"browseForAttributes-label\"\r\n                          id=\"browseForAttributes\"\r\n                          value={this.state.browseAttributesSelected}\r\n                          onChange={e => {\r\n                            this.setState({ browseAttributesSelected: e.target.value });\r\n                          }}\r\n                          fullWidth\r\n                          labelWidth={200}\r\n                        >\r\n                          {additionalAttributes.map((attr, i) => {\r\n                            return (<MenuItem key={i} value={attr._id}>{attr.Name}</MenuItem>);\r\n                          })}\r\n                        </Select>\r\n                      </FormControl>\r\n                    </Grid>\r\n                    <Grid item xs={12} sm={6}>\r\n                      <Button\r\n                        variant=\"contained\" color=\"primary\"\r\n                        disabled={ this.state.browseAttributesSelected === \"\" }\r\n                        onClick={e => {this.addSelectedAttribute();}}\r\n                        type=\"submit\"\r\n                      >\r\n                        Add Attribute\r\n                      </Button>\r\n                    </Grid>\r\n                  </Grid>\r\n                }\r\n                { !this.state.resetting && this.state.loaded &&\r\n                  <AttributesControl \r\n                    addNewThing={attribute => {\r\n                      this.setState({ \r\n                        thingModalOpen: true,\r\n                        newThingType: this.props.types.filter(t => t._id === attribute.DefinedType)[0],\r\n                        putThingOnAttribute: attribute\r\n                      });\r\n                    }} \r\n                    onInfo={e => {\r\n                      this.setState({ infoAttribute: e});\r\n                    }} />\r\n                }\r\n                <FormHelperText>\r\n                  {this.state.fieldValidation.Attributes.message}\r\n                </FormHelperText>\r\n              </Grid>\r\n              <Grid item>\r\n                <div className=\"float-right\">\r\n                  { ((this.state.majorType === null && this.props.things.length > 0) || (this.state.majorType !== null && this.props.things.filter(t => t.TypeIDs.includes(this.state.majorType._id)).length > 0)) && \r\n                    <Button\r\n                      variant=\"contained\" color=\"primary\"\r\n                      disabled={this.state.waiting}\r\n                      onClick={e => {this.onSubmit(\"next\")}}\r\n                      type=\"submit\"\r\n                    >\r\n                      {this.state.waiting ? \"Please Wait\" : \"Submit and Edit Next\"}\r\n                    </Button>\r\n                  }\r\n                  <Button\r\n                    variant=\"contained\" color=\"primary\"\r\n                    style={{marginLeft: \"4px\"}}\r\n                    disabled={this.state.waiting}\r\n                    onClick={e => {this.onSubmit(\"add\")}}\r\n                    type=\"submit\"\r\n                  >\r\n                    {this.state.waiting ? \"Please Wait\" : \"Submit and Create Another\"}\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"contained\" color=\"primary\"\r\n                    style={{marginLeft: \"4px\"}}\r\n                    className=\"w200\"\r\n                    disabled={this.state.waiting}\r\n                    onClick={e => {this.onSubmit(\"\")}}\r\n                    type=\"submit\"\r\n                  >\r\n                    {this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n                  </Button>\r\n                  <Button\r\n                    variant=\"contained\"\r\n                    style={{marginLeft: \"4px\"}}\r\n                    disabled={this.state.waiting}\r\n                    onClick={_ => {\r\n                      if (this.props.selectedThing._id === null) {\r\n                        this.setState({\r\n                          redirectTo: `/world/details/${this.props.selectedWorldID}`\r\n                        });\r\n                      }\r\n                      else {\r\n                        this.setState({\r\n                          redirectTo: `/thing/details/${this.props.selectedThing._id}`\r\n                        });\r\n                      }\r\n                    }}\r\n                    type=\"button\"\r\n                  >\r\n                    Cancel\r\n                  </Button>\r\n                </div>\r\n              </Grid>\r\n              <Grid item>{this.state.message}</Grid>\r\n              <Grid item>\r\n                {this.state.errors.map((e, key) => {\r\n                  return (<div key={key}>{e}</div>);\r\n                })}\r\n              </Grid>\r\n              <Grid item>\r\n                {Object.keys(this.state.fieldValidation).map((fieldName, i) => {\r\n                  if (\r\n                    this.state.fieldValidation[fieldName] !== undefined &&\r\n                    this.state.fieldValidation[fieldName].message.length > 0\r\n                  ) {\r\n                    return (\r\n                      <p className=\"redFont\" key={i}>\r\n                        {this.state.fieldValidation[fieldName].message}\r\n                      </p>\r\n                    );\r\n                  } else {\r\n                    return \"\";\r\n                  }\r\n                })}\r\n              </Grid>\r\n            </Grid>\r\n          }\r\n        </Grid>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst ThingEditPage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default ThingEditPage;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport Button from \"@material-ui/core/Button\";\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport OutlinedInput from '@material-ui/core/OutlinedInput';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport InputAdornment from '@material-ui/core/InputAdornment';\r\nimport Visibility from '@material-ui/icons/Visibility';\r\nimport VisibilityOff from '@material-ui/icons/VisibilityOff';\r\nimport FormHelperText from '@material-ui/core/FormHelperText';\r\nimport API from '../../smartAPI';\r\n\r\n\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      resetPasswordCode: null,\r\n      codeValid: false,\r\n      password: \"\",\r\n      confirmPassword: \"\",\r\n      fieldValidation: { \r\n        password: { valid: true, message: \"\" }, \r\n        confirmPassword: { valid: true, message: \"\" }\r\n      },\r\n      formValid: false,\r\n      message: \"Please wait.  Validating code.\"\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount = () => {\r\n  }\r\n\r\n  handleUserInput = e => {\r\n    const name = e.target.name;\r\n    const value = (e.target.type === \"checkbox\" ? e.target.checked : e.target.value);\r\n    this.setState({ [name]: value });\r\n  };\r\n\r\n  inputBlur = e => {\r\n    const name = e.target.name;\r\n    const validation = this.validateField(name);\r\n    const fieldValidation = this.state.fieldValidation;\r\n    if (fieldValidation[name].valid !== validation.valid) {\r\n      fieldValidation[name].valid = validation.valid;\r\n      fieldValidation[name].message = validation.message;\r\n      this.setState({ fieldValidation: fieldValidation });\r\n    }\r\n  }\r\n\r\n  handleClickShowPassword = () => {\r\n    this.setState({ showPassword: !this.state.showPassword });\r\n  };\r\n\r\n  handleMouseDownPassword = event => {\r\n    event.preventDefault();\r\n  };\r\n\r\n  validateField = (fieldName) => {\r\n    let valid = true;\r\n    let message = \"\";\r\n    let value = this.state[fieldName];\r\n    switch (fieldName) {\r\n      case \"email\":\r\n        valid = value.match(/^([\\w.%+-]+)@([\\w-]+\\.)+([\\w]{2,})$/i) !== null;\r\n        message = valid ? \"\" : \"Email is invalid\";\r\n        break;\r\n      case \"password\":\r\n        valid = value.length >= 6;\r\n        message = valid ? \"\" : \"Password is too short\";\r\n        break;\r\n      case \"confirmEmail\":\r\n        valid = value === this.state.email;\r\n        message = valid ? \"\" : \"Confirm Email doesn't match Email\";\r\n        break;\r\n      case \"confirmPassword\":\r\n        valid = value === this.state.password;\r\n        message = valid ? \"\" : \"Confirm Password doesn't match Password\";\r\n        break;\r\n      case \"username\":\r\n        valid = value.length >= 2;\r\n        message = valid ? \"\" : \"Username is too short\";\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    const response = { valid: valid, message: message };\r\n    return response;\r\n  };\r\n\r\n  validateForm = (respond) => {\r\n    const passwordValid = this.validateField(\"password\");\r\n    const confirmPasswordValid = this.validateField(\"confirmPassword\");\r\n    const formValid = \r\n      passwordValid.valid && \r\n      confirmPasswordValid.valid;\r\n    const fieldValidation = this.state.fieldValidation;\r\n    fieldValidation.password = passwordValid;\r\n    fieldValidation.confirmPassword = confirmPasswordValid;\r\n    this.setState({ \r\n      formValid: formValid,\r\n      fieldValidation: fieldValidation\r\n    }, respond);\r\n  }\r\n\r\n  onSubmit = () => {\r\n    function respond() {\r\n      if (this.state.formValid) {\r\n        this.setState({ waiting: true },\r\n          this.submitThroughAPI);\r\n      }\r\n    }\r\n\r\n    this.validateForm(respond);\r\n  };\r\n\r\n  submitThroughAPI = () => {\r\n    this.api.resetPassword(this.state.resetPasswordCode, this.state.password).then(res => {\r\n      this.setState({ \r\n        message: res.message,\r\n        waiting: false\r\n      });\r\n    })\r\n    .catch(err => console.log(err));\r\n  }\r\n\r\n  render() {\r\n    if (this.state.resetPasswordCode === null) {\r\n      const { id } = this.props.match.params;\r\n      setTimeout(() => {\r\n        this.api.checkResetPasswordCode(id).then(res => {\r\n          if (res.error !== undefined) {\r\n            this.setState({resetPasswordCode: id, codeValid: false, message: res.error});\r\n          }\r\n          else {\r\n            this.setState({resetPasswordCode: id, codeValid: true, message: \"\"});\r\n          }\r\n        });\r\n      }, 500);\r\n      return (\r\n        <div>\r\n          <h2>Reset Password</h2>\r\n          {this.state.message}\r\n        </div>\r\n      );\r\n    }\r\n    else if (this.state.codeValid) {\r\n      return (\r\n        <div>\r\n          <h2>Reset Password</h2>\r\n          <div className=\"row\">\r\n            <div className=\"col-sm-12\">\r\n              <div className=\"row\">\r\n                <div className=\"col-sm-12 margined\">\r\n                  <FormControl variant=\"outlined\"\r\n                      fullWidth>\r\n                    <InputLabel htmlFor=\"outlined-adornment-password\">Password</InputLabel>\r\n                    <OutlinedInput\r\n                      id=\"outlined-adornment-password\"\r\n                      name=\"password\"\r\n                      type={this.state.showPassword ? 'text' : 'password'}\r\n                      value={this.state.password}\r\n                      error={ !this.state.fieldValidation.password.valid }\r\n                      onChange={this.handleUserInput}\r\n                      onBlur={this.inputBlur}\r\n                      endAdornment={\r\n                        <InputAdornment position=\"end\">\r\n                          <IconButton\r\n                            aria-label=\"toggle password visibility\"\r\n                            onClick={this.handleClickShowPassword}\r\n                            onMouseDown={this.handleMouseDownPassword}\r\n                            edge=\"end\"\r\n                          >\r\n                            {this.state.showPassword ? <Visibility /> : <VisibilityOff />}\r\n                          </IconButton>\r\n                        </InputAdornment>\r\n                      }\r\n                      labelWidth={70}\r\n                      fullWidth\r\n                    />\r\n                    <FormHelperText>{ this.state.fieldValidation.password.message }</FormHelperText>\r\n                  </FormControl>\r\n                </div>\r\n              </div>\r\n              <div className=\"row\">\r\n                <div className=\"col-sm-12 margined\">\r\n                  <FormControl variant=\"outlined\"\r\n                      fullWidth>\r\n                    <InputLabel htmlFor=\"confirm-password\">Confirm Password</InputLabel>\r\n                    <OutlinedInput\r\n                      id=\"confirm-password\"\r\n                      name=\"confirmPassword\"\r\n                      type={this.state.showPassword ? 'text' : 'password'}\r\n                      value={this.state.confirmPassword}\r\n                      error={ !this.state.fieldValidation.confirmPassword.valid }\r\n                      onChange={this.handleUserInput}\r\n                      onBlur={this.inputBlur}\r\n                      endAdornment={\r\n                        <InputAdornment position=\"end\">\r\n                          <IconButton\r\n                            aria-label=\"toggle password visibility\"\r\n                            onClick={this.handleClickShowPassword}\r\n                            onMouseDown={this.handleMouseDownPassword}\r\n                            edge=\"end\"\r\n                          >\r\n                            {this.state.showPassword ? <Visibility /> : <VisibilityOff />}\r\n                          </IconButton>\r\n                        </InputAdornment>\r\n                      }\r\n                      labelWidth={130}\r\n                      fullWidth\r\n                    />\r\n                    <FormHelperText>{ this.state.fieldValidation.confirmPassword.message }</FormHelperText>\r\n                  </FormControl>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"row\">\r\n            <div className=\"col-sm-12\">\r\n              <div className=\"float-right\">\r\n                <Button className=\"w200\" disabled={this.state.waiting}\r\n                  onClick={this.onSubmit}\r\n                  type=\"submit\">{this.state.waiting ? \"Please Wait\" : \"Submit\"}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {this.state.message}\r\n          {\r\n            Object.keys(this.state.fieldValidation).map((fieldName, i) => {\r\n              if (this.state.fieldValidation[fieldName] !== undefined && this.state.fieldValidation[fieldName].message.length > 0) {\r\n                return (\r\n                  <p className=\"redFont\" key={i}>\r\n                    {this.state.fieldValidation[fieldName].message}\r\n                  </p>\r\n                );\r\n              } else {\r\n                return \"\";\r\n              }\r\n            })\r\n          }\r\n        </div>\r\n      );\r\n    }\r\n    else {\r\n      return (\r\n        <div>\r\n          <h2>Reset Password</h2>\r\n          {this.state.message}\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst ResetPasswordPage = connect()(Page);\r\nexport default ResetPasswordPage;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport API from '../../smartAPI';\r\n\r\n\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      confirmEmailCode: null,\r\n      codeValid: false,\r\n      message: \"Please wait.  Validating code.\"\r\n    };\r\n    this.api = API.getInstance();\r\n  }\r\n\r\n  componentDidMount = () => {\r\n  }\r\n\r\n  render() {\r\n    if (this.state.confirmEmailCode === null) {\r\n      const { id } = this.props.match.params;\r\n      setTimeout(() => {\r\n        this.api.confirmEmail(id).then(res => {\r\n          if (res.error !== undefined) {\r\n            this.setState({confirmEmailCode: id, codeValid: false, message: res.error});\r\n          }\r\n          else {\r\n            this.setState({confirmEmailCode: id, codeValid: true, message: res.message});\r\n          }\r\n        });\r\n      }, 500);\r\n    }\r\n    return (\r\n      <div>\r\n        <h2>Confirming Email</h2>\r\n        {this.state.message}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst ConfirmEmailPage = connect()(Page);\r\nexport default ConfirmEmailPage;\r\n","import React, { Component } from \"react\";\r\n// import { Redirect } from \"react-router-dom\";\r\nimport { \r\n  Route, \r\n  Switch } from \"react-router-dom\";\r\n  import { connect } from \"react-redux\";\r\nimport HomePage from \"./Home\";\r\nimport GeneralDiscussionPage from \"./Discussion/GeneralDiscussion\";\r\nimport ProfilePage from \"./User/Profile\";\r\n// import UserEditPage from \"./User/Edit\";\r\nimport WorldDetailsPage from \"./World/Details\";\r\nimport WorldEditPage from \"./World/Edit\";\r\nimport CollaboratePage from \"./World/Collaborate\";\r\nimport EditCollaboratorsPage from \"./World/EditCollaborators\";\r\n// import WorldDeletePage from \"./World/Delete\";\r\nimport TypeDetailsPage from \"./Type/Details\";\r\nimport TypeEditPage from \"./Type/Edit\";\r\n// import TypeDeletePage from \"./Type/Delete\";\r\nimport ThingDetailsPage from \"./Thing/Details\";\r\nimport ThingEditPage from \"./Thing/Edit\";\r\nimport ResetPasswordPage from \"./User/ResetPassword\";\r\nimport ConfirmEmailPage from \"./User/ConfirmEmail\";\r\n// import ThingDeletePage from \"./Thing/Delete\";\r\nimport Grid from \"@material-ui/core/Grid\";\r\nimport LoginControl from './User/LoginControl';\r\nimport {\r\n  toggleLogin\r\n} from \"../redux/actions/index\";\r\n\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    loginOpen: state.app.loginOpen\r\n  };\r\n};\r\nfunction mapDispatchToProps(dispatch) {\r\n  return {\r\n    toggleLogin: () => dispatch(toggleLogin({}))\r\n  };\r\n}\r\nclass Page extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      version: \"0\"\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Grid item xs={12} className=\"h-100 margined\">\r\n        { this.props.loginOpen ?\r\n          <LoginControl onLogin={_ => { \r\n            this.props.toggleLogin();\r\n          }}/>\r\n        :\r\n          <Switch>\r\n            {/* <Route exact path=\"/Template\" component={TemplatePage} /> */}\r\n            <Route exact path=\"/\" component={HomePage} />\r\n            <Route exact path=\"/home\" component={HomePage} />\r\n            <Route exact path=\"/User/Profile\" component={ProfilePage} />\r\n            <Route exact path=\"/User/resetPassword/:id\" component={ResetPasswordPage} />\r\n            <Route exact path=\"/User/confirmEmail/:id\" component={ConfirmEmailPage} />\r\n            {/* <Route exact path=\"/profile\" component={UserEditPage} /> */}\r\n            \r\n            {/* <Route exact path=\"/test/:testtext\" component={Test} /> */}\r\n            <Route exact path=\"/discussion\" component={GeneralDiscussionPage} />\r\n            <Route exact path=\"/world/details/:id\" component={WorldDetailsPage} />\r\n            <Route exact path=\"/world/create\" component={WorldEditPage} />\r\n            <Route exact path=\"/world/edit/:id\" component={WorldEditPage} />\r\n            <Route exact path=\"/world/collaborators/:id\" component={EditCollaboratorsPage} />\r\n            <Route exact path=\"/world/collaborate/:worldID/:collabID\" component={CollaboratePage} />\r\n            {/* <Route exact path=\"/world/delete/:id\" component={WorldDeletePage} /> */}\r\n            <Route exact path=\"/type/create\" component={TypeEditPage} />\r\n            <Route exact path=\"/type/details/:id\" component={TypeDetailsPage} />\r\n            <Route exact path=\"/type/edit/:id\" component={TypeEditPage} />\r\n            {/* <Route exact path=\"/type/delete/:id\" component={TypeDeletePage} /> */}\r\n            <Route exact path=\"/thing/create\" component={ThingEditPage} />\r\n            <Route exact path=\"/thing/create/:id\" component={ThingEditPage} />\r\n            <Route exact path=\"/thing/details/:id\" component={ThingDetailsPage} />\r\n            <Route exact path=\"/thing/edit/:id\" component={ThingEditPage} />\r\n            {/* <Route exact path=\"/thing/delete/:id\" component={ThingDeletePage} /> */}\r\n          </Switch>\r\n        }\r\n      </Grid>\r\n    );\r\n  }\r\n}\r\n\r\nconst MainPage = connect(mapStateToProps, mapDispatchToProps)(Page);\r\nexport default MainPage;\r\n","\nimport React, { Component } from \"react\";\nimport \"./assets/css/material-dashboard-react.css\";\nimport {\n  BrowserRouter as Router\n} from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport NavBar from \"./components/Navigation/Navbar\";\nimport Sidebar from \"./components/Navigation/Sidebar\";\nimport MainPage from \"./views/MainPage\";\nimport Grid from \"@material-ui/core/Grid\";\nimport Box from \"@material-ui/core/Box\";\nimport { \n  setWidth,\n  setAPI\n} from \"./redux/actions/index\";\nimport API from \"./smartAPI\";\n\nconst mapStateToProps = state => {\n  return {\n    menuOpen: state.app.menuOpen,\n    api: state.app.api\n  };\n};\nfunction mapDispatchToProps(dispatch) {\n  return {\n    setWidth: width => dispatch(setWidth(width)),\n    setAPI: api => dispatch(setAPI(api))\n  };\n}\nclass AppLayout extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      version: \"0\",\n      width: 0,\n      marginLeft: 220\n    };\n    this.api = API.getInstance();\n  }\n\n  componentDidMount() {\n    this.updateDimensions();\n    window.addEventListener(\"resize\", this.updateDimensions.bind(this));\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.updateDimensions.bind(this));\n  }\n\n  updateDimensions() {\n    let w = window.innerWidth;\n    if (w >= 600) {\n      w -= 200;\n      this.props.setWidth(w);\n      this.setState({ width: w, marginLeft: 220, innerWidth: window.innerWidth });\n    }\n    else {\n      this.props.setWidth(w);\n      this.setState({ width: w, marginLeft: 0, innerWidth: window.innerWidth });\n    }\n  }\n\n  render() {\n    if (this.props.api === null) {\n      this.props.setAPI(this.api);\n    }\n    return (\n      <Router>\n        {this.props.menuOpen ? \n          <Box display={{ xs: 'none', sm: 'inline' }} className=\"Sidebar\">\n            <Sidebar className=\"\" logoText={\"Author's Notebook\"} />\n          </Box>\n        : \"\" }\n        <Grid container>\n          <Grid item xs={12}\n            style={{ \n              marginLeft: `${this.props.menuOpen ? this.state.marginLeft : 0}px`, \n              width: `${this.props.menuOpen ? this.state.width : this.state.innerWidth}px` \n            }}>\n            <NavBar />\n          </Grid>\n          <Grid item xs={12}\n            style={{ \n              marginLeft: `${this.props.menuOpen ? this.state.marginLeft + 10 : 10}px`, \n              width: `${this.props.menuOpen ? this.state.width - 20 : this.state.innerWidth - 20}px`,\n              marginRight: \"10px\",\n              marginTop: \"10px\" \n            }}>\n            <MainPage />\n          </Grid>\n        </Grid>\n      </Router>\n    );\n  }\n}\n\nconst App = connect(mapStateToProps, mapDispatchToProps)(AppLayout);\nexport default App;\n\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import {\r\n  UPDATE_INDEX_EXPANDED_PANEL,\r\n  SET_API,\r\n  ADD_ARTICLE,\r\n  LOGIN,\r\n  LOGOUT,\r\n  REDIRECT_TO,\r\n  SET_WORLDS,\r\n  SET_PUBLIC_WORLDS,\r\n  SET_TEMPLATES,\r\n  ADD_WORLD,\r\n  UPDATE_WORLD,\r\n  UPDATE_PUBLIC_WORLD_COLLAB,\r\n  SELECT_WORLD,\r\n  SET_TYPES,\r\n  ADD_TYPE,\r\n  SET_THINGS,\r\n  ADD_THING,\r\n  UPDATE_TYPE,\r\n  // UPDATE_ATTRIBUTES_ARR,\r\n  SET_ATTRIBUTES,\r\n  ADD_ATTRIBUTES,\r\n  UPDATE_ATTRIBUTES,\r\n  UPDATE_SELECTED_TYPE,\r\n  UPDATE_THING,\r\n  UPDATE_SELECTED_THING,\r\n  LOAD_FROM_STORAGE,\r\n  TOGGLE_MENU,\r\n  TOGGLE_LOGIN,\r\n  NOT_FROM_LOGIN,\r\n  SET_FOLLOWING_WORLDS,\r\n  SET_WIDTH\r\n} from \"../constants/actionTypes\";\r\n\r\nconst initialState = {\r\n  indexExpandedPanel: false,\r\n  api: null,\r\n  articles: [],\r\n  user: null,\r\n  redirectToURL: null,\r\n  loginError: \"\",\r\n  worlds: [],\r\n  publicWorlds: [],\r\n  followingWorlds: [],\r\n  selectedWorld: null,\r\n  selectedWorldID: null,\r\n  types: [],\r\n  things: [],\r\n  selectedType: null,\r\n  // attributesArr: [],\r\n  // attributes: [],\r\n  attributesByID: {},\r\n  attributesByName: {},\r\n  selectedThing: null,\r\n  loadIt: true,\r\n  menuOpen: true,\r\n  loginOpen: false,\r\n  fromLogin: false,\r\n  width: 0,\r\n  templates: []\r\n};\r\nfunction rootReducer(state = initialState, action) {\r\n  if (action.type === UPDATE_INDEX_EXPANDED_PANEL) {\r\n    return Object.assign({}, state, {\r\n      indexExpandedPanel: action.payload\r\n    });\r\n  } else if (action.type === LOAD_FROM_STORAGE) {\r\n    let user = JSON.parse(sessionStorage.getItem(\"user\"));\r\n    if (user !== undefined && user !== null && user.body !== undefined && user.body.user !== undefined)\r\n      user = user.body.user;\r\n    else \r\n      user = null;\r\n    // const worlds = JSON.parse(sessionStorage.getItem(\"worlds\"));\r\n    // const publicWorlds = JSON.parse(sessionStorage.getItem(\"publicWorlds\"));\r\n    const selectedWorld = JSON.parse(sessionStorage.getItem(\"selectedWorld\"));\r\n    const selectedWorldID = sessionStorage.getItem(\"selectedWorldID\");\r\n    const types = JSON.parse(sessionStorage.getItem(\"types\"));\r\n    const things = JSON.parse(sessionStorage.getItem(\"things\"));\r\n    const followingWorlds = JSON.parse(sessionStorage.getItem(\"followingWorlds\"));\r\n    // const attributes = JSON.parse(sessionStorage.getItem(\"attributes\"));\r\n    const attributesByID = JSON.parse(sessionStorage.getItem(\"attributesByID\"));\r\n    const attributesByName = JSON.parse(sessionStorage.getItem(\"attributesByName\"));\r\n    \r\n    return Object.assign({}, state, {\r\n      user: user,\r\n      // worlds: worlds === null ? [] : worlds,\r\n      // publicWorlds: publicWorlds === null ? [] : publicWorlds,\r\n      selectedWorld,\r\n      selectedWorldID,\r\n      types: types === null ? [] : types,\r\n      things: things === null ? [] : things,\r\n      followingWorlds: followingWorlds === null ? [] : followingWorlds,\r\n      // attributes: attributes === null ? [] : attributes,\r\n      attributesByID: attributesByID === null ? {} : attributesByID,\r\n      attributesByName: attributesByName === null ? {} : attributesByName,\r\n    });\r\n  } else if (action.type === SET_API) {\r\n    return Object.assign({}, state, {\r\n      api: action.payload\r\n    });\r\n  } else if (action.type === ADD_ARTICLE) {\r\n    return Object.assign({}, state, {\r\n      articles: state.articles.concat(action.payload)\r\n    });\r\n  } else if (action.type === LOGIN) {\r\n    // sessionStorage.setItem(\"user\", JSON.stringify(action.payload));\r\n    sessionStorage.setItem(\"followingWorlds\", JSON.stringify(action.payload.followingWorlds));\r\n    return Object.assign({}, state, {\r\n      user: action.payload, \r\n      followingWorlds: action.payload.followingWorlds\r\n    });\r\n  } else if (action.type === LOGOUT) {\r\n    // sessionStorage.removeItem(\"user\");\r\n    return Object.assign({}, state, {\r\n      user: null\r\n    });\r\n  } else if (action.type === REDIRECT_TO) {\r\n    return Object.assign({}, state, {\r\n      redirectToURL: action.payload\r\n    });\r\n  } else if (action.type === SET_WORLDS) {\r\n    if (action.payload !== undefined && action.payload.error === undefined){\r\n      // sessionStorage.setItem(\"worlds\", JSON.stringify(action.payload));\r\n      if (state.selectedWorldID !== null && state.selectedWorld === null) {\r\n        const worldArr = action.payload.filter(\r\n          world => world._id === state.selectedWorldID\r\n        );\r\n        if (worldArr.length > 0) {\r\n          let world = worldArr[0];\r\n          sessionStorage.setItem(\"selectedWorld\", JSON.stringify(world));\r\n          return Object.assign({}, state, {\r\n            worlds: action.payload,\r\n            selectedWorld: world,\r\n            // attributes: [],\r\n            // attributesByID: {},\r\n            // attributesByName: {}\r\n          });\r\n        } else {\r\n          return Object.assign({}, state, {\r\n            worlds: action.payload,\r\n            // attributes: [],\r\n            // attributesByID: {},\r\n            // attributesByName: {}\r\n          });\r\n        }\r\n      } else {\r\n        return Object.assign({}, state, {\r\n          worlds: action.payload,\r\n          // attributes: [],\r\n          // attributesByID: {},\r\n          // attributesByName: {}\r\n        });\r\n      }\r\n    }\r\n    else {\r\n      return Object.assign({}, state, {});\r\n    }\r\n  } else if (action.type === SET_PUBLIC_WORLDS) {\r\n    if (action.payload.error === undefined) {\r\n      // sessionStorage.setItem(\"publicWorlds\", JSON.stringify(action.payload));\r\n      if (state.selectedWorldID !== null && state.selectedWorld === null) {\r\n        const worldArr = action.payload.filter(\r\n          world => world._id === state.selectedWorldID\r\n        );\r\n        if (worldArr.length > 0) {\r\n          let world = worldArr[0];\r\n          sessionStorage.setItem(\"selectedWorld\", JSON.stringify(world));\r\n          return Object.assign({}, state, {\r\n            publicWorlds: action.payload,\r\n            selectedWorld: world,\r\n            // attributes: [],\r\n            // attributesByID: {},\r\n            // attributesByName: {}\r\n          });\r\n        } else {\r\n          return Object.assign({}, state, {\r\n            publicWorlds: action.payload\r\n          });\r\n        }\r\n      } else {\r\n        return Object.assign({}, state, {\r\n          publicWorlds: action.payload\r\n        });\r\n      }\r\n    }\r\n    else {\r\n      return Object.assign({}, state, {});\r\n    }\r\n  } else if (action.type === SET_TEMPLATES) {\r\n    return Object.assign({}, state, {\r\n      templates: action.payload\r\n    });\r\n  } else if (action.type === ADD_WORLD) {\r\n    if (action.payload.Public) {\r\n      const worlds = state.worlds.concat(action.payload);\r\n      const publicWorlds = state.publicWorlds.concat(action.payload);\r\n      // sessionStorage.setItem(\"worlds\", JSON.stringify(worlds));\r\n      // sessionStorage.setItem(\"publicWorlds\", JSON.stringify(publicWorlds));\r\n      return Object.assign({}, state, {\r\n        worlds,\r\n        publicWorlds\r\n      });\r\n    } else {\r\n      // const worlds = state.worlds.concat(action.payload);\r\n      // sessionStorage.setItem(\"worlds\", JSON.stringify(worlds));\r\n      return Object.assign({}, state, {\r\n        worlds: state.worlds.concat(action.payload)\r\n      });\r\n    }\r\n  } else if (action.type === UPDATE_WORLD) {\r\n    const worlds = [...state.worlds];\r\n    let publicWorlds = [...state.publicWorlds];\r\n    const world = worlds.filter(t => t._id === action.payload._id)[0];\r\n    world.Name = action.payload.Name;\r\n    world.Description = action.payload.Description;\r\n    const wasPublic = world.Public;\r\n    world.Public = action.payload.Public;\r\n    world.AcceptingCollaborators = action.payload.AcceptingCollaborators;\r\n    world.Collaborators = action.payload.Collaborators;\r\n    // sessionStorage.setItem(\"worlds\", JSON.stringify(worlds));\r\n    if (world.Public) {\r\n      if (wasPublic) {\r\n        // It was already public so we just need to update the name\r\n        const publicWorld = publicWorlds.filter(t => t._id === world._id)[0];\r\n        publicWorld.Name = world.Name;\r\n      }\r\n      else {\r\n        // It's been changed to public, so we need to add it\r\n        publicWorlds = publicWorlds.concat(world);\r\n      }\r\n      // sessionStorage.setItem(\"publicWorlds\", JSON.stringify(publicWorlds));\r\n      return Object.assign({}, state, {\r\n        worlds,\r\n        publicWorlds\r\n      });\r\n    } else {\r\n      if (wasPublic) {\r\n        // It used to be public, so we need to remove it\r\n        publicWorlds = publicWorlds.filter(t => t._id !== world._id);\r\n        // sessionStorage.setItem(\"publicWorlds\", JSON.stringify(publicWorlds));\r\n        return Object.assign({}, state, {\r\n          worlds,\r\n          publicWorlds\r\n        });\r\n      }\r\n      else {\r\n        // It's still not public, so we can leave it\r\n        return Object.assign({}, state, {\r\n          worlds\r\n        });\r\n      }\r\n    }\r\n  } else if (action.type === UPDATE_PUBLIC_WORLD_COLLAB) {\r\n    let publicWorlds = [...state.publicWorlds];\r\n    const world = publicWorlds.filter(t => t._id === action.payload._id)[0];\r\n    world.Collaborators = action.payload.Collaborators;\r\n    // sessionStorage.setItem(\"publicWorlds\", JSON.stringify(publicWorlds));\r\n    return Object.assign({}, state, {\r\n      publicWorlds\r\n    });\r\n  } else if (action.type === SELECT_WORLD) {\r\n    let world = state.worlds.filter(world => world._id === action.payload);\r\n    if (world.length === 0)\r\n      world = state.publicWorlds.filter(world => world._id === action.payload);\r\n    if (world.length > 0) {\r\n      sessionStorage.setItem(\"selectedWorldID\", action.payload);\r\n      sessionStorage.setItem(\"selectedWorld\", JSON.stringify(world[0]));\r\n      return Object.assign({}, state, {\r\n        selectedWorldID: action.payload,\r\n        selectedWorld: world[0],\r\n        // attributes: [],\r\n        attributesByID: {},\r\n        attributesByName: {}\r\n      });\r\n    } else {\r\n      sessionStorage.setItem(\"selectedWorldID\", action.payload);\r\n      sessionStorage.removeItem(\"selectedWorld\");\r\n      return Object.assign({}, state, {\r\n        selectedWorldID: action.payload,\r\n        selectedWorld: null,\r\n        // attributes: [],\r\n        attributesByID: {},\r\n        attributesByName: {}\r\n      });\r\n    }\r\n  } else if (action.type === SET_ATTRIBUTES) {\r\n    const attributesByID = {};\r\n    const attributesByName = {};\r\n    action.payload.forEach(attribute => {\r\n      attributesByID[attribute._id] = attribute;\r\n      attributesByName[attribute.Name] = attribute;\r\n    });\r\n    \r\n    // sessionStorage.setItem(\"attributes\", JSON.stringify(action.payload));\r\n    sessionStorage.setItem(\"attributesByID\", JSON.stringify(attributesByID));\r\n    sessionStorage.setItem(\"attributesByName\", JSON.stringify(attributesByName));\r\n\r\n    return Object.assign({}, state, {\r\n      // attributes: action.payload,\r\n      attributesByID: attributesByID,\r\n      attributesByName: attributesByName\r\n    });\r\n  } else if (action.type === UPDATE_ATTRIBUTES) {\r\n    const attributesByID = state.attributesByID;\r\n    const attributesByName = state.attributesByName;\r\n    action.payload.forEach(attribute => {\r\n      attributesByID[attribute._id] = attribute;\r\n      attributesByName[attribute.Name] = attribute;\r\n    });\r\n    \r\n    // sessionStorage.setItem(\"attributes\", JSON.stringify(action.payload));\r\n    sessionStorage.setItem(\"attributesByID\", JSON.stringify(attributesByID));\r\n    sessionStorage.setItem(\"attributesByName\", JSON.stringify(attributesByName));\r\n\r\n    return Object.assign({}, state, {\r\n      // attributes: action.payload,\r\n      attributesByID: attributesByID,\r\n      attributesByName: attributesByName\r\n    });\r\n  } else if (action.type === ADD_ATTRIBUTES) {\r\n    // const attributes = state.attributes.concat(action.payload);\r\n    const attributesByID = state.attributesByID;\r\n    const attributesByName = state.attributesByName;\r\n    action.payload.forEach(attribute => {\r\n      attributesByID[attribute._id] = attribute;\r\n      attributesByName[attribute.Name] = attribute;\r\n    });\r\n    \r\n    // sessionStorage.setItem(\"attributes\", JSON.stringify(attributes));\r\n    sessionStorage.setItem(\"attributesByID\", JSON.stringify(attributesByID));\r\n    sessionStorage.setItem(\"attributesByName\", JSON.stringify(attributesByName));\r\n    \r\n    return Object.assign({}, state, {\r\n      // attributes: attributes,\r\n      attributesByID: attributesByID,\r\n      attributesByName: attributesByName\r\n    });\r\n  } else if (action.type === SET_TYPES) {\r\n    sessionStorage.setItem(\"types\", JSON.stringify(action.payload));\r\n    return Object.assign({}, state, {\r\n      types: action.payload\r\n    });\r\n  } else if (action.type === ADD_TYPE) {\r\n    const types = state.types.concat(action.payload);\r\n    sessionStorage.setItem(\"types\", JSON.stringify(types));\r\n    return Object.assign({}, state, {\r\n      types: types\r\n    });\r\n  } else if (action.type === SET_THINGS) {\r\n    sessionStorage.setItem(\"things\", JSON.stringify(action.payload));\r\n    return Object.assign({}, state, {\r\n      things: action.payload\r\n    });\r\n  } else if (action.type === ADD_THING) {\r\n    const things = state.things.concat(action.payload);\r\n    sessionStorage.setItem(\"things\", JSON.stringify(things));\r\n    return Object.assign({}, state, {\r\n      things: things\r\n    });\r\n  } else if (action.type === UPDATE_SELECTED_TYPE) {\r\n    // This is because Redux won't cause a rerender\r\n    // on changes to arrays.\r\n    const changedType = { ...action.payload, changedAt: Date.now() };\r\n    return Object.assign({}, state, {\r\n      selectedType: changedType\r\n    });\r\n  } else if (action.type === UPDATE_TYPE) {\r\n    const types = [...state.types];\r\n    const type = types.filter(t => t._id === action.payload._id)[0];\r\n    type.Name = action.payload.Name;\r\n    type.Description = action.payload.Description;\r\n    type.Supers = action.payload.Supers;\r\n    type.AttributesArr = action.payload.AttributesArr;\r\n    type.Attributes = action.payload.Attributes;\r\n    sessionStorage.setItem(\"types\", JSON.stringify(types));\r\n    return Object.assign({}, state, {\r\n      types: types\r\n    });\r\n  // } else if (action.type === UPDATE_ATTRIBUTES_ARR) {\r\n  //   return Object.assign({}, state, {\r\n  //     attributesArr: action.payload\r\n  //   });\r\n  } else if (action.type === UPDATE_SELECTED_THING) {\r\n    // This is because Redux won't cause a rerender\r\n    // on changes to arrays.\r\n    const changedThing = { ...action.payload, changedAt: Date.now() };\r\n    return Object.assign({}, state, {\r\n      selectedThing: changedThing\r\n    });\r\n  } else if (action.type === UPDATE_THING) {\r\n    const things = [...state.things];\r\n    const thing = things.filter(t => t._id === action.payload._id)[0];\r\n    thing.Name = action.payload.Name;\r\n    thing.Description = action.payload.Description;\r\n    thing.Types = action.payload.Types;\r\n    thing.Attributes = action.payload.Attributes;\r\n    sessionStorage.setItem(\"things\", JSON.stringify(things));\r\n    return Object.assign({}, state, {\r\n      things: things\r\n    });\r\n  } else if (action.type === TOGGLE_MENU) {\r\n    return Object.assign({}, state, {\r\n      menuOpen: !state.menuOpen\r\n    });\r\n  } else if (action.type === TOGGLE_LOGIN) {\r\n    return Object.assign({}, state, {\r\n      fromLogin: state.loginOpen,\r\n      loginOpen: !state.loginOpen\r\n    });\r\n  } else if (action.type === NOT_FROM_LOGIN) {\r\n    return Object.assign({}, state, {\r\n      fromLogin: false\r\n    });\r\n  } else if (action.type === SET_WIDTH) {\r\n    return Object.assign({}, state, {\r\n      width: action.payload\r\n    });\r\n  } else if (action.type === SET_FOLLOWING_WORLDS) {\r\n    sessionStorage.setItem(\"followingWorlds\", JSON.stringify(action.payload));\r\n    return Object.assign({}, state, {\r\n      followingWorlds: action.payload\r\n    });\r\n  }\r\n  return state;\r\n}\r\n\r\nexport default rootReducer;\r\n\r\nexport const login = (user, history) => {};\r\n\r\nexport const logout = history => {};\r\n","import { createStore, combineReducers } from \"redux\";\r\nimport { sessionService, sessionReducer } from \"redux-react-session\";\r\nimport rootReducer from \"../reducers/index\";\r\nconst reducers = {\r\n  app: rootReducer,\r\n  session: sessionReducer\r\n};\r\n\r\nconst reducer = combineReducers(reducers);\r\nconst store = createStore(reducer);\r\nconst validateSession = session => {\r\n  // check if your session is still valid\r\n  return true;\r\n};\r\nconst options = {\r\n  refreshFromLocalStorage: true,\r\n  refreshOnCheckAuth: true,\r\n  redirectPath: \"/home\",\r\n  driver: \"COOKIES\",\r\n  validateSession\r\n};\r\n\r\nsessionService\r\n  .initSessionService(store, options)\r\n  .then(() =>\r\n    console.log(\r\n      \"Redux React Session is ready and a session was refreshed from your storage\"\r\n    )\r\n  )\r\n  .catch(() =>\r\n    console.log(\r\n      \"Redux React Session is ready and there is no session in your storage\"\r\n    )\r\n  );\r\nexport default store;\r\n","// import React from 'react';\n// import ReactDOM from 'react-dom';\n// import './index.css';\n// import App from './App';\n// import * as serviceWorker from './serviceWorker';\n\n// ReactDOM.render(<App />, document.getElementById('root'));\n\n// // If you want your app to work offline and load faster, you can change\n// // unregister() to register() below. Note this comes with some pitfalls.\n// // Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport * as serviceWorker from \"./serviceWorker\";\nimport { Provider } from \"react-redux\";\nimport store from \"./redux/store/index\";\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}